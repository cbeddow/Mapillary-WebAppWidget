!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Mapillary=e()}}(function(){var e;return function t(e,r,n){function i(s,a){if(!r[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var h=r[s]={exports:{}};e[s][0].call(h.exports,function(t){var r=e[s][1][t];return i(r?r:t)},h,h.exports,t,e,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){},{}],2:[function(e,t,r){(function(e){function t(e,t){for(var r=0,n=e.length-1;n>=0;n--){var i=e[n];"."===i?e.splice(n,1):".."===i?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}function n(e,t){if(e.filter)return e.filter(t);for(var r=[],n=0;n<e.length;n++)t(e[n],n,e)&&r.push(e[n]);return r}var i=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(e){return i.exec(e).slice(1)};r.resolve=function(){for(var r="",i=!1,o=arguments.length-1;o>=-1&&!i;o--){var s=o>=0?arguments[o]:e.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(r=s+"/"+r,i="/"===s.charAt(0))}return r=t(n(r.split("/"),function(e){return!!e}),!i).join("/"),(i?"/":"")+r||"."},r.normalize=function(e){var i=r.isAbsolute(e),o="/"===s(e,-1);return e=t(n(e.split("/"),function(e){return!!e}),!i).join("/"),e||i||(e="."),e&&o&&(e+="/"),(i?"/":"")+e},r.isAbsolute=function(e){return"/"===e.charAt(0)},r.join=function(){var e=Array.prototype.slice.call(arguments,0);return r.normalize(n(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},r.relative=function(e,t){function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=r.resolve(e).substr(1),t=r.resolve(t).substr(1);for(var i=n(e.split("/")),o=n(t.split("/")),s=Math.min(i.length,o.length),a=s,u=0;s>u;u++)if(i[u]!==o[u]){a=u;break}for(var c=[],u=a;u<i.length;u++)c.push("..");return c=c.concat(o.slice(a)),c.join("/")},r.sep="/",r.delimiter=":",r.dirname=function(e){var t=o(e),r=t[0],n=t[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},r.basename=function(e,t){var r=o(e)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},r.extname=function(e){return o(e)[3]};var s="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return 0>t&&(t=e.length+t),e.substr(t,r)}}).call(this,e("_process"))},{_process:3}],3:[function(e,t,r){function n(){h=!1,a.length?c=a.concat(c):l=-1,c.length&&i()}function i(){if(!h){var e=setTimeout(n);h=!0;for(var t=c.length;t;){for(a=c,c=[];++l<t;)a&&a[l].run();l=-1,t=c.length}a=null,h=!1,clearTimeout(e)}}function o(e,t){this.fun=e,this.array=t}function s(){}var a,u=t.exports={},c=[],h=!1,l=-1;u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new o(e,t)),1!==c.length||h||setTimeout(i,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=s,u.addListener=s,u.once=s,u.off=s,u.removeListener=s,u.removeAllListeners=s,u.emit=s,u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],4:[function(e,t,r){"use strict";function n(e,t){var r;for(r in t)e[r]=t[r];return e}function i(e,t){if(this._jsongUrl=e,"number"==typeof t){var r={timeout:t};t=r}this._config=n({timeout:15e3,headers:{}},t||{})}var o=e("./request"),s=e("./buildQueryObject");Array.isArray;i.prototype={constructor:i,buildQueryObject:s,get:function(e){var t="GET",r=this.buildQueryObject(this._jsongUrl,t,{paths:e,method:"get"}),i=n(r,this._config),s=this;return o(t,i,s)},set:function(e){var t="POST",r=this.buildQueryObject(this._jsongUrl,t,{jsonGraph:e,method:"set"}),i=n(r,this._config);i.headers["Content-Type"]="application/x-www-form-urlencoded";var s=this;return o(t,i,s)},call:function(e,t,r,i){t=t||[],r=r||[],i=i||[];var s="POST",a=[];a.push("method=call"),a.push("callPath="+encodeURIComponent(JSON.stringify(e))),a.push("arguments="+encodeURIComponent(JSON.stringify(t))),a.push("pathSuffixes="+encodeURIComponent(JSON.stringify(r))),a.push("paths="+encodeURIComponent(JSON.stringify(i)));var u=this.buildQueryObject(this._jsongUrl,s,a.join("&")),c=n(u,this._config);c.headers["Content-Type"]="application/x-www-form-urlencoded";var h=this;return o(s,c,h)}},i.XMLHttpSource=i,i["default"]=i,t.exports=i},{"./buildQueryObject":5,"./request":8}],5:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i=[],o={url:e},s=-1!==e.indexOf("?"),a=s?"&":"?";return"string"==typeof r?i.push(r):(n=Object.keys(r),n.forEach(function(e){var t="object"==typeof r[e]?JSON.stringify(r[e]):r[e];i.push(e+"="+encodeURIComponent(t))})),"GET"===t?o.url+=a+i.join("&"):o.data=i.join("&"),o}},{}],6:[function(e,t,r){(function(e){"use strict";t.exports=function(){var t=new e.XMLHttpRequest;if("withCredentials"in t)return t;if(e.XDomainRequest)return new XDomainRequest;throw new Error("CORS is not supported by your browser")}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(e,t,r){(function(e){"use strict";t.exports=function(){var t,r,n;if(e.XMLHttpRequest)return new e.XMLHttpRequest;try{for(r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],n=0;3>n;n++)try{if(t=r[n],new e.ActiveXObject(t))break}catch(i){}return new e.ActiveXObject(t)}catch(i){throw new Error("XMLHttpRequest is not supported by your browser")}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(e,t,r){"use strict";function n(){}function i(e,t,r){return n.create(function(n){var i,o,l,p,f,d={method:e||"GET",crossDomain:!1,async:!0,headers:{},responseType:"json"};for(f in t)h.call(t,f)&&(d[f]=t[f]);d.crossDomain||d.headers["X-Requested-With"]||(d.headers["X-Requested-With"]="XMLHttpRequest"),null!=r.onBeforeRequest&&r.onBeforeRequest(d);try{i=d.crossDomain?c():u()}catch(m){n.onError(m)}try{d.user?i.open(d.method,d.url,d.async,d.user,d.password):i.open(d.method,d.url,d.async),i.timeout=d.timeout,i.withCredentials=d.withCredentials!==!1,l=d.headers;for(p in l)h.call(l,p)&&i.setRequestHeader(p,l[p]);if(d.responseType)try{i.responseType=d.responseType}catch(v){if("json"!==d.responseType)throw v}i.onreadystatechange=function(e){4===i.readyState&&(o||(o=!0,s(n,i,e)))},i.ontimeout=function(e){o||(o=!0,a(n,i,"timeout error",e))},i.send(d.data)}catch(v){n.onError(v)}return function(){o||4===i.readyState||(o=!0,i.abort())}})}function o(e,t,r){r||(r=new Error(t)),e.onError(r)}function s(e,t,r){var n,i;if(t&&e){i=t.responseType,n="response"in t?t.response:t.responseText;var s=1223===t.status?204:t.status;if(s>=200&&399>=s){try{"json"!==i&&(n=JSON.parse(n||"")),"string"==typeof n&&(n=JSON.parse(n||""))}catch(r){o(e,"invalid json",r)}return e.onNext(n),void e.onCompleted()}return 401===s||403===s||407===s?o(e,n):410===s?o(e,n):408===s||504===s?o(e,n):o(e,n||"Response code "+s)}}function a(e,t,r,n){o(e,r||t.statusText||"request error",n)}var u=e("./getXMLHttpRequest"),c=e("./getCORSRequest"),h=Object.prototype.hasOwnProperty,l=function(){};n.create=function(e){var t=new n;return t.subscribe=function(t,r,n){var i,o;return i="function"==typeof t?{onNext:t,onError:r||l,onCompleted:n||l}:t,o=e(i),"function"==typeof o?{dispose:o}:o},t},t.exports=i},{"./getCORSRequest":6,"./getXMLHttpRequest":7}],9:[function(e,t,r){function n(e){var t=e||{};this._root=t._root||new i(t),this._path=t.path||t._path||[],this._scheduler=t.scheduler||t._scheduler||new p,this._source=t.source||t._source,this._request=t.request||t._request||new s(this,this._scheduler),this._ID=E++,"number"==typeof t.maxSize?this._maxSize=t.maxSize:this._maxSize=t._maxSize||n.prototype._maxSize,"number"==typeof t.collectRatio?this._collectRatio=t.collectRatio:this._collectRatio=t._collectRatio||n.prototype._collectRatio,(t.boxed||t.hasOwnProperty("_boxed"))&&(this._boxed=t.boxed||t._boxed),(t.materialized||t.hasOwnProperty("_materialized"))&&(this._materialized=t.materialized||t._materialized),"boolean"==typeof t.treatErrorsAsValues?this._treatErrorsAsValues=t.treatErrorsAsValues:t.hasOwnProperty("_treatErrorsAsValues")&&(this._treatErrorsAsValues=t._treatErrorsAsValues),this._allowFromWhenceYouCame=t.allowFromWhenceYouCame||t._allowFromWhenceYouCame||!1,t.cache&&this.setCache(t.cache)}var i=e("./ModelRoot"),o=e("./ModelDataSourceAdapter"),s=e("./request/RequestQueueV2"),a=e("./response/ModelResponse"),u=e("./response/CallResponse"),c=e("./response/InvalidateResponse"),h=e("./schedulers/ASAPScheduler"),l=e("./schedulers/TimeoutScheduler"),p=e("./schedulers/ImmediateScheduler"),f=e("./support/array-clone"),d=e("./support/array-slice"),m=e("./lru/collect"),v=e("falcor-path-syntax"),g=e("./support/getSize"),y=e("./support/isObject"),_=e("./support/isPrimitive"),b=e("./support/isJSONEnvelope"),x=e("./support/isJSONGraphEnvelope"),w=e("./set/setPathMaps"),S=e("./set/setJSONGraphs"),M=e("falcor-json-graph"),E=0,C=e("./support/validateInput"),T=function(){},A=e("./get/getCache"),P=e("./get"),k=e("./response/get/validInput");t.exports=n,n.ref=M.ref,n.atom=M.atom,n.error=M.error,n.pathValue=M.pathValue,n.prototype.constructor=n,n.prototype._materialized=!1,n.prototype._boxed=!1,n.prototype._progressive=!1,n.prototype._treatErrorsAsValues=!1,n.prototype._maxSize=Math.pow(2,53)-1,n.prototype._collectRatio=.75,n.prototype.get=e("./response/get"),n.prototype._getWithPaths=e("./response/get/getWithPaths"),n.prototype.set=e("./response/set"),n.prototype.preload=function(){var e=C(arguments,k,"preload");if(e!==!0)return new a(function(t){t.onError(e)});var t=Array.prototype.slice.call(arguments),r=this;return new a(function(e){return r.get.apply(r,t).subscribe(function(){},function(t){e.onError(t)},function(){e.onCompleted()})})},n.prototype.call=function(){var e,t=-1,r=arguments.length;for(e=new Array(r);++t<r;){var n=arguments[t];e[t]=n;var i=typeof n;if(t>1&&!Array.isArray(n)||0===t&&!Array.isArray(n)&&"string"!==i||1===t&&!Array.isArray(n)&&!_(n))return new a(function(e){e.onError(new Error("Invalid argument"))})}return new u(this,e[0],e[1],e[2],e[3])},n.prototype.invalidate=function(){var e,t=-1,r=arguments.length;for(e=[];++t<r;)if(e[t]=v.fromPath(arguments[t]),!Array.isArray(e[t]))throw new Error("Invalid argument");new c(this,e).subscribe(T,function(e){throw e})},n.prototype.deref=e("./deref"),n.prototype._hasValidParentReference=e("./deref/hasValidParentReference"),n.prototype.getValue=e("./get/getValue"),n.prototype.setValue=e("./set/setValue"),n.prototype._getValueSync=e("./get/sync"),n.prototype._setValueSync=e("./set/sync"),n.prototype._derefSync=e("./deref/sync"),n.prototype.setCache=function(e){var t=this._root.cache;if(e!==t){var r=this._root,n=this._path;this._path=[],this._root.cache={},"undefined"!=typeof t&&m(r,r.expired,g(t),0);var i;x(e)?i=S(this,[e])[0]:b(e)?i=w(this,[e])[0]:y(e)&&(i=w(this,[{json:e}])[0]),i&&P.getWithPathsAsPathMap(this,i,[]),this._path=n}else"undefined"==typeof t&&(this._root.cache={});return this},n.prototype.getCache=function(){var e=d(arguments);if(0===e.length)return A(this._root.cache);var t=[{}],r=this._path;return P.getWithPathsAsJSONGraph(this,e,t),this._path=r,t[0].jsonGraph},n.prototype.getVersion=function(e){var t=e&&v.fromPath(e)||[];if(Array.isArray(t)===!1)throw new Error("Model#getVersion must be called with an Array path.");return this._path.length&&(t=this._path.concat(t)),this._getVersion(this,t)},n.prototype._syncCheck=function(e){if(Boolean(this._source)&&this._root.syncRefCount<=0&&this._root.unsafeMode===!1)throw new Error("Model#"+e+" may only be called within the context of a request selector.");return!0},n.prototype._clone=function(e){var t=new n(this);for(var r in e){var i=e[r];"delete"===i?delete t[r]:t[r]=i}return t.setCache=void 0,t},n.prototype.batch=function(e){var t=e;"number"==typeof t?t=new l(Math.round(Math.abs(t))):t&&t.schedule||(t=new h);var r=this._clone();return r._request=new s(r,t),r},n.prototype.unbatch=function(){var e=this._clone();return e._request=new s(e,new p),e},n.prototype.treatErrorsAsValues=function(){return this._clone({_treatErrorsAsValues:!0})},n.prototype.asDataSource=function(){return new o(this)},n.prototype._materialize=function(){return this._clone({_materialized:!0})},n.prototype._dematerialize=function(){return this._clone({_materialized:"delete"})},n.prototype.boxValues=function(){return this._clone({_boxed:!0})},n.prototype.unboxValues=function(){return this._clone({_boxed:"delete"})},n.prototype.withoutDataSource=function(){return this._clone({_source:"delete"})},n.prototype.toJSON=function(){return{$type:"ref",value:this._path}},n.prototype.getPath=function(){return f(this._path)},n.prototype._fromWhenceYouCame=function(e){return this._clone({_allowFromWhenceYouCame:void 0===e?!0:e})},n.prototype._getBoundValue=e("./get/getBoundValue"),n.prototype._getVersion=e("./get/getVersion"),n.prototype._getValueSync=e("./get/getValueSync"),n.prototype._getPathValuesAsPathMap=P.getWithPathsAsPathMap,n.prototype._getPathValuesAsJSONG=P.getWithPathsAsJSONGraph,n.prototype._setPathValues=e("./set/setPathValues"),n.prototype._setPathMaps=e("./set/setPathMaps"),n.prototype._setJSONGs=e("./set/setJSONGraphs"),n.prototype._setCache=e("./set/setPathMaps"),n.prototype._invalidatePathValues=e("./invalidate/invalidatePathSets"),n.prototype._invalidatePathMaps=e("./invalidate/invalidatePathMaps")},{"./ModelDataSourceAdapter":10,"./ModelRoot":11,"./deref":13,"./deref/hasValidParentReference":12,"./deref/sync":14,"./get":29,"./get/getBoundValue":23,"./get/getCache":24,"./get/getValue":26,"./get/getValueSync":27,"./get/getVersion":28,"./get/sync":34,"./invalidate/invalidatePathMaps":43,"./invalidate/invalidatePathSets":44,"./lru/collect":45,"./request/RequestQueueV2":49,"./response/CallResponse":55,"./response/InvalidateResponse":56,"./response/ModelResponse":57,"./response/get":62,"./response/get/getWithPaths":61,"./response/get/validInput":63,"./response/set":65,"./schedulers/ASAPScheduler":69,"./schedulers/ImmediateScheduler":70,"./schedulers/TimeoutScheduler":71,"./set/setJSONGraphs":72,"./set/setPathMaps":73,"./set/setPathValues":74,"./set/setValue":75,"./set/sync":76,"./support/array-clone":77,"./support/array-slice":80,"./support/getSize":85,"./support/isJSONEnvelope":95,"./support/isJSONGraphEnvelope":96,"./support/isObject":97,"./support/isPrimitive":99,"./support/validateInput":113,"falcor-json-graph":122,"falcor-path-syntax":126}],10:[function(e,t,r){function n(e){this._model=e._materialize().boxValues().treatErrorsAsValues()}n.prototype.get=function(e){return this._model.get.apply(this._model,e)._toJSONG()},n.prototype.set=function(e){return this._model.set(e)._toJSONG()},n.prototype.call=function(e,t,r,n){var i=[e,t,r].concat(n);return this._model.call.apply(this._model,i)._toJSONG()},t.exports=n},{}],11:[function(e,t,r){function n(e){var t=e||{};this.syncRefCount=0,this.expired=t.expired||[],this.unsafeMode=t.unsafeMode||!1,this.collectionScheduler=t.collectionScheduler||new s,this.cache={},i(t.comparator)&&(this.comparator=t.comparator),i(t.errorSelector)&&(this.errorSelector=t.errorSelector),i(t.onChange)&&(this.onChange=t.onChange)}var i=e("./support/isFunction"),o=e("./support/hasOwn"),s=e("./schedulers/ImmediateScheduler");n.prototype.errorSelector=function(e,t){return t},n.prototype.comparator=function(e,t){return o(e,"value")&&o(t,"value")?e.value===t.value&&e.$type===t.$type&&e.$expires===t.$expires:e===t},t.exports=n},{"./schedulers/ImmediateScheduler":70,"./support/hasOwn":88,"./support/isFunction":93}],12:[function(e,t,r){t.exports=function(){var e=this._referenceContainer;return this._allowFromWhenceYouCame?e===!0?!0:e===!1?!1:e&&void 0===e.ツparent?!1:e&&e.ツinvalidated?!1:!0:!0}},{}],13:[function(e,t,r){var n=e("./../errors/InvalidDerefInputError"),i=e("./../get/getCachePosition"),o="e",s=e("./../types/ref");t.exports=function(e){var t,r=e&&e.$__path,a=e&&e.$__refPath,u=e&&e.$__toReference;if(r){var c=o;if(u&&(c=!1,t=i(this,u),a&&t&&t.$type===s)){var h=t.value,l=0,p=a.length;for(c=!0;c&&p>l;++l)h[l]!==a[l]&&(c=!1)}return c?c===o&&(t=!0):t=!1,this._clone({_path:r,_referenceContainer:t})}throw new n}},{"./../errors/InvalidDerefInputError":16,"./../get/getCachePosition":25,"./../types/ref":117}],14:[function(e,t,r){var n=e("falcor-path-syntax"),i=e("./../get/getBoundValue"),o=e("./../errors/InvalidModelError");t.exports=function(e){var t=n.fromPath(e);if(!Array.isArray(t))throw new Error("Model#derefSync must be called with an Array path.");var r=i(this,this._path.concat(t),!1),s=r.path,a=r.value,u=r.found;if(u&&void 0!==a){if(a.$type)throw new o;return this._clone({_path:s})}}},{"./../errors/InvalidModelError":17,"./../get/getBoundValue":23,"falcor-path-syntax":126}],15:[function(e,t,r){function n(){this.message=n.message,this.stack=(new Error).stack}n.prototype=new Error,n.prototype.name="BoundJSONGraphModelError",n.message="It is not legal to use the JSON Graph format from a bound Model. JSON Graph format can only be used from a root model.",t.exports=n},{}],16:[function(e,t,r){function n(){this.message=o,this.stack=(new Error).stack}var i="InvalidDerefInputError",o="Deref can only be used with a non-primitive object from get, set, or call.";n.prototype=new Error,n.prototype.name=i,n.name=i,n.message=o,t.exports=n},{}],17:[function(e,t,r){function n(e,t){this.message=o,this.stack=(new Error).stack,this.boundPath=e,this.shortedPath=t}var i="InvalidModelError",o="The boundPath of the model is not valid since a value or error was found before the path end.";n.prototype=new Error,n.prototype.name=i,n.message=o,t.exports=n},{}],18:[function(e,t,r){function n(e){this.message="An exception was thrown when making a request.",this.stack=(new Error).stack,this.innerError=e}var i="InvalidSourceError";n.prototype=new Error,n.prototype.name=i,n.is=function(e){return e&&e.name===i},t.exports=n},{}],19:[function(e,t,r){function n(){this.message="The allowed number of retries have been exceeded.",this.stack=(new Error).stack}var i="MaxRetryExceededError";n.prototype=new Error,n.prototype.name=i,n.is=function(e){return e&&e.name===i},t.exports=n},{}],20:[function(e,t,r){function n(){this.message=o,this.stack=(new Error).stack}var i="NullInPathError",o="`null` is not allowed in branch key positions.";n.prototype=new Error,n.prototype.name=i,n.message=o,t.exports=n},{}],21:[function(e,t,r){function n(e,t,r,n,c,h,l){for(var p,f,d=r,m=c,v=n,g=0;;){if(0===g&&v.ツcontext?(g=m.length,f=v.ツcontext):(p=m[g++],f=d[p]),f){var y=f.$type,_=y&&f.value||f;if(g<m.length){if(y){d=f;break}d=f;continue}if(d=f,y&&s(f))break;if(v.ツcontext||i(v,f),y===a){l?o(e,f,h,null,null,null,null,m,m.length,l):u(e._root,f),g=0,m=_,v=f,d=t;continue}break}d=void 0;break}if(g<m.length&&void 0!==d){for(var b=[],x=0;g>x;x++)b[x]=m[x];m=b}return[d,m,v]}var i=e("./../support/createHardlink"),o=e("./../get/onValue"),s=e("./../get/util/isExpired"),a=e("./../types/ref"),u=e("./../lru/promote");t.exports=n},{"./../get/onValue":32,"./../get/util/isExpired":36,"./../lru/promote":46,"./../support/createHardlink":82,"./../types/ref":117}],22:[function(e,t,r){var n=e("./../get/getCachePosition"),i=e("./../errors/InvalidModelError"),o=e("./../errors/BoundJSONGraphModelError");t.exports=function(e,t){return function(r,s,a){var u,c,h,l,p=a[0],f={values:a,optimizedPaths:[]},d=r._root.cache,m=r._path,v=d,g=m.length,y=[],_=[];if(g){if(t)return{criticalError:new o};if(v=n(r,m),v.$type)return{criticalError:new i(m,m)};for(u=[],c=0;g>c;++c)u[c]=m[c];l=r._referenceContainer}else u=[],g=0;for(c=0,h=s.length;h>c;c++)e(r,d,v,s[c],0,p,f,_,y,u,g,t,!1,l);return f}}},{"./../errors/BoundJSONGraphModelError":15,"./../errors/InvalidModelError":17,"./../get/getCachePosition":25}],23:[function(e,t,r){var n=e("./../get/getValueSync"),i=e("./../errors/InvalidModelError");t.exports=function(e,t,r){var o,s,a,u,c,h=t,l=t;for(o=e._boxed,r=e._materialized,s=e._treatErrorsAsValues,e._boxed=!0,e._materialized=void 0===r||r,e._treatErrorsAsValues=!0,a=n(e,h.concat(null),!0),e._boxed=o,e._materialized=r,e._treatErrorsAsValues=s,h=a.optimizedPath,u=a.shorted,c=a.found,a=a.value;h.length&&null===h[h.length-1];)h.pop();if(c&&u)throw new i(l,h);return{path:h,value:a,shorted:u,found:c}}},{"./../errors/InvalidModelError":17,"./../get/getValueSync":27}],24:[function(e,t,r){function n(e){var t,r,n,i={},s=Object.keys(e);for(r=0,n=s.length;n>r;r++)t=s[r],o(t)||(i[t]=e[t]);return i}function i(e,t,r){Object.keys(e).filter(function(t){return!o(t)&&void 0!==e[t]}).forEach(function(r){var o=e[r],s=t[r];if(s||(s=t[r]={}),o.$type){var a,u=o.value&&"object"==typeof o.value,c=!o.ツmodelCreated;return a=u||c?n(o):o.value,void(t[r]=a)}i(o,s,r)})}var o=e("./../support/isInternalKey");t.exports=function(e){var t={};return i(e,t),t}},{"./../support/isInternalKey":94}],25:[function(e,t,r){t.exports=function(e,t){for(var r=e._root.cache,n=-1,i=t.length;++n<i&&r&&!r.$type;)r=r[t[n]];return r}},{}],26:[function(e,t,r){var n=e("./../response/ModelResponse"),i=e("falcor-path-syntax");t.exports=function(e){for(var t=i.fromPath(e),r=0,o=t.length;++r<o;)if("object"==typeof t[r])return new n(function(e){e.onError(new Error("Paths must be simple paths"))});var s=this;return new n(function(e){return s.get(t).subscribe(function(r){for(var n=r.json,i=-1,o=t.length;n&&++i<o;)n=n[t[i]];e.onNext(n)},function(t){e.onError(t)},function(){e.onCompleted()})})}},{"./../response/ModelResponse":57,"falcor-path-syntax":126}],27:[function(e,t,r){var n=e("./../get/followReference"),i=e("./../get/util/clone"),o=e("./../get/util/isExpired"),s=e("./../lru/promote"),a=e("./../types/ref"),u=e("./../types/atom"),c=e("./../types/error");t.exports=function(e,t,r){for(var h,l,p,f,d,m=e._root.cache,v=t.length,g=[],y=!1,_=!1,b=0,x=m,w=m,S=m,M=!0,E=!1;x&&v>b;){if(h=t[b++],null!==h&&(x=w[h],g[g.length]=h),!x){S=void 0,y=!0,M=!1;break}if(p=x.$type,p===u&&void 0===x.value){S=void 0,M=!1,y=v>b;break}if(v>b){if(p===a){if(o(x)){E=!0,S=void 0;break}if(f=n(e,m,m,x,x.value),d=f[0],!d){S=void 0,x=void 0,M=!1;break}p=d.$type,x=d,g=f[1].slice(0)}if(p)break}else S=x;w=x}if(v>b&&!E){for(l=b;v>l;++l)if(null!==t[b]){_=!0;break}for(_?(y=!0,S=void 0):S=x,l=b;v>l;++l)null!==t[l]&&(g[g.length]=t[l])}if(S&&p&&(o(S)?S=void 0:s(e._root,S)),S&&p===c&&!e._treatErrorsAsValues)throw{path:b===v?t:t.slice(0,b),value:S.value};return S&&e._boxed?S=Boolean(p)&&!r?i(S):S:!S&&e._materialized?S={$type:u}:S&&(S=S.value),{value:S,shorted:y,optimizedPath:g,found:M}}},{"./../get/followReference":21,"./../get/util/clone":35,"./../get/util/isExpired":36,"./../lru/promote":46,"./../types/atom":115,"./../types/error":116,"./../types/ref":117}],28:[function(e,t,r){t.exports=function(e,t){var r=e._getValueSync({_boxed:!0,_root:e._root,_treatErrorsAsValues:e._treatErrorsAsValues},t,!0).value,n=r&&r.ツversion;return null==n?-1:n}},{}],29:[function(e,t,r){var n=e("./get"),i=e("./walkPath"),o=n(i,!1),s=n(i,!0);t.exports={getValueSync:e("./../get/getValueSync"),getBoundValue:e("./../get/getBoundValue"),getWithPathsAsPathMap:o,getWithPathsAsJSONGraph:s}},{"./../get/getBoundValue":23,"./../get/getValueSync":27,"./get":22,"./walkPath":39}],30:[function(e,t,r){var n=e("./../lru/promote"),i=e("./../get/util/clone");t.exports=function(e,t,r,o,s){var a=t.value;s.errors||(s.errors=[]),e._boxed&&(a=i(t)),s.errors.push({path:o.slice(0,r+1),value:a}),n(e._root,t)}},{"./../get/util/clone":35,"./../lru/promote":46}],31:[function(e,t,r){function n(e,t,r,n,i,o,s){s.requestedMissingPaths.push(n.slice(0,r).concat(t)),s.optimizedMissingPaths.push(i.slice(0,o).concat(t))}var i=e("./util/support"),o=i.fastCopy;t.exports=function(e,t,r,i,s,a,u){var c;i.requestedMissingPaths||(i.requestedMissingPaths=[],i.optimizedMissingPaths=[]),c=r<t.length?o(t,r):[],n(e,c,r,s,a,u,i)}},{"./util/support":38}],32:[function(e,t,r){var n=e("./../lru/promote"),i=e("./util/clone"),o=e("./../types/ref"),s=e("./../types/atom"),a=e("./../types/error");t.exports=function(e,t,r,u,c,h,l,p,f,d){if(t&&n(e._root,t),r){var m,v,g,y,_,b,x,w=null,S=!1;if(t&&void 0!==t.value||(S=e._materialized),S)x={$type:s};else if(e._boxed)x=i(t);else if(t.$type===o||t.$type===a)x=d?i(t):t.value;else if(d){var M=t.value&&"object"==typeof t.value,E=!t.ツmodelCreated;x=M||E?i(t):t.value}else x=t.value;if(c&&(c.hasValue=!0),d){for(_=r.jsonGraph,_||(_=r.jsonGraph={},r.paths=[]),m=0,v=f-1;v>m;m++)y=p[m],_[y]||(_[y]={}),_=_[y];y=p[m],_[y]=S?{$type:s}:x,l&&r.paths.push(l.slice(0,u))}else if(0===u)r.json=x;else{for(_=r.json,_||(_=r.json={}),m=0;u-1>m;m++)g=l[m],_[g]||(_[g]=h[m]),w=_,b=g,_=_[g];g=l[m],null!==g?_[g]=x:w[b]=x}}}},{"./../lru/promote":46,"./../types/atom":115,"./../types/error":116,"./../types/ref":117,"./util/clone":35}],33:[function(e,t,r){var n=e("./util/isExpired"),i=e("./../types/error"),o=e("./onError"),s=e("./onValue"),a=e("./onMissing"),u=e("./util/isMaterialzed"),c=e("./../support/expireNode");t.exports=function(e,t,r,h,l,p,f,d,m,v,g,y){var _=t&&t.$type,b=t&&void 0===t.value;return t&&_?void(n(t)?(t.ツinvalidated||c(t,e._root.expired,e._root),a(e,r,h,p,d,m,v)):_===i?(y&&(d[h]=null),g||e._treatErrorsAsValues?s(e,t,l,h,p,f,d,m,v,g):o(e,t,h,d,p)):(y&&(d[h]=null),(!b||b&&e._materialized)&&s(e,t,l,h,p,f,d,m,v,g))):void(u(e)?s(e,t,l,h,p,f,d,m,v,g):a(e,r,h,p,d,m,v))}},{"./../support/expireNode":83,"./../types/error":116,"./onError":30,"./onMissing":31,"./onValue":32,"./util/isExpired":36,"./util/isMaterialzed":37}],34:[function(e,t,r){var n=e("falcor-path-syntax");t.exports=function(e){var t=n.fromPath(e);if(Array.isArray(t)===!1)throw new Error("Model#getValueSync must be called with an Array path.");return this._path.length&&(t=this._path.concat(t)),this._syncCheck("getValueSync")&&this._getValueSync(this,t).value}},{"falcor-path-syntax":126}],35:[function(e,t,r){var n=e("./../../internal/unicodePrefix");t.exports=function(e){var t,r,i,o=Object.keys(e);for(t={},r=0,i=o.length;i>r;r++){var s=o[r],a=s.charAt(0);a!==n&&(t[s]=e[s])}return t}},{"./../../internal/unicodePrefix":42}],36:[function(e,t,r){var n=e("./../../support/now");t.exports=function(e){var t=void 0===e.$expires&&-1||e.$expires;return-1!==t&&1!==t&&(0===t||t<n())}},{"./../../support/now":103}],37:[function(e,t,r){t.exports=function(e){return e._materialized&&!e._source}},{}],38:[function(e,t,r){function n(e,t){var r,n,i,o=[];for(n=0,i=t||0,r=e.length;r>i;n++,i++)o[n]=e[i];return o}function i(e,t){var r,n,i,o=[];for(r=0,n=e.length;n>r;r++)o[r]=e[r];for(i=0,n=t.length;n>i;i++)o[r++]=t[i];return o}t.exports={fastCat:i,fastCopy:n}},{}],39:[function(e,t,r){var n=e("./followReference"),i=e("./onValueType"),o=e("./onValue"),s=e("./util/isExpired"),a=e("falcor-path-utils").iterateKeySet,u=e("./../types/ref"),c=e("./../errors/NullInPathError"),h=e("./../lru/promote");t.exports=function l(e,t,r,p,f,d,m,v,g,y,_,b,x,w){var S=x,M=y,E=w;if(!r||r&&r.$type||f===p.length)return void i(e,r,p,f,d,m,v,g,M,_,b,S);var C,T;C=p[f];var A="object"==typeof C,P=f+1,k=!1,O=C,N=e._allowFromWhenceYouCame;if(A&&(k={},O=a(C,k)),void 0!==O||!k.done){var D,L=_+1;do{S=!1;var R;if(null===O){if(f<p.length)throw new c;R=r}else R=r[O],M[_]=O,g[f]=O;var j=M,I=L;if(R){var V=R.$type,F=V&&R.value||R;if(P<p.length&&V&&V===u&&!s(R)){h(e._root,R),b&&o(e,R,d,P,m,null,null,M,I,b);var B=n(e,t,t,R,F,d,b);for(S=!0,R=B[0],D=B[1],E=B[2],j=[],I=D.length,T=0;I>T;++T)j[T]=D[T]}if(R){var U;U=E&&N?{$__path:R.ツabsolutePath,$__refPath:E.value,$__toReference:E.ツabsolutePath}:{$__path:R.ツabsolutePath},v[f]=U}}l(e,t,R,p,P,d,m,v,g,j,I,b,S,E),k&&!k.done&&(O=a(C,k))}while(k&&!k.done)}}},{"./../errors/NullInPathError":20,"./../lru/promote":46,"./../types/ref":117,"./followReference":21,"./onValue":32,"./onValueType":33,"./util/isExpired":36,"falcor-path-utils":135}],40:[function(e,t,r){"use strict";function n(e){return new n.Model(e)}n.keys=function(e){return e?Object.keys(e).filter(function(e){return"$__path"!==e}):void 0},"function"==typeof Promise?n.Promise=Promise:n.Promise=e("promise"),t.exports=n,n.Model=e("./Model")},{"./Model":9,promise:142}],41:[function(e,t,r){t.exports=e("./unicodePrefix")+"ref"},{"./unicodePrefix":42}],42:[function(e,t,r){t.exports="ツ"},{}],43:[function(e,t,r){function n(e,t,r,i,s,u,c,h,d,m){if(!v(e)&&!e.$type)for(var g in e)if(g[0]!==a&&"$"!==g[0]&&p(e,g)){var y=e[g],x=f(y)&&!y.$type,w=o(r,i,s,g,y,x,!1,u,c,h,d,m),S=w[0],M=w[1];S&&(x?n(y,t+1,r,M,S,u,c,h,d,m):b(S,M,g,h)&&_(M,l(S),h,u))}}function i(e,t,r,n,i,a,u,c){if(d(r))return g(r,i,a),[void 0,t];h(a,r);var l=r,p=r.value,f=t;if(r=r.ツcontext,null!=r)f=r.ツparent||t;else{var m=0,y=p.length-1;f=r=t;do{var _=p[m],b=y>m,x=o(t,f,r,_,e,b,!0,n,i,a,u,c);if(r=x[0],v(r))return x;f=x[1]}while(m++<y);l.ツcontext!==r&&s(l,r)}return[r,f]}function o(e,t,r,n,o,s,a,c,h,l,p,f){for(var d=r.$type;d===u;){var m=i(o,e,r,c,h,l,p,f);if(r=m[0],v(r))return m;t=m[1],d=r&&r.$type}if(void 0!==d)return[r,t];if(null==n){if(s)throw new Error("`null` is not allowed in branch key positions.");r&&(n=r.ツkey)}else t=r,r=t[n];return[r,t]}var s=e("../support/createHardlink"),a=e("./../internal/unicodePrefix"),u=e("./../types/ref"),c=e("./../get/getBoundValue"),h=e("./../lru/promote"),l=e("./../support/getSize"),p=e("./../support/hasOwn"),f=e("./../support/isObject"),d=e("./../support/isExpired"),m=e("./../support/isFunction"),v=e("./../support/isPrimitive"),g=e("./../support/expireNode"),y=e("./../support/incrementVersion"),_=e("./../support/updateNodeAncestors"),b=e("./../support/removeNodeAndDescendants");t.exports=function(e,t){for(var r=e._root,i=r,o=r.expired,s=y(),a=r._comparator,u=r._errorSelector,h=e._path,l=r.cache,p=h.length?c(e,h).value:l,f=p.ツparent||l,d=l.ツversion,v=-1,g=t.length;++v<g;){var _=t[v];n(_.json,0,l,f,p,s,o,i,a,u)}var b=l.ツversion,x=r.onChange;m(x)&&d!==b&&x()}},{"../support/createHardlink":82,"./../get/getBoundValue":23,"./../internal/unicodePrefix":42,"./../lru/promote":46,"./../support/expireNode":83,"./../support/getSize":85,"./../support/hasOwn":88,"./../support/incrementVersion":89,"./../support/isExpired":92,"./../support/isFunction":93,"./../support/isObject":97,"./../support/isPrimitive":99,"./../support/removeNodeAndDescendants":106,"./../support/updateNodeAncestors":112,"./../types/ref":117}],44:[function(e,t,r){function n(e,t,r,i,s,a,u,c){var l={},p=t<e.length-1,f=e[t],d=m(f,l);do{var v=o(r,i,s,d,p,!1,a,u,c),_=v[0],b=v[1];_&&(p?n(e,t+1,r,b,_,a,u,c):y(_,b,d,c)&&g(b,h(_),c,a)),d=m(f,l)}while(!l.done)}function i(e,t,r,n,i){if(l(t))return d(t,n,i),[void 0,e];c(i,t);var a=t,u=t.value,h=e;if(t=t.ツcontext,null!=t)h=t.ツparent||e;else{var p=0,m=u.length-1;h=t=e;do{var v=u[p],g=m>p,y=o(e,h,t,v,g,!0,r,n,i);if(t=y[0],f(t))return y;h=y[1]}while(p++<m);if(a.ツcontext!==t){var _=t.ツrefsLength||0;t.ツrefsLength=_+1,t[s+_]=a,a.ツcontext=t,a.ツrefIndex=_}}return[t,h]}function o(e,t,r,n,o,s,u,c,h){for(var l=r.$type;l===a;){var p=i(e,r,u,c,h);if(r=p[0],f(r))return p;t=p[1],l=r.$type}if(void 0!==l)return[r,t];if(null==n){if(o)throw new Error("`null` is not allowed in branch key positions.");r&&(n=r.ツkey)}else t=r,r=t[n];return[r,t]}var s=e("./../internal/ref"),a=e("./../types/ref"),u=e("./../get/getBoundValue"),c=e("./../lru/promote"),h=e("./../support/getSize"),l=e("./../support/isExpired"),p=e("./../support/isFunction"),f=e("./../support/isPrimitive"),d=e("./../support/expireNode"),m=e("falcor-path-utils").iterateKeySet,v=e("./../support/incrementVersion"),g=e("./../support/updateNodeAncestors"),y=e("./../support/removeNodeAndDescendants");
t.exports=function(e,t){for(var r=e._root,i=r,o=r.expired,s=v(),a=e._path,c=r.cache,h=a.length?u(e,a).value:c,l=h.ツparent||c,f=c.ツversion,d=-1,m=t.length;++d<m;){var g=t[d];n(g,0,c,l,h,s,o,i)}var y=c.ツversion,_=r.onChange;p(_)&&f!==y&&_()}},{"./../get/getBoundValue":23,"./../internal/ref":41,"./../lru/promote":46,"./../support/expireNode":83,"./../support/getSize":85,"./../support/incrementVersion":89,"./../support/isExpired":92,"./../support/isFunction":93,"./../support/isPrimitive":99,"./../support/removeNodeAndDescendants":106,"./../support/updateNodeAncestors":112,"./../types/ref":117,"falcor-path-utils":135}],45:[function(e,t,r){var n=e("./../support/removeNode"),i=e("./../support/updateNodeAncestors");t.exports=function(e,t,r,o,s,a){var u=r,c=s;"number"!=typeof c&&(c=.75);var h,l,p,f="number"==typeof a,d=o*c;for(l=t.pop();l;)p=l.$size||0,u-=p,f===!0?i(l,p,e,a):(h=l.ツparent)&&n(l,h,l.ツkey,e),l=t.pop();if(u>=o){var m=e.ツtail;for(l=m;u>=d&&l;)m=m.ツprev,p=l.$size||0,u-=p,f===!0&&i(l,p,e,a),l=m;e.ツtail=e.ツprev=l,null==l?e.ツhead=e.ツnext=void 0:l.ツnext=void 0}}},{"./../support/removeNode":105,"./../support/updateNodeAncestors":112}],46:[function(e,t,r){var n=e("./../values/expires-never");t.exports=function(e,t){if(t.$expires!==n){var r=e.ツhead;if(!r)return void(e.ツhead=e.ツtail=t);if(r!==t){var i=t.ツprev,o=t.ツnext;o&&(o.ツprev=i),i&&(i.ツnext=o),t.ツprev=void 0,e.ツhead=t,t.ツnext=r,r.ツprev=t,t===e.ツtail&&(e.ツtail=i)}}}},{"./../values/expires-never":118}],47:[function(e,t,r){t.exports=function(e,t){var r=t.ツprev,n=t.ツnext;n&&(n.ツprev=r),r&&(r.ツnext=n),t.ツprev=t.ツnext=void 0,t===e.ツhead&&(e.ツhead=n),t===e.ツtail&&(e.ツtail=r)}},{}],48:[function(e,t,r){function n(e,t){var r=!1;return function(){if(!r&&!e._disposed){r=!0,e._callbacks[t]=null,e._optimizedPaths[t]=[],e._requestedPaths[t]=[];var n=--e._count;0===n&&(e._disposable.dispose(),e.requestQueue.removeRequest(e))}}}function i(e){for(var t=[],r=-1,n=0,i=e.length;i>n;++n)for(var o=e[n],s=0,a=o.length;a>s;++s)t[++r]=o[s];return t}var o=e("./complement"),s=e("./flushGetRequest"),a=0,u=e("./RequestTypes").GetRequest,c=e("./../set/setJSONGraphs"),h=e("./../set/setPathValues"),l=e("./../types/error"),p=[],f=e("./../errors/InvalidSourceError"),d=function(e,t){this.sent=!1,this.scheduled=!1,this.requestQueue=t,this.id=++a,this.type=u,this._scheduler=e,this._pathMap={},this._optimizedPaths=[],this._requestedPaths=[],this._callbacks=[],this._count=0,this._disposable=null,this._collapsed=null,this._disposed=!1};d.prototype={batch:function(e,t,r){var i=this,o=i._optimizedPaths,a=i._requestedPaths,u=i._callbacks,c=o.length;if(o[c]=t,a[c]=e,u[c]=r,++i._count,!i.scheduled){i.scheduled=!0;var h,l=i._scheduler.schedule(function(){h=s(i,o,function(e,t){var r,n,o;if(i.requestQueue.removeRequest(i),i._disposed=!0,e instanceof f)for(r=0,o=u.length;o>r;++r)n=u[r],n&&n(e);else if(i._count)for(i._merge(a,e,t),r=0,o=u.length;o>r;++r)n=u[r],n&&n(e,t)})});i._disposable=h||l}return n(i,c)},add:function(e,t,r){var i,s,a=this,u=o(e,t,a._pathMap);u?(s=u[2],i=u[1]):(s=e,i=t);var c=!1,h=!1;if(i.length<t.length){c=!0;var l=a._callbacks.length;a._callbacks[l]=r,a._requestedPaths[l]=u[0],a._optimizedPaths[l]=[],++a._count,h=n(a,l)}return[c,s,i,h]},_merge:function(e,t,r){var n=this,o=n.requestQueue.model,s=o._root,a=s.errorSelector,u=s.comparator,f=o._path;o._path=p;var d=i(e);if(t){var m=t;m instanceof Error&&(m={message:m.message}),m.$type||(m={$type:l,value:m});var v=d.map(function(e){return{path:e,value:m}});h(o,v,null,a,u)}else c(o,[{paths:d,jsonGraph:r.jsonGraph}],null,a,u);o._path=f}},t.exports=d},{"./../errors/InvalidSourceError":18,"./../set/setJSONGraphs":72,"./../set/setPathValues":74,"./../types/error":116,"./RequestTypes":50,"./complement":51,"./flushGetRequest":52}],49:[function(e,t,r){function n(e,t){this.model=e,this.scheduler=t,this.requests=this._requests=[]}var i=e("./RequestTypes"),o=e("./sendSetRequest"),s=e("./GetRequestV2"),a=e("falcor-path-utils");n.prototype={setScheduler:function(e){this.scheduler=e},set:function(e,t){return e.paths=a.collapse(e.paths),o(e,this.model,t)},get:function(e,t,r){function n(e){m||(--l,0===l&&r(e))}var o,a,u,c=this,h=[],l=0,p=c._requests,f=t,d=e,m=!1;for(o=0,a=p.length;a>o;++o)if(u=p[o],u.type===i.GetRequest){if(u.sent){var v=u.add(d,f,n);v[0]&&(d=v[1],f=v[2],h[h.length]=v[3],++l)}else u.batch(d,f,n),f=[],d=[],++l;if(!f.length)break}if(f.length){u=new s(c.scheduler,c),p[p.length]=u,++l;var g=u.batch(d,f,n);h[h.length]=g}return function(){if(!m&&0!==l){m=!0;for(var e=h.length,t=0;e>t;++t)h[t]()}}},removeRequest:function(e){for(var t=this._requests,r=t.length;--r>=0;)if(t[r].id===e.id){t.splice(r,1);break}}},t.exports=n},{"./GetRequestV2":48,"./RequestTypes":50,"./sendSetRequest":53,"falcor-path-utils":135}],50:[function(e,t,r){t.exports={GetRequest:"GET"}},{}],51:[function(e,t,r){var n=e("falcor-path-utils").hasIntersection,i=e("./../support/array-slice");t.exports=function(e,t,r){for(var o=[],s=[],a=[],u=-1,c=-1,h=!1,l=0,p=t.length;p>l;++l){var f=t[l],d=r[f.length];d&&n(d,f,0)?(!h&&l>0&&(s=i(e,0,l),o=i(t,0,l)),a[++u]=e[l],h=!0):h&&(o[++c]=f,s[c]=e[l])}return h?[a,o,s]:null}},{"./../support/array-slice":80,"falcor-path-utils":135}],52:[function(e,t,r){var n=e("falcor-path-utils"),i=n.toTree,o=n.toPaths,s=e("./../errors/InvalidSourceError");t.exports=function(e,t,r){if(0===e._count)return e.requestQueue.removeRequest(e),null;e.sent=!0,e.scheduled=!1;for(var n=e._pathMap,a=Object.keys(t),u=0,c=a.length;c>u;++u)for(var h=t[u],l=0,p=h.length;p>l;++l){var f=h[l],d=f.length;if(n[d]){var m=n[d];m[m.length]=f}else n[d]=[f]}for(var v=Object.keys(n),g=0,y=v.length;y>g;++g){var _=v[g];n[_]=i(n[_])}var b,x,w=e._collasped=o(n);try{x=e.requestQueue.model._source.get(w)}catch(S){return r(new s),null}var M=x.subscribe(function(e){b=e},function(e){r(e,b)},function(){r(null,b)});return M}},{"./../errors/InvalidSourceError":18,"falcor-path-utils":135}],53:[function(e,t,r){var n=e("./../support/array-map"),i=e("./../set/setJSONGraphs"),o=e("./../set/setPathValues"),s=e("./../errors/InvalidSourceError"),a=[],u={dispose:function(){}},c=function(e,t,r){var c,h,l=e.paths,p=t._root,f=p.errorSelector,d=p.comparator,m=t._path;try{h=t._source.set(e)}catch(v){return r(new s),u}var g=h.subscribe(function(e){if(!g||!g.disposed){t._path=a;var r=i(t,[{paths:l,jsonGraph:e.jsonGraph}],null,f,d);e.paths=r[1],t._path=m,c=e}},function(e){g&&g.disposed||(t._path=a,o(t,n(l,function(t){return{path:t,value:e}}),null,f,d),t._path=m,r(e))},function(){r(null,c)});return g};t.exports=c},{"./../errors/InvalidSourceError":18,"./../set/setJSONGraphs":72,"./../set/setPathValues":74,"./../support/array-map":79}],54:[function(e,t,r){var n=function(e){this.disposed=!1,this.currentDisposable=e};n.prototype={dispose:function(){if(!this.disposed&&this.currentDisposable){this.disposed=!0;var e=this.currentDisposable;e.dispose?e.dispose():e()}}},t.exports=n},{}],55:[function(e,t,r){function n(e,t,r,n,i){this.callPath=s.fromPath(t),this.args=r,i&&(this.paths=i.map(s.fromPath)),n&&(this.suffix=n.map(s.fromPath)),this.model=e}var i=e("./../response/ModelResponse"),o=e("./../errors/InvalidSourceError"),s=e("falcor-path-syntax");n.prototype=Object.create(i.prototype),n.prototype._subscribe=function(e){var t=this.callPath,r=this.args,n=this.suffix,i=this.paths,s=this.model,a=s._clone({_path:[]}),u=s._path,c=u.concat(t);if(!s._source)return void e.onError(new Error("function does not exist"));var h,l;try{l=s._source.call(c,r,n,i)}catch(p){return void e.onError(new o(p))}return l.subscribe(function(e){h=e},function(t){e.onError(t)},function(){var t=h.invalidated;t&&t.length&&a.invalidate.apply(a,t),a.withoutDataSource().set(h).subscribe(function(t){e.onNext(t)},function(t){e.onError(t)},function(){e.onCompleted()})})},t.exports=n},{"./../errors/InvalidSourceError":18,"./../response/ModelResponse":57,"falcor-path-syntax":126}],56:[function(e,t,r){function n(e,t){this._model=e;for(var r,n,o=[],u=-1,c=t.length;++u<c;){var h,l=t[u];if(i(l))h="PathValues";else if(s(l))h="PathValues";else{if(!a(l))throw new Error("Invalid Input");h="PathMaps"}n!==h&&(n=h,r={inputType:h,arguments:[]},o.push(r)),r.arguments.push(l)}this._groups=o}var i=Array.isArray,o=e("./ModelResponse"),s=e("./../support/isPathValue"),a=e("./../support/isJSONEnvelope"),u={dispose:function(){}};n.prototype=Object.create(o.prototype),n.prototype.progressively=function(){return this},n.prototype._toJSONG=function(){return this},n.prototype._subscribe=function(e){var t=this._model;return this._groups.forEach(function(e){var r=e.inputType,n=e.arguments,i="_invalidate"+r,o=t[i];o(t,n)}),e.onCompleted(),u},t.exports=n},{"./../support/isJSONEnvelope":95,"./../support/isPathValue":98,"./ModelResponse":57}],57:[function(e,t,r){function n(e){this._subscribe=e}var i=e("./../"),o=e("./../support/noop");n.prototype._toJSONG=function(){return this},n.prototype.progressively=function(){return this},n.prototype.subscribe=n.prototype.forEach=function(e,t,r){var n=e;n&&"object"==typeof n||(n={onNext:e||o,onError:t||o,onCompleted:r||o});var i=this._subscribe(n);switch(typeof i){case"function":return{dispose:i};case"object":return i||{dispose:o};default:return{dispose:o}}},n.prototype.then=function(e,t){var r=this;return new i.Promise(function(e,t){var n=!1,i=[];r.subscribe(function(e){i[i.length]=e},function(e){n=!0,t(e)},function(){var t=i;i.length<=1&&(t=i[0]),n===!1&&e(t)})}).then(e,t)},t.exports=n},{"./../":40,"./../support/noop":102}],58:[function(e,t,r){var n=e("./../ModelResponse"),i=e("./checkCacheAndReport"),o=e("./getRequestCycle"),s={dispose:function(){}},a=e("./../../lru/collect"),u=e("./../../support/getSize"),c=t.exports=function(e,t,r,n,i){this.model=e,this.currentRemainingPaths=t,this.isJSONGraph=r||!1,this.isProgressive=n||!1,this.forceCollect=i||!1};c.prototype=Object.create(n.prototype),c.prototype._toJSONG=function(){return new c(this.model,this.currentRemainingPaths,!0,this.isProgressive,this.forceCollect)},c.prototype.progressively=function(){return new c(this.model,this.currentRemainingPaths,this.isJSONGraph,!0,this.forceCollect)},c.prototype._subscribe=function(e){var t=[{}],r=[],n=this.model,c=e.isJSONG=this.isJSONGraph,h=this.isProgressive,l=i(n,this.currentRemainingPaths,e,h,c,t,r);if(!l){if(this.forceCollect){var p=n._root,f=p.cache,d=f.ツversion;a(p,p.expired,u(f),n._maxSize,n._collectRatio,d)}return s}return o(this,n,l,e,t,r,1)}},{"./../../lru/collect":45,"./../../support/getSize":85,"./../ModelResponse":57,"./checkCacheAndReport":59,"./getRequestCycle":60}],59:[function(e,t,r){var n=e("./../../get"),i=n.getWithPathsAsJSONGraph,o=n.getWithPathsAsPathMap;t.exports=function(e,t,r,n,s,a,u){var c;if(c=s?i(e,t,a):o(e,t,a),c.criticalError)return r.onError(c.criticalError),null;var h=c.hasValue,l=!c.requestedMissingPaths||!e._source,p=Boolean(a[0].json||a[0].jsonGraph);if(c.errors)for(var f=c.errors,d=u.length,m=0,v=f.length;v>m;++m,++d)u[d]=f[m];if(h&&n||p&&l)try{r.onNext(a[0])}catch(g){throw g}return l?(u.length?r.onError(u):r.onCompleted(),null):c}},{"./../../get":29}],60:[function(e,t,r){var n=e("./checkCacheAndReport"),i=e("./../../errors/MaxRetryExceededError"),o=e("./../../get/util/support").fastCat,s=e("./../../lru/collect"),a=e("./../../support/getSize"),u=e("./../AssignableDisposable"),c=e("../../errors/InvalidSourceError");t.exports=function h(e,t,r,l,p,f,d){if(10===d)throw new i;var m=t._request,v=r.requestedMissingPaths,g=r.optimizedMissingPaths,y=new u,_=[],b=t._path;if(b.length)for(var x=0,w=v.length;w>x;++x)_[x]=o(b,v[x]);else _=v;var S=m.get(_,g,function(r){if(r instanceof c)return void l.onError(r);var i=n(t,v,l,e.isProgressive,e.isJSONGraph,p,f);if(i)y.currentDisposable=h(e,t,i,l,p,f,d+1);else{var o=t._root,u=o.cache,m=u.ツversion;s(o,o.expired,a(u),t._maxSize,t._collectRatio,m)}});return y.currentDisposable=S,y}},{"../../errors/InvalidSourceError":18,"./../../errors/MaxRetryExceededError":19,"./../../get/util/support":38,"./../../lru/collect":45,"./../../support/getSize":85,"./../AssignableDisposable":54,"./checkCacheAndReport":59}],61:[function(e,t,r){var n=e("./GetResponse");t.exports=function(e){return new n(this,e)}},{"./GetResponse":58}],62:[function(e,t,r){var n=e("falcor-path-syntax"),i=e("./../ModelResponse"),o=e("./validInput"),s=e("./../../support/validateInput"),a=e("./GetResponse");t.exports=function(){var e=s(arguments,o,"get");if(e!==!0)return new i(function(t){t.onError(e)});var t=n.fromPathsOrPathValues(arguments);return new a(this,t)}},{"./../../support/validateInput":113,"./../ModelResponse":57,"./GetResponse":58,"./validInput":63,"falcor-path-syntax":126}],63:[function(e,t,r){t.exports={path:!0,pathSyntax:!0}},{}],64:[function(e,t,r){var n=e("./../ModelResponse"),i=e("falcor-path-syntax"),o=Array.isArray,s=e("./../../support/isPathValue"),a=e("./../../support/isJSONGraphEnvelope"),u=e("./../../support/isJSONEnvelope"),c=e("./setRequestCycle"),h=t.exports=function(e,t,r,n){this._model=e,this._isJSONGraph=r||!1,this._isProgressive=n||!1,this._initialArgs=t,this._value=[{}];for(var c,h,l=[],p=-1,f=t.length;++p<f;){var d,m=t[p];o(m)||"string"==typeof m?(m=i.fromPath(m),d="PathValues"):s(m)?(m.path=i.fromPath(m.path),d="PathValues"):a(m)?d="JSONGs":u(m)&&(d="PathMaps"),h!==d&&(h=d,c={inputType:d,arguments:[]},l.push(c)),c.arguments.push(m)}this._groups=l};h.prototype=Object.create(n.prototype),h.prototype._subscribe=function(e){var t=this._groups,r=this._model,n=this._isJSONGraph,i=this._isProgressive;return c(r,e,t,n,i,0)},h.prototype._toJSONG=function(){return new h(this._model,this._initialArgs,!0,this._isProgressive)},h.prototype.progressively=function(){return new h(this._model,this._initialArgs,this._isJSONGraph,!0)}},{"./../../support/isJSONEnvelope":95,"./../../support/isJSONGraphEnvelope":96,"./../../support/isPathValue":98,"./../ModelResponse":57,"./setRequestCycle":67,"falcor-path-syntax":126}],65:[function(e,t,r){var n=e("./setValidInput"),i=e("./../../support/validateInput"),o=e("./SetResponse"),s=e("./../ModelResponse");t.exports=function(){var e=i(arguments,n,"set");if(e!==!0)return new s(function(t){t.onError(e)});for(var t=-1,r=arguments.length,a=[];++t<r;)a[t]=arguments[t];return new o(this,a)}},{"./../../support/validateInput":113,"./../ModelResponse":57,"./SetResponse":64,"./setValidInput":68}],66:[function(e,t,r){function n(e){return e.path}function i(e){return e.paths}var o=e("./../../support/array-flat-map");t.exports=function(e,t){for(var r=e._root,s=r.errorSelector,a=-1,u=t.length,c=[],h=[],l={requestedPaths:c,optimizedPaths:h};++a<u;){var p=t[a],f=p.inputType,d=p.arguments;if(d.length>0){var m="_set"+f,v=e[m],g=v(e,d,null,s);h.push.apply(h,g[1]),"PathValues"===f?c.push.apply(c,d.map(n)):"JSONGs"===f?c.push.apply(c,o(d,i)):c.push.apply(c,g[0])}}return l}},{"./../../support/array-flat-map":78}],67:[function(e,t,r){function n(e,t){var r=e._path,n={};return e._path=o,e._getPathValuesAsJSONG(e._materialize().withoutDataSource(),t,[n]),e._path=r,n}function i(e,t,r,n,i){var o=new a(e,r,n,i,!0);return o.subscribe(t)}var o=[],s=e("./../AssignableDisposable"),a=e("./../get/GetResponse"),u=e("./setGroupsIntoCache"),c=e("./../../get").getWithPathsAsPathMap,h=e("./../../errors/InvalidSourceError"),l=e("./../../errors/MaxRetryExceededError");t.exports=function p(e,t,r,o,a,f){if(10===f)throw new l;var d=u(e,r),m=d.optimizedPaths,v=d.requestedPaths,g=void 0===e._source;if(g)return i(e,t,v,o,a);if(a){var y={};c(e,v,[y]),t.onNext(y)}var _=n(e,m),b=new s,x=e._request.set(_,function(n,s){if(typeof n===h)return t.onError(n);var u=!1;(n||m.length===s.paths.length)&&(u=!0),u?b.currentDisposable=i(e,t,v,o,a):p(e,t,r,o,a,f+1)});return b.currentDisposable=x,b}},{"./../../errors/InvalidSourceError":18,"./../../errors/MaxRetryExceededError":19,"./../../get":29,"./../AssignableDisposable":54,"./../get/GetResponse":58,"./setGroupsIntoCache":66}],68:[function(e,t,r){t.exports={pathValue:!0,pathSyntax:!0,json:!0,jsonGraph:!0}},{}],69:[function(e,t,r){function n(){}var i=e("asap"),o={dispose:function(){}};n.prototype.schedule=function(e){return i(e),o},n.prototype.scheduleWithState=function(e,t){var r=this;return i(function(){t(r,e)}),o},t.exports=n},{asap:120}],70:[function(e,t,r){function n(){}var i={dispose:function(){}};n.prototype.schedule=function(e){return e(),i},n.prototype.scheduleWithState=function(e,t){return t(this,e),i},t.exports=n},{}],71:[function(e,t,r){function n(e){this.delay=e}var i=function(e){this.id=e,this.disposed=!1};n.prototype.schedule=function(e){var t=setTimeout(e,this.delay);return new i(t)},n.prototype.scheduleWithState=function(e,t){var r=this,n=setTimeout(function(){t(r,e)},this.delay);return new i(n)},i.prototype.dispose=function(){this.disposed||(clearTimeout(this.id),this.disposed=!0)},t.exports=n},{}],72:[function(e,t,r){function n(e,t,r,i,s,a,u,c,h,l,f,d,m,v,g,y,_){for(var b={},x=t<e.length-1,w=e[t],S=p(w,b),M=d.index;;){f.depth=t;var E=o(r,i,s,a,u,c,S,x,!1,f,d,m,v,g,y,_);f[t]=S,f.index=t,d[d.index++]=S;var C=E[0],T=E[1];if(C&&(x?n(e,t+1,r,T,C,a,E[3],E[2],h,l,f,d,m,v,g,y,_):(h.push(f.slice(0,f.index+1)),l.push(d.slice(0,d.index)))),S=p(w,b),b.done)break;d.index=M}}function i(e,t,r,n,i,a,c,p,f,d,m){var v=t.value;if(a.splice(0,a.length),a.push.apply(a,v),u(t))return a.index=v.length,l(t,p,f),[void 0,e,n,r];var g=0,y=t,_=v.length-1,b=t=e,x=n=r;do{var w=v[g],S=_>g;a.index=g;var M=o(e,b,t,r,x,n,w,S,!0,i,a,c,p,f,d,m);if(t=M[0],h(t))return a.index=g,M;b=M[1],n=M[2],x=M[3]}while(g++<_);return a.index=g,y.ツcontext!==t&&s(y,t),[t,b,n,x]}function o(e,t,r,n,o,s,u,c,l,p,f,v,g,y,_,b){for(var x=r.$type;x===a;){var w=i(e,r,n,s,p,f,v,g,y,_,b);if(r=w[0],h(r))return w;t=w[1],s=w[2],o=w[3],x=r.$type}if(void 0!==x)return[r,t,s,o];if(null==u){if(c)throw new m;r&&(u=r.ツkey)}else t=r,o=s,r=t[u],s=o&&o[u];return r=d(t,r,s,u,p,f,v,g,y,_,b),[r,t,s,o]}var s=e("./../support/createHardlink"),a=e("./../types/ref"),u=e("./../support/isAlreadyExpired"),c=e("./../support/isFunction"),h=e("./../support/isPrimitive"),l=e("./../support/expireNode"),p=e("falcor-path-utils").iterateKeySet,f=e("./../support/incrementVersion"),d=e("./../support/mergeJSONGraphNode"),m=e("./../errors/NullInPathError");t.exports=function(e,t,r,i,o){for(var s=e._root,a=s,u=s.expired,h=f(),l=s.cache,p=l.ツversion,d=[],m=[],v=[],g=[],y=-1,_=t.length;++y<_;)for(var b=t[y],x=b.paths,w=b.jsonGraph,S=-1,M=x.length;++S<M;){var E=x[S];m.index=0,n(E,0,l,l,l,w,w,w,v,g,d,m,h,u,a,o,i)}var C=l.ツversion,T=s.onChange;return c(T)&&p!==C&&T(),[v,g]}},{"./../errors/NullInPathError":20,"./../support/createHardlink":82,"./../support/expireNode":83,"./../support/incrementVersion":89,"./../support/isAlreadyExpired":91,"./../support/isFunction":93,"./../support/isPrimitive":99,"./../support/mergeJSONGraphNode":100,"./../types/ref":117,"falcor-path-utils":135}],73:[function(e,t,r){function n(e,t,r,i,a,u,c,h,l,p,d,m,v,g){var y=s(e);if(y&&y.length)for(var _=0,b=y.length,x=l.index;;){var w=y[_],S=e[w],M=f(S)&&!S.$type;h.depth=t;var E=o(r,i,a,w,S,M,!1,h,l,p,d,m,v,g);h[t]=w,h.index=t,l[l.index++]=w;var C=E[0],T=E[1];if(C&&(M?n(S,t+1,r,T,C,u,c,h,l,p,d,m,v,g):(u.push(h.slice(0,h.index+1)),c.push(l.slice(0,l.index)))),++_>=b)break;l.index=x}}function i(e,t,r,n,i,s,u,c,h,l){var p=r.value;if(i.splice(0,i.length),i.push.apply(i,p),d(r))return i.index=p.length,g(r,u,c),[void 0,t];var f=r,m=t;if(r=r.ツcontext,null!=r)m=r.ツparent||t,i.index=p.length;else{var y=0,_=p.length-1;i.index=y,m=r=t;do{var b=p[y],x=_>y,w=o(t,m,r,b,e,x,!0,n,i,s,u,c,h,l);if(r=w[0],v(r))return i.index=y,w;m=w[1]}while(y++<_);i.index=y,f.ツcontext!==r&&a(f,r)}return[r,m]}function o(e,t,r,n,o,s,a,u,h,l,p,f,d,m){for(var g=r.$type;g===c;){var y=i(o,e,r,u,h,l,p,f,d,m);if(r=y[0],v(r))return y;t=y[1],g=r&&r.$type}if(void 0!==g)return[r,t];if(null==n){if(s)throw new b;r&&(n=r.ツkey)}else t=r,r=t[n];return r=_(t,r,n,o,s,a,u,h,l,p,f,d,m),[r,t]}function s(e){if(f(e)&&!e.$type){var t=[],r=0;l(e)&&(t[r++]="length");for(var n in e)n[0]!==u&&"$"!==n[0]&&p(e,n)&&(t[r++]=n);return t}}var a=e("./../support/createHardlink"),u=e("./../internal/unicodePrefix"),c=e("./../types/ref"),h=e("./../get/getBoundValue"),l=Array.isArray,p=e("./../support/hasOwn"),f=e("./../support/isObject"),d=e("./../support/isExpired"),m=e("./../support/isFunction"),v=e("./../support/isPrimitive"),g=e("./../support/expireNode"),y=e("./../support/incrementVersion"),_=e("./../support/mergeValueOrInsertBranch"),b=e("./../errors/NullInPathError");t.exports=function(e,t,r,i,o){for(var s=e._root,a=s,u=s.expired,c=y(),l=e._path,p=s.cache,f=l.length?h(e,l).value:p,d=f.ツparent||p,v=p.ツversion,g=[],_=[],b=[],x=l.length,w=-1,S=t.length;++w<S;){var M=t[w],E=l.slice(0);E.index=x,n(M.json,0,p,d,f,_,b,g,E,c,u,a,o,i)}var C=p.ツversion,T=s.onChange;return m(T)&&v!==C&&T(),[_,b]}},{"./../errors/NullInPathError":20,"./../get/getBoundValue":23,"./../internal/unicodePrefix":42,"./../support/createHardlink":82,"./../support/expireNode":83,"./../support/hasOwn":88,"./../support/incrementVersion":89,"./../support/isExpired":92,"./../support/isFunction":93,"./../support/isObject":97,"./../support/isPrimitive":99,"./../support/mergeValueOrInsertBranch":101,"./../types/ref":117}],74:[function(e,t,r){function n(e,t,r,i,s,a,u,c,h,l,p,d,m,v,g){for(var y={},_=r<t.length-1,b=t[r],x=f(b,y),w=l.index;;){h.depth=r;var S=o(i,s,a,x,e,_,!1,h,l,p,d,m,v,g);h[r]=x,h.index=r,l[l.index++]=x;var M=S[0],E=S[1];if(M&&(_?n(e,t,r+1,i,E,M,u,c,h,l,p,d,m,v,g):(u.push(h.slice(0,h.index+1)),c.push(l.slice(0,l.index)))),x=f(b,y),y.done)break;l.index=w}}function i(e,t,r,n,i,a,u,h,f,d){var m=r.value;if(i.splice(0,i.length),i.push.apply(i,m),c(r))return i.index=m.length,p(r,u,h),[void 0,t];var v=r,g=t;if(r=r.ツcontext,null!=r)g=r.ツparent||t,i.index=m.length;else{var y=0,_=m.length-1;g=r=t;do{var b=m[y],x=_>y;i.index=y;var w=o(t,g,r,b,e,x,!0,n,i,a,u,h,f,d);if(r=w[0],l(r))return i.index=y,w;g=w[1]}while(y++<_);i.index=y,v.ツcontext!==r&&s(v,r)}return[r,g]}function o(e,t,r,n,o,s,u,c,h,p,f,d,g,y){for(var _=r.$type;_===a;){var b=i(o,e,r,c,h,p,f,d,g,y);if(r=b[0],l(r))return b;t=b[1],_=r.$type}if(void 0!==_)return[r,t];if(null==n){if(s)throw new v;r&&(n=r.ツkey)}else t=r,r=t[n];return r=m(t,r,n,o,s,u,c,h,p,f,d,g,y),[r,t]}var s=e("./../support/createHardlink"),a=e("./../types/ref"),u=e("./../get/getBoundValue"),c=e("./../support/isExpired"),h=e("./../support/isFunction"),l=e("./../support/isPrimitive"),p=e("./../support/expireNode"),f=e("falcor-path-utils").iterateKeySet,d=e("./../support/incrementVersion"),m=e("./../support/mergeValueOrInsertBranch"),v=e("./../errors/NullInPathError");t.exports=function(e,t,r,i,o){for(var s=e._root,a=s,c=s.expired,l=d(),p=e._path,f=s.cache,m=p.length?u(e,p).value:f,v=m.ツparent||f,g=f.ツversion,y=[],_=[],b=[],x=p.length,w=-1,S=t.length;++w<S;){var M=t[w],E=M.path,C=M.value,T=p.slice(0);T.index=x,n(C,E,0,f,v,m,_,b,y,T,l,c,a,o,i)}var A=f.ツversion,P=s.onChange;return h(P)&&g!==A&&P(),[_,b]}},{"./../errors/NullInPathError":20,"./../get/getBoundValue":23,"./../support/createHardlink":82,"./../support/expireNode":83,"./../support/incrementVersion":89,"./../support/isExpired":92,"./../support/isFunction":93,"./../support/isPrimitive":99,"./../support/mergeValueOrInsertBranch":101,"./../types/ref":117,"falcor-path-utils":135}],75:[function(e,t,r){var n=e("falcor-json-graph"),i=e("./../response/ModelResponse"),o=e("./../support/isPathValue");t.exports=function(e,t){for(var r=o(e)?e:n.pathValue(e,t),s=0,a=r.path,u=a.length;++s<u;)if("object"==typeof a[s])return new i(function(e){e.onError(new Error("Paths must be simple paths"))});var c=this;return new i(function(e){return c.set(r).subscribe(function(t){for(var r=t.json,n=-1,i=a.length;r&&++n<i;)r=r[a[n]];e.onNext(r)},function(t){e.onError(t)},function(){e.onCompleted()})})}},{"./../response/ModelResponse":57,"./../support/isPathValue":98,"falcor-json-graph":122}],76:[function(e,t,r){var n=e("falcor-path-syntax"),i=e("./../support/isPathValue"),o=e("./../set/setPathValues");t.exports=function(e,t,r,s){var a=n.fromPath(e),u=t,c=r,h=s;if(i(a)?(h=c,c=u,u=a):u={path:a,value:u},i(u)===!1)throw new Error("Model#setValueSync must be called with an Array path.");return"function"!=typeof c&&(c=this._root._errorSelector),"function"!=typeof h&&(h=this._root._comparator),this._syncCheck("setValueSync")?(o(this,[u]),this._getValueSync(this,u.path).value):void 0}},{"./../set/setPathValues":74,"./../support/isPathValue":98,"falcor-path-syntax":126}],77:[function(e,t,r){t.exports=function(e){if(!e)return e;for(var t=-1,r=e.length,n=[];++t<r;)n[t]=e[t];return n}},{}],78:[function(e,t,r){t.exports=function(e,t){for(var r=-1,n=-1,i=e.length,o=[];++n<i;)for(var s=t(e[n],n,e),a=-1,u=s.length;++a<u;)o[++r]=s[a];return o}},{}],79:[function(e,t,r){t.exports=function(e,t){for(var r=-1,n=e.length,i=new Array(n);++r<n;)i[r]=t(e[r],r,e);return i}},{}],80:[function(e,t,r){t.exports=function(e,t,r){var n=t||0,i=-1,o=e.length-n;0>o&&(o=0),r>0&&o>r&&(o=r);for(var s=new Array(o);++i<o;)s[i]=e[i+n];return s}},{}],81:[function(e,t,r){var n=e("./../internal/unicodePrefix"),i=e("./../support/hasOwn"),o=Array.isArray,s=e("./../support/isObject");t.exports=function(e){var t=e;if(s(t)){t=o(e)?[]:{};var r=e;for(var a in r)a.charAt(0)!==n&&i(r,a)&&(t[a]=r[a])}return t}},{"./../internal/unicodePrefix":42,"./../support/hasOwn":88,"./../support/isObject":97}],82:[function(e,t,r){var n=e("./../internal/ref");t.exports=function(e,t){var r=t.ツrefsLength||0;t[n+r]=e,t.ツrefsLength=r+1,e.ツrefIndex=r,e.ツcontext=t}},{"./../internal/ref":41}],83:[function(e,t,r){var n=e("./../lru/splice");t.exports=function(e,t,r){return e.ツinvalidated||(e.ツinvalidated=!0,t.push(e),n(r,e)),e}},{"./../lru/splice":47}],84:[function(e,t,r){var n=e("./isObject");t.exports=function(e){return n(e)&&e.$expires||void 0}},{"./isObject":97}],85:[function(e,t,r){var n=e("./../support/isObject");t.exports=function(e){return n(e)&&e.$size||0}},{"./../support/isObject":97}],86:[function(e,t,r){var n=e("./../support/isObject");t.exports=function(e){return n(e)&&e.$timestamp||void 0}},{"./../support/isObject":97}],87:[function(e,t,r){var n=e("./../support/isObject");t.exports=function(e,t){var r=n(e)&&e.$type||void 0;return t&&r?"branch":r}},{"./../support/isObject":97}],88:[function(e,t,r){var n=e("./isObject"),i=Object.prototype.hasOwnProperty;t.exports=function(e,t){return n(e)&&i.call(e,t)}},{"./isObject":97}],89:[function(e,t,r){var n=1;t.exports=function(){return n++}},{}],90:[function(e,t,r){t.exports=function(e,t,r,n,i){return e.ツkey=r,e.ツparent=t,void 0!==n&&(e.ツversion=n),e.ツabsolutePath||(e.ツabsolutePath=i.slice(0,i.index).concat(r)),t[r]=e,e}},{}],91:[function(e,t,r){var n=e("./../support/now"),i=e("./../values/expires-now"),o=e("./../values/expires-never");t.exports=function(e){var t=e.$expires;return null!=t&&t!==o&&t!==i&&t<n()}},{"./../support/now":103,"./../values/expires-never":118,"./../values/expires-now":119}],92:[function(e,t,r){var n=e("./../support/now"),i=e("../values/expires-now"),o=e("../values/expires-never");t.exports=function(e){var t=e.$expires;return null!=t&&t!==o&&(t===i||t<n())}},{"../values/expires-never":118,"../values/expires-now":119,"./../support/now":103}],93:[function(e,t,r){var n="function";t.exports=function(e){return Boolean(e)&&typeof e===n}},{}],94:[function(e,t,r){var n=e("./../internal/unicodePrefix");t.exports=function(e){return"$size"===e||"$modelCreated"===e||e.charAt(0)===n}},{"./../internal/unicodePrefix":42}],95:[function(e,t,r){var n=e("./../support/isObject");t.exports=function(e){return n(e)&&"json"in e}},{"./../support/isObject":97}],96:[function(e,t,r){var n=Array.isArray,i=e("./../support/isObject");t.exports=function(e){return i(e)&&n(e.paths)&&(i(e.jsonGraph)||i(e.jsong)||i(e.json)||i(e.values)||i(e.value))}},{"./../support/isObject":97}],97:[function(e,t,r){var n="object";t.exports=function(e){return null!==e&&typeof e===n}},{}],98:[function(e,t,r){var n=Array.isArray,i=e("./../support/isObject");t.exports=function(e){return i(e)&&(n(e.path)||"string"==typeof e.path)}},{"./../support/isObject":97}],99:[function(e,t,r){var n="object";t.exports=function(e){return null==e||typeof e!==n}},{}],100:[function(e,t,r){var n=e("./../types/ref"),i=e("./../types/error"),o=e("./../support/getSize"),s=e("./../support/getTimestamp"),a=e("./../support/isObject"),u=e("./../support/isExpired"),c=e("./../support/isFunction"),h=e("./../support/wrapNode"),l=e("./../support/insertNode"),p=e("./../support/expireNode"),f=e("./../support/replaceNode"),d=e("./../support/updateNodeAncestors"),m=e("./../support/reconstructPath");t.exports=function(e,t,r,v,g,y,_,b,x,w,S){var M,E,C,T,A,P,k;if(t===r){if(null===r)return t=h(r,void 0,r),e=d(e,-t.$size,x,_),t=l(t,e,v,void 0,y);if(void 0===r)return r;if(T=a(t),T&&(E=t.$type,null==E))return null==t.ツparent&&l(t,e,v,_,y),t}else T=a(t),T&&(E=t.$type);if(E!==n){if(A=a(r),A&&(C=r.$type),T&&!E&&(null==r||A&&!C))return t}else{if(null==r)return u(t)?void p(t,b,x):t;if(A=a(r),A&&(C=r.$type,C===n))if(t===r){if(null!=t.ツparent)return t}else if(P=t.$timestamp,k=r.$timestamp,!u(t)&&!u(r)&&P>k)return}if(E&&A&&!C)return l(f(t,r,e,v,x),e,v,void 0,y);if(C||!A){if(C===i&&c(S)&&(r=S(m(g,v),r)),C&&t===r)null==t.ツparent&&(t=h(t,E,t.value),e=d(e,-t.$size,x,_),t=l(t,e,v,_,y));else{var O=!0;(E||!T)&&(O=s(r)<s(t)==!1,(E||C)&&c(w)&&(O=!w(t,r,y.slice(0,y.index)))),O&&(r=h(r,C,C?r.value:r),M=o(t)-o(r),t=f(t,r,e,v,x),e=d(e,M,x,_),t=l(t,e,v,_,y))}u(t)&&p(t,b,x)}else null==t&&(t=l(r,e,v,void 0,y));return t}},{"./../support/expireNode":83,"./../support/getSize":85,"./../support/getTimestamp":86,"./../support/insertNode":90,"./../support/isExpired":92,"./../support/isFunction":93,"./../support/isObject":97,"./../support/reconstructPath":104,"./../support/replaceNode":107,"./../support/updateNodeAncestors":112,"./../support/wrapNode":114,"./../types/error":116,"./../types/ref":117}],101:[function(e,t,r){var n=e("./../types/ref"),i=e("./../types/error"),o=e("./../support/getType"),s=e("./../support/getSize"),a=e("./../support/getTimestamp"),u=e("./../support/isExpired"),c=e("./../support/isPrimitive"),h=e("./../support/isFunction"),l=e("./../support/wrapNode"),p=e("./../support/expireNode"),f=e("./../support/insertNode"),d=e("./../support/replaceNode"),m=e("./../support/updateNodeAncestors"),v=e("./../support/updateBackReferenceVersions"),g=e("./../support/reconstructPath");t.exports=function(e,t,r,y,_,b,x,w,S,M,E,C,T){var A=o(t,b);if(_||b)A&&u(t)&&(A="expired",p(t,M,E)),(A&&A!==n||c(t))&&(t=d(t,{},e,r,E),t=f(t,e,r,S,w),t=v(t,S));else{var P=y,k=o(P),O=a(P)<a(t)==!1;if((A||k)&&h(C)&&(O=!C(t,P,w.slice(0,w.index))),O){k===i&&h(T)&&(P=T(g(x,r),P)),P=l(P,k,k?P.value:P);var N=s(t)-s(P);t=d(t,P,e,r,E),e=m(e,N,E,S),t=f(t,e,r,S,w)}}return t}},{"./../support/expireNode":83,"./../support/getSize":85,"./../support/getTimestamp":86,"./../support/getType":87,"./../support/insertNode":90,"./../support/isExpired":92,"./../support/isFunction":93,"./../support/isPrimitive":99,"./../support/reconstructPath":104,"./../support/replaceNode":107,"./../support/updateBackReferenceVersions":111,"./../support/updateNodeAncestors":112,"./../support/wrapNode":114,"./../types/error":116,"./../types/ref":117}],102:[function(e,t,r){t.exports=function(){}},{}],103:[function(e,t,r){t.exports=Date.now},{}],104:[function(e,t,r){t.exports=function(e,t){var r=e.slice(0,e.depth);return r[r.length]=t,r}},{}],105:[function(e,t,r){var n=e("./../types/ref"),i=e("./../lru/splice"),o=e("./../support/isObject"),s=e("./../support/unlinkBackReferences"),a=e("./../support/unlinkForwardReference");t.exports=function(e,t,r,u){if(o(e)){var c=e.$type;return Boolean(c)&&(c===n&&a(e),i(u,e)),s(e),t[r]=e.ツparent=void 0,!0}return!1}},{"./../lru/splice":47,"./../support/isObject":97,"./../support/unlinkBackReferences":109,"./../support/unlinkForwardReference":110,"./../types/ref":117}],106:[function(e,t,r){var n=e("./../support/hasOwn"),i=e("./../internal/unicodePrefix"),o=e("./../support/removeNode");t.exports=function s(e,t,r,a){if(o(e,t,r,a)){if(null==e.$type)for(var u in e)u[0]!==i&&"$"!==u[0]&&n(e,u)&&s(e[u],e,u,a);return!0;
}return!1}},{"./../internal/unicodePrefix":42,"./../support/hasOwn":88,"./../support/removeNode":105}],107:[function(e,t,r){var n=e("./../support/isObject"),i=e("./../support/transferBackReferences"),o=e("./../support/removeNodeAndDescendants");t.exports=function(e,t,r,s,a){return e===t?e:(n(e)&&(i(e,t),o(e,r,s,a)),r[s]=t,t)}},{"./../support/isObject":97,"./../support/removeNodeAndDescendants":106,"./../support/transferBackReferences":108}],108:[function(e,t,r){var n=e("./../internal/ref");t.exports=function(e,t){for(var r=e.ツrefsLength||0,i=t.ツrefsLength||0,o=-1;++o<r;){var s=e[n+o];void 0!==s&&(s.ツcontext=t,t[n+(i+o)]=s,e[n+o]=void 0)}return t.ツrefsLength=r+i,e.ツrefsLength=void 0,t}},{"./../internal/ref":41}],109:[function(e,t,r){var n=e("./../internal/ref");t.exports=function(e){for(var t=-1,r=e.ツrefsLength||0;++t<r;){var i=e[n+t];null!=i&&(i.ツcontext=i.ツrefIndex=e[n+t]=void 0)}return e.ツrefsLength=void 0,e}},{"./../internal/ref":41}],110:[function(e,t,r){var n=e("./../internal/ref");t.exports=function(e){var t=e.ツcontext;if(t){for(var r=(e.ツrefIndex||0)-1,i=(t.ツrefsLength||0)-1;++r<=i;)t[n+r]=t[n+(r+1)];t.ツrefsLength=i,e.ツrefIndex=e.ツcontext=t=void 0}return e}},{"./../internal/ref":41}],111:[function(e,t,r){var n=e("./../internal/ref");t.exports=function(e,t){var r=[e],i=0;do{var o=r[i];if(o&&o.ツversion!==t){o.ツversion=t,r[i++]=o.ツparent;for(var s=-1,a=o.ツrefsLength||0;++s<a;)r[i++]=o[n+s]}}while(--i>-1);return e}},{"./../internal/ref":41}],112:[function(e,t,r){var n=e("./../support/removeNode"),i=e("./../support/updateBackReferenceVersions");t.exports=function(e,t,r,o){var s=e;do{var a=s.ツparent,u=s.$size=(s.$size||0)-t;0>=u&&null!=a?n(s,a,s.ツkey,r):s.ツversion!==o&&i(s,o),s=a}while(s);return e}},{"./../support/removeNode":105,"./../support/updateBackReferenceVersions":111}],113:[function(e,t,r){var n=Array.isArray,i=e("./../support/isPathValue"),o=e("./../support/isJSONGraphEnvelope"),s=e("./../support/isJSONEnvelope"),a=e("falcor-path-syntax");t.exports=function(e,t,r){for(var u=0,c=e.length;c>u;++u){var h=e[u],l=!1;if(n(h)&&t.path?l=!0:"string"==typeof h&&t.pathSyntax?l=!0:i(h)&&t.pathValue?(h.path=a.fromPath(h.path),l=!0):o(h)&&t.jsonGraph?l=!0:s(h)&&t.json?l=!0:"function"==typeof h&&u+1===c&&t.selector&&(l=!0),!l)return new Error("Unrecognized argument "+typeof h+" ["+String(h)+"] to Model#"+r)}return!0}},{"./../support/isJSONEnvelope":95,"./../support/isJSONGraphEnvelope":96,"./../support/isPathValue":98,"falcor-path-syntax":126}],114:[function(e,t,r){var n=e("./../support/now"),i=e("../values/expires-now"),o=50,s=e("./../support/clone"),a=Array.isArray,u=e("./../support/getSize"),c=e("./../support/getExpires"),h=e("./../types/atom");t.exports=function(e,t,r){var l=0,p=e,f=t;if(f){var d=p.ツmodelCreated;p=s(p),l=u(p),p.$type=f,p.ツprev=void 0,p.ツnext=void 0,p.ツmodelCreated=d||!1}else p={$type:h,value:r,"ツprev":void 0,"ツnext":void 0,"ツmodelCreated":!0};if(null==r)l=o+1;else if(null==l||0>=l)switch(typeof r){case"object":l=a(r)?o+r.length:o+1;break;case"string":l=o+r.length;break;default:l=o+1}var m=c(p);return"number"==typeof m&&i>m&&(p.$expires=n()+-1*m),p.$size=l,p}},{"../values/expires-now":119,"./../support/clone":81,"./../support/getExpires":84,"./../support/getSize":85,"./../support/now":103,"./../types/atom":115}],115:[function(e,t,r){t.exports="atom"},{}],116:[function(e,t,r){t.exports="error"},{}],117:[function(e,t,r){t.exports="ref"},{}],118:[function(e,t,r){t.exports=1},{}],119:[function(e,t,r){t.exports=0},{}],120:[function(e,t,r){"use strict";function n(){if(u.length)throw u.shift()}function i(e){var t;t=a.length?a.pop():new o,t.task=e,s(t)}function o(){this.task=null}var s=e("./raw"),a=[],u=[],c=s.makeRequestCallFromTimer(n);t.exports=i,o.prototype.call=function(){try{this.task.call()}catch(e){i.onerror?i.onerror(e):(u.push(e),c())}finally{this.task=null,a[a.length]=this}}},{"./raw":121}],121:[function(e,t,r){(function(e){"use strict";function r(e){a.length||(s(),u=!0),a[a.length]=e}function n(){for(;c<a.length;){var e=c;if(c+=1,a[e].call(),c>h){for(var t=0,r=a.length-c;r>t;t++)a[t]=a[t+c];a.length-=c,c=0}}a.length=0,c=0,u=!1}function i(e){var t=1,r=new l(e),n=document.createTextNode("");return r.observe(n,{characterData:!0}),function(){t=-t,n.data=t}}function o(e){return function(){function t(){clearTimeout(r),clearInterval(n),e()}var r=setTimeout(t,0),n=setInterval(t,50)}}t.exports=r;var s,a=[],u=!1,c=0,h=1024,l=e.MutationObserver||e.WebKitMutationObserver;s="function"==typeof l?i(n):o(n),r.requestFlush=s,r.makeRequestCallFromTimer=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],122:[function(e,t,r){function n(e,t,r){var n=Object.create(null);if(null!=r){for(var i in r)n[i]=r[i];return n.$type=e,n.value=t,n}return{$type:e,value:t}}var i=e("falcor-path-syntax");t.exports={ref:function(e,t){return n("ref",i.fromPath(e),t)},atom:function(e,t){return n("atom",e,t)},undefined:function(){return n("atom")},error:function(e,t){return n("error",e,t)},pathValue:function(e,t){return{path:i.fromPath(e),value:t}},pathInvalidation:function(e){return{path:i.fromPath(e),invalidated:!0}}}},{"falcor-path-syntax":126}],123:[function(e,t,r){t.exports={integers:"integers",ranges:"ranges",keys:"keys"}},{}],124:[function(e,t,r){var n={token:"token",dotSeparator:".",commaSeparator:",",openingBracket:"[",closingBracket:"]",openingBrace:"{",closingBrace:"}",escape:"\\",space:" ",colon:":",quote:"quote",unknown:"unknown"};t.exports=n},{}],125:[function(e,t,r){t.exports={indexer:{nested:"Indexers cannot be nested.",needQuotes:"unquoted indexers must be numeric.",empty:"cannot have empty indexers.",leadingDot:"Indexers cannot have leading dots.",leadingComma:"Indexers cannot have leading comma.",requiresComma:"Indexers require commas between indexer args.",routedTokens:"Only one token can be used per indexer when specifying routed tokens."},range:{precedingNaN:"ranges must be preceded by numbers.",suceedingNaN:"ranges must be suceeded by numbers."},routed:{invalid:"Invalid routed token.  only integers|ranges|keys are supported."},quote:{empty:"cannot have empty quoted keys.",illegalEscape:"Invalid escape character.  Only quotes are escapable."},unexpectedToken:"Unexpected token.",invalidIdentifier:"Invalid Identifier.",invalidPath:"Please provide a valid path.",throwError:function(e,t,r){if(r)throw e+" -- "+t.parseString+" with next token: "+r;throw e+" -- "+t.parseString}}},{}],126:[function(e,t,r){var n=e("./tokenizer"),i=e("./parse-tree/head"),o=e("./RoutedTokens"),s=function(e,t){return i(new n(e,t))};t.exports=s,s.fromPathsOrPathValues=function(e,t){if(!e)return[];for(var r=[],n=0,i=e.length;i>n;n++)"string"==typeof e[n]?r[n]=s(e[n],t):"string"==typeof e[n].path?r[n]={path:s(e[n].path,t),value:e[n].value}:r[n]=e[n];return r},s.fromPath=function(e,t){return e?"string"==typeof e?s(e,t):e:[]},s.RoutedTokens=o},{"./RoutedTokens":123,"./parse-tree/head":127,"./tokenizer":132}],127:[function(e,t,r){var n=e("./../TokenTypes"),i=e("./../exceptions"),o=e("./indexer");t.exports=function(e){for(var t=e.next(),r={},s=[];!t.done;){switch(t.type){case n.token:var a=+t.token[0];isNaN(a)||i.throwError(i.invalidIdentifier,e),s[s.length]=t.token;break;case n.dotSeparator:0===s.length&&i.throwError(i.unexpectedToken,e);break;case n.space:break;case n.openingBracket:o(e,t,r,s);break;default:i.throwError(i.unexpectedToken,e)}t=e.next()}return 0===s.length&&i.throwError(i.invalidPath,e),s}},{"./../TokenTypes":124,"./../exceptions":125,"./indexer":128}],128:[function(e,t,r){var n=e("./../TokenTypes"),i=e("./../exceptions"),o=i.indexer,s=e("./range"),a=e("./quote"),u=e("./routed");t.exports=function(e,t,r,c){var h=e.next(),l=!1,p=1,f=!1;for(r.indexer=[];!h.done;){switch(h.type){case n.token:case n.quote:r.indexer.length===p&&i.throwError(o.requiresComma,e)}switch(h.type){case n.openingBrace:f=!0,u(e,h,r,c);break;case n.token:var d=+h.token;isNaN(d)&&i.throwError(o.needQuotes,e),r.indexer[r.indexer.length]=d;break;case n.dotSeparator:r.indexer.length||i.throwError(o.leadingDot,e),s(e,h,r,c);break;case n.space:break;case n.closingBracket:l=!0;break;case n.quote:a(e,h,r,c);break;case n.openingBracket:i.throwError(o.nested,e);break;case n.commaSeparator:++p;break;default:i.throwError(i.unexpectedToken,e)}if(l)break;h=e.next()}0===r.indexer.length&&i.throwError(o.empty,e),r.indexer.length>1&&f&&i.throwError(o.routedTokens,e),1===r.indexer.length&&(r.indexer=r.indexer[0]),c[c.length]=r.indexer,r.indexer=void 0}},{"./../TokenTypes":124,"./../exceptions":125,"./quote":129,"./range":130,"./routed":131}],129:[function(e,t,r){var n=e("./../TokenTypes"),i=e("./../exceptions"),o=i.quote;t.exports=function(e,t,r,s){for(var a=e.next(),u="",c=t.token,h=!1,l=!1;!a.done;){switch(a.type){case n.token:case n.space:case n.dotSeparator:case n.commaSeparator:case n.openingBracket:case n.closingBracket:case n.openingBrace:case n.closingBrace:h&&i.throwError(o.illegalEscape,e),u+=a.token;break;case n.quote:h?(u+=a.token,h=!1):a.token!==c?u+=a.token:l=!0;break;case n.escape:h=!0;break;default:i.throwError(i.unexpectedToken,e)}if(l)break;a=e.next()}0===u.length&&i.throwError(o.empty,e),r.indexer[r.indexer.length]=u}},{"./../TokenTypes":124,"./../exceptions":125}],130:[function(e,t,r){var n=e("./../tokenizer"),i=e("./../TokenTypes"),o=e("./../exceptions");t.exports=function(e,t,r,s){var a,u=e.peek(),c=1,h=!1,l=!0,p=r.indexer.length-1,f=n.toNumber(r.indexer[p]);for(isNaN(f)&&o.throwError(o.range.precedingNaN,e);!h&&!u.done;){switch(u.type){case i.dotSeparator:3===c&&o.throwError(o.unexpectedToken,e),++c,3===c&&(l=!1);break;case i.token:a=n.toNumber(e.next().token),isNaN(a)&&o.throwError(o.range.suceedingNaN,e),h=!0;break;default:h=!0}if(h)break;e.next(),u=e.peek()}r.indexer[p]={from:f,to:l?a:a-1}}},{"./../TokenTypes":124,"./../exceptions":125,"./../tokenizer":132}],131:[function(e,t,r){var n=e("./../TokenTypes"),i=e("./../RoutedTokens"),o=e("./../exceptions"),s=o.routed;t.exports=function(e,t,r,a){var u=e.next(),c=!1,h="";switch(u.token){case i.integers:case i.ranges:case i.keys:break;default:o.throwError(s.invalid,e)}var l=e.next();if(l.type===n.colon&&(c=!0,l=e.next(),l.type!==n.token&&o.throwError(s.invalid,e),h=l.token,l=e.next()),l.type===n.closingBrace){var p={type:u.token,named:c,name:h};r.indexer[r.indexer.length]=p}else o.throwError(s.invalid,e)}},{"./../RoutedTokens":123,"./../TokenTypes":124,"./../exceptions":125}],132:[function(e,t,r){function n(e,t,r){return{token:e,done:r,type:t}}function i(e,t,r){var i,_=!1,b="",x=r?y:g;do{if(i=t+1>=e.length)break;var w=e[t+1];if(void 0===w||-1!==x.indexOf(w)){if(b.length)break;++t;var S;switch(w){case s:S=o.dotSeparator;break;case a:S=o.commaSeparator;break;case u:S=o.openingBracket;break;case c:S=o.closingBracket;break;case h:S=o.openingBrace;break;case l:S=o.closingBrace;break;case v:S=o.space;break;case d:case m:S=o.quote;break;case f:S=o.escape;break;case p:S=o.colon;break;default:S=o.unknown}_=n(w,S,!1);break}b+=w,++t}while(!i);return!_&&b.length&&(_=n(b,o.token,!1)),_||(_={done:!0}),{token:_,idx:t}}var o=e("./../TokenTypes"),s=".",a=",",u="[",c="]",h="{",l="}",p=":",f="\\",d='"',m="'",v=" ",g="\\'\"[]., ",y="\\{}'\"[]., :",_=t.exports=function(e,t){this._string=e,this._idx=-1,this._extended=t,this.parseString=""};_.prototype={next:function(){var e=this._nextToken?this._nextToken:i(this._string,this._idx,this._extended);return this._idx=e.idx,this._nextToken=!1,this.parseString+=e.token.token,e.token},peek:function(){var e=this._nextToken?this._nextToken:i(this._string,this._idx,this._extended);return this._nextToken=e,e.token}},_.toNumber=function(e){return isNaN(+e)?NaN:+e}},{"./../TokenTypes":124}],133:[function(e,t,r){var n=e("./toPaths"),i=e("./toTree");t.exports=function(e){var t=e.reduce(function(e,t){var r=t.length;return e[r]||(e[r]=[]),e[r].push(t),e},{});return Object.keys(t).forEach(function(e){t[e]=i(t[e])}),n(t)}},{"./toPaths":139,"./toTree":140}],134:[function(e,t,r){var n=e("./iterateKeySet");t.exports=function i(e,t,r){for(var o=e,s=!0;s&&r<t.length;++r){var a=t[r],u=typeof a;if(a&&"object"===u){var c={},h=n(a,c),l=r+1;do{var p=o[h];s=void 0!==p,s&&(s=i(p,t,l)),h=n(a,c)}while(s&&!c.done);break}o=o[a],s=void 0!==o}return s}},{"./iterateKeySet":136}],135:[function(e,t,r){t.exports={iterateKeySet:e("./iterateKeySet"),toTree:e("./toTree"),toTreeWithUnion:e("./toTreeWithUnion"),pathsComplementFromTree:e("./pathsComplementFromTree"),pathsComplementFromLengthTree:e("./pathsComplementFromLengthTree"),hasIntersection:e("./hasIntersection"),toPaths:e("./toPaths"),collapse:e("./collapse")}},{"./collapse":133,"./hasIntersection":134,"./iterateKeySet":136,"./pathsComplementFromLengthTree":137,"./pathsComplementFromTree":138,"./toPaths":139,"./toTree":140,"./toTreeWithUnion":141}],136:[function(e,t,r){function n(e,t){var r=t.from=e.from||0,n=t.to=e.to||"number"==typeof e.length&&t.from+e.length-1||0;t.rangeOffset=t.from,t.loaded=!0,r>n&&(t.empty=!0)}function i(e,t){t.done=!1;var r=t.isObject=!(!e||"object"!=typeof e);t.isArray=r&&o(e),t.arrayOffset=0}var o=Array.isArray;t.exports=function(e,t){if(void 0===t.isArray&&i(e,t),t.isArray){var r;do{t.loaded&&t.rangeOffset>t.to&&(++t.arrayOffset,t.loaded=!1);var o=t.arrayOffset,s=e.length;if(o>=s){t.done=!0;break}var a=e[t.arrayOffset],u=typeof a;if("object"===u){if(t.loaded||n(a,t),t.empty)continue;r=t.rangeOffset++}else++t.arrayOffset,r=a}while(void 0===r);return r}return t.isObject?(t.loaded||n(e,t),t.rangeOffset>t.to?void(t.done=!0):t.rangeOffset++):(t.done=!0,e)}},{}],137:[function(e,t,r){var n=e("./hasIntersection");t.exports=function(e,t){for(var r=[],i=-1,o=0,s=e.length;s>o;++o){var a=e[o];n(t[a.length],a,0)||(r[++i]=a)}return r}},{"./hasIntersection":134}],138:[function(e,t,r){var n=e("./hasIntersection");t.exports=function(e,t){for(var r=[],i=-1,o=0,s=e.length;s>o;++o)n(t,e[o],0)||(r[++i]=e[o]);return r}},{"./hasIntersection":134}],139:[function(e,t,r){function n(e){return null!==e&&typeof e===p}function i(e,t,r){var n,o,s,a,l,p,f,d,m,v,g,y,_,b,x=c(String(t)),w=Object.create(null),S=[],M=-1,E=0,C=[],T=0;if(a=[],l=-1,r-1>t){for(p=u(e,a);++l<p;)n=a[l],o=i(e[n],t+1,r),s=o.code,w[s]?o=w[s]:(S[E++]=s,o=w[s]={keys:[],sets:o.sets}),x=c(x+n+s),h(n)&&o.keys.push(parseInt(n,10))||o.keys.push(n);for(;++M<E;)if(n=S[M],o=w[n],a=o.keys,p=a.length,p>0)for(f=o.sets,d=-1,m=f.length,_=a[0];++d<m;){for(v=f[d],g=-1,y=v.length,b=new Array(y+1),b[0]=p>1&&a||_;++g<y;)b[g+1]=v[g];C[T++]=b}}else for(p=u(e,a),p>1?C[T++]=[a]:C[T++]=a;++l<p;)x=c(x+a[l]);return{code:x,sets:C}}function o(e){for(var t=-1,r=e.length;++t<r;){var n=e[t];l(n)&&(e[t]=s(n))}return e}function s(e){for(var t=-1,r=e.length-1,n=r>0;++t<=r;){var i=e[t];if(!h(i)){n=!1;break}e[t]=parseInt(i,10)}if(n===!0){e.sort(a);var o=e[0],s=e[r];if(r>=s-o)return{from:o,to:s}}return e}function a(e,t){return e-t}function u(e,t,r){var n=0;for(var i in e)t[n++]=i;return n>1&&t.sort(r),n}function c(e){for(var t=5381,r=-1,n=e.length;++r<n;)t=(t<<5)+t+e.charCodeAt(r);return String(t)}function h(e){return!l(e)&&e-parseFloat(e)+1>=0}var l=Array.isArray,p="object";t.exports=function(e){var t,r=[],s=0;for(var a in e)if(h(a)&&n(t=e[a]))for(var u=i(t,0,parseInt(a,10)).sets,c=-1,l=u.length;++c<l;)r[s++]=o(u[c]);return r}},{}],140:[function(e,t,r){function n(e,t,r){var o,s=t[r],a={},u=r+1;o=i(s,a);do{var c=e[o];c||(u===t.length?e[o]=null:c=e[o]={}),u<t.length&&n(c,t,u),a.done||(o=i(s,a))}while(!a.done)}var i=e("./../lib/iterateKeySet");Array.isArray;t.exports=function(e){return e.reduce(function(e,t){return n(e,t,0),e},{})}},{"./../lib/iterateKeySet":136}],141:[function(e,t,r){arguments[4][1][0].apply(r,arguments)},{dup:1}],142:[function(e,t,r){"use strict";t.exports=e("./lib")},{"./lib":147}],143:[function(e,t,r){"use strict";function n(){}function i(e){try{return e.then}catch(t){return v=t,g}}function o(e,t){try{return e(t)}catch(r){return v=r,g}}function s(e,t,r){try{e(t,r)}catch(n){return v=n,g}}function a(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._37=0,this._12=null,this._59=[],e!==n&&d(e,this)}function u(e,t,r){return new e.constructor(function(i,o){var s=new a(n);s.then(i,o),c(e,new f(t,r,s))})}function c(e,t){for(;3===e._37;)e=e._12;return 0===e._37?void e._59.push(t):void m(function(){var r=1===e._37?t.onFulfilled:t.onRejected;if(null===r)return void(1===e._37?h(t.promise,e._12):l(t.promise,e._12));var n=o(r,e._12);n===g?l(t.promise,v):h(t.promise,n)})}function h(e,t){if(t===e)return l(e,new TypeError("A promise cannot be resolved with itself."));if(t&&("object"==typeof t||"function"==typeof t)){var r=i(t);if(r===g)return l(e,v);if(r===e.then&&t instanceof a)return e._37=3,e._12=t,void p(e);if("function"==typeof r)return void d(r.bind(t),e)}e._37=1,e._12=t,p(e)}function l(e,t){e._37=2,e._12=t,p(e)}function p(e){for(var t=0;t<e._59.length;t++)c(e,e._59[t]);e._59=null}function f(e,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=r}function d(e,t){var r=!1,n=s(e,function(e){r||(r=!0,h(t,e))},function(e){r||(r=!0,l(t,e))});r||n!==g||(r=!0,l(t,v))}var m=e("asap/raw"),v=null,g={};t.exports=a,a._99=n,a.prototype.then=function(e,t){if(this.constructor!==a)return u(this,e,t);var r=new a(n);return c(this,new f(e,t,r)),r}},{"asap/raw":121}],144:[function(e,t,r){"use strict";var n=e("./core.js");t.exports=n,n.prototype.done=function(e,t){var r=arguments.length?this.then.apply(this,arguments):this;r.then(null,function(e){setTimeout(function(){throw e},0)})}},{"./core.js":143}],145:[function(e,t,r){"use strict";function n(e){var t=new i(i._99);return t._37=1,t._12=e,t}var i=e("./core.js");t.exports=i;var o=n(!0),s=n(!1),a=n(null),u=n(void 0),c=n(0),h=n("");i.resolve=function(e){if(e instanceof i)return e;if(null===e)return a;if(void 0===e)return u;if(e===!0)return o;if(e===!1)return s;if(0===e)return c;if(""===e)return h;if("object"==typeof e||"function"==typeof e)try{var t=e.then;if("function"==typeof t)return new i(t.bind(e))}catch(r){return new i(function(e,t){t(r)})}return n(e)},i.all=function(e){var t=Array.prototype.slice.call(e);return new i(function(e,r){function n(s,a){if(a&&("object"==typeof a||"function"==typeof a)){if(a instanceof i&&a.then===i.prototype.then){for(;3===a._37;)a=a._12;return 1===a._37?n(s,a._12):(2===a._37&&r(a._12),void a.then(function(e){n(s,e)},r))}var u=a.then;if("function"==typeof u){var c=new i(u.bind(a));return void c.then(function(e){n(s,e)},r)}}t[s]=a,0===--o&&e(t)}if(0===t.length)return e([]);for(var o=t.length,s=0;s<t.length;s++)n(s,t[s])})},i.reject=function(e){return new i(function(t,r){r(e)})},i.race=function(e){return new i(function(t,r){e.forEach(function(e){i.resolve(e).then(t,r)})})},i.prototype["catch"]=function(e){return this.then(null,e)}},{"./core.js":143}],146:[function(e,t,r){"use strict";var n=e("./core.js");t.exports=n,n.prototype["finally"]=function(e){return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})})}},{"./core.js":143}],147:[function(e,t,r){"use strict";t.exports=e("./core.js"),e("./done.js"),e("./finally.js"),e("./es6-extensions.js"),e("./node-extensions.js")},{"./core.js":143,"./done.js":144,"./es6-extensions.js":145,"./finally.js":146,"./node-extensions.js":148}],148:[function(e,t,r){"use strict";var n=e("./core.js"),i=e("asap");t.exports=n,n.denodeify=function(e,t){return t=t||1/0,function(){var r=this,i=Array.prototype.slice.call(arguments,0,t>0?t:0);return new n(function(t,n){i.push(function(e,r){e?n(e):t(r)});var o=e.apply(r,i);!o||"object"!=typeof o&&"function"!=typeof o||"function"!=typeof o.then||t(o)})}},n.nodeify=function(e){return function(){var t=Array.prototype.slice.call(arguments),r="function"==typeof t[t.length-1]?t.pop():null,o=this;try{return e.apply(this,arguments).nodeify(r,o)}catch(s){if(null===r||"undefined"==typeof r)return new n(function(e,t){t(s)});i(function(){r.call(o,s)})}}},n.prototype.nodeify=function(e,t){return"function"!=typeof e?this:void this.then(function(r){i(function(){e.call(t,null,r)})},function(r){i(function(){e.call(t,r)})})}},{"./core.js":143,asap:120}],149:[function(e,t,r){var n=e("./lib");t.exports={Graph:n.Graph,json:e("./lib/json"),alg:e("./lib/alg"),version:n.version}},{"./lib":165,"./lib/alg":156,"./lib/json":166}],150:[function(e,t,r){function n(e){function t(o){i.has(n,o)||(n[o]=!0,r.push(o),i.each(e.successors(o),t),i.each(e.predecessors(o),t))}var r,n={},o=[];return i.each(e.nodes(),function(e){r=[],t(e),r.length&&o.push(r)}),o}var i=e("../lodash");t.exports=n},{"../lodash":167}],151:[function(e,t,r){function n(e,t,r){o.isArray(t)||(t=[t]);var n=[],s={};return o.each(t,function(t){if(!e.hasNode(t))throw new Error("Graph does not have node: "+t);i(e,t,"post"===r,s,n)}),n}function i(e,t,r,n,s){o.has(n,t)||(n[t]=!0,r||s.push(t),o.each(e.neighbors(t),function(t){i(e,t,r,n,s)}),r&&s.push(t))}var o=e("../lodash");t.exports=n},{"../lodash":167}],152:[function(e,t,r){function n(e,t,r){return o.transform(e.nodes(),function(n,o){n[o]=i(e,o,t,r)},{})}var i=e("./dijkstra"),o=e("../lodash");t.exports=n},{"../lodash":167,"./dijkstra":153}],153:[function(e,t,r){function n(e,t,r,n){return i(e,String(t),r||a,n||function(t){return e.outEdges(t)})}function i(e,t,r,n){var i,o,a={},u=new s,c=function(e){var t=e.v!==i?e.v:e.w,n=a[t],s=r(e),c=o.distance+s;if(0>s)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+e+" Weight: "+s);c<n.distance&&(n.distance=c,n.predecessor=i,u.decrease(t,c))};for(e.nodes().forEach(function(e){var r=e===t?0:Number.POSITIVE_INFINITY;a[e]={distance:r},u.add(e,r)});u.size()>0&&(i=u.removeMin(),o=a[i],o.distance!==Number.POSITIVE_INFINITY);)n(i).forEach(c);return a}var o=e("../lodash"),s=e("../data/priority-queue");t.exports=n;var a=o.constant(1)},{"../data/priority-queue":163,"../lodash":167}],154:[function(e,t,r){function n(e){return i.filter(o(e),function(t){return t.length>1||1===t.length&&e.hasEdge(t[0],t[0])})}var i=e("../lodash"),o=e("./tarjan");t.exports=n},{"../lodash":167,"./tarjan":161}],155:[function(e,t,r){function n(e,t,r){return i(e,t||s,r||function(t){return e.outEdges(t)})}function i(e,t,r){var n={},i=e.nodes();return i.forEach(function(e){n[e]={},n[e][e]={distance:0},i.forEach(function(t){e!==t&&(n[e][t]={distance:Number.POSITIVE_INFINITY})}),r(e).forEach(function(r){var i=r.v===e?r.w:r.v,o=t(r);n[e][i]={distance:o,predecessor:e}})}),i.forEach(function(e){var t=n[e];i.forEach(function(r){var o=n[r];i.forEach(function(r){var n=o[e],i=t[r],s=o[r],a=n.distance+i.distance;a<s.distance&&(s.distance=a,s.predecessor=i.predecessor)})})}),n}var o=e("../lodash");t.exports=n;var s=o.constant(1)},{"../lodash":167}],156:[function(e,t,r){t.exports={components:e("./components"),dijkstra:e("./dijkstra"),dijkstraAll:e("./dijkstra-all"),findCycles:e("./find-cycles"),floydWarshall:e("./floyd-warshall"),isAcyclic:e("./is-acyclic"),postorder:e("./postorder"),preorder:e("./preorder"),prim:e("./prim"),tarjan:e("./tarjan"),topsort:e("./topsort")}},{"./components":150,"./dijkstra":153,"./dijkstra-all":152,"./find-cycles":154,"./floyd-warshall":155,"./is-acyclic":157,"./postorder":158,"./preorder":159,"./prim":160,"./tarjan":161,"./topsort":162}],157:[function(e,t,r){function n(e){try{i(e)}catch(t){if(t instanceof i.CycleException)return!1;throw t}return!0}var i=e("./topsort");t.exports=n},{"./topsort":162}],158:[function(e,t,r){function n(e,t){return i(e,t,"post")}var i=e("./dfs");t.exports=n},{"./dfs":151}],159:[function(e,t,r){function n(e,t){return i(e,t,"pre")}var i=e("./dfs");t.exports=n},{"./dfs":151}],160:[function(e,t,r){function n(e,t){function r(e){var r=e.v===n?e.w:e.v,i=c.priority(r);if(void 0!==i){var o=t(e);i>o&&(u[r]=n,c.decrease(r,o))}}var n,a=new o,u={},c=new s;if(0===e.nodeCount())return a;i.each(e.nodes(),function(e){c.add(e,Number.POSITIVE_INFINITY),a.setNode(e)}),c.decrease(e.nodes()[0],0);for(var h=!1;c.size()>0;){if(n=c.removeMin(),i.has(u,n))a.setEdge(n,u[n]);else{if(h)throw new Error("Input graph is not connected: "+e);h=!0}e.nodeEdges(n).forEach(r)}return a}var i=e("../lodash"),o=e("../graph"),s=e("../data/priority-queue");t.exports=n},{"../data/priority-queue":163,"../graph":164,"../lodash":167}],161:[function(e,t,r){function n(e){function t(a){var u=o[a]={onStack:!0,lowlink:r,index:r++};if(n.push(a),e.successors(a).forEach(function(e){i.has(o,e)?o[e].onStack&&(u.lowlink=Math.min(u.lowlink,o[e].index)):(t(e),u.lowlink=Math.min(u.lowlink,o[e].lowlink))}),u.lowlink===u.index){var c,h=[];do c=n.pop(),o[c].onStack=!1,h.push(c);while(a!==c);s.push(h)}}var r=0,n=[],o={},s=[];return e.nodes().forEach(function(e){i.has(o,e)||t(e)}),s}var i=e("../lodash");t.exports=n},{"../lodash":167}],162:[function(e,t,r){function n(e){function t(a){if(o.has(n,a))throw new i;o.has(r,a)||(n[a]=!0,r[a]=!0,o.each(e.predecessors(a),t),delete n[a],s.push(a))}var r={},n={},s=[];if(o.each(e.sinks(),t),o.size(r)!==e.nodeCount())throw new i;return s}function i(){}var o=e("../lodash");t.exports=n,n.CycleException=i},{"../lodash":167}],163:[function(e,t,r){function n(){this._arr=[],this._keyIndices={}}var i=e("../lodash");t.exports=n,n.prototype.size=function(){return this._arr.length},n.prototype.keys=function(){return this._arr.map(function(e){return e.key})},n.prototype.has=function(e){return i.has(this._keyIndices,e)},n.prototype.priority=function(e){var t=this._keyIndices[e];return void 0!==t?this._arr[t].priority:void 0},n.prototype.min=function(){if(0===this.size())throw new Error("Queue underflow");return this._arr[0].key},n.prototype.add=function(e,t){var r=this._keyIndices;if(e=String(e),!i.has(r,e)){var n=this._arr,o=n.length;return r[e]=o,n.push({key:e,priority:t}),this._decrease(o),!0}return!1},n.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var e=this._arr.pop();return delete this._keyIndices[e.key],this._heapify(0),e.key},n.prototype.decrease=function(e,t){var r=this._keyIndices[e];if(t>this._arr[r].priority)throw new Error("New priority is greater than current priority. Key: "+e+" Old: "+this._arr[r].priority+" New: "+t);this._arr[r].priority=t,this._decrease(r)},n.prototype._heapify=function(e){var t=this._arr,r=2*e,n=r+1,i=e;r<t.length&&(i=t[r].priority<t[i].priority?r:i,n<t.length&&(i=t[n].priority<t[i].priority?n:i),i!==e&&(this._swap(e,i),this._heapify(i)))},n.prototype._decrease=function(e){for(var t,r=this._arr,n=r[e].priority;0!==e&&(t=e>>1,!(r[t].priority<n));)this._swap(e,t),e=t},n.prototype._swap=function(e,t){var r=this._arr,n=this._keyIndices,i=r[e],o=r[t];r[e]=o,r[t]=i,n[o.key]=e,n[i.key]=t}},{"../lodash":167}],164:[function(e,t,r){"use strict";function n(e){this._isDirected=c.has(e,"directed")?e.directed:!0,this._isMultigraph=c.has(e,"multigraph")?e.multigraph:!1,this._isCompound=c.has(e,"compound")?e.compound:!1,this._label=void 0,this._defaultNodeLabelFn=c.constant(void 0),this._defaultEdgeLabelFn=c.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[l]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}function i(e,t){e[t]?e[t]++:e[t]=1}function o(e,t){--e[t]||delete e[t]}function s(e,t,r,n){var i=""+t,o=""+r;if(!e&&i>o){var s=i;i=o,o=s}return i+p+o+p+(c.isUndefined(n)?h:n)}function a(e,t,r,n){var i=""+t,o=""+r;if(!e&&i>o){var s=i;i=o,o=s}var a={v:i,w:o};return n&&(a.name=n),a}function u(e,t){return s(e,t.v,t.w,t.name)}var c=e("./lodash");t.exports=n;var h="\x00",l="\x00",p="";n.prototype._nodeCount=0,n.prototype._edgeCount=0,n.prototype.isDirected=function(){return this._isDirected},n.prototype.isMultigraph=function(){return this._isMultigraph},n.prototype.isCompound=function(){return this._isCompound},n.prototype.setGraph=function(e){return this._label=e,this},n.prototype.graph=function(){return this._label},n.prototype.setDefaultNodeLabel=function(e){return c.isFunction(e)||(e=c.constant(e)),this._defaultNodeLabelFn=e,this},n.prototype.nodeCount=function(){return this._nodeCount},n.prototype.nodes=function(){return c.keys(this._nodes)},n.prototype.sources=function(){return c.filter(this.nodes(),function(e){return c.isEmpty(this._in[e])},this)},n.prototype.sinks=function(){return c.filter(this.nodes(),function(e){return c.isEmpty(this._out[e])},this)},n.prototype.setNodes=function(e,t){var r=arguments;return c.each(e,function(e){r.length>1?this.setNode(e,t):this.setNode(e)},this),this},n.prototype.setNode=function(e,t){return c.has(this._nodes,e)?(arguments.length>1&&(this._nodes[e]=t),this):(this._nodes[e]=arguments.length>1?t:this._defaultNodeLabelFn(e),this._isCompound&&(this._parent[e]=l,this._children[e]={},this._children[l][e]=!0),this._in[e]={},this._preds[e]={},this._out[e]={},this._sucs[e]={},++this._nodeCount,this)},n.prototype.node=function(e){return this._nodes[e]},n.prototype.hasNode=function(e){return c.has(this._nodes,e)},n.prototype.removeNode=function(e){var t=this;if(c.has(this._nodes,e)){var r=function(e){t.removeEdge(t._edgeObjs[e])};delete this._nodes[e],this._isCompound&&(this._removeFromParentsChildList(e),delete this._parent[e],c.each(this.children(e),function(e){this.setParent(e)},this),delete this._children[e]),c.each(c.keys(this._in[e]),r),delete this._in[e],delete this._preds[e],c.each(c.keys(this._out[e]),r),delete this._out[e],delete this._sucs[e],--this._nodeCount}return this},n.prototype.setParent=function(e,t){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(c.isUndefined(t))t=l;else{t+="";for(var r=t;!c.isUndefined(r);r=this.parent(r))if(r===e)throw new Error("Setting "+t+" as parent of "+e+" would create create a cycle");this.setNode(t)}return this.setNode(e),this._removeFromParentsChildList(e),this._parent[e]=t,this._children[t][e]=!0,this},n.prototype._removeFromParentsChildList=function(e){delete this._children[this._parent[e]][e]},n.prototype.parent=function(e){if(this._isCompound){var t=this._parent[e];if(t!==l)return t}},n.prototype.children=function(e){if(c.isUndefined(e)&&(e=l),this._isCompound){var t=this._children[e];if(t)return c.keys(t)}else{if(e===l)return this.nodes();if(this.hasNode(e))return[]}},n.prototype.predecessors=function(e){var t=this._preds[e];return t?c.keys(t):void 0},n.prototype.successors=function(e){var t=this._sucs[e];return t?c.keys(t):void 0},n.prototype.neighbors=function(e){var t=this.predecessors(e);return t?c.union(t,this.successors(e)):void 0},n.prototype.filterNodes=function(e){function t(e){var o=n.parent(e);return void 0===o||r.hasNode(o)?(i[e]=o,o):o in i?i[o]:t(o)}var r=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});r.setGraph(this.graph()),c.each(this._nodes,function(t,n){e(n)&&r.setNode(n,t)},this),c.each(this._edgeObjs,function(e){r.hasNode(e.v)&&r.hasNode(e.w)&&r.setEdge(e,this.edge(e))},this);var n=this,i={};return this._isCompound&&c.each(r.nodes(),function(e){r.setParent(e,t(e))}),r},n.prototype.setDefaultEdgeLabel=function(e){return c.isFunction(e)||(e=c.constant(e)),this._defaultEdgeLabelFn=e,this},n.prototype.edgeCount=function(){return this._edgeCount},n.prototype.edges=function(){return c.values(this._edgeObjs)},n.prototype.setPath=function(e,t){var r=this,n=arguments;return c.reduce(e,function(e,i){return n.length>1?r.setEdge(e,i,t):r.setEdge(e,i),i}),this},n.prototype.setEdge=function(){var e,t,r,n,o=!1,u=arguments[0];"object"==typeof u&&null!==u&&"v"in u?(e=u.v,t=u.w,r=u.name,2===arguments.length&&(n=arguments[1],o=!0)):(e=u,t=arguments[1],r=arguments[3],arguments.length>2&&(n=arguments[2],o=!0)),e=""+e,t=""+t,c.isUndefined(r)||(r=""+r);var h=s(this._isDirected,e,t,r);if(c.has(this._edgeLabels,h))return o&&(this._edgeLabels[h]=n),this;if(!c.isUndefined(r)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(e),this.setNode(t),this._edgeLabels[h]=o?n:this._defaultEdgeLabelFn(e,t,r);var l=a(this._isDirected,e,t,r);
return e=l.v,t=l.w,Object.freeze(l),this._edgeObjs[h]=l,i(this._preds[t],e),i(this._sucs[e],t),this._in[t][h]=l,this._out[e][h]=l,this._edgeCount++,this},n.prototype.edge=function(e,t,r){var n=1===arguments.length?u(this._isDirected,arguments[0]):s(this._isDirected,e,t,r);return this._edgeLabels[n]},n.prototype.hasEdge=function(e,t,r){var n=1===arguments.length?u(this._isDirected,arguments[0]):s(this._isDirected,e,t,r);return c.has(this._edgeLabels,n)},n.prototype.removeEdge=function(e,t,r){var n=1===arguments.length?u(this._isDirected,arguments[0]):s(this._isDirected,e,t,r),i=this._edgeObjs[n];return i&&(e=i.v,t=i.w,delete this._edgeLabels[n],delete this._edgeObjs[n],o(this._preds[t],e),o(this._sucs[e],t),delete this._in[t][n],delete this._out[e][n],this._edgeCount--),this},n.prototype.inEdges=function(e,t){var r=this._in[e];if(r){var n=c.values(r);return t?c.filter(n,function(e){return e.v===t}):n}},n.prototype.outEdges=function(e,t){var r=this._out[e];if(r){var n=c.values(r);return t?c.filter(n,function(e){return e.w===t}):n}},n.prototype.nodeEdges=function(e,t){var r=this.inEdges(e,t);return r?r.concat(this.outEdges(e,t)):void 0}},{"./lodash":167}],165:[function(e,t,r){t.exports={Graph:e("./graph"),version:e("./version")}},{"./graph":164,"./version":168}],166:[function(e,t,r){function n(e){var t={options:{directed:e.isDirected(),multigraph:e.isMultigraph(),compound:e.isCompound()},nodes:i(e),edges:o(e)};return a.isUndefined(e.graph())||(t.value=a.clone(e.graph())),t}function i(e){return a.map(e.nodes(),function(t){var r=e.node(t),n=e.parent(t),i={v:t};return a.isUndefined(r)||(i.value=r),a.isUndefined(n)||(i.parent=n),i})}function o(e){return a.map(e.edges(),function(t){var r=e.edge(t),n={v:t.v,w:t.w};return a.isUndefined(t.name)||(n.name=t.name),a.isUndefined(r)||(n.value=r),n})}function s(e){var t=new u(e.options).setGraph(e.value);return a.each(e.nodes,function(e){t.setNode(e.v,e.value),e.parent&&t.setParent(e.v,e.parent)}),a.each(e.edges,function(e){t.setEdge({v:e.v,w:e.w,name:e.name},e.value)}),t}var a=e("./lodash"),u=e("./graph");t.exports={write:n,read:s}},{"./graph":164,"./lodash":167}],167:[function(e,t,r){var n;if("function"==typeof e)try{n=e("lodash")}catch(i){}n||(n=window._),t.exports=n},{lodash:169}],168:[function(e,t,r){t.exports="1.0.7"},{}],169:[function(t,r,n){(function(t){(function(){function i(e,t){if(e!==t){var r=null===e,n=e===C,i=e===e,o=null===t,s=t===C,a=t===t;if(e>t&&!o||!i||r&&!s&&a||n&&a)return 1;if(t>e&&!r||!a||o&&!n&&i||s&&i)return-1}return 0}function o(e,t,r){for(var n=e.length,i=r?n:-1;r?i--:++i<n;)if(t(e[i],i,e))return i;return-1}function s(e,t,r){if(t!==t)return g(e,r);for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}function a(e){return"function"==typeof e||!1}function u(e){return null==e?"":e+""}function c(e,t){for(var r=-1,n=e.length;++r<n&&t.indexOf(e.charAt(r))>-1;);return r}function h(e,t){for(var r=e.length;r--&&t.indexOf(e.charAt(r))>-1;);return r}function l(e,t){return i(e.criteria,t.criteria)||e.index-t.index}function p(e,t,r){for(var n=-1,o=e.criteria,s=t.criteria,a=o.length,u=r.length;++n<a;){var c=i(o[n],s[n]);if(c){if(n>=u)return c;var h=r[n];return c*("asc"===h||h===!0?1:-1)}}return e.index-t.index}function f(e){return We[e]}function d(e){return qe[e]}function m(e,t,r){return t?e=Ke[e]:r&&(e=Ye[e]),"\\"+e}function v(e){return"\\"+Ye[e]}function g(e,t,r){for(var n=e.length,i=t+(r?0:-1);r?i--:++i<n;){var o=e[i];if(o!==o)return i}return-1}function y(e){return!!e&&"object"==typeof e}function _(e){return 160>=e&&e>=9&&13>=e||32==e||160==e||5760==e||6158==e||e>=8192&&(8202>=e||8232==e||8233==e||8239==e||8287==e||12288==e||65279==e)}function b(e,t){for(var r=-1,n=e.length,i=-1,o=[];++r<n;)e[r]===t&&(e[r]=W,o[++i]=r);return o}function x(e,t){for(var r,n=-1,i=e.length,o=-1,s=[];++n<i;){var a=e[n],u=t?t(a,n,e):a;n&&r===u||(r=u,s[++o]=a)}return s}function w(e){for(var t=-1,r=e.length;++t<r&&_(e.charCodeAt(t)););return t}function S(e){for(var t=e.length;t--&&_(e.charCodeAt(t)););return t}function M(e){return $e[e]}function E(e){function t(e){if(y(e)&&!Pa(e)&&!(e instanceof _)){if(e instanceof n)return e;if(ts.call(e,"__chain__")&&ts.call(e,"__wrapped__"))return fn(e)}return new n(e)}function r(){}function n(e,t,r){this.__wrapped__=e,this.__actions__=r||[],this.__chain__=!!t}function _(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=As,this.__views__=[]}function J(){var e=new _(this.__wrapped__);return e.__actions__=et(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=et(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=et(this.__views__),e}function re(){if(this.__filtered__){var e=new _(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function ie(){var e=this.__wrapped__.value(),t=this.__dir__,r=Pa(e),n=0>t,i=r?e.length:0,o=Wr(0,i,this.__views__),s=o.start,a=o.end,u=a-s,c=n?a:s-1,h=this.__iteratees__,l=h.length,p=0,f=Ss(u,this.__takeCount__);if(!r||U>i||i==u&&f==u)return rr(n&&r?e.reverse():e,this.__actions__);var d=[];e:for(;u--&&f>p;){c+=t;for(var m=-1,v=e[c];++m<l;){var g=h[m],y=g.iteratee,_=g.type,b=y(v);if(_==z)v=b;else if(!b){if(_==G)continue e;break e}}d[p++]=v}return d}function We(){this.__data__={}}function qe(e){return this.has(e)&&delete this.__data__[e]}function $e(e){return"__proto__"==e?C:this.__data__[e]}function Xe(e){return"__proto__"!=e&&ts.call(this.__data__,e)}function Ke(e,t){return"__proto__"!=e&&(this.__data__[e]=t),this}function Ye(e){var t=e?e.length:0;for(this.data={hash:gs(null),set:new ls};t--;)this.push(e[t])}function Qe(e,t){var r=e.data,n="string"==typeof t||Li(t)?r.set.has(t):r.hash[t];return n?0:-1}function Je(e){var t=this.data;"string"==typeof e||Li(e)?t.set.add(e):t.hash[e]=!0}function Ze(e,t){for(var r=-1,n=e.length,i=-1,o=t.length,s=Uo(n+o);++r<n;)s[r]=e[r];for(;++i<o;)s[r++]=t[i];return s}function et(e,t){var r=-1,n=e.length;for(t||(t=Uo(n));++r<n;)t[r]=e[r];return t}function tt(e,t){for(var r=-1,n=e.length;++r<n&&t(e[r],r,e)!==!1;);return e}function rt(e,t){for(var r=e.length;r--&&t(e[r],r,e)!==!1;);return e}function ot(e,t){for(var r=-1,n=e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}function st(e,t,r,n){for(var i=-1,o=e.length,s=n,a=s;++i<o;){var u=e[i],c=+t(u);r(c,s)&&(s=c,a=u)}return a}function at(e,t){for(var r=-1,n=e.length,i=-1,o=[];++r<n;){var s=e[r];t(s,r,e)&&(o[++i]=s)}return o}function ut(e,t){for(var r=-1,n=e.length,i=Uo(n);++r<n;)i[r]=t(e[r],r,e);return i}function ct(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}function ht(e,t,r,n){var i=-1,o=e.length;for(n&&o&&(r=e[++i]);++i<o;)r=t(r,e[i],i,e);return r}function lt(e,t,r,n){var i=e.length;for(n&&i&&(r=e[--i]);i--;)r=t(r,e[i],i,e);return r}function pt(e,t){for(var r=-1,n=e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function ft(e,t){for(var r=e.length,n=0;r--;)n+=+t(e[r])||0;return n}function dt(e,t){return e===C?t:e}function mt(e,t,r,n){return e!==C&&ts.call(n,r)?e:t}function vt(e,t,r){for(var n=-1,i=Ba(t),o=i.length;++n<o;){var s=i[n],a=e[s],u=r(a,t[s],s,e,t);(u===u?u===a:a!==a)&&(a!==C||s in e)||(e[s]=u)}return e}function gt(e,t){return null==t?e:_t(t,Ba(t),e)}function yt(e,t){for(var r=-1,n=null==e,i=!n&&Yr(e),o=i?e.length:0,s=t.length,a=Uo(s);++r<s;){var u=t[r];i?a[r]=Qr(u,o)?e[u]:C:a[r]=n?C:e[u]}return a}function _t(e,t,r){r||(r={});for(var n=-1,i=t.length;++n<i;){var o=t[n];r[o]=e[o]}return r}function bt(e,t,r){var n=typeof e;return"function"==n?t===C?e:or(e,t,r):null==e?Ao:"object"==n?Ft(e):t===C?Lo(e):Bt(e,t)}function xt(e,t,r,n,i,o,s){var a;if(r&&(a=i?r(e,n,i):r(e)),a!==C)return a;if(!Li(e))return e;var u=Pa(e);if(u){if(a=qr(e),!t)return et(e,a)}else{var c=ns.call(e),h=c==Q;if(c!=ee&&c!=q&&(!h||i))return He[c]?Xr(e,c,t):i?e:{};if(a=$r(h?{}:e),!t)return gt(a,e)}o||(o=[]),s||(s=[]);for(var l=o.length;l--;)if(o[l]==e)return s[l];return o.push(e),s.push(a),(u?tt:Ot)(e,function(n,i){a[i]=xt(n,t,r,i,e,o,s)}),a}function wt(e,t,r){if("function"!=typeof e)throw new Yo(H);return ps(function(){e.apply(C,r)},t)}function St(e,t){var r=e?e.length:0,n=[];if(!r)return n;var i=-1,o=Gr(),a=o==s,u=a&&t.length>=U?dr(t):null,c=t.length;u&&(o=Qe,a=!1,t=u);e:for(;++i<r;){var h=e[i];if(a&&h===h){for(var l=c;l--;)if(t[l]===h)continue e;n.push(h)}else o(t,h,0)<0&&n.push(h)}return n}function Mt(e,t){var r=!0;return js(e,function(e,n,i){return r=!!t(e,n,i)}),r}function Et(e,t,r,n){var i=n,o=i;return js(e,function(e,s,a){var u=+t(e,s,a);(r(u,i)||u===n&&u===o)&&(i=u,o=e)}),o}function Ct(e,t,r,n){var i=e.length;for(r=null==r?0:+r||0,0>r&&(r=-r>i?0:i+r),n=n===C||n>i?i:+n||0,0>n&&(n+=i),i=r>n?0:n>>>0,r>>>=0;i>r;)e[r++]=t;return e}function Tt(e,t){var r=[];return js(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r}function At(e,t,r,n){var i;return r(e,function(e,r,o){return t(e,r,o)?(i=n?r:e,!1):void 0}),i}function Pt(e,t,r,n){n||(n=[]);for(var i=-1,o=e.length;++i<o;){var s=e[i];y(s)&&Yr(s)&&(r||Pa(s)||Ei(s))?t?Pt(s,t,r,n):ct(n,s):r||(n[n.length]=s)}return n}function kt(e,t){return Vs(e,t,eo)}function Ot(e,t){return Vs(e,t,Ba)}function Nt(e,t){return Fs(e,t,Ba)}function Dt(e,t){for(var r=-1,n=t.length,i=-1,o=[];++r<n;){var s=t[r];Di(e[s])&&(o[++i]=s)}return o}function Lt(e,t,r){if(null!=e){r!==C&&r in ln(e)&&(t=[r]);for(var n=0,i=t.length;null!=e&&i>n;)e=e[t[n++]];return n&&n==i?e:C}}function Rt(e,t,r,n,i,o){return e===t?!0:null==e||null==t||!Li(e)&&!y(t)?e!==e&&t!==t:jt(e,t,Rt,r,n,i,o)}function jt(e,t,r,n,i,o,s){var a=Pa(e),u=Pa(t),c=$,h=$;a||(c=ns.call(e),c==q?c=ee:c!=ee&&(a=zi(e))),u||(h=ns.call(t),h==q?h=ee:h!=ee&&(u=zi(t)));var l=c==ee,p=h==ee,f=c==h;if(f&&!a&&!l)return Vr(e,t,c);if(!i){var d=l&&ts.call(e,"__wrapped__"),m=p&&ts.call(t,"__wrapped__");if(d||m)return r(d?e.value():e,m?t.value():t,n,i,o,s)}if(!f)return!1;o||(o=[]),s||(s=[]);for(var v=o.length;v--;)if(o[v]==e)return s[v]==t;o.push(e),s.push(t);var g=(a?Ir:Fr)(e,t,r,n,i,o,s);return o.pop(),s.pop(),g}function It(e,t,r){var n=t.length,i=n,o=!r;if(null==e)return!i;for(e=ln(e);n--;){var s=t[n];if(o&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++n<i;){s=t[n];var a=s[0],u=e[a],c=s[1];if(o&&s[2]){if(u===C&&!(a in e))return!1}else{var h=r?r(u,c,a):C;if(!(h===C?Rt(c,u,r,!0):h))return!1}}return!0}function Vt(e,t){var r=-1,n=Yr(e)?Uo(e.length):[];return js(e,function(e,i,o){n[++r]=t(e,i,o)}),n}function Ft(e){var t=zr(e);if(1==t.length&&t[0][2]){var r=t[0][0],n=t[0][1];return function(e){return null==e?!1:e[r]===n&&(n!==C||r in ln(e))}}return function(e){return It(e,t)}}function Bt(e,t){var r=Pa(e),n=Zr(e)&&rn(t),i=e+"";return e=pn(e),function(o){if(null==o)return!1;var s=i;if(o=ln(o),(r||!n)&&!(s in o)){if(o=1==e.length?o:Lt(o,Xt(e,0,-1)),null==o)return!1;s=Cn(e),o=ln(o)}return o[s]===t?t!==C||s in o:Rt(t,o[s],C,!0)}}function Ut(e,t,r,n,i){if(!Li(e))return e;var o=Yr(t)&&(Pa(t)||zi(t)),s=o?C:Ba(t);return tt(s||t,function(a,u){if(s&&(u=a,a=t[u]),y(a))n||(n=[]),i||(i=[]),Gt(e,t,u,Ut,r,n,i);else{var c=e[u],h=r?r(c,a,u,e,t):C,l=h===C;l&&(h=a),h===C&&(!o||u in e)||!l&&(h===h?h===c:c!==c)||(e[u]=h)}}),e}function Gt(e,t,r,n,i,o,s){for(var a=o.length,u=t[r];a--;)if(o[a]==u)return void(e[r]=s[a]);var c=e[r],h=i?i(c,u,r,e,t):C,l=h===C;l&&(h=u,Yr(u)&&(Pa(u)||zi(u))?h=Pa(c)?c:Yr(c)?et(c):[]:Bi(u)||Ei(u)?h=Ei(c)?Xi(c):Bi(c)?c:{}:l=!1),o.push(u),s.push(h),l?e[r]=n(h,u,i,o,s):(h===h?h!==c:c===c)&&(e[r]=h)}function zt(e){return function(t){return null==t?C:t[e]}}function Ht(e){var t=e+"";return e=pn(e),function(r){return Lt(r,e,t)}}function Wt(e,t){for(var r=e?t.length:0;r--;){var n=t[r];if(n!=i&&Qr(n)){var i=n;fs.call(e,n,1)}}return e}function qt(e,t){return e+ys(Cs()*(t-e+1))}function $t(e,t,r,n,i){return i(e,function(e,i,o){r=n?(n=!1,e):t(r,e,i,o)}),r}function Xt(e,t,r){var n=-1,i=e.length;t=null==t?0:+t||0,0>t&&(t=-t>i?0:i+t),r=r===C||r>i?i:+r||0,0>r&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var o=Uo(i);++n<i;)o[n]=e[n+t];return o}function Kt(e,t){var r;return js(e,function(e,n,i){return r=t(e,n,i),!r}),!!r}function Yt(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}function Qt(e,t,r){var n=Br(),i=-1;t=ut(t,function(e){return n(e)});var o=Vt(e,function(e){var r=ut(t,function(t){return t(e)});return{criteria:r,index:++i,value:e}});return Yt(o,function(e,t){return p(e,t,r)})}function Jt(e,t){var r=0;return js(e,function(e,n,i){r+=+t(e,n,i)||0}),r}function Zt(e,t){var r=-1,n=Gr(),i=e.length,o=n==s,a=o&&i>=U,u=a?dr():null,c=[];u?(n=Qe,o=!1):(a=!1,u=t?[]:c);e:for(;++r<i;){var h=e[r],l=t?t(h,r,e):h;if(o&&h===h){for(var p=u.length;p--;)if(u[p]===l)continue e;t&&u.push(l),c.push(h)}else n(u,l,0)<0&&((t||a)&&u.push(l),c.push(h))}return c}function er(e,t){for(var r=-1,n=t.length,i=Uo(n);++r<n;)i[r]=e[t[r]];return i}function tr(e,t,r,n){for(var i=e.length,o=n?i:-1;(n?o--:++o<i)&&t(e[o],o,e););return r?Xt(e,n?0:o,n?o+1:i):Xt(e,n?o+1:0,n?i:o)}function rr(e,t){var r=e;r instanceof _&&(r=r.value());for(var n=-1,i=t.length;++n<i;){var o=t[n];r=o.func.apply(o.thisArg,ct([r],o.args))}return r}function nr(e,t,r){var n=0,i=e?e.length:n;if("number"==typeof t&&t===t&&Os>=i){for(;i>n;){var o=n+i>>>1,s=e[o];(r?t>=s:t>s)&&null!==s?n=o+1:i=o}return i}return ir(e,t,Ao,r)}function ir(e,t,r,n){t=r(t);for(var i=0,o=e?e.length:0,s=t!==t,a=null===t,u=t===C;o>i;){var c=ys((i+o)/2),h=r(e[c]),l=h!==C,p=h===h;if(s)var f=p||n;else f=a?p&&l&&(n||null!=h):u?p&&(n||l):null==h?!1:n?t>=h:t>h;f?i=c+1:o=c}return Ss(o,ks)}function or(e,t,r){if("function"!=typeof e)return Ao;if(t===C)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 3:return function(r,n,i){return e.call(t,r,n,i)};case 4:return function(r,n,i,o){return e.call(t,r,n,i,o)};case 5:return function(r,n,i,o,s){return e.call(t,r,n,i,o,s)}}return function(){return e.apply(t,arguments)}}function sr(e){var t=new ss(e.byteLength),r=new ds(t);return r.set(new ds(e)),t}function ar(e,t,r){for(var n=r.length,i=-1,o=ws(e.length-n,0),s=-1,a=t.length,u=Uo(a+o);++s<a;)u[s]=t[s];for(;++i<n;)u[r[i]]=e[i];for(;o--;)u[s++]=e[i++];return u}function ur(e,t,r){for(var n=-1,i=r.length,o=-1,s=ws(e.length-i,0),a=-1,u=t.length,c=Uo(s+u);++o<s;)c[o]=e[o];for(var h=o;++a<u;)c[h+a]=t[a];for(;++n<i;)c[h+r[n]]=e[o++];return c}function cr(e,t){return function(r,n,i){var o=t?t():{};if(n=Br(n,i,3),Pa(r))for(var s=-1,a=r.length;++s<a;){var u=r[s];e(o,u,n(u,s,r),r)}else js(r,function(t,r,i){e(o,t,n(t,r,i),i)});return o}}function hr(e){return gi(function(t,r){var n=-1,i=null==t?0:r.length,o=i>2?r[i-2]:C,s=i>2?r[2]:C,a=i>1?r[i-1]:C;for("function"==typeof o?(o=or(o,a,5),i-=2):(o="function"==typeof a?a:C,i-=o?1:0),s&&Jr(r[0],r[1],s)&&(o=3>i?C:o,i=1);++n<i;){var u=r[n];u&&e(t,u,o)}return t})}function lr(e,t){return function(r,n){var i=r?Gs(r):0;if(!tn(i))return e(r,n);for(var o=t?i:-1,s=ln(r);(t?o--:++o<i)&&n(s[o],o,s)!==!1;);return r}}function pr(e){return function(t,r,n){for(var i=ln(t),o=n(t),s=o.length,a=e?s:-1;e?a--:++a<s;){var u=o[a];if(r(i[u],u,i)===!1)break}return t}}function fr(e,t){function r(){var i=this&&this!==nt&&this instanceof r?n:e;return i.apply(t,arguments)}var n=vr(e);return r}function dr(e){return gs&&ls?new Ye(e):null}function mr(e){return function(t){for(var r=-1,n=Eo(ho(t)),i=n.length,o="";++r<i;)o=e(o,n[r],r);return o}}function vr(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=Rs(e.prototype),n=e.apply(r,t);return Li(n)?n:r}}function gr(e){function t(r,n,i){i&&Jr(r,n,i)&&(n=C);var o=jr(r,e,C,C,C,C,C,n);return o.placeholder=t.placeholder,o}return t}function yr(e,t){return gi(function(r){var n=r[0];return null==n?n:(r.push(t),e.apply(C,r))})}function _r(e,t){return function(r,n,i){if(i&&Jr(r,n,i)&&(n=C),n=Br(n,i,3),1==n.length){r=Pa(r)?r:hn(r);var o=st(r,n,e,t);if(!r.length||o!==t)return o}return Et(r,n,e,t)}}function br(e,t){return function(r,n,i){if(n=Br(n,i,3),Pa(r)){var s=o(r,n,t);return s>-1?r[s]:C}return At(r,n,e)}}function xr(e){return function(t,r,n){return t&&t.length?(r=Br(r,n,3),o(t,r,e)):-1}}function wr(e){return function(t,r,n){return r=Br(r,n,3),At(t,r,e,!0)}}function Sr(e){return function(){for(var t,r=arguments.length,i=e?r:-1,o=0,s=Uo(r);e?i--:++i<r;){var a=s[o++]=arguments[i];if("function"!=typeof a)throw new Yo(H);!t&&n.prototype.thru&&"wrapper"==Ur(a)&&(t=new n([],!0))}for(i=t?-1:r;++i<r;){a=s[i];var u=Ur(a),c="wrapper"==u?Us(a):C;t=c&&en(c[0])&&c[1]==(R|O|D|j)&&!c[4].length&&1==c[9]?t[Ur(c[0])].apply(t,c[3]):1==a.length&&en(a)?t[u]():t.thru(a)}return function(){var e=arguments,n=e[0];if(t&&1==e.length&&Pa(n)&&n.length>=U)return t.plant(n).value();for(var i=0,o=r?s[i].apply(this,e):n;++i<r;)o=s[i].call(this,o);return o}}}function Mr(e,t){return function(r,n,i){return"function"==typeof n&&i===C&&Pa(r)?e(r,n):t(r,or(n,i,3))}}function Er(e){return function(t,r,n){return("function"!=typeof r||n!==C)&&(r=or(r,n,3)),e(t,r,eo)}}function Cr(e){return function(t,r,n){return("function"!=typeof r||n!==C)&&(r=or(r,n,3)),e(t,r)}}function Tr(e){return function(t,r,n){var i={};return r=Br(r,n,3),Ot(t,function(t,n,o){var s=r(t,n,o);n=e?s:n,t=e?t:s,i[n]=t}),i}}function Ar(e){return function(t,r,n){return t=u(t),(e?t:"")+Nr(t,r,n)+(e?"":t)}}function Pr(e){var t=gi(function(r,n){var i=b(n,t.placeholder);return jr(r,e,C,n,i)});return t}function kr(e,t){return function(r,n,i,o){var s=arguments.length<3;return"function"==typeof n&&o===C&&Pa(r)?e(r,n,i,s):$t(r,Br(n,o,4),i,s,t)}}function Or(e,t,r,n,i,o,s,a,u,c){function h(){for(var y=arguments.length,_=y,x=Uo(y);_--;)x[_]=arguments[_];if(n&&(x=ar(x,n,i)),o&&(x=ur(x,o,s)),d||v){var w=h.placeholder,S=b(x,w);if(y-=S.length,c>y){var M=a?et(a):C,E=ws(c-y,0),T=d?S:C,k=d?C:S,O=d?x:C,N=d?C:x;t|=d?D:L,t&=~(d?L:D),m||(t&=~(A|P));var R=[e,t,r,O,T,N,k,M,u,E],j=Or.apply(C,R);return en(e)&&zs(j,R),j.placeholder=w,j}}var I=p?r:this,V=f?I[e]:e;return a&&(x=un(x,a)),l&&u<x.length&&(x.length=u),this&&this!==nt&&this instanceof h&&(V=g||vr(e)),V.apply(I,x)}var l=t&R,p=t&A,f=t&P,d=t&O,m=t&k,v=t&N,g=f?C:vr(e);return h}function Nr(e,t,r){var n=e.length;if(t=+t,n>=t||!bs(t))return"";var i=t-n;return r=null==r?" ":r+"",go(r,vs(i/r.length)).slice(0,i)}function Dr(e,t,r,n){function i(){for(var t=-1,a=arguments.length,u=-1,c=n.length,h=Uo(c+a);++u<c;)h[u]=n[u];for(;a--;)h[u++]=arguments[++t];var l=this&&this!==nt&&this instanceof i?s:e;return l.apply(o?r:this,h)}var o=t&A,s=vr(e);return i}function Lr(e){var t=Wo[e];return function(e,r){return r=r===C?0:+r||0,r?(r=cs(10,r),t(e*r)/r):t(e)}}function Rr(e){return function(t,r,n,i){var o=Br(n);return null==n&&o===bt?nr(t,r,e):ir(t,r,o(n,i,1),e)}}function jr(e,t,r,n,i,o,s,a){var u=t&P;if(!u&&"function"!=typeof e)throw new Yo(H);var c=n?n.length:0;if(c||(t&=~(D|L),n=i=C),c-=i?i.length:0,t&L){var h=n,l=i;n=i=C}var p=u?C:Us(e),f=[e,t,r,n,i,h,l,o,s,a];if(p&&(nn(f,p),t=f[1],a=f[9]),f[9]=null==a?u?0:e.length:ws(a-c,0)||0,t==A)var d=fr(f[0],f[2]);else d=t!=D&&t!=(A|D)||f[4].length?Or.apply(C,f):Dr.apply(C,f);var m=p?Bs:zs;return m(d,f)}function Ir(e,t,r,n,i,o,s){var a=-1,u=e.length,c=t.length;if(u!=c&&!(i&&c>u))return!1;for(;++a<u;){var h=e[a],l=t[a],p=n?n(i?l:h,i?h:l,a):C;if(p!==C){if(p)continue;return!1}if(i){if(!pt(t,function(e){return h===e||r(h,e,n,i,o,s)}))return!1}else if(h!==l&&!r(h,l,n,i,o,s))return!1}return!0}function Vr(e,t,r){switch(r){case X:case K:return+e==+t;case Y:return e.name==t.name&&e.message==t.message;case Z:return e!=+e?t!=+t:e==+t;case te:case ne:return e==t+""}return!1}function Fr(e,t,r,n,i,o,s){var a=Ba(e),u=a.length,c=Ba(t),h=c.length;if(u!=h&&!i)return!1;for(var l=u;l--;){var p=a[l];if(!(i?p in t:ts.call(t,p)))return!1}for(var f=i;++l<u;){p=a[l];var d=e[p],m=t[p],v=n?n(i?m:d,i?d:m,p):C;if(!(v===C?r(d,m,n,i,o,s):v))return!1;f||(f="constructor"==p)}if(!f){var g=e.constructor,y=t.constructor;if(g!=y&&"constructor"in e&&"constructor"in t&&!("function"==typeof g&&g instanceof g&&"function"==typeof y&&y instanceof y))return!1}return!0}function Br(e,r,n){var i=t.callback||Co;return i=i===Co?bt:i,n?i(e,r,n):i}function Ur(e){for(var t=e.name,r=Ls[t],n=r?r.length:0;n--;){var i=r[n],o=i.func;if(null==o||o==e)return i.name}return t}function Gr(e,r,n){var i=t.indexOf||Mn;return i=i===Mn?s:i,e?i(e,r,n):i}function zr(e){for(var t=to(e),r=t.length;r--;)t[r][2]=rn(t[r][1]);return t}function Hr(e,t){var r=null==e?C:e[t];return Ii(r)?r:C}function Wr(e,t,r){for(var n=-1,i=r.length;++n<i;){var o=r[n],s=o.size;switch(o.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=Ss(t,e+s);break;case"takeRight":e=ws(e,t-s)}}return{start:e,end:t}}function qr(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&ts.call(e,"index")&&(r.index=e.index,r.input=e.input),r}function $r(e){var t=e.constructor;return"function"==typeof t&&t instanceof t||(t=$o),new t}function Xr(e,t,r){var n=e.constructor;switch(t){case oe:return sr(e);case X:case K:return new n(+e);case se:case ae:case ue:case ce:case he:case le:case pe:case fe:case de:var i=e.buffer;return new n(r?sr(i):i,e.byteOffset,e.length);case Z:case ne:return new n(e);case te:var o=new n(e.source,De.exec(e));o.lastIndex=e.lastIndex}return o}function Kr(e,t,r){null==e||Zr(t,e)||(t=pn(t),e=1==t.length?e:Lt(e,Xt(t,0,-1)),t=Cn(t));var n=null==e?e:e[t];return null==n?C:n.apply(e,r)}function Yr(e){return null!=e&&tn(Gs(e))}function Qr(e,t){return e="number"==typeof e||je.test(e)?+e:-1,t=null==t?Ns:t,e>-1&&e%1==0&&t>e}function Jr(e,t,r){if(!Li(r))return!1;var n=typeof t;if("number"==n?Yr(r)&&Qr(t,r.length):"string"==n&&t in r){var i=r[t];return e===e?e===i:i!==i}return!1}function Zr(e,t){var r=typeof e;if("string"==r&&Ce.test(e)||"number"==r)return!0;if(Pa(e))return!1;var n=!Ee.test(e);return n||null!=t&&e in ln(t)}function en(e){var r=Ur(e);if(!(r in _.prototype))return!1;var n=t[r];if(e===n)return!0;var i=Us(n);return!!i&&e===i[0]}function tn(e){return"number"==typeof e&&e>-1&&e%1==0&&Ns>=e}function rn(e){return e===e&&!Li(e)}function nn(e,t){var r=e[1],n=t[1],i=r|n,o=R>i,s=n==R&&r==O||n==R&&r==j&&e[7].length<=t[8]||n==(R|j)&&r==O;if(!o&&!s)return e;n&A&&(e[2]=t[2],i|=r&A?0:k);var a=t[3];if(a){var u=e[3];e[3]=u?ar(u,a,t[4]):et(a),e[4]=u?b(e[3],W):et(t[4])}return a=t[5],a&&(u=e[5],e[5]=u?ur(u,a,t[6]):et(a),e[6]=u?b(e[5],W):et(t[6])),a=t[7],a&&(e[7]=et(a)),n&R&&(e[8]=null==e[8]?t[8]:Ss(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=i,e}function on(e,t){return e===C?t:ka(e,t,on)}function sn(e,t){e=ln(e);for(var r=-1,n=t.length,i={};++r<n;){var o=t[r];o in e&&(i[o]=e[o])}return i}function an(e,t){var r={};return kt(e,function(e,n,i){t(e,n,i)&&(r[n]=e)}),r}function un(e,t){for(var r=e.length,n=Ss(t.length,r),i=et(e);n--;){var o=t[n];e[n]=Qr(o,r)?i[o]:C}return e}function cn(e){for(var t=eo(e),r=t.length,n=r&&e.length,i=!!n&&tn(n)&&(Pa(e)||Ei(e)),o=-1,s=[];++o<r;){var a=t[o];(i&&Qr(a,n)||ts.call(e,a))&&s.push(a)}return s}function hn(e){return null==e?[]:Yr(e)?Li(e)?e:$o(e):oo(e)}function ln(e){return Li(e)?e:$o(e)}function pn(e){if(Pa(e))return e;var t=[];return u(e).replace(Te,function(e,r,n,i){t.push(n?i.replace(Oe,"$1"):r||e)}),t}function fn(e){return e instanceof _?e.clone():new n(e.__wrapped__,e.__chain__,et(e.__actions__))}function dn(e,t,r){t=(r?Jr(e,t,r):null==t)?1:ws(ys(t)||1,1);for(var n=0,i=e?e.length:0,o=-1,s=Uo(vs(i/t));i>n;)s[++o]=Xt(e,n,n+=t);return s}function mn(e){for(var t=-1,r=e?e.length:0,n=-1,i=[];++t<r;){var o=e[t];o&&(i[++n]=o)}return i}function vn(e,t,r){var n=e?e.length:0;return n?((r?Jr(e,t,r):null==t)&&(t=1),Xt(e,0>t?0:t)):[]}function gn(e,t,r){var n=e?e.length:0;return n?((r?Jr(e,t,r):null==t)&&(t=1),t=n-(+t||0),Xt(e,0,0>t?0:t)):[]}function yn(e,t,r){return e&&e.length?tr(e,Br(t,r,3),!0,!0):[]}function _n(e,t,r){return e&&e.length?tr(e,Br(t,r,3),!0):[]}function bn(e,t,r,n){var i=e?e.length:0;return i?(r&&"number"!=typeof r&&Jr(e,t,r)&&(r=0,n=i),Ct(e,t,r,n)):[]}function xn(e){return e?e[0]:C}function wn(e,t,r){var n=e?e.length:0;return r&&Jr(e,t,r)&&(t=!1),n?Pt(e,t):[]}function Sn(e){var t=e?e.length:0;return t?Pt(e,!0):[]}function Mn(e,t,r){var n=e?e.length:0;if(!n)return-1;if("number"==typeof r)r=0>r?ws(n+r,0):r;else if(r){var i=nr(e,t);return n>i&&(t===t?t===e[i]:e[i]!==e[i])?i:-1}return s(e,t,r||0)}function En(e){return gn(e,1)}function Cn(e){var t=e?e.length:0;return t?e[t-1]:C}function Tn(e,t,r){var n=e?e.length:0;if(!n)return-1;var i=n;if("number"==typeof r)i=(0>r?ws(n+r,0):Ss(r||0,n-1))+1;else if(r){i=nr(e,t,!0)-1;var o=e[i];return(t===t?t===o:o!==o)?i:-1}if(t!==t)return g(e,i,!0);for(;i--;)if(e[i]===t)return i;return-1}function An(){var e=arguments,t=e[0];if(!t||!t.length)return t;for(var r=0,n=Gr(),i=e.length;++r<i;)for(var o=0,s=e[r];(o=n(t,s,o))>-1;)fs.call(t,o,1);return t}function Pn(e,t,r){var n=[];if(!e||!e.length)return n;var i=-1,o=[],s=e.length;for(t=Br(t,r,3);++i<s;){var a=e[i];t(a,i,e)&&(n.push(a),o.push(i))}return Wt(e,o),n}function kn(e){return vn(e,1)}function On(e,t,r){var n=e?e.length:0;return n?(r&&"number"!=typeof r&&Jr(e,t,r)&&(t=0,r=n),Xt(e,t,r)):[]}function Nn(e,t,r){var n=e?e.length:0;return n?((r?Jr(e,t,r):null==t)&&(t=1),Xt(e,0,0>t?0:t)):[]}function Dn(e,t,r){var n=e?e.length:0;return n?((r?Jr(e,t,r):null==t)&&(t=1),t=n-(+t||0),Xt(e,0>t?0:t)):[]}function Ln(e,t,r){return e&&e.length?tr(e,Br(t,r,3),!1,!0):[]}function Rn(e,t,r){return e&&e.length?tr(e,Br(t,r,3)):[]}function jn(e,t,r,n){var i=e?e.length:0;if(!i)return[];null!=t&&"boolean"!=typeof t&&(n=r,r=Jr(e,t,n)?C:t,t=!1);var o=Br();return(null!=r||o!==bt)&&(r=o(r,n,3)),t&&Gr()==s?x(e,r):Zt(e,r)}function In(e){if(!e||!e.length)return[];var t=-1,r=0;e=at(e,function(e){return Yr(e)?(r=ws(e.length,r),!0):void 0});for(var n=Uo(r);++t<r;)n[t]=ut(e,zt(t));return n}function Vn(e,t,r){var n=e?e.length:0;if(!n)return[];var i=In(e);return null==t?i:(t=or(t,r,4),ut(i,function(e){return ht(e,t,C,!0)}))}function Fn(){for(var e=-1,t=arguments.length;++e<t;){var r=arguments[e];if(Yr(r))var n=n?ct(St(n,r),St(r,n)):r}return n?Zt(n):[]}function Bn(e,t){var r=-1,n=e?e.length:0,i={};for(!n||t||Pa(e[0])||(t=[]);++r<n;){var o=e[r];t?i[o]=t[r]:o&&(i[o[0]]=o[1])}return i}function Un(e){var r=t(e);return r.__chain__=!0,r}function Gn(e,t,r){return t.call(r,e),e}function zn(e,t,r){return t.call(r,e)}function Hn(){return Un(this)}function Wn(){return new n(this.value(),this.__chain__)}function qn(e){for(var t,n=this;n instanceof r;){var i=fn(n);t?o.__wrapped__=i:t=i;var o=i;n=n.__wrapped__}return o.__wrapped__=e,t}function $n(){var e=this.__wrapped__,t=function(e){return r&&r.__dir__<0?e:e.reverse()};if(e instanceof _){var r=e;return this.__actions__.length&&(r=new _(this)),r=r.reverse(),r.__actions__.push({func:zn,args:[t],thisArg:C}),new n(r,this.__chain__)}return this.thru(t)}function Xn(){return this.value()+""}function Kn(){return rr(this.__wrapped__,this.__actions__)}function Yn(e,t,r){var n=Pa(e)?ot:Mt;return r&&Jr(e,t,r)&&(t=C),("function"!=typeof t||r!==C)&&(t=Br(t,r,3)),n(e,t)}function Qn(e,t,r){var n=Pa(e)?at:Tt;return t=Br(t,r,3),n(e,t)}function Jn(e,t){return ia(e,Ft(t))}function Zn(e,t,r,n){var i=e?Gs(e):0;return tn(i)||(e=oo(e),i=e.length),r="number"!=typeof r||n&&Jr(t,r,n)?0:0>r?ws(i+r,0):r||0,"string"==typeof e||!Pa(e)&&Gi(e)?i>=r&&e.indexOf(t,r)>-1:!!i&&Gr(e,t,r)>-1}function ei(e,t,r){var n=Pa(e)?ut:Vt;return t=Br(t,r,3),n(e,t)}function ti(e,t){return ei(e,Lo(t))}function ri(e,t,r){var n=Pa(e)?at:Tt;return t=Br(t,r,3),n(e,function(e,r,n){return!t(e,r,n)})}function ni(e,t,r){if(r?Jr(e,t,r):null==t){e=hn(e);var n=e.length;return n>0?e[qt(0,n-1)]:C}var i=-1,o=$i(e),n=o.length,s=n-1;for(t=Ss(0>t?0:+t||0,n);++i<t;){var a=qt(i,s),u=o[a];o[a]=o[i],o[i]=u}return o.length=t,o}function ii(e){return ni(e,As)}function oi(e){var t=e?Gs(e):0;return tn(t)?t:Ba(e).length}function si(e,t,r){var n=Pa(e)?pt:Kt;return r&&Jr(e,t,r)&&(t=C),("function"!=typeof t||r!==C)&&(t=Br(t,r,3)),n(e,t)}function ai(e,t,r){if(null==e)return[];r&&Jr(e,t,r)&&(t=C);var n=-1;t=Br(t,r,3);var i=Vt(e,function(e,r,i){return{criteria:t(e,r,i),index:++n,value:e}});return Yt(i,l)}function ui(e,t,r,n){return null==e?[]:(n&&Jr(t,r,n)&&(r=C),Pa(t)||(t=null==t?[]:[t]),Pa(r)||(r=null==r?[]:[r]),Qt(e,t,r))}function ci(e,t){return Qn(e,Ft(t))}function hi(e,t){if("function"!=typeof t){if("function"!=typeof e)throw new Yo(H);var r=e;e=t,t=r}return e=bs(e=+e)?e:0,function(){return--e<1?t.apply(this,arguments):void 0}}function li(e,t,r){return r&&Jr(e,t,r)&&(t=C),t=e&&null==t?e.length:ws(+t||0,0),jr(e,R,C,C,C,C,t)}function pi(e,t){var r;if("function"!=typeof t){if("function"!=typeof e)throw new Yo(H);var n=e;e=t,t=n}return function(){return--e>0&&(r=t.apply(this,arguments)),1>=e&&(t=C),r}}function fi(e,t,r){function n(){f&&as(f),c&&as(c),m=0,c=f=d=C}function i(t,r){r&&as(r),c=f=d=C,t&&(m=ma(),h=e.apply(p,u),f||c||(u=p=C))}function o(){var e=t-(ma()-l);0>=e||e>t?i(d,c):f=ps(o,e)}function s(){i(g,f)}function a(){if(u=arguments,l=ma(),p=this,d=g&&(f||!y),v===!1)var r=y&&!f;else{c||y||(m=l);var n=v-(l-m),i=0>=n||n>v;i?(c&&(c=as(c)),m=l,h=e.apply(p,u)):c||(c=ps(s,n))}return i&&f?f=as(f):f||t===v||(f=ps(o,t)),r&&(i=!0,h=e.apply(p,u)),!i||f||c||(u=p=C),h}var u,c,h,l,p,f,d,m=0,v=!1,g=!0;if("function"!=typeof e)throw new Yo(H);if(t=0>t?0:+t||0,r===!0){var y=!0;g=!1}else Li(r)&&(y=!!r.leading,v="maxWait"in r&&ws(+r.maxWait||0,t),g="trailing"in r?!!r.trailing:g);return a.cancel=n,a}function di(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new Yo(H);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var s=e.apply(this,n);return r.cache=o.set(i,s),s};return r.cache=new di.Cache,r}function mi(e){if("function"!=typeof e)throw new Yo(H);return function(){return!e.apply(this,arguments)}}function vi(e){return pi(2,e)}function gi(e,t){if("function"!=typeof e)throw new Yo(H);return t=ws(t===C?e.length-1:+t||0,0),function(){for(var r=arguments,n=-1,i=ws(r.length-t,0),o=Uo(i);++n<i;)o[n]=r[t+n];switch(t){case 0:return e.call(this,o);case 1:return e.call(this,r[0],o);case 2:return e.call(this,r[0],r[1],o)}var s=Uo(t+1);for(n=-1;++n<t;)s[n]=r[n];return s[t]=o,e.apply(this,s)}}function yi(e){if("function"!=typeof e)throw new Yo(H);return function(t){return e.apply(this,t)}}function _i(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new Yo(H);return r===!1?n=!1:Li(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),fi(e,t,{leading:n,maxWait:+t,trailing:i})}function bi(e,t){return t=null==t?Ao:t,jr(t,D,C,[e],[])}function xi(e,t,r,n){return t&&"boolean"!=typeof t&&Jr(e,t,r)?t=!1:"function"==typeof t&&(n=r,r=t,t=!1),"function"==typeof r?xt(e,t,or(r,n,1)):xt(e,t)}function wi(e,t,r){return"function"==typeof t?xt(e,!0,or(t,r,1)):xt(e,!0)}function Si(e,t){return e>t}function Mi(e,t){return e>=t}function Ei(e){return y(e)&&Yr(e)&&ts.call(e,"callee")&&!hs.call(e,"callee")}function Ci(e){return e===!0||e===!1||y(e)&&ns.call(e)==X}function Ti(e){return y(e)&&ns.call(e)==K}function Ai(e){return!!e&&1===e.nodeType&&y(e)&&!Bi(e)}function Pi(e){return null==e?!0:Yr(e)&&(Pa(e)||Gi(e)||Ei(e)||y(e)&&Di(e.splice))?!e.length:!Ba(e).length}function ki(e,t,r,n){r="function"==typeof r?or(r,n,3):C;var i=r?r(e,t):C;return i===C?Rt(e,t,r):!!i}function Oi(e){return y(e)&&"string"==typeof e.message&&ns.call(e)==Y}function Ni(e){return"number"==typeof e&&bs(e)}function Di(e){return Li(e)&&ns.call(e)==Q}function Li(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Ri(e,t,r,n){return r="function"==typeof r?or(r,n,3):C,It(e,zr(t),r)}function ji(e){return Fi(e)&&e!=+e}function Ii(e){return null==e?!1:Di(e)?os.test(es.call(e)):y(e)&&Re.test(e)}function Vi(e){return null===e}function Fi(e){return"number"==typeof e||y(e)&&ns.call(e)==Z}function Bi(e){var t;if(!y(e)||ns.call(e)!=ee||Ei(e)||!ts.call(e,"constructor")&&(t=e.constructor,"function"==typeof t&&!(t instanceof t)))return!1;var r;return kt(e,function(e,t){r=t}),r===C||ts.call(e,r)}function Ui(e){return Li(e)&&ns.call(e)==te;
}function Gi(e){return"string"==typeof e||y(e)&&ns.call(e)==ne}function zi(e){return y(e)&&tn(e.length)&&!!ze[ns.call(e)]}function Hi(e){return e===C}function Wi(e,t){return t>e}function qi(e,t){return t>=e}function $i(e){var t=e?Gs(e):0;return tn(t)?t?et(e):[]:oo(e)}function Xi(e){return _t(e,eo(e))}function Ki(e,t,r){var n=Rs(e);return r&&Jr(e,t,r)&&(t=C),t?gt(n,t):n}function Yi(e){return Dt(e,eo(e))}function Qi(e,t,r){var n=null==e?C:Lt(e,pn(t),t+"");return n===C?r:n}function Ji(e,t){if(null==e)return!1;var r=ts.call(e,t);if(!r&&!Zr(t)){if(t=pn(t),e=1==t.length?e:Lt(e,Xt(t,0,-1)),null==e)return!1;t=Cn(t),r=ts.call(e,t)}return r||tn(e.length)&&Qr(t,e.length)&&(Pa(e)||Ei(e))}function Zi(e,t,r){r&&Jr(e,t,r)&&(t=C);for(var n=-1,i=Ba(e),o=i.length,s={};++n<o;){var a=i[n],u=e[a];t?ts.call(s,u)?s[u].push(a):s[u]=[a]:s[u]=a}return s}function eo(e){if(null==e)return[];Li(e)||(e=$o(e));var t=e.length;t=t&&tn(t)&&(Pa(e)||Ei(e))&&t||0;for(var r=e.constructor,n=-1,i="function"==typeof r&&r.prototype===e,o=Uo(t),s=t>0;++n<t;)o[n]=n+"";for(var a in e)s&&Qr(a,t)||"constructor"==a&&(i||!ts.call(e,a))||o.push(a);return o}function to(e){e=ln(e);for(var t=-1,r=Ba(e),n=r.length,i=Uo(n);++t<n;){var o=r[t];i[t]=[o,e[o]]}return i}function ro(e,t,r){var n=null==e?C:e[t];return n===C&&(null==e||Zr(t,e)||(t=pn(t),e=1==t.length?e:Lt(e,Xt(t,0,-1)),n=null==e?C:e[Cn(t)]),n=n===C?r:n),Di(n)?n.call(e):n}function no(e,t,r){if(null==e)return e;var n=t+"";t=null!=e[n]||Zr(t,e)?[n]:pn(t);for(var i=-1,o=t.length,s=o-1,a=e;null!=a&&++i<o;){var u=t[i];Li(a)&&(i==s?a[u]=r:null==a[u]&&(a[u]=Qr(t[i+1])?[]:{})),a=a[u]}return e}function io(e,t,r,n){var i=Pa(e)||zi(e);if(t=Br(t,n,4),null==r)if(i||Li(e)){var o=e.constructor;r=i?Pa(e)?new o:[]:Rs(Di(o)?o.prototype:C)}else r={};return(i?tt:Ot)(e,function(e,n,i){return t(r,e,n,i)}),r}function oo(e){return er(e,Ba(e))}function so(e){return er(e,eo(e))}function ao(e,t,r){return t=+t||0,r===C?(r=t,t=0):r=+r||0,e>=Ss(t,r)&&e<ws(t,r)}function uo(e,t,r){r&&Jr(e,t,r)&&(t=r=C);var n=null==e,i=null==t;if(null==r&&(i&&"boolean"==typeof e?(r=e,e=1):"boolean"==typeof t&&(r=t,i=!0)),n&&i&&(t=1,i=!1),e=+e||0,i?(t=e,e=0):t=+t||0,r||e%1||t%1){var o=Cs();return Ss(e+o*(t-e+us("1e-"+((o+"").length-1))),t)}return qt(e,t)}function co(e){return e=u(e),e&&e.charAt(0).toUpperCase()+e.slice(1)}function ho(e){return e=u(e),e&&e.replace(Ie,f).replace(ke,"")}function lo(e,t,r){e=u(e),t+="";var n=e.length;return r=r===C?n:Ss(0>r?0:+r||0,n),r-=t.length,r>=0&&e.indexOf(t,r)==r}function po(e){return e=u(e),e&&xe.test(e)?e.replace(_e,d):e}function fo(e){return e=u(e),e&&Pe.test(e)?e.replace(Ae,m):e||"(?:)"}function mo(e,t,r){e=u(e),t=+t;var n=e.length;if(n>=t||!bs(t))return e;var i=(t-n)/2,o=ys(i),s=vs(i);return r=Nr("",s,r),r.slice(0,o)+e+r}function vo(e,t,r){return(r?Jr(e,t,r):null==t)?t=0:t&&(t=+t),e=bo(e),Es(e,t||(Le.test(e)?16:10))}function go(e,t){var r="";if(e=u(e),t=+t,1>t||!e||!bs(t))return r;do t%2&&(r+=e),t=ys(t/2),e+=e;while(t);return r}function yo(e,t,r){return e=u(e),r=null==r?0:Ss(0>r?0:+r||0,e.length),e.lastIndexOf(t,r)==r}function _o(e,r,n){var i=t.templateSettings;n&&Jr(e,r,n)&&(r=n=C),e=u(e),r=vt(gt({},n||r),i,mt);var o,s,a=vt(gt({},r.imports),i.imports,mt),c=Ba(a),h=er(a,c),l=0,p=r.interpolate||Ve,f="__p += '",d=Xo((r.escape||Ve).source+"|"+p.source+"|"+(p===Me?Ne:Ve).source+"|"+(r.evaluate||Ve).source+"|$","g"),m="//# sourceURL="+("sourceURL"in r?r.sourceURL:"lodash.templateSources["+ ++Ge+"]")+"\n";e.replace(d,function(t,r,n,i,a,u){return n||(n=i),f+=e.slice(l,u).replace(Fe,v),r&&(o=!0,f+="' +\n__e("+r+") +\n'"),a&&(s=!0,f+="';\n"+a+";\n__p += '"),n&&(f+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),l=u+t.length,t}),f+="';\n";var g=r.variable;g||(f="with (obj) {\n"+f+"\n}\n"),f=(s?f.replace(me,""):f).replace(ve,"$1").replace(ge,"$1;"),f="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var y=Qa(function(){return Ho(c,m+"return "+f).apply(C,h)});if(y.source=f,Oi(y))throw y;return y}function bo(e,t,r){var n=e;return(e=u(e))?(r?Jr(n,t,r):null==t)?e.slice(w(e),S(e)+1):(t+="",e.slice(c(e,t),h(e,t)+1)):e}function xo(e,t,r){var n=e;return e=u(e),e?(r?Jr(n,t,r):null==t)?e.slice(w(e)):e.slice(c(e,t+"")):e}function wo(e,t,r){var n=e;return e=u(e),e?(r?Jr(n,t,r):null==t)?e.slice(0,S(e)+1):e.slice(0,h(e,t+"")+1):e}function So(e,t,r){r&&Jr(e,t,r)&&(t=C);var n=I,i=V;if(null!=t)if(Li(t)){var o="separator"in t?t.separator:o;n="length"in t?+t.length||0:n,i="omission"in t?u(t.omission):i}else n=+t||0;if(e=u(e),n>=e.length)return e;var s=n-i.length;if(1>s)return i;var a=e.slice(0,s);if(null==o)return a+i;if(Ui(o)){if(e.slice(s).search(o)){var c,h,l=e.slice(0,s);for(o.global||(o=Xo(o.source,(De.exec(o)||"")+"g")),o.lastIndex=0;c=o.exec(l);)h=c.index;a=a.slice(0,null==h?s:h)}}else if(e.indexOf(o,s)!=s){var p=a.lastIndexOf(o);p>-1&&(a=a.slice(0,p))}return a+i}function Mo(e){return e=u(e),e&&be.test(e)?e.replace(ye,M):e}function Eo(e,t,r){return r&&Jr(e,t,r)&&(t=C),e=u(e),e.match(t||Be)||[]}function Co(e,t,r){return r&&Jr(e,t,r)&&(t=C),y(e)?Po(e):bt(e,t)}function To(e){return function(){return e}}function Ao(e){return e}function Po(e){return Ft(xt(e,!0))}function ko(e,t){return Bt(e,xt(t,!0))}function Oo(e,t,r){if(null==r){var n=Li(t),i=n?Ba(t):C,o=i&&i.length?Dt(t,i):C;(o?o.length:n)||(o=!1,r=t,t=e,e=this)}o||(o=Dt(t,Ba(t)));var s=!0,a=-1,u=Di(e),c=o.length;r===!1?s=!1:Li(r)&&"chain"in r&&(s=r.chain);for(;++a<c;){var h=o[a],l=t[h];e[h]=l,u&&(e.prototype[h]=function(t){return function(){var r=this.__chain__;if(s||r){var n=e(this.__wrapped__),i=n.__actions__=et(this.__actions__);return i.push({func:t,args:arguments,thisArg:e}),n.__chain__=r,n}return t.apply(e,ct([this.value()],arguments))}}(l))}return e}function No(){return nt._=is,this}function Do(){}function Lo(e){return Zr(e)?zt(e):Ht(e)}function Ro(e){return function(t){return Lt(e,pn(t),t+"")}}function jo(e,t,r){r&&Jr(e,t,r)&&(t=r=C),e=+e||0,r=null==r?1:+r||0,null==t?(t=e,e=0):t=+t||0;for(var n=-1,i=ws(vs((t-e)/(r||1)),0),o=Uo(i);++n<i;)o[n]=e,e+=r;return o}function Io(e,t,r){if(e=ys(e),1>e||!bs(e))return[];var n=-1,i=Uo(Ss(e,Ps));for(t=or(t,r,1);++n<e;)Ps>n?i[n]=t(n):t(n);return i}function Vo(e){var t=++rs;return u(e)+t}function Fo(e,t){return(+e||0)+(+t||0)}function Bo(e,t,r){return r&&Jr(e,t,r)&&(t=C),t=Br(t,r,3),1==t.length?ft(Pa(e)?e:hn(e),t):Jt(e,t)}e=e?it.defaults(nt.Object(),e,it.pick(nt,Ue)):nt;var Uo=e.Array,Go=e.Date,zo=e.Error,Ho=e.Function,Wo=e.Math,qo=e.Number,$o=e.Object,Xo=e.RegExp,Ko=e.String,Yo=e.TypeError,Qo=Uo.prototype,Jo=$o.prototype,Zo=Ko.prototype,es=Ho.prototype.toString,ts=Jo.hasOwnProperty,rs=0,ns=Jo.toString,is=nt._,os=Xo("^"+es.call(ts).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ss=e.ArrayBuffer,as=e.clearTimeout,us=e.parseFloat,cs=Wo.pow,hs=Jo.propertyIsEnumerable,ls=Hr(e,"Set"),ps=e.setTimeout,fs=Qo.splice,ds=e.Uint8Array,ms=Hr(e,"WeakMap"),vs=Wo.ceil,gs=Hr($o,"create"),ys=Wo.floor,_s=Hr(Uo,"isArray"),bs=e.isFinite,xs=Hr($o,"keys"),ws=Wo.max,Ss=Wo.min,Ms=Hr(Go,"now"),Es=e.parseInt,Cs=Wo.random,Ts=qo.NEGATIVE_INFINITY,As=qo.POSITIVE_INFINITY,Ps=4294967295,ks=Ps-1,Os=Ps>>>1,Ns=9007199254740991,Ds=ms&&new ms,Ls={};t.support={};t.templateSettings={escape:we,evaluate:Se,interpolate:Me,variable:"",imports:{_:t}};var Rs=function(){function e(){}return function(t){if(Li(t)){e.prototype=t;var r=new e;e.prototype=C}return r||{}}}(),js=lr(Ot),Is=lr(Nt,!0),Vs=pr(),Fs=pr(!0),Bs=Ds?function(e,t){return Ds.set(e,t),e}:Ao,Us=Ds?function(e){return Ds.get(e)}:Do,Gs=zt("length"),zs=function(){var e=0,t=0;return function(r,n){var i=ma(),o=B-(i-t);if(t=i,o>0){if(++e>=F)return r}else e=0;return Bs(r,n)}}(),Hs=gi(function(e,t){return y(e)&&Yr(e)?St(e,Pt(t,!1,!0)):[]}),Ws=xr(),qs=xr(!0),$s=gi(function(e){for(var t=e.length,r=t,n=Uo(l),i=Gr(),o=i==s,a=[];r--;){var u=e[r]=Yr(u=e[r])?u:[];n[r]=o&&u.length>=120?dr(r&&u):null}var c=e[0],h=-1,l=c?c.length:0,p=n[0];e:for(;++h<l;)if(u=c[h],(p?Qe(p,u):i(a,u,0))<0){for(var r=t;--r;){var f=n[r];if((f?Qe(f,u):i(e[r],u,0))<0)continue e}p&&p.push(u),a.push(u)}return a}),Xs=gi(function(e,t){t=Pt(t);var r=yt(e,t);return Wt(e,t.sort(i)),r}),Ks=Rr(),Ys=Rr(!0),Qs=gi(function(e){return Zt(Pt(e,!1,!0))}),Js=gi(function(e,t){return Yr(e)?St(e,t):[]}),Zs=gi(In),ea=gi(function(e){var t=e.length,r=t>2?e[t-2]:C,n=t>1?e[t-1]:C;return t>2&&"function"==typeof r?t-=2:(r=t>1&&"function"==typeof n?(--t,n):C,n=C),e.length=t,Vn(e,r,n)}),ta=gi(function(e){return e=Pt(e),this.thru(function(t){return Ze(Pa(t)?t:[ln(t)],e)})}),ra=gi(function(e,t){return yt(e,Pt(t))}),na=cr(function(e,t,r){ts.call(e,r)?++e[r]:e[r]=1}),ia=br(js),oa=br(Is,!0),sa=Mr(tt,js),aa=Mr(rt,Is),ua=cr(function(e,t,r){ts.call(e,r)?e[r].push(t):e[r]=[t]}),ca=cr(function(e,t,r){e[r]=t}),ha=gi(function(e,t,r){var n=-1,i="function"==typeof t,o=Zr(t),s=Yr(e)?Uo(e.length):[];return js(e,function(e){var a=i?t:o&&null!=e?e[t]:C;s[++n]=a?a.apply(e,r):Kr(e,t,r)}),s}),la=cr(function(e,t,r){e[r?0:1].push(t)},function(){return[[],[]]}),pa=kr(ht,js),fa=kr(lt,Is),da=gi(function(e,t){if(null==e)return[];var r=t[2];return r&&Jr(t[0],t[1],r)&&(t.length=1),Qt(e,Pt(t),[])}),ma=Ms||function(){return(new Go).getTime()},va=gi(function(e,t,r){var n=A;if(r.length){var i=b(r,va.placeholder);n|=D}return jr(e,n,t,r,i)}),ga=gi(function(e,t){t=t.length?Pt(t):Yi(e);for(var r=-1,n=t.length;++r<n;){var i=t[r];e[i]=jr(e[i],A,e)}return e}),ya=gi(function(e,t,r){var n=A|P;if(r.length){var i=b(r,ya.placeholder);n|=D}return jr(t,n,e,r,i)}),_a=gr(O),ba=gr(N),xa=gi(function(e,t){return wt(e,1,t)}),wa=gi(function(e,t,r){return wt(e,t,r)}),Sa=Sr(),Ma=Sr(!0),Ea=gi(function(e,t){if(t=Pt(t),"function"!=typeof e||!ot(t,a))throw new Yo(H);var r=t.length;return gi(function(n){for(var i=Ss(n.length,r);i--;)n[i]=t[i](n[i]);return e.apply(this,n)})}),Ca=Pr(D),Ta=Pr(L),Aa=gi(function(e,t){return jr(e,j,C,C,C,Pt(t))}),Pa=_s||function(e){return y(e)&&tn(e.length)&&ns.call(e)==$},ka=hr(Ut),Oa=hr(function(e,t,r){return r?vt(e,t,r):gt(e,t)}),Na=yr(Oa,dt),Da=yr(ka,on),La=wr(Ot),Ra=wr(Nt),ja=Er(Vs),Ia=Er(Fs),Va=Cr(Ot),Fa=Cr(Nt),Ba=xs?function(e){var t=null==e?C:e.constructor;return"function"==typeof t&&t.prototype===e||"function"!=typeof e&&Yr(e)?cn(e):Li(e)?xs(e):[]}:cn,Ua=Tr(!0),Ga=Tr(),za=gi(function(e,t){if(null==e)return{};if("function"!=typeof t[0]){var t=ut(Pt(t),Ko);return sn(e,St(eo(e),t))}var r=or(t[0],t[1],3);return an(e,function(e,t,n){return!r(e,t,n)})}),Ha=gi(function(e,t){return null==e?{}:"function"==typeof t[0]?an(e,or(t[0],t[1],3)):sn(e,Pt(t))}),Wa=mr(function(e,t,r){return t=t.toLowerCase(),e+(r?t.charAt(0).toUpperCase()+t.slice(1):t)}),qa=mr(function(e,t,r){return e+(r?"-":"")+t.toLowerCase()}),$a=Ar(),Xa=Ar(!0),Ka=mr(function(e,t,r){return e+(r?"_":"")+t.toLowerCase()}),Ya=mr(function(e,t,r){return e+(r?" ":"")+(t.charAt(0).toUpperCase()+t.slice(1))}),Qa=gi(function(e,t){try{return e.apply(C,t)}catch(r){return Oi(r)?r:new zo(r)}}),Ja=gi(function(e,t){return function(r){return Kr(r,e,t)}}),Za=gi(function(e,t){return function(r){return Kr(e,r,t)}}),eu=Lr("ceil"),tu=Lr("floor"),ru=_r(Si,Ts),nu=_r(Wi,As),iu=Lr("round");return t.prototype=r.prototype,n.prototype=Rs(r.prototype),n.prototype.constructor=n,_.prototype=Rs(r.prototype),_.prototype.constructor=_,We.prototype["delete"]=qe,We.prototype.get=$e,We.prototype.has=Xe,We.prototype.set=Ke,Ye.prototype.push=Je,di.Cache=We,t.after=hi,t.ary=li,t.assign=Oa,t.at=ra,t.before=pi,t.bind=va,t.bindAll=ga,t.bindKey=ya,t.callback=Co,t.chain=Un,t.chunk=dn,t.compact=mn,t.constant=To,t.countBy=na,t.create=Ki,t.curry=_a,t.curryRight=ba,t.debounce=fi,t.defaults=Na,t.defaultsDeep=Da,t.defer=xa,t.delay=wa,t.difference=Hs,t.drop=vn,t.dropRight=gn,t.dropRightWhile=yn,t.dropWhile=_n,t.fill=bn,t.filter=Qn,t.flatten=wn,t.flattenDeep=Sn,t.flow=Sa,t.flowRight=Ma,t.forEach=sa,t.forEachRight=aa,t.forIn=ja,t.forInRight=Ia,t.forOwn=Va,t.forOwnRight=Fa,t.functions=Yi,t.groupBy=ua,t.indexBy=ca,t.initial=En,t.intersection=$s,t.invert=Zi,t.invoke=ha,t.keys=Ba,t.keysIn=eo,t.map=ei,t.mapKeys=Ua,t.mapValues=Ga,t.matches=Po,t.matchesProperty=ko,t.memoize=di,t.merge=ka,t.method=Ja,t.methodOf=Za,t.mixin=Oo,t.modArgs=Ea,t.negate=mi,t.omit=za,t.once=vi,t.pairs=to,t.partial=Ca,t.partialRight=Ta,t.partition=la,t.pick=Ha,t.pluck=ti,t.property=Lo,t.propertyOf=Ro,t.pull=An,t.pullAt=Xs,t.range=jo,t.rearg=Aa,t.reject=ri,t.remove=Pn,t.rest=kn,t.restParam=gi,t.set=no,t.shuffle=ii,t.slice=On,t.sortBy=ai,t.sortByAll=da,t.sortByOrder=ui,t.spread=yi,t.take=Nn,t.takeRight=Dn,t.takeRightWhile=Ln,t.takeWhile=Rn,t.tap=Gn,t.throttle=_i,t.thru=zn,t.times=Io,t.toArray=$i,t.toPlainObject=Xi,t.transform=io,t.union=Qs,t.uniq=jn,t.unzip=In,t.unzipWith=Vn,t.values=oo,t.valuesIn=so,t.where=ci,t.without=Js,t.wrap=bi,t.xor=Fn,t.zip=Zs,t.zipObject=Bn,t.zipWith=ea,t.backflow=Ma,t.collect=ei,t.compose=Ma,t.each=sa,t.eachRight=aa,t.extend=Oa,t.iteratee=Co,t.methods=Yi,t.object=Bn,t.select=Qn,t.tail=kn,t.unique=jn,Oo(t,t),t.add=Fo,t.attempt=Qa,t.camelCase=Wa,t.capitalize=co,t.ceil=eu,t.clone=xi,t.cloneDeep=wi,t.deburr=ho,t.endsWith=lo,t.escape=po,t.escapeRegExp=fo,t.every=Yn,t.find=ia,t.findIndex=Ws,t.findKey=La,t.findLast=oa,t.findLastIndex=qs,t.findLastKey=Ra,t.findWhere=Jn,t.first=xn,t.floor=tu,t.get=Qi,t.gt=Si,t.gte=Mi,t.has=Ji,t.identity=Ao,t.includes=Zn,t.indexOf=Mn,t.inRange=ao,t.isArguments=Ei,t.isArray=Pa,t.isBoolean=Ci,t.isDate=Ti,t.isElement=Ai,t.isEmpty=Pi,t.isEqual=ki,t.isError=Oi,t.isFinite=Ni,t.isFunction=Di,t.isMatch=Ri,t.isNaN=ji,t.isNative=Ii,t.isNull=Vi,t.isNumber=Fi,t.isObject=Li,t.isPlainObject=Bi,t.isRegExp=Ui,t.isString=Gi,t.isTypedArray=zi,t.isUndefined=Hi,t.kebabCase=qa,t.last=Cn,t.lastIndexOf=Tn,t.lt=Wi,t.lte=qi,t.max=ru,t.min=nu,t.noConflict=No,t.noop=Do,t.now=ma,t.pad=mo,t.padLeft=$a,t.padRight=Xa,t.parseInt=vo,t.random=uo,t.reduce=pa,t.reduceRight=fa,t.repeat=go,t.result=ro,t.round=iu,t.runInContext=E,t.size=oi,t.snakeCase=Ka,t.some=si,t.sortedIndex=Ks,t.sortedLastIndex=Ys,t.startCase=Ya,t.startsWith=yo,t.sum=Bo,t.template=_o,t.trim=bo,t.trimLeft=xo,t.trimRight=wo,t.trunc=So,t.unescape=Mo,t.uniqueId=Vo,t.words=Eo,t.all=Yn,t.any=si,t.contains=Zn,t.eq=ki,t.detect=ia,t.foldl=pa,t.foldr=fa,t.head=xn,t.include=Zn,t.inject=pa,Oo(t,function(){var e={};return Ot(t,function(r,n){t.prototype[n]||(e[n]=r)}),e}(),!1),t.sample=ni,t.prototype.sample=function(e){return this.__chain__||null!=e?this.thru(function(t){return ni(t,e)}):ni(this.value())},t.VERSION=T,tt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){t[e].placeholder=t}),tt(["drop","take"],function(e,t){_.prototype[e]=function(r){var n=this.__filtered__;if(n&&!t)return new _(this);r=null==r?1:ws(ys(r)||0,0);var i=this.clone();return n?i.__takeCount__=Ss(i.__takeCount__,r):i.__views__.push({size:r,type:e+(i.__dir__<0?"Right":"")}),i},_.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}}),tt(["filter","map","takeWhile"],function(e,t){var r=t+1,n=r!=z;_.prototype[e]=function(e,t){var i=this.clone();return i.__iteratees__.push({iteratee:Br(e,t,1),type:r}),i.__filtered__=i.__filtered__||n,i}}),tt(["first","last"],function(e,t){var r="take"+(t?"Right":"");_.prototype[e]=function(){return this[r](1).value()[0]}}),tt(["initial","rest"],function(e,t){var r="drop"+(t?"":"Right");_.prototype[e]=function(){return this.__filtered__?new _(this):this[r](1)}}),tt(["pluck","where"],function(e,t){var r=t?"filter":"map",n=t?Ft:Lo;_.prototype[e]=function(e){return this[r](n(e))}}),_.prototype.compact=function(){return this.filter(Ao)},_.prototype.reject=function(e,t){return e=Br(e,t,1),this.filter(function(t){return!e(t)})},_.prototype.slice=function(e,t){e=null==e?0:+e||0;var r=this;return r.__filtered__&&(e>0||0>t)?new _(r):(0>e?r=r.takeRight(-e):e&&(r=r.drop(e)),t!==C&&(t=+t||0,r=0>t?r.dropRight(-t):r.take(t-e)),r)},_.prototype.takeRightWhile=function(e,t){return this.reverse().takeWhile(e,t).reverse()},_.prototype.toArray=function(){return this.take(As)},Ot(_.prototype,function(e,r){var i=/^(?:filter|map|reject)|While$/.test(r),o=/^(?:first|last)$/.test(r),s=t[o?"take"+("last"==r?"Right":""):r];s&&(t.prototype[r]=function(){var t=o?[1]:arguments,r=this.__chain__,a=this.__wrapped__,u=!!this.__actions__.length,c=a instanceof _,h=t[0],l=c||Pa(a);l&&i&&"function"==typeof h&&1!=h.length&&(c=l=!1);var p=function(e){return o&&r?s(e,1)[0]:s.apply(C,ct([e],t))},f={func:zn,args:[p],thisArg:C},d=c&&!u;if(o&&!r)return d?(a=a.clone(),a.__actions__.push(f),e.call(a)):s.call(C,this.value())[0];if(!o&&l){a=d?a:new _(this);var m=e.apply(a,t);return m.__actions__.push(f),new n(m,r)}return this.thru(p)})}),tt(["join","pop","push","replace","shift","sort","splice","split","unshift"],function(e){var r=(/^(?:replace|split)$/.test(e)?Zo:Qo)[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",i=/^(?:join|pop|replace|shift)$/.test(e);t.prototype[e]=function(){var e=arguments;return i&&!this.__chain__?r.apply(this.value(),e):this[n](function(t){return r.apply(t,e)})}}),Ot(_.prototype,function(e,r){var n=t[r];if(n){var i=n.name,o=Ls[i]||(Ls[i]=[]);o.push({name:r,func:n})}}),Ls[Or(C,P).name]=[{name:"wrapper",func:C}],_.prototype.clone=J,_.prototype.reverse=re,_.prototype.value=ie,t.prototype.chain=Hn,t.prototype.commit=Wn,t.prototype.concat=ta,t.prototype.plant=qn,t.prototype.reverse=$n,t.prototype.toString=Xn,t.prototype.run=t.prototype.toJSON=t.prototype.valueOf=t.prototype.value=Kn,t.prototype.collect=t.prototype.map,t.prototype.head=t.prototype.first,t.prototype.select=t.prototype.filter,t.prototype.tail=t.prototype.rest,t}var C,T="3.10.1",A=1,P=2,k=4,O=8,N=16,D=32,L=64,R=128,j=256,I=30,V="...",F=150,B=16,U=200,G=1,z=2,H="Expected a function",W="__lodash_placeholder__",q="[object Arguments]",$="[object Array]",X="[object Boolean]",K="[object Date]",Y="[object Error]",Q="[object Function]",J="[object Map]",Z="[object Number]",ee="[object Object]",te="[object RegExp]",re="[object Set]",ne="[object String]",ie="[object WeakMap]",oe="[object ArrayBuffer]",se="[object Float32Array]",ae="[object Float64Array]",ue="[object Int8Array]",ce="[object Int16Array]",he="[object Int32Array]",le="[object Uint8Array]",pe="[object Uint8ClampedArray]",fe="[object Uint16Array]",de="[object Uint32Array]",me=/\b__p \+= '';/g,ve=/\b(__p \+=) '' \+/g,ge=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ye=/&(?:amp|lt|gt|quot|#39|#96);/g,_e=/[&<>"'`]/g,be=RegExp(ye.source),xe=RegExp(_e.source),we=/<%-([\s\S]+?)%>/g,Se=/<%([\s\S]+?)%>/g,Me=/<%=([\s\S]+?)%>/g,Ee=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,Ce=/^\w*$/,Te=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,Ae=/^[:!,]|[\\^$.*+?()[\]{}|\/]|(^[0-9a-fA-Fnrtuvx])|([\n\r\u2028\u2029])/g,Pe=RegExp(Ae.source),ke=/[\u0300-\u036f\ufe20-\ufe23]/g,Oe=/\\(\\)?/g,Ne=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,De=/\w*$/,Le=/^0[xX]/,Re=/^\[object .+?Constructor\]$/,je=/^\d+$/,Ie=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,Ve=/($^)/,Fe=/['\n\r\u2028\u2029\\]/g,Be=function(){var e="[A-Z\\xc0-\\xd6\\xd8-\\xde]",t="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(e+"+(?="+e+t+")|"+e+"?"+t+"|"+e+"+|[0-9]+","g")}(),Ue=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","isFinite","parseFloat","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap"],Ge=-1,ze={};ze[se]=ze[ae]=ze[ue]=ze[ce]=ze[he]=ze[le]=ze[pe]=ze[fe]=ze[de]=!0,ze[q]=ze[$]=ze[oe]=ze[X]=ze[K]=ze[Y]=ze[Q]=ze[J]=ze[Z]=ze[ee]=ze[te]=ze[re]=ze[ne]=ze[ie]=!1;var He={};He[q]=He[$]=He[oe]=He[X]=He[K]=He[se]=He[ae]=He[ue]=He[ce]=He[he]=He[Z]=He[ee]=He[te]=He[ne]=He[le]=He[pe]=He[fe]=He[de]=!0,He[Y]=He[Q]=He[J]=He[re]=He[ie]=!1;var We={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},qe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},$e={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},Xe={"function":!0,object:!0},Ke={0:"x30",1:"x31",2:"x32",3:"x33",4:"x34",5:"x35",6:"x36",7:"x37",8:"x38",9:"x39",A:"x41",B:"x42",C:"x43",D:"x44",E:"x45",F:"x46",a:"x61",b:"x62",c:"x63",d:"x64",e:"x65",f:"x66",n:"x6e",r:"x72",t:"x74",u:"x75",v:"x76",x:"x78"},Ye={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Qe=Xe[typeof n]&&n&&!n.nodeType&&n,Je=Xe[typeof r]&&r&&!r.nodeType&&r,Ze=Qe&&Je&&"object"==typeof t&&t&&t.Object&&t,et=Xe[typeof self]&&self&&self.Object&&self,tt=Xe[typeof window]&&window&&window.Object&&window,rt=Je&&Je.exports===Qe&&Qe,nt=Ze||tt!==(this&&this.window)&&tt||et||this,it=E();"function"==typeof e&&"object"==typeof e.amd&&e.amd?(nt._=it,e(function(){return it})):Qe&&Je?rt?(Je.exports=it)._=it:Qe._=it:nt._=it}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],170:[function(t,r,n){"use strict";var i={};i.base32="0123456789bcdefghjkmnpqrstuvwxyz",i.encode=function(e,t,r){if("undefined"==typeof r){for(var n=1;12>=n;n++){var o=i.encode(e,t,n),s=i.decode(o);if(s.lat==e&&s.lon==t)return o}r=12}if(e=Number(e),t=Number(t),r=Number(r),isNaN(e)||isNaN(t)||isNaN(r))throw new Error("Invalid geohash");for(var a=0,u=0,c=!0,h="",l=-90,p=90,f=-180,d=180;h.length<r;){if(c){var m=(f+d)/2;t>m?(a=2*a+1,f=m):(a=2*a,d=m)}else{var v=(l+p)/2;e>v?(a=2*a+1,l=v):(a=2*a,p=v)}c=!c,5==++u&&(h+=i.base32.charAt(a),u=0,a=0)}return h},i.decode=function(e){var t=i.bounds(e),r=t.sw.lat,n=t.sw.lon,o=t.ne.lat,s=t.ne.lon,a=(r+o)/2,u=(n+s)/2;return a=a.toFixed(Math.floor(2-Math.log(o-r)/Math.LN10)),u=u.toFixed(Math.floor(2-Math.log(s-n)/Math.LN10)),{lat:Number(a),lon:Number(u)}},i.bounds=function(e){if(0===e.length)throw new Error("Invalid geohash");e=e.toLowerCase();for(var t=!0,r=-90,n=90,o=-180,s=180,a=0;a<e.length;a++){var u=e.charAt(a),c=i.base32.indexOf(u);if(-1==c)throw new Error("Invalid geohash");for(var h=4;h>=0;h--){var l=c>>h&1;if(t){var p=(o+s)/2;1==l?o=p:s=p}else{var f=(r+n)/2;1==l?r=f:n=f}t=!t}}var d={sw:{lat:r,lon:o},ne:{lat:n,lon:s}};return d},i.adjacent=function(e,t){if(e=e.toLowerCase(),t=t.toLowerCase(),0===e.length)throw new Error("Invalid geohash");if(-1=="nsew".indexOf(t))throw new Error("Invalid direction");var r={n:["p0r21436x8zb9dcf5h7kjnmqesgutwvy","bc01fg45238967deuvhjyznpkmstqrwx"],s:["14365h7k9dcfesgujnmqp0r2twvyx8zb","238967debc01fg45kmstqrwxuvhjyznp"],e:["bc01fg45238967deuvhjyznpkmstqrwx","p0r21436x8zb9dcf5h7kjnmqesgutwvy"],w:["238967debc01fg45kmstqrwxuvhjyznp","14365h7k9dcfesgujnmqp0r2twvyx8zb"]},n={n:["prxz","bcfguvyz"],s:["028b","0145hjnp"],e:["bcfguvyz","prxz"],w:["0145hjnp","028b"]},o=e.slice(-1),s=e.slice(0,-1),a=e.length%2;return-1!=n[t][a].indexOf(o)&&""!==s&&(s=i.adjacent(s,t)),s+i.base32.charAt(r[t][a].indexOf(o))},i.neighbours=function(e){return{n:i.adjacent(e,"n"),ne:i.adjacent(i.adjacent(e,"n"),"e"),e:i.adjacent(e,"e"),se:i.adjacent(i.adjacent(e,"s"),"e"),s:i.adjacent(e,"s"),sw:i.adjacent(i.adjacent(e,"s"),"w"),w:i.adjacent(e,"w"),nw:i.adjacent(i.adjacent(e,"n"),"w")}},"undefined"!=typeof r&&r.exports&&(r.exports=i),"function"==typeof e&&e.amd&&e([],function(){return i})},{}],171:[function(t,r,n){!function(){"use strict";function t(e,r){return this instanceof t?(this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),r&&this._initFormat(r),void this.clear()):new t(e,r)}function n(e,t){e.bbox=i(e,0,e.children.length,t)}function i(e,t,r,n){for(var i,a=o(),u=t;r>u;u++)i=e.children[u],s(a,e.leaf?n(i):i.bbox);return a}function o(){return[1/0,1/0,-(1/0),-(1/0)]}function s(e,t){return e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e}function a(e,t){return e.bbox[0]-t.bbox[0]}function u(e,t){return e.bbox[1]-t.bbox[1]}function c(e){return(e[2]-e[0])*(e[3]-e[1])}function h(e){return e[2]-e[0]+(e[3]-e[1])}function l(e,t){return(Math.max(t[2],e[2])-Math.min(t[0],e[0]))*(Math.max(t[3],e[3])-Math.min(t[1],e[1]))}function p(e,t){var r=Math.max(e[0],t[0]),n=Math.max(e[1],t[1]),i=Math.min(e[2],t[2]),o=Math.min(e[3],t[3]);return Math.max(0,i-r)*Math.max(0,o-n)}function f(e,t){return e[0]<=t[0]&&e[1]<=t[1]&&t[2]<=e[2]&&t[3]<=e[3]}function d(e,t){return t[0]<=e[2]&&t[1]<=e[3]&&t[2]>=e[0]&&t[3]>=e[1]}function m(e,t,r,n,i){for(var o,s=[t,r];s.length;)r=s.pop(),t=s.pop(),n>=r-t||(o=t+Math.ceil((r-t)/n/2)*n,v(e,t,r,o,i),s.push(t,o,o,r))}function v(e,t,r,n,i){for(var o,s,a,u,c,h,l,p,f;r>t;){for(r-t>600&&(o=r-t+1,s=n-t+1,a=Math.log(o),u=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*u*(o-u)/o)*(0>s-o/2?-1:1),h=Math.max(t,Math.floor(n-s*u/o+c)),l=Math.min(r,Math.floor(n+(o-s)*u/o+c)),v(e,h,l,n,i)),p=e[n],s=t,f=r,g(e,t,n),i(e[r],p)>0&&g(e,t,r);f>s;){for(g(e,s,f),s++,f--;i(e[s],p)<0;)s++;for(;i(e[f],p)>0;)f--}0===i(e[t],p)?g(e,t,f):(f++,g(e,f,r)),n>=f&&(t=f+1),f>=n&&(r=f-1)}}function g(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}t.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,r=[],n=this.toBBox;if(!d(e,t.bbox))return r;for(var i,o,s,a,u=[];t;){for(i=0,o=t.children.length;o>i;i++)s=t.children[i],a=t.leaf?n(s):s.bbox,d(e,a)&&(t.leaf?r.push(s):f(e,a)?this._all(s,r):u.push(s));t=u.pop()}return r},collides:function(e){var t=this.data,r=this.toBBox;if(!d(e,t.bbox))return!1;for(var n,i,o,s,a=[];t;){for(n=0,i=t.children.length;i>n;n++)if(o=t.children[n],s=t.leaf?r(o):o.bbox,d(e,s)){if(t.leaf||f(e,s))return!0;a.push(o)}t=a.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,r=e.length;r>t;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data={children:[],height:1,bbox:o(),leaf:!0},this},remove:function(e){if(!e)return this;for(var t,r,n,i,o=this.data,s=this.toBBox(e),a=[],u=[];o||a.length;){if(o||(o=a.pop(),r=a[a.length-1],t=u.pop(),i=!0),o.leaf&&(n=o.children.indexOf(e),-1!==n))return o.children.splice(n,1),a.push(o),this._condense(a),this;i||o.leaf||!f(o.bbox,s)?r?(t++,o=r.children[t],i=!1):o=null:(a.push(o),u.push(t),t=0,r=o,o=o.children[0])}return this},toBBox:function(e){return e},compareMinX:function(e,t){return e[0]-t[0]},compareMinY:function(e,t){return e[1]-t[1]},toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var r=[];e;)e.leaf?t.push.apply(t,e.children):r.push.apply(r,e.children),e=r.pop();return t},_build:function(e,t,r,i){var o,s=r-t+1,a=this._maxEntries;if(a>=s)return o={children:e.slice(t,r+1),height:1,bbox:null,leaf:!0},n(o,this.toBBox),o;i||(i=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,i-1))),o={children:[],height:i,bbox:null,leaf:!1};var u,c,h,l,p=Math.ceil(s/a),f=p*Math.ceil(Math.sqrt(a));for(m(e,t,r,f,this.compareMinX),u=t;r>=u;u+=f)for(h=Math.min(u+f-1,r),m(e,u,h,p,this.compareMinY),c=u;h>=c;c+=p)l=Math.min(c+p-1,h),o.children.push(this._build(e,c,l,i-1));return n(o,this.toBBox),o},_chooseSubtree:function(e,t,r,n){for(var i,o,s,a,u,h,p,f;;){if(n.push(t),t.leaf||n.length-1===r)break;for(p=f=1/0,i=0,o=t.children.length;o>i;i++)s=t.children[i],u=c(s.bbox),h=l(e,s.bbox)-u,f>h?(f=h,p=p>u?u:p,a=s):h===f&&p>u&&(p=u,a=s);t=a}return t},_insert:function(e,t,r){var n=this.toBBox,i=r?e.bbox:n(e),o=[],a=this._chooseSubtree(i,this.data,t,o);for(a.children.push(e),s(a.bbox,i);t>=0&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(i,o,t)},_split:function(e,t){var r=e[t],i=r.children.length,o=this._minEntries;this._chooseSplitAxis(r,o,i);var s=this._chooseSplitIndex(r,o,i),a={children:r.children.splice(s,r.children.length-s),height:r.height,bbox:null,leaf:!1};r.leaf&&(a.leaf=!0),n(r,this.toBBox),n(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(r,a)},_splitRoot:function(e,t){this.data={children:[e,t],height:e.height+1,bbox:null,leaf:!1},n(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,r){var n,o,s,a,u,h,l,f;for(h=l=1/0,n=t;r-t>=n;n++)o=i(e,0,n,this.toBBox),s=i(e,n,r,this.toBBox),a=p(o,s),u=c(o)+c(s),h>a?(h=a,f=n,l=l>u?u:l):a===h&&l>u&&(l=u,f=n);return f},_chooseSplitAxis:function(e,t,r){var n=e.leaf?this.compareMinX:a,i=e.leaf?this.compareMinY:u,o=this._allDistMargin(e,t,r,n),s=this._allDistMargin(e,t,r,i);s>o&&e.children.sort(n)},_allDistMargin:function(e,t,r,n){e.children.sort(n);var o,a,u=this.toBBox,c=i(e,0,t,u),l=i(e,r-t,r,u),p=h(c)+h(l);for(o=t;r-t>o;o++)a=e.children[o],s(c,e.leaf?u(a):a.bbox),p+=h(c);for(o=r-t-1;o>=t;o--)a=e.children[o],s(l,e.leaf?u(a):a.bbox),p+=h(l);return p},_adjustParentBBoxes:function(e,t,r){for(var n=r;n>=0;n--)s(t[n].bbox,e)},_condense:function(e){for(var t,r=e.length-1;r>=0;r--)0===e[r].children.length?r>0?(t=e[r-1].children,t.splice(t.indexOf(e[r]),1)):this.clear():n(e[r],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return [a"+e.join(", a")+"];")}},"function"==typeof e&&e.amd?e("rbush",function(){return t}):"undefined"!=typeof r?r.exports=t:"undefined"!=typeof self?self.rbush=t:window.rbush=t}()},{}],172:[function(t,r,n){!function(e,t){"use strict";var r;e(function(e){function n(e,t){var r,n,i,o;if(r=e,i={},t){for(n in t)o=new RegExp("\\{"+n+"\\}"),o.test(r)?r=r.replace(o,encodeURIComponent(t[n]),"g"):i[n]=t[n];for(n in i)r+=-1===r.indexOf("?")?"?":"&",r+=encodeURIComponent(n),null!==i[n]&&void 0!==i[n]&&(r+="=",r+=encodeURIComponent(i[n]))}return r}function i(e,t){return 0===e.indexOf(t)}function o(e,t){return this instanceof o?void(e instanceof o?(this._template=e.template,this._params=s({},this._params,t)):(this._template=(e||"").toString(),this._params=t||{})):new o(e,t)}var s,a,u,c,h;return s=e("./util/mixin"),u=/([a-z][a-z0-9\+\-\.]*:)\/\/([^@]+@)?(([^:\/]+)(:([0-9]+))?)?(\/[^?#]*)?(\?[^#]*)?(#\S*)?/i,c=/^([a-z][a-z0-9\-\+\.]*:\/\/|\/)/i,h=/([a-z][a-z0-9\+\-\.]*:)\/\/([^@]+@)?(([^:\/]+)(:([0-9]+))?)?\//i,o.prototype={append:function(e,t){return new o(this._template+e,s({},this._params,t))},fullyQualify:function(){if(!t)return this;if(this.isFullyQualified())return this;var e=this._template;return i(e,"//")?e=a.protocol+e:i(e,"/")?e=a.origin+e:this.isAbsolute()||(e=a.origin+a.pathname.substring(0,a.pathname.lastIndexOf("/")+1)),-1===e.indexOf("/",8)&&(e+="/"),new o(e,this._params)},isAbsolute:function(){return c.test(this.build())},isFullyQualified:function(){return h.test(this.build())},isCrossOrigin:function(){if(!a)return!0;var e=this.parts();return e.protocol!==a.protocol||e.hostname!==a.hostname||e.port!==a.port},parts:function(){var e,t;return e=this.fullyQualify().build().match(u),t={href:e[0],protocol:e[1],host:e[3]||"",hostname:e[4]||"",port:e[6],pathname:e[7]||"",search:e[8]||"",hash:e[9]||""},t.origin=t.protocol+"//"+t.host,t.port=t.port||("https:"===t.protocol?"443":"http:"===t.protocol?"80":""),t},build:function(e){return n(this._template,s({},this._params,e))},toString:function(){return this.build()}},a=t?new o(t.href).parts():r,o})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)},"undefined"!=typeof window?window.location:void 0)},{"./util/mixin":190}],173:[function(t,r,n){!function(e){"use strict";e(function(e){var t=e("./client/default"),r=e("./client/xhr");
return t.setPlatformDefaultClient(r),t})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{"./client/default":175,"./client/xhr":176}],174:[function(t,r,n){!function(e){"use strict";e(function(){return function(e,t){return t&&(e.skip=function(){return t}),e.wrap=function(t,r){return t(e,r)},e.chain=function(){return"undefined"!=typeof console&&console.log("rest.js: client.chain() is deprecated, use client.wrap() instead"),e.wrap.apply(this,arguments)},e}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{}],175:[function(t,r,n){!function(e){"use strict";var t;e(function(e){function r(){return i.apply(t,arguments)}var n,i,o;return n=e("../client"),r.setDefaultClient=function(e){i=e},r.getDefaultClient=function(){return i},r.resetDefaultClient=function(){i=o},r.setPlatformDefaultClient=function(e){if(o)throw new Error("Unable to redefine platformDefaultClient");i=o=e},n(r)})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{"../client":174}],176:[function(t,r,n){!function(e,t){"use strict";e(function(e){function r(e){var t={};return e?(e.trim().split(c).forEach(function(e){var r,n,i;r=e.indexOf(":"),n=s(e.substring(0,r).trim()),i=e.substring(r+1).trim(),t[n]?Array.isArray(t[n])?t[n].push(i):t[n]=[t[n],i]:t[n]=i}),t):t}function n(e,t){return Object.keys(t||{}).forEach(function(r){if(t.hasOwnProperty(r)&&r in e)try{e[r]=t[r]}catch(n){}}),e}var i,o,s,a,u,c;return i=e("when"),o=e("../UrlBuilder"),s=e("../util/normalizeHeaderName"),a=e("../util/responsePromise"),u=e("../client"),c=/[\r|\n]+/,u(function(e){return a.promise(function(i,s){var a,u,c,h,l,p,f,d;if(e="string"==typeof e?{path:e}:e||{},f={request:e},e.canceled)return f.error="precanceled",void s(f);if(d=e.engine||t.XMLHttpRequest,!d)return void s({request:e,error:"xhr-not-available"});l=e.entity,e.method=e.method||(l?"POST":"GET"),u=e.method,c=new o(e.path||"",e.params).build();try{a=f.raw=new d,n(a,e.mixin),a.open(u,c,!0),n(a,e.mixin),h=e.headers;for(p in h)("Content-Type"!==p||"multipart/form-data"!==h[p])&&a.setRequestHeader(p,h[p]);e.canceled=!1,e.cancel=function(){e.canceled=!0,a.abort(),s(f)},a.onreadystatechange=function(){e.canceled||a.readyState===(d.DONE||4)&&(f.status={code:a.status,text:a.statusText},f.headers=r(a.getAllResponseHeaders()),f.entity=a.responseText,f.status.code>0?i(f):setTimeout(function(){i(f)},0))};try{a.onerror=function(){f.error="loaderror",s(f)}}catch(m){}a.send(l)}catch(m){f.error="loaderror",s(f)}})})})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)},"undefined"!=typeof window?window:void 0)},{"../UrlBuilder":172,"../client":174,"../util/normalizeHeaderName":191,"../util/responsePromise":192,when:250}],177:[function(t,r,n){!function(e){"use strict";e(function(e){function t(e){return e}function r(e){return e}function n(e){return e}function i(e){return l.promise(function(t,r){e.forEach(function(e){l(e,t,r)})})}function o(e){return this instanceof o?void u(this,e):new o(e)}function s(e){var s,u,p,f;return e=e||{},s=e.init||t,u=e.request||r,p=e.success||e.response||n,f=e.error||function(){return l((e.response||n).apply(this,arguments),l.reject,l.reject)},function(t,r){function n(e){var s,a;return s={},a={arguments:Array.prototype.slice.call(arguments),client:n},e="string"==typeof e?{path:e}:e||{},e.originator=e.originator||n,c(u.call(s,e,r,a),function(e){var n,u,c;return c=t,e instanceof o&&(u=e.abort,c=e.client||c,n=e.response,e=e.request),n=n||l(e,function(e){return l(c(e),function(e){return p.call(s,e,r,a)},function(e){return f.call(s,e,r,a)})}),u?i([n,u]):n},function(t){return l.reject({request:e,error:t})})}return"object"==typeof t&&(r=t),"function"!=typeof t&&(t=e.client||a),r=s(r||{}),h(n,t)}}var a,u,c,h,l;return a=e("./client/default"),u=e("./util/mixin"),c=e("./util/responsePromise"),h=e("./client"),l=e("when"),s.ComplexRequest=o,s})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{"./client":174,"./client/default":175,"./util/mixin":190,"./util/responsePromise":192,when:250}],178:[function(t,r,n){!function(e){"use strict";e(function(e){var t,r,n,i,o;return t=e("../interceptor"),r=e("../mime"),n=e("../mime/registry"),o=e("when"),i={read:function(e){return e},write:function(e){return e}},t({init:function(e){return e.registry=e.registry||n,e},request:function(e,t){var n,s;return s=e.headers||(e.headers={}),n=r.parse(s["Content-Type"]=s["Content-Type"]||t.mime||"text/plain"),s.Accept=s.Accept||t.accept||n.raw+", application/json;q=0.8, text/plain;q=0.5, */*;q=0.2","entity"in e?t.registry.lookup(n).otherwise(function(){if(t.permissive)return i;throw"mime-unknown"}).then(function(r){var i=t.client||e.originator;return o.attempt(r.write,e.entity,{client:i,request:e,mime:n,registry:t.registry}).otherwise(function(){throw"mime-serialization"}).then(function(t){return e.entity=t,e})}):e},response:function(e,t){if(!(e.headers&&e.headers["Content-Type"]&&e.entity))return e;var n=r.parse(e.headers["Content-Type"]);return t.registry.lookup(n).otherwise(function(){return i}).then(function(r){var i=t.client||e.request&&e.request.originator;return o.attempt(r.read,e.entity,{client:i,response:e,mime:n,registry:t.registry}).otherwise(function(t){throw e.error="mime-deserialization",e.cause=t,e}).then(function(t){return e.entity=t,e})})}})})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{"../interceptor":177,"../mime":181,"../mime/registry":182,when:250}],179:[function(t,r,n){!function(e){"use strict";e(function(e){function t(e,t){return 0===e.indexOf(t)}function r(e,t){return e.lastIndexOf(t)+t.length===e.length}var n,i;return n=e("../interceptor"),i=e("../UrlBuilder"),n({request:function(e,n){var o;return n.prefix&&!new i(e.path).isFullyQualified()&&(o=n.prefix,e.path&&(r(o,"/")||t(e.path,"/")||(o+="/"),o+=e.path),e.path=o),e}})})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{"../UrlBuilder":172,"../interceptor":177}],180:[function(t,r,n){!function(e){"use strict";e(function(e){var t,r,n;return t=e("../interceptor"),r=e("../util/uriTemplate"),n=e("../util/mixin"),t({init:function(e){return e.params=e.params||{},e.template=e.template||"",e},request:function(e,t){var i,o;return i=e.path||t.template,o=n({},e.params,t.params),e.path=r.expand(i,o),delete e.params,e}})})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{"../interceptor":177,"../util/mixin":190,"../util/uriTemplate":194}],181:[function(t,r,n){!function(e){"use strict";var t;e(function(){function e(e){var r,n;return r=e.split(";"),n=r[0].trim().split("+"),{raw:e,type:n[0],suffix:n[1]?"+"+n[1]:"",params:r.slice(1).reduce(function(e,r){return r=r.split("="),e[r[0].trim()]=r[1]?r[1].trim():t,e},{})}}return{parse:e}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{}],182:[function(t,r,n){!function(e){"use strict";e(function(e){function t(e){this.lookup=function(t){var i;return i="string"==typeof t?r.parse(t):t,e[i.raw]?e[i.raw]:e[i.type+i.suffix]?e[i.type+i.suffix]:e[i.type]?e[i.type]:e[i.suffix]?e[i.suffix]:n.reject(new Error('Unable to locate converter for mime "'+i.raw+'"'))},this.delegate=function(e){return{read:function(){var t=arguments;return this.lookup(e).then(function(e){return e.read.apply(this,t)}.bind(this))}.bind(this),write:function(){var t=arguments;return this.lookup(e).then(function(e){return e.write.apply(this,t)}.bind(this))}.bind(this)}},this.register=function(t,r){return e[t]=n(r),e[t]},this.child=function(){return new t(Object.create(e))}}var r,n,i;return r=e("../mime"),n=e("when"),i=new t({}),i.register("application/hal",e("./type/application/hal")),i.register("application/json",e("./type/application/json")),i.register("application/x-www-form-urlencoded",e("./type/application/x-www-form-urlencoded")),i.register("multipart/form-data",e("./type/multipart/form-data")),i.register("text/plain",e("./type/text/plain")),i.register("+json",i.delegate("application/json")),i})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{"../mime":181,"./type/application/hal":183,"./type/application/json":184,"./type/application/x-www-form-urlencoded":185,"./type/multipart/form-data":186,"./type/text/plain":187,when:250}],183:[function(t,r,n){!function(e){"use strict";e(function(e){function t(e,t,r){Object.defineProperty(e,t,{value:r,configurable:!0,enumerable:!1,writeable:!0})}var r,n,i,o,s,a;return r=e("../../../interceptor/pathPrefix"),n=e("../../../interceptor/template"),i=e("../../../util/find"),o=e("../../../util/lazyPromise"),s=e("../../../util/responsePromise"),a=e("when"),{read:function(e,u){function c(e,t){(t&&l&&l.warn||l.log)&&(l.warn||l.log).call(l,"Relationship '"+e+"' is deprecated, see "+t)}var h,l;return u=u||{},h=u.client,l=u.console||l,u.registry.lookup(u.mime.suffix).then(function(l){return a(l.read(e,u)).then(function(e){return i.findProperties(e,"_embedded",function(e,r,n){Object.keys(e).forEach(function(n){if(!(n in r)){var i=s({entity:e[n]});t(r,n,i)}}),t(r,n,e)}),i.findProperties(e,"_links",function(e,i,a){Object.keys(e).forEach(function(r){var a=e[r];r in i||t(i,r,s.make(o(function(){return a.deprecation&&c(r,a.deprecation),a.templated===!0?n(h)({path:a.href}):h({path:a.href})})))}),t(i,a,e),t(i,"clientFor",function(t,i){var o=e[t];if(!o)throw new Error("Unknown relationship: "+t);return o.deprecation&&c(t,o.deprecation),o.templated===!0?n(i||h,{template:o.href}):r(i||h,{prefix:o.href})}),t(i,"requestFor",function(e,t,r){var n=this.clientFor(e,r);return n(t)})}),e})})},write:function(e,t){return t.registry.lookup(t.mime.suffix).then(function(r){return r.write(e,t)})}}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{"../../../interceptor/pathPrefix":179,"../../../interceptor/template":180,"../../../util/find":188,"../../../util/lazyPromise":189,"../../../util/responsePromise":192,when:250}],184:[function(t,r,n){!function(e){"use strict";e(function(){function e(t,r){return{read:function(e){return JSON.parse(e,t)},write:function(e){return JSON.stringify(e,r)},extend:e}}return e()})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{}],185:[function(t,r,n){!function(e){"use strict";e(function(){function e(e){return e=encodeURIComponent(e),e.replace(n,"+")}function t(e){return e=e.replace(i," "),decodeURIComponent(e)}function r(t,n,i){return Array.isArray(i)?i.forEach(function(e){t=r(t,n,e)}):(t.length>0&&(t+="&"),t+=e(n),void 0!==i&&null!==i&&(t+="="+e(i))),t}var n,i;return n=/%20/g,i=/\+/g,{read:function(e){var r={};return e.split("&").forEach(function(e){var n,i,o;n=e.split("="),i=t(n[0]),o=2===n.length?t(n[1]):null,i in r?(Array.isArray(r[i])||(r[i]=[r[i]]),r[i].push(o)):r[i]=o}),r},write:function(e){var t="";return Object.keys(e).forEach(function(n){t=r(t,n,e[n])}),t}}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{}],186:[function(t,r,n){!function(e){"use strict";e(function(){function e(e){return e&&1===e.nodeType&&"FORM"===e.tagName}function t(e){var t,r=new FormData;for(var n in e)e.hasOwnProperty(n)&&(t=e[n],t instanceof File?r.append(n,t,t.name):t instanceof Blob?r.append(n,t):r.append(n,String(t)));return r}return{write:function(r){if("undefined"==typeof FormData)throw new Error("The multipart/form-data mime serializer requires FormData support");if(r instanceof FormData)return r;if(e(r))return new FormData(r);if("object"==typeof r&&null!==r)return t(r);throw new Error("Unable to create FormData from object "+r)}}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{}],187:[function(t,r,n){!function(e){"use strict";e(function(){return{read:function(e){return e},write:function(e){return e.toString()}}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{}],188:[function(t,r,n){!function(e){"use strict";e(function(){return{findProperties:function e(t,r,n){"object"==typeof t&&null!==t&&(r in t&&n(t[r],t,r),Object.keys(t).forEach(function(i){e(t[i],r,n)}))}}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{}],189:[function(t,r,n){!function(e){"use strict";e(function(e){function t(e){var t,n,i,o,s;return t=r.defer(),n=!1,i=t.resolver,o=t.promise,s=o.then,o.then=function(){return n||(n=!0,r.attempt(e).then(i.resolve,i.reject)),s.apply(o,arguments)},o}var r;return r=e("when"),t})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{when:250}],190:[function(t,r,n){!function(e){"use strict";e(function(){function e(e){var r,n,i,o;for(e||(e={}),r=1,n=arguments.length;n>r;r+=1){i=arguments[r];for(o in i)o in e&&(e[o]===i[o]||o in t&&t[o]===i[o])||(e[o]=i[o])}return e}var t={};return e})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{}],191:[function(t,r,n){!function(e){"use strict";e(function(){function e(e){return e.toLowerCase().split("-").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join("-")}return e})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{}],192:[function(t,r,n){!function(e){"use strict";e(function(e){function t(e,t){return e.then(function(e){return e&&e[t]},function(e){return c.reject(e&&e[t])})}function r(){return t(this,"entity")}function n(){return t(t(this,"status"),"code")}function i(){return t(this,"headers")}function o(e){return e=h(e),t(this.headers(),e)}function s(e){return e=[].concat(e),a(c.reduce(e,function(e,t){if("string"==typeof t&&(t={rel:t}),"function"!=typeof e.entity.clientFor)throw new Error("Hypermedia response expected");var r=e.entity.clientFor(t.rel);return r({params:t.params})},this))}function a(e){return e.status=n,e.headers=i,e.header=o,e.entity=r,e.follow=s,e}function u(){return a(c.apply(c,arguments))}var c=e("when"),h=e("./normalizeHeaderName");return u.make=a,u.reject=function(e){return a(c.reject(e))},u.promise=function(e){return a(c.promise(e))},u})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{"./normalizeHeaderName":191,when:250}],193:[function(t,r,n){!function(e){"use strict";e(function(){function e(e,t){if("string"!=typeof e)throw new Error("String required for URL encoding");return e.split("").map(function(e){if(t.hasOwnProperty(e))return e;var r=e.charCodeAt(0);return 127>=r?"%"+r.toString(16).toUpperCase():encodeURIComponent(e).toUpperCase()}).join("")}function t(t){return t=t||n.unreserved,function(r){return e(r,t)}}function r(e){return decodeURIComponent(e)}var n;return n=function(){var e={alpha:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",digit:"0123456789"};return e.genDelims=":/?#[]@",e.subDelims="!$&'()*+,;=",e.reserved=e.genDelims+e.subDelims,e.unreserved=e.alpha+e.digit+"-._~",e.url=e.reserved+e.unreserved,e.scheme=e.alpha+e.digit+"+-.",e.userinfo=e.unreserved+e.subDelims+":",e.host=e.unreserved+e.subDelims,e.port=e.digit,e.pchar=e.unreserved+e.subDelims+":@",e.segment=e.pchar,e.path=e.segment+"/",e.query=e.pchar+"/?",e.fragment=e.pchar+"/?",Object.keys(e).reduce(function(t,r){return t[r]=e[r].split("").reduce(function(e,t){return e[t]=!0,e},{}),t},{})}(),{decode:r,encode:t(),encodeURL:t(n.url),encodeScheme:t(n.scheme),encodeUserInfo:t(n.userinfo),encodeHost:t(n.host),encodePort:t(n.port),encodePathSegment:t(n.segment),encodePath:t(n.path),encodeQuery:t(n.query),encodeFragment:t(n.fragment)}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{}],194:[function(t,r,n){!function(e){"use strict";var t;e(function(e){function r(e,r,n){return r.split(",").reduce(function(r,i){var s,u;if(s={},"*"===i.slice(-1)&&(i=i.slice(0,-1),s.explode=!0),a.test(i)){var c=a.exec(i);i=c[1],s.maxLength=parseInt(c[2])}return i=o.decode(i),u=n[i],u===t||null===u?r:(Array.isArray(u)?r+=u.reduce(function(t,r){return t.length?(t+=s.explode?e.separator:",",e.named&&s.explode&&(t+=e.encoder(i),t+=r.length?"=":e.empty)):(t+=e.first,e.named&&(t+=e.encoder(i),t+=r.length?"=":e.empty)),t+=e.encoder(r)},""):"object"==typeof u?r+=Object.keys(u).reduce(function(t,r){return t.length?t+=s.explode?e.separator:",":(t+=e.first,e.named&&!s.explode&&(t+=e.encoder(i),t+=u[r].length?"=":e.empty)),t+=e.encoder(r),t+=s.explode?"=":",",t+=e.encoder(u[r])},""):(u=String(u),s.maxLength&&(u=u.slice(0,s.maxLength)),r+=r.length?e.separator:e.first,e.named&&(r+=e.encoder(i),r+=u.length?"=":e.empty),r+=e.encoder(u)),r)},"")}function n(e,t){var n;if(n=s[e.slice(0,1)],n?e=e.slice(1):n=s[""],n.reserved)throw new Error("Reserved expression operations are not supported");return r(n,e,t)}function i(e,t){var r,i,o;for(o="",i=0;;){if(r=e.indexOf("{",i),-1===r){o+=e.slice(i);break}o+=e.slice(i,r),i=e.indexOf("}",r)+1,o+=n(e.slice(r+1,i-1),t)}return o}var o,s,a;return o=e("./uriEncoder"),a=/^([^:]*):([0-9]+)$/,s={"":{first:"",separator:",",named:!1,empty:"",encoder:o.encode},"+":{first:"",separator:",",named:!1,empty:"",encoder:o.encodeURL},"#":{first:"#",separator:",",named:!1,empty:"",encoder:o.encodeURL},".":{first:".",separator:".",named:!1,empty:"",encoder:o.encode},"/":{first:"/",separator:"/",named:!1,empty:"",encoder:o.encode},";":{first:";",separator:";",named:!0,empty:"",encoder:o.encode},"?":{first:"?",separator:"&",named:!0,empty:"=",encoder:o.encode},"&":{first:"&",separator:"&",named:!0,empty:"=",encoder:o.encode},"=":{reserved:!0},",":{reserved:!0},"!":{reserved:!0},"@":{reserved:!0},"|":{reserved:!0}},{expand:i}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{"./uriEncoder":193}],195:[function(t,r,n){(function(t,i){(function(o){function s(e){return e&&e.Object===Object?e:null}function a(e){for(var t=[],r=0,n=e.length;n>r;r++)t.push(e[r]);return t}function u(e){return function(){try{return e.apply(this,arguments)}catch(t){return rt.e=t,rt}}}function c(e){throw e}function h(e,t){if(it&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(ut)){for(var r=[],n=t;n;n=n.source)n.stack&&r.unshift(n.stack);r.unshift(e.stack);var i=r.join("\n"+ut+"\n");e.stack=l(i)}}function l(e){for(var t=e.split("\n"),r=[],n=0,i=t.length;i>n;n++){var o=t[n];p(o)||f(o)||!o||r.push(o)}return r.join("\n")}function p(e){var t=m(e);if(!t)return!1;var r=t[0],n=t[1];return r===st&&n>=at&&Vs>=n}function f(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function d(){if(it)try{throw new Error}catch(e){var t=e.stack.split("\n"),r=t[0].indexOf("@")>0?t[1]:t[2],n=m(r);if(!n)return;return st=n[0],n[1]}}function m(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var r=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(r)return[r[1],Number(r[2])];var n=/.*@(.+):(\d+)$/.exec(e);return n?[n[1],Number(n[2])]:void 0}function v(e,t,r,n,i,s){var a=Kt(e),u=a.length,c=Kt(t),h=c.length;if(u!==h&&!n)return!1;for(var l,p=u;p--;)if(l=a[p],!(n?l in t:qt.call(t,l)))return!1;for(var f=n;++p<u;){l=a[p];var d,m=e[l],v=t[l];if(!(d===o?r(m,v,n,i,s):d))return!1;f||(f="constructor"===l)}if(!f){var g=e.constructor,y=t.constructor;if(g!==y&&"constructor"in e&&"constructor"in t&&!("function"==typeof g&&g instanceof g&&"function"==typeof y&&y instanceof y))return!1}return!0}function g(e,t,r){switch(r){case St:case Mt:return+e===+t;case Et:return e.name===t.name&&e.message===t.message;case At:return e!==+e?t!==+t:e===+t;case kt:case Nt:return e===t+""}return!1}function y(e){return!!e&&"object"==typeof e}function _(e){return"number"==typeof e&&e>-1&&e%1===0&&Xt>=e}function b(e){return y(e)&&_(e.length)&&!!Ht[$t.call(e)]}function x(e,t){for(var r=-1,n=e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function w(e,t,r,n,i,s){var a=-1,u=e.length,c=t.length;if(u!==c&&!(n&&c>u))return!1;for(;++a<u;){var h,l=e[a],p=t[a];if(h!==o){if(h)continue;return!1}if(n){if(!x(t,function(e){return l===e||r(l,e,n,i,s)}))return!1}else if(l!==p&&!r(l,p,n,i,s))return!1}return!0}function S(e,t,r,n,i,o){var s=Qt(e),a=Qt(t),u=wt,c=wt;s||(u=$t.call(e),u===xt?u=Pt:u!==Pt&&(s=b(e))),a||(c=$t.call(t),c===xt&&(c=Pt));var h=u===Pt&&!Yt(e),l=c===Pt&&!Yt(t),p=u===c;if(p&&!s&&!h)return g(e,t,u);if(!n){var f=h&&qt.call(e,"__wrapped__"),d=l&&qt.call(t,"__wrapped__");if(f||d)return r(f?e.value():e,d?t.value():t,n,i,o)}if(!p)return!1;i||(i=[]),o||(o=[]);for(var m=i.length;m--;)if(i[m]===e)return o[m]===t;i.push(e),o.push(t);var y=(s?w:v)(e,t,r,n,i,o);return i.pop(),o.pop(),y}function M(e,t,r,n,i){return e===t?!0:null==e||null==t||!se(e)&&!y(t)?e!==e&&t!==t:S(e,t,M,r,n,i)}function E(e,t){for(var r=new Array(e),n=0;e>n;n++)r[n]=t();return r}function C(e,t){this.id=e,this.value=t}function T(e,t){this.scheduler=e,this.disposable=t,this.isDisposed=!1}function A(e,t){t.isDisposed||(t.isDisposed=!0,t.disposable.dispose())}function P(e){this._s=e,this.isDisposed=!1}function k(e){this._s=e}function O(e){this._s=e,this._l=e.length,this._i=0}function N(e){this._a=e}function D(e){this._a=e,this._l=I(e),this._i=0}function L(e){return"number"==typeof e&&qe.isFinite(e)}function R(e){var t,r=e[mt];if(!r&&"string"==typeof e)return t=new k(e),t[mt]();if(!r&&e.length!==o)return t=new N(e),t[mt]();if(!r)throw new TypeError("Object is not iterable");return e[mt]()}function j(e){var t=+e;return 0===t?t:isNaN(t)?t:0>t?-1:1}function I(e){var t=+e.length;return isNaN(t)?0:0!==t&&L(t)?(t=j(t)*Math.floor(Math.abs(t)),0>=t?0:t>gn?gn:t):t}function V(e,t){return br(e)||(e=Tr),new _n(t,e)}function F(e,t){this.observer=e,this.parent=t}function B(e,t){return e.amb(t)}function U(){return!1}function G(){for(var e=arguments.length,t=new Array(e),r=0;e>r;r++)t[r]=arguments[r];return t}function U(){return!1}function G(){for(var e=arguments.length,t=new Array(e),r=0;e>r;r++)t[r]=arguments[r];return t}function U(){return!1}function z(){return[]}function U(){return!1}function z(){return[]}function G(){for(var e=arguments.length,t=new Array(e),r=0;e>r;r++)t[r]=arguments[r];return t}function H(e){return function(t){return e.subscribe(t)}}function W(e){return e.toArray()}function q(e){return e.length>0}function $(e){return{"@@iterator":function(){return{next:function(){return{done:!1,value:e}}}}}}function $(e){return{"@@iterator":function(){return{next:function(){return{done:!1,value:e}}}}}}function X(e,t,r){var n=_t(t,r,3);return e.map(function(t,r){var i=n(t,r,e);return et(i)&&(i=cn(i)),(yt(i)||gt(i))&&(i=yn(i)),i}).concatAll()}function K(e,t,r){for(var n=0,i=e.length;i>n;n++)if(r(e[n],t))return n;return-1}function Y(e){this.comparer=e,this.set=[]}function Q(e,t){return function(r){for(var n=r,i=0;t>i;i++){var s=n[e[i]];if("undefined"==typeof s)return o;n=s}return n}}function J(e){if(0===e.length)throw new ct;return e[0]}function Z(e,t,r,n){var i=_t(t,r,3);return new Ps(function(t){return e.subscribe(new po(t,e,i,n))},e)}function ee(e){return e?Kr.isObservable(e)?e:et(e)?Kr.fromPromise(e):oe(e)||ie(e)?wo.call(this,e):tt(e)?ne.call(this,e):yt(e)||gt(e)?te.call(this,e):se(e)?re.call(this,e):e:e}function te(e){return Kr.from(e).concatMap(function(e){return Kr.isObservable(e)||se(e)?ee.call(null,e):$e.Observable.just(e)}).toArray()}function re(e){function t(e,t){r[t]=o,i.push(e.map(function(e){r[t]=e}))}for(var r=new e.constructor,n=Object.keys(e),i=[],s=0,a=n.length;a>s;s++){var u=n[s],c=ee.call(this,e[u]);c&&Kr.isObservable(c)?t(c,u):r[u]=e[u]}return Kr.forkJoin.apply(Kr,i).map(function(){return r})}function ne(e){var t=this;return new Ps(function(r){e.call(t,function(){var e=arguments[0],t=arguments[1];if(e)return r.onError(e);if(arguments.length>2){for(var n=[],i=1,o=arguments.length;o>i;i++)n.push(arguments[i]);t=n}r.onNext(t),r.onCompleted()})})}function ie(e){return tt(e.next)&&tt(e["throw"])}function oe(e){var t=e.constructor;return t?"GeneratorFunction"===t.name||"GeneratorFunction"===t.displayName?!0:ie(t.prototype):!1}function se(e){return Object==e.constructor}function ae(e,t,r,n){var i=new Ls;return n.push(ue(i,t,r)),e.apply(t,n),i.asObservable()}function ue(e,t,r){return function(){for(var n=arguments.length,i=new Array(n),o=0;n>o;o++)i[o]=arguments[o];if(tt(r)){if(i=nt(r).apply(t,i),i===rt)return e.onError(i.e);e.onNext(i)}else i.length<=1?e.onNext(i[0]):e.onNext(i);e.onCompleted()}}function ce(e,t,r,n){var i=new Ls;return n.push(he(i,t,r)),e.apply(t,n),i.asObservable()}function he(e,t,r){return function(){var n=arguments[0];if(n)return e.onError(n);for(var i=arguments.length,o=[],s=1;i>s;s++)o[s-1]=arguments[s];if(tt(r)){var o=nt(r).apply(t,o);if(o===rt)return e.onError(o.e);e.onNext(o)}else o.length<=1?e.onNext(o[0]):e.onNext(o);e.onCompleted()}}function le(e){return qe.StaticNodeList?e instanceof qe.StaticNodeList||e instanceof qe.NodeList:"[object NodeList]"===Object.prototype.toString.call(e)}function pe(e,t,r){this._e=e,this._n=t,this._fn=r,this._e.addEventListener(this._n,this._fn,!1),this.isDisposed=!1}function fe(e,t,r){var n=new ir,i=Object.prototype.toString.call(e);if(le(e)||"[object HTMLCollection]"===i)for(var o=0,s=e.length;s>o;o++)n.add(fe(e.item(o),t,r));else e&&n.add(new pe(e,t,r));return n}function de(e,t,r){return new Ps(function(n){function i(e,t){if(c[t]=e,s[t]=!0,a||(a=s.every(Ke))){if(o)return n.onError(o);var i=nt(r).apply(null,c);if(i===rt)return n.onError(i.e);n.onNext(i)}u&&c[1]&&n.onCompleted()}var o,s=[!1,!1],a=!1,u=!1,c=new Array(2);return new dr(e.subscribe(function(e){i(e,0)},function(e){c[1]?n.onError(e):o=e},function(){u=!0,c[1]&&n.onCompleted()}),t.subscribe(function(e){i(e,1)},function(e){n.onError(e)},function(){u=!0,i(!0,1)}))},e)}function W(e){return e.toArray()}function me(e,t){return e.groupJoin(this,t,mn,function(e,t){return t})}function ve(e){var t=this;return new Ps(function(r){var n=new Ds,i=new ir,o=new vr(i);return r.onNext(tr(n,o)),i.add(t.subscribe(function(e){n.onNext(e)},function(e){n.onError(e),r.onError(e)},function(){n.onCompleted(),r.onCompleted()})),et(e)&&(e=cn(e)),i.add(e.subscribe(function(e){n.onCompleted(),n=new Ds,r.onNext(tr(n,o))},function(e){n.onError(e),r.onError(e)},function(){n.onCompleted(),r.onCompleted()})),o},t)}function ge(e){var t=this;return new Ps(function(r){function n(){var t;try{t=e()}catch(o){return void r.onError(o)}et(t)&&(t=cn(t));var u=new pr;i.setDisposable(u),u.setDisposable(t.take(1).subscribe(Xe,function(e){a.onError(e),r.onError(e)},function(){a.onCompleted(),a=new Ds,r.onNext(tr(a,s)),n()}))}var i=new fr,o=new ir(i),s=new vr(o),a=new Ds;return r.onNext(tr(a,s)),o.add(t.subscribe(function(e){a.onNext(e)},function(e){a.onError(e),r.onError(e)},function(){a.onCompleted(),r.onCompleted()})),n(),s},t)}function ye(e,t){return new Fo(e,t)}function G(){for(var e=arguments.length,t=new Array(e),r=0;e>r;r++)t[r]=arguments[r];return t}function _e(e){this.patterns=e}function be(e,t){this.expression=e,this.selector=t}function xe(e){return function(t){e.onError(t)}}function we(e,t){return function(){var r=nt(e.selector).apply(e,arguments);return r===rt?t.onError(r.e):void t.onNext(r)}}function Se(e,t,r){var n=e.get(t);if(!n){var i=new $o(t,r);return e.set(t,i),i}return n}function Me(e,t,r){this.joinObserverArray=e,this.onNext=t,this.onCompleted=r,this.joinObservers=new qo;for(var n=0,i=this.joinObserverArray.length;i>n;n++){var o=this.joinObserverArray[n];this.joinObservers.set(o,o)}}function Ee(e,t){return new Xo(e,t)}function Ce(e,t,r){return new Ps(function(n){var i=e,o=_r(t);return r.scheduleRecursiveFuture(0,i,function(e,t){if(o>0){var s=r.now();i=new Date(i.getTime()+o),i.getTime()<=s&&(i=new Date(s+o))}n.onNext(e),t(e+1,new Date(i))})})}function Te(e,t,r){return e===t?new Ps(function(e){return r.schedulePeriodic(0,t,function(t){return e.onNext(t),t+1})}):pn(function(){return Ce(new Date(r.now()+e),t,r)})}function Ae(e,t,r){return new Ps(function(n){var i,o=!1,s=new fr,a=null,u=[],c=!1;return i=e.materialize().timestamp(r).subscribe(function(e){var i,h;"E"===e.value.kind?(u=[],u.push(e),a=e.value.error,h=!c):(u.push({value:e.value,timestamp:e.timestamp+t}),h=!o,o=!0),h&&(null!==a?n.onError(a):(i=new pr,s.setDisposable(i),i.setDisposable(r.scheduleRecursiveFuture(null,t,function(e,t){var i,s,h,l;if(null===a){c=!0;do h=null,u.length>0&&u[0].timestamp-r.now()<=0&&(h=u.shift().value),null!==h&&h.accept(n);while(null!==h);l=!1,s=0,u.length>0?(l=!0,s=Math.max(0,u[0].timestamp-r.now())):o=!1,i=a,c=!1,null!==i?n.onError(i):l&&t(null,s)}}))))}),new dr(i,s)},e)}function Pe(e,t,r){return pn(function(){return Ae(e,t-r.now(),r)})}function ke(e,t,r){var n,i;return tt(t)?i=t:(n=t,i=r),new Ps(function(t){function r(){u.setDisposable(e.subscribe(function(e){var r=nt(i)(e);if(r===rt)return t.onError(r.e);var n=new pr;s.add(n),n.setDisposable(r.subscribe(function(){t.onNext(e),s.remove(n),o()},function(e){t.onError(e)},function(){t.onNext(e),s.remove(n),o()}))},function(e){t.onError(e)},function(){a=!0,u.dispose(),o()}))}function o(){a&&0===s.length&&t.onCompleted()}var s=new ir,a=!1,u=new fr;return n?u.setDisposable(n.subscribe(r,function(e){t.onError(e)},r)):r(),new dr(u,s)},e)}function Oe(e,t){return new Ps(function(r){var n,i=!1,o=new fr,s=0,a=e.subscribe(function(e){var a=nt(t)(e);if(a===rt)return r.onError(a.e);et(a)&&(a=cn(a)),i=!0,n=e,s++;var u=s,c=new pr;o.setDisposable(c),c.setDisposable(a.subscribe(function(){i&&s===u&&r.onNext(n),i=!1,c.dispose()},function(e){r.onError(e)},function(){i&&s===u&&r.onNext(n),i=!1,c.dispose()}))},function(e){o.dispose(),r.onError(e),i=!1,s++},function(){o.dispose(),i&&r.onNext(n),r.onCompleted(),i=!1,s++});return new dr(a,o)},e)}function W(e){return e.toArray()}function W(e){return e.toArray()}function Ne(e,t,r,n){return tt(t)&&(n=r,r=t,t=Mn()),Kr.isObservable(n)||(n=kn(new os)),new Ps(function(i){function o(e){function t(){return l=r===h}var r=h,o=new pr;u.setDisposable(o),o.setDisposable(e.subscribe(function(){t()&&a.setDisposable(n.subscribe(i)),o.dispose()},function(e){t()&&i.onError(e)},function(){t()&&a.setDisposable(n.subscribe(i))}))}function s(){var e=!l;return e&&h++,e}var a=new fr,u=new fr,c=new pr;a.setDisposable(c);var h=0,l=!1;return o(t),c.setDisposable(e.subscribe(function(e){if(s()){i.onNext(e);var t=nt(r)(e);if(t===rt)return i.onError(t.e);o(et(t)?cn(t):t)}},function(e){s()&&i.onError(e)},function(){s()&&i.onCompleted()})),new dr(a,u)},e)}function De(e,t,r,n){return br(r)&&(n=r,r=kn(new os)),r instanceof Error&&(r=kn(r)),br(n)||(n=Nr),Kr.isObservable(r)||(r=kn(new os)),new Ps(function(i){function o(){var e=s;h.setDisposable(n.scheduleFuture(null,t,function(){c=s===e,c&&(et(r)&&(r=cn(r)),u.setDisposable(r.subscribe(i)))}))}var s=0,a=new pr,u=new fr,c=!1,h=new fr;return u.setDisposable(a),o(),a.setDisposable(e.subscribe(function(e){c||(s++,i.onNext(e),o())},function(e){c||(s++,i.onError(e))},function(){c||(s++,i.onCompleted())})),new dr(u,h)},e)}function Le(e){return{"@@transducer/init":function(){return e},"@@transducer/step":function(e,t){return e.onNext(t)},"@@transducer/result":function(e){return e.onCompleted()}}}function Re(e){this.predicate=e}function je(e){this.predicate=e}function Ie(e,t){var r=this;this.scheduler=e,this.messages=t,this.subscriptions=[],this.observers=[];for(var n=0,i=this.messages.length;i>n;n++){var o=this.messages[n],s=o.value;!function(t){e.scheduleAbsolute(null,o.time,function(){for(var e=r.observers.slice(0),n=0,i=e.length;i>n;n++)t.accept(e[n]);return ur})}(s)}}var Ve={"function":!0,object:!0},Fe=Ve[typeof n]&&n&&!n.nodeType?n:null,Be=Ve[typeof r]&&r&&!r.nodeType?r:null,Ue=s(Fe&&Be&&"object"==typeof i&&i),Ge=s(Ve[typeof self]&&self),ze=s(Ve[typeof window]&&window),He=Be&&Be.exports===Fe?Fe:null,We=s(Ve[typeof this]&&this),qe=Ue||ze!==(We&&We.window)&&ze||Ge||We||Function("return this")(),$e={internals:{},config:{Promise:qe.Promise},helpers:{}},Xe=$e.helpers.noop=function(){},Ke=$e.helpers.identity=function(e){return e},Ye=$e.helpers.defaultNow=Date.now,Qe=$e.helpers.defaultComparer=function(e,t){return Jt(e,t)},Je=$e.helpers.defaultSubComparer=function(e,t){return e>t?1:t>e?-1:0},Ze=($e.helpers.defaultKeySerializer=function(e){return e.toString()},$e.helpers.defaultError=function(e){throw e}),et=$e.helpers.isPromise=function(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then},tt=$e.helpers.isFunction=function(){var e=function(e){return"function"==typeof e||!1};return e(/x/)&&(e=function(e){return"function"==typeof e&&"[object Function]"==toString.call(e)}),e}(),rt={e:{}},nt=$e.internals.tryCatch=function(e){if(!tt(e))throw new TypeError("fn must be a function");return u(e)};$e.config.longStackSupport=!1;var it=!1,ot=nt(function(){
throw new Error})();it=!!ot.e&&!!ot.e.stack;var st,at=d(),ut="From previous event:",ct=$e.EmptyError=function(){this.message="Sequence contains no elements.",Error.call(this)};ct.prototype=Object.create(Error.prototype),ct.prototype.name="EmptyError";var ht=$e.ObjectDisposedError=function(){this.message="Object has been disposed",Error.call(this)};ht.prototype=Object.create(Error.prototype),ht.prototype.name="ObjectDisposedError";var lt=$e.ArgumentOutOfRangeError=function(){this.message="Argument out of range",Error.call(this)};lt.prototype=Object.create(Error.prototype),lt.prototype.name="ArgumentOutOfRangeError";var pt=$e.NotSupportedError=function(e){this.message=e||"This operation is not supported",Error.call(this)};pt.prototype=Object.create(Error.prototype),pt.prototype.name="NotSupportedError";var ft=$e.NotImplementedError=function(e){this.message=e||"This operation is not implemented",Error.call(this)};ft.prototype=Object.create(Error.prototype),ft.prototype.name="NotImplementedError";var dt=$e.helpers.notImplemented=function(){throw new ft},mt=($e.helpers.notSupported=function(){throw new pt},"function"==typeof Symbol&&Symbol.iterator||"_es6shim_iterator_");qe.Set&&"function"==typeof(new qe.Set)["@@iterator"]&&(mt="@@iterator");var vt=$e.doneEnumerator={done:!0,value:o},gt=$e.helpers.isIterable=function(e){return e&&e[mt]!==o},yt=$e.helpers.isArrayLike=function(e){return e&&e.length!==o};$e.helpers.iterator=mt;var _t=$e.internals.bindCallback=function(e,t,r){if("undefined"==typeof t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}},bt=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],xt=(bt.length,"[object Arguments]"),wt="[object Array]",St="[object Boolean]",Mt="[object Date]",Et="[object Error]",Ct="[object Function]",Tt="[object Map]",At="[object Number]",Pt="[object Object]",kt="[object RegExp]",Ot="[object Set]",Nt="[object String]",Dt="[object WeakMap]",Lt="[object ArrayBuffer]",Rt="[object Float32Array]",jt="[object Float64Array]",It="[object Int8Array]",Vt="[object Int16Array]",Ft="[object Int32Array]",Bt="[object Uint8Array]",Ut="[object Uint8ClampedArray]",Gt="[object Uint16Array]",zt="[object Uint32Array]",Ht={};Ht[Rt]=Ht[jt]=Ht[It]=Ht[Vt]=Ht[Ft]=Ht[Bt]=Ht[Ut]=Ht[Gt]=Ht[zt]=!0,Ht[xt]=Ht[wt]=Ht[Lt]=Ht[St]=Ht[Mt]=Ht[Et]=Ht[Ct]=Ht[Tt]=Ht[At]=Ht[Pt]=Ht[kt]=Ht[Ot]=Ht[Nt]=Ht[Dt]=!1;var Wt=Object.prototype,qt=Wt.hasOwnProperty,$t=Wt.toString,Xt=Math.pow(2,53)-1,Kt=Object.keys||function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=r.length;return function(i){if("object"!=typeof i&&("function"!=typeof i||null===i))throw new TypeError("Object.keys called on non-object");var o,s,a=[];for(o in i)e.call(i,o)&&a.push(o);if(t)for(s=0;n>s;s++)e.call(i,r[s])&&a.push(r[s]);return a}}(),se=$e.internals.isObject=function(e){var t=typeof e;return!!e&&("object"===t||"function"===t)},Yt=function(){try{Object({toString:0}+"")}catch(e){return function(){return!1}}return function(e){return"function"!=typeof e.toString&&"string"==typeof(e+"")}}(),Qt=Array.isArray||function(e){return y(e)&&_(e.length)&&$t.call(e)===wt},Jt=$e.internals.isEqual=function(e,t){return M(e,t)},Zt=({}.hasOwnProperty,Array.prototype.slice,$e.internals.inherits=function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}),er=$e.internals.addProperties=function(e){for(var t=[],r=1,n=arguments.length;n>r;r++)t.push(arguments[r]);for(var i=0,o=t.length;o>i;i++){var s=t[i];for(var a in s)e[a]=s[a]}},tr=$e.internals.addRef=function(e,t){return new Ps(function(r){return new dr(t.getDisposable(),e.subscribe(r))})};C.prototype.compareTo=function(e){var t=this.value.compareTo(e.value);return 0===t&&(t=this.id-e.id),t};var rr=$e.internals.PriorityQueue=function(e){this.items=new Array(e),this.length=0},nr=rr.prototype;nr.isHigherPriority=function(e,t){return this.items[e].compareTo(this.items[t])<0},nr.percolate=function(e){if(!(e>=this.length||0>e)){var t=e-1>>1;if(!(0>t||t===e)&&this.isHigherPriority(e,t)){var r=this.items[e];this.items[e]=this.items[t],this.items[t]=r,this.percolate(t)}}},nr.heapify=function(e){if(+e||(e=0),!(e>=this.length||0>e)){var t=2*e+1,r=2*e+2,n=e;if(t<this.length&&this.isHigherPriority(t,n)&&(n=t),r<this.length&&this.isHigherPriority(r,n)&&(n=r),n!==e){var i=this.items[e];this.items[e]=this.items[n],this.items[n]=i,this.heapify(n)}}},nr.peek=function(){return this.items[0].value},nr.removeAt=function(e){this.items[e]=this.items[--this.length],this.items[this.length]=o,this.heapify()},nr.dequeue=function(){var e=this.peek();return this.removeAt(0),e},nr.enqueue=function(e){var t=this.length++;this.items[t]=new C(rr.count++,e),this.percolate(t)},nr.remove=function(e){for(var t=0;t<this.length;t++)if(this.items[t].value===e)return this.removeAt(t),!0;return!1},rr.count=0;var ir=$e.CompositeDisposable=function(){var e,t,r=[];if(Array.isArray(arguments[0]))r=arguments[0];else for(t=arguments.length,r=new Array(t),e=0;t>e;e++)r[e]=arguments[e];this.disposables=r,this.isDisposed=!1,this.length=r.length},or=ir.prototype;or.add=function(e){this.isDisposed?e.dispose():(this.disposables.push(e),this.length++)},or.remove=function(e){var t=!1;if(!this.isDisposed){var r=this.disposables.indexOf(e);-1!==r&&(t=!0,this.disposables.splice(r,1),this.length--,e.dispose())}return t},or.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;for(var e=this.disposables.length,t=new Array(e),r=0;e>r;r++)t[r]=this.disposables[r];for(this.disposables=[],this.length=0,r=0;e>r;r++)t[r].dispose()}};var sr=$e.Disposable=function(e){this.isDisposed=!1,this.action=e||Xe};sr.prototype.dispose=function(){this.isDisposed||(this.action(),this.isDisposed=!0)};var ar=sr.create=function(e){return new sr(e)},ur=sr.empty={dispose:Xe},cr=sr.isDisposable=function(e){return e&&tt(e.dispose)},hr=sr.checkDisposed=function(e){if(e.isDisposed)throw new ht},lr=sr._fixup=function(e){return cr(e)?e:ur},pr=$e.SingleAssignmentDisposable=function(){this.isDisposed=!1,this.current=null};pr.prototype.getDisposable=function(){return this.current},pr.prototype.setDisposable=function(e){if(this.current)throw new Error("Disposable has already been assigned");var t=this.isDisposed;!t&&(this.current=e),t&&e&&e.dispose()},pr.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var e=this.current;this.current=null,e&&e.dispose()}};var fr=$e.SerialDisposable=function(){this.isDisposed=!1,this.current=null};fr.prototype.getDisposable=function(){return this.current},fr.prototype.setDisposable=function(e){var t=this.isDisposed;if(!t){var r=this.current;this.current=e}r&&r.dispose(),t&&e&&e.dispose()},fr.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var e=this.current;this.current=null}e&&e.dispose()};var dr=$e.BinaryDisposable=function(e,t){this._first=e,this._second=t,this.isDisposed=!1};dr.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var e=this._first;this._first=null,e&&e.dispose();var t=this._second;this._second=null,t&&t.dispose()}};var mr=$e.NAryDisposable=function(e){this._disposables=e,this.isDisposed=!1};mr.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;for(var e=0,t=this._disposables.length;t>e;e++)this._disposables[e].dispose();this._disposables.length=0}};var vr=$e.RefCountDisposable=function(){function e(e){this.disposable=e,this.disposable.count++,this.isInnerDisposed=!1}function t(e){this.underlyingDisposable=e,this.isDisposed=!1,this.isPrimaryDisposed=!1,this.count=0}return e.prototype.dispose=function(){this.disposable.isDisposed||this.isInnerDisposed||(this.isInnerDisposed=!0,this.disposable.count--,0===this.disposable.count&&this.disposable.isPrimaryDisposed&&(this.disposable.isDisposed=!0,this.disposable.underlyingDisposable.dispose()))},t.prototype.dispose=function(){this.isDisposed||this.isPrimaryDisposed||(this.isPrimaryDisposed=!0,0===this.count&&(this.isDisposed=!0,this.underlyingDisposable.dispose()))},t.prototype.getDisposable=function(){return this.isDisposed?ur:new e(this)},t}();T.prototype.dispose=function(){this.scheduler.schedule(this,A)};var gr=$e.internals.ScheduledItem=function(e,t,r,n,i){this.scheduler=e,this.state=t,this.action=r,this.dueTime=n,this.comparer=i||Je,this.disposable=new pr};gr.prototype.invoke=function(){this.disposable.setDisposable(this.invokeCore())},gr.prototype.compareTo=function(e){return this.comparer(this.dueTime,e.dueTime)},gr.prototype.isCancelled=function(){return this.disposable.isDisposed},gr.prototype.invokeCore=function(){return lr(this.action(this.scheduler,this.state))};var yr=$e.Scheduler=function(){function e(){}e.isScheduler=function(t){return t instanceof e};var t=e.prototype;return t.schedule=function(e,t){throw new ft},t.scheduleFuture=function(t,r,n){var i=r;return i instanceof Date&&(i-=this.now()),i=e.normalize(i),0===i?this.schedule(t,n):this._scheduleFuture(t,i,n)},t._scheduleFuture=function(e,t,r){throw new ft},e.now=Ye,e.prototype.now=Ye,e.normalize=function(e){return 0>e&&(e=0),e},e}(),_r=yr.normalize,br=yr.isScheduler;!function(e){function t(e,t){function r(t){function n(e,t){return s?o.remove(u):a=!0,i(t,r),ur}var s=!1,a=!1,u=e.schedule(t,n);a||(o.add(u),s=!0)}var n=t[0],i=t[1],o=new ir;return i(n,r),o}function r(e,t){function r(t,n){function s(e,t){return a?o.remove(c):u=!0,i(t,r),ur}var a=!1,u=!1,c=e.scheduleFuture(t,n,s);u||(o.add(c),a=!0)}var n=t[0],i=t[1],o=new ir;return i(n,r),o}e.scheduleRecursive=function(e,r){return this.schedule([e,r],t)},e.scheduleRecursiveFuture=function(e,t,n){return this.scheduleFuture([e,n],t,r)}}(yr.prototype),function(e){e.schedulePeriodic=function(e,t,r){if("undefined"==typeof qe.setInterval)throw new pt;t=_r(t);var n=e,i=qe.setInterval(function(){n=r(n)},t);return ar(function(){qe.clearInterval(i)})}}(yr.prototype),function(e){e.catchError=e["catch"]=function(e){return new Dr(this,e)}}(yr.prototype);var xr,wr,Sr=$e.internals.SchedulePeriodicRecursive=function(){function e(e){return function(t,r){r(0,e._period);var n=nt(e._action)(e._state);n===rt&&(e._cancel.dispose(),c(n.e)),e._state=n}}function t(e,t,r,n){this._scheduler=e,this._state=t,this._period=r,this._action=n}return t.prototype.start=function(){var t=new pr;return this._cancel=t,t.setDisposable(this._scheduler.scheduleRecursiveFuture(0,this._period,e(this))),t},t}(),Mr=function(e){function t(){e.call(this)}return Zt(t,e),t.prototype.schedule=function(e,t){return lr(t(this,e))},t}(yr),Er=yr.immediate=new Mr,Cr=function(e){function t(){for(;n.length>0;){var e=n.dequeue();!e.isCancelled()&&e.invoke()}}function r(){e.call(this)}var n;return Zt(r,e),r.prototype.schedule=function(e,r){var i=new gr(this,e,r,this.now());if(n)n.enqueue(i);else{n=new rr(4),n.enqueue(i);var o=nt(t)();n=null,o===rt&&c(o.e)}return i.disposable},r.prototype.scheduleRequired=function(){return!n},r}(yr),Tr=yr.currentThread=new Cr,Ar=function(){var e,t=Xe;if(qe.setTimeout)e=qe.setTimeout,t=qe.clearTimeout;else{if(!qe.WScript)throw new pt;e=function(e,t){qe.WScript.Sleep(t),e()}}return{setTimeout:e,clearTimeout:t}}(),Pr=Ar.setTimeout,kr=Ar.clearTimeout;!function(){function e(t){if(o)Pr(function(){e(t)},0);else{var r=i[t];if(r){o=!0;var n=nt(r)();wr(t),o=!1,n===rt&&c(n.e)}}}function r(){if(!qe.postMessage||qe.importScripts)return!1;var e=!1,t=qe.onmessage;return qe.onmessage=function(){e=!0},qe.postMessage("","*"),qe.onmessage=t,e}var n=1,i={},o=!1;wr=function(e){delete i[e]};var s=new RegExp("^"+String(toString).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),a="function"==typeof(a=Ue&&He&&Ue.setImmediate)&&!s.test(a)&&a;if(tt(a))xr=function(t){var r=n++;return i[r]=t,a(function(){e(r)}),r};else if("undefined"!=typeof t&&"[object process]"==={}.toString.call(t))xr=function(r){var o=n++;return i[o]=r,t.nextTick(function(){e(o)}),o};else if(r()){var u="ms.rx.schedule"+Math.random(),h=function(t){"string"==typeof t.data&&t.data.substring(0,u.length)===u&&e(t.data.substring(u.length))};qe.addEventListener("message",h,!1),xr=function(e){var t=n++;return i[t]=e,qe.postMessage(u+t,"*"),t}}else if(qe.MessageChannel){var l=new qe.MessageChannel;l.port1.onmessage=function(t){e(t.data)},xr=function(e){var t=n++;return i[t]=e,l.port2.postMessage(t),t}}else xr="document"in qe&&"onreadystatechange"in qe.document.createElement("script")?function(t){var r=qe.document.createElement("script"),o=n++;return i[o]=t,r.onreadystatechange=function(){e(o),r.onreadystatechange=null,r.parentNode.removeChild(r),r=null},qe.document.documentElement.appendChild(r),o}:function(t){var r=n++;return i[r]=t,Pr(function(){e(r)},0),r}}();var Or=function(e){function t(){e.call(this)}function r(e,t,r,n){return function(){e.setDisposable(sr._fixup(t(r,n)))}}function n(e){this._id=e,this.isDisposed=!1}function i(e){this._id=e,this.isDisposed=!1}return Zt(t,e),n.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,wr(this._id))},i.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,kr(this._id))},t.prototype.schedule=function(e,t){var i=new pr,o=xr(r(i,t,this,e));return new dr(i,new n(o))},t.prototype._scheduleFuture=function(e,t,n){if(0===t)return this.schedule(e,n);var o=new pr,s=Pr(r(o,n,this,e),t);return new dr(o,new i(s))},t}(yr),Nr=yr["default"]=yr.async=new Or,Dr=function(e){function t(t,r){this._scheduler=t,this._handler=r,this._recursiveOriginal=null,this._recursiveWrapper=null,e.call(this)}return Zt(t,e),t.prototype.schedule=function(e,t){return this._scheduler.schedule(e,this._wrap(t))},t.prototype._scheduleFuture=function(e,t,r){return this._scheduler.schedule(e,t,this._wrap(r))},t.prototype.now=function(){return this._scheduler.now()},t.prototype._clone=function(e){return new t(e,this._handler)},t.prototype._wrap=function(e){var t=this;return function(r,n){var i=nt(e)(t._getRecursiveWrapper(r),n);return i===rt?(t._handler(i.e)||c(i.e),ur):lr(i)}},t.prototype._getRecursiveWrapper=function(e){if(this._recursiveOriginal!==e){this._recursiveOriginal=e;var t=this._clone(e);t._recursiveOriginal=e,t._recursiveWrapper=t,this._recursiveWrapper=t}return this._recursiveWrapper},t.prototype.schedulePeriodic=function(e,t,r){var n=this,i=!1,o=new pr;return o.setDisposable(this._scheduler.schedulePeriodic(e,t,function(e){if(i)return null;var t=nt(r)(e);return t===rt?(i=!0,n._handler(t.e)||c(t.e),o.dispose(),null):t})),o},t}(yr),Lr=$e.Notification=function(){function e(){}return e.prototype._accept=function(e,t,r){throw new ft},e.prototype._acceptObserver=function(e,t,r){throw new ft},e.prototype.accept=function(e,t,r){return e&&"object"==typeof e?this._acceptObserver(e):this._accept(e,t,r)},e.prototype.toObservable=function(e){var t=this;return br(e)||(e=Er),new Ps(function(r){return e.schedule(t,function(e,t){t._acceptObserver(r),"N"===t.kind&&r.onCompleted()})})},e}(),Rr=function(e){function t(e){this.value=e,this.kind="N"}return Zt(t,e),t.prototype._accept=function(e){return e(this.value)},t.prototype._acceptObserver=function(e){return e.onNext(this.value)},t.prototype.toString=function(){return"OnNext("+this.value+")"},t}(Lr),jr=function(e){function t(e){this.error=e,this.kind="E"}return Zt(t,e),t.prototype._accept=function(e,t){return t(this.error)},t.prototype._acceptObserver=function(e){return e.onError(this.error)},t.prototype.toString=function(){return"OnError("+this.error+")"},t}(Lr),Ir=function(e){function t(){this.kind="C"}return Zt(t,e),t.prototype._accept=function(e,t,r){return r()},t.prototype._acceptObserver=function(e){return e.onCompleted()},t.prototype.toString=function(){return"OnCompleted()"},t}(Lr),Vr=Lr.createOnNext=function(e){return new Rr(e)},Fr=Lr.createOnError=function(e){return new jr(e)},Br=Lr.createOnCompleted=function(){return new Ir},Ur=$e.Observer=function(){};Ur.prototype.toNotifier=function(){var e=this;return function(t){return t.accept(e)}},Ur.prototype.asObserver=function(){var e=this;return new Wr(function(t){e.onNext(t)},function(t){e.onError(t)},function(){e.onCompleted()})},Ur.prototype.checked=function(){return new qr(this)};var Gr=Ur.create=function(e,t,r){return e||(e=Xe),t||(t=Ze),r||(r=Xe),new Wr(e,t,r)};Ur.fromNotifier=function(e,t){var r=_t(e,t,1);return new Wr(function(e){return r(Vr(e))},function(e){return r(Fr(e))},function(){return r(Br())})},Ur.prototype.notifyOn=function(e){return new Xr(e,this)},Ur.prototype.makeSafe=function(e){return new AnonymousSafeObserver(this._onNext,this._onError,this._onCompleted,e)};var zr,Hr=$e.internals.AbstractObserver=function(e){function t(){this.isStopped=!1}return Zt(t,e),t.prototype.next=dt,t.prototype.error=dt,t.prototype.completed=dt,t.prototype.onNext=function(e){!this.isStopped&&this.next(e)},t.prototype.onError=function(e){this.isStopped||(this.isStopped=!0,this.error(e))},t.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.completed())},t.prototype.dispose=function(){this.isStopped=!0},t.prototype.fail=function(e){return this.isStopped?!1:(this.isStopped=!0,this.error(e),!0)},t}(Ur),Wr=$e.AnonymousObserver=function(e){function t(t,r,n){e.call(this),this._onNext=t,this._onError=r,this._onCompleted=n}return Zt(t,e),t.prototype.next=function(e){this._onNext(e)},t.prototype.error=function(e){this._onError(e)},t.prototype.completed=function(){this._onCompleted()},t}(Hr),qr=function(e){function t(t){e.call(this),this._observer=t,this._state=0}Zt(t,e);var r=t.prototype;return r.onNext=function(e){this.checkAccess();var t=nt(this._observer.onNext).call(this._observer,e);this._state=0,t===rt&&c(t.e)},r.onError=function(e){this.checkAccess();var t=nt(this._observer.onError).call(this._observer,e);this._state=2,t===rt&&c(t.e)},r.onCompleted=function(){this.checkAccess();var e=nt(this._observer.onCompleted).call(this._observer);this._state=2,e===rt&&c(e.e)},r.checkAccess=function(){if(1===this._state)throw new Error("Re-entrancy detected");if(2===this._state)throw new Error("Observer completed");0===this._state&&(this._state=1)},t}(Ur),$r=$e.internals.ScheduledObserver=function(e){function t(t,r){e.call(this),this.scheduler=t,this.observer=r,this.isAcquired=!1,this.hasFaulted=!1,this.queue=[],this.disposable=new fr}function r(e,t){return function(){e.onNext(t)}}function n(e,t){return function(){e.onError(t)}}function i(e){return function(){e.onCompleted()}}function o(e,t){var r;if(!(e.queue.length>0))return void(e.isAcquired=!1);r=e.queue.shift();var n=nt(r)();return n===rt?(e.queue=[],e.hasFaulted=!0,c(n.e)):void t(e)}return Zt(t,e),t.prototype.next=function(e){this.queue.push(r(this.observer,e))},t.prototype.error=function(e){this.queue.push(n(this.observer,e))},t.prototype.completed=function(){this.queue.push(i(this.observer))},t.prototype.ensureActive=function(){var e=!1;!this.hasFaulted&&this.queue.length>0&&(e=!this.isAcquired,this.isAcquired=!0),e&&this.disposable.setDisposable(this.scheduler.scheduleRecursive(this,o))},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.disposable.dispose()},t}(Hr),Xr=function(e){function t(t,r,n){e.call(this,t,r),this._cancel=n}return Zt(t,e),t.prototype.next=function(t){e.prototype.next.call(this,t),this.ensureActive()},t.prototype.error=function(t){e.prototype.error.call(this,t),this.ensureActive()},t.prototype.completed=function(){e.prototype.completed.call(this),this.ensureActive()},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._cancel&&this._cancel.dispose(),this._cancel=null},t}($r),Kr=$e.Observable=function(){function e(e,t){return function(r){var n=r.onError;return r.onError=function(t){h(t,e),n.call(r,t)},t.call(e,r)}}function t(){if($e.config.longStackSupport&&it){var t=this._subscribe,r=nt(c)(new Error).e;this.stack=r.stack.substring(r.stack.indexOf("\n")+1),this._subscribe=e(this,t)}}return zr=t.prototype,t.isObservable=function(e){return e&&tt(e.subscribe)},zr.subscribe=zr.forEach=function(e,t,r){return this._subscribe("object"==typeof e?e:Gr(e,t,r))},zr.subscribeOnNext=function(e,t){return this._subscribe(Gr("undefined"!=typeof t?function(r){e.call(t,r)}:e))},zr.subscribeOnError=function(e,t){return this._subscribe(Gr(null,"undefined"!=typeof t?function(r){e.call(t,r)}:e))},zr.subscribeOnCompleted=function(e,t){return this._subscribe(Gr(null,null,"undefined"!=typeof t?function(){e.call(t)}:e))},t}(),Yr=$e.ObservableBase=function(e){function t(e){return e&&tt(e.dispose)?e:tt(e)?ar(e):ur}function r(e,r){var n=r[0],i=r[1],o=nt(i.subscribeCore).call(i,n);o!==rt||n.fail(rt.e)||c(rt.e),n.setDisposable(t(o))}function n(){e.call(this)}return Zt(n,e),n.prototype._subscribe=function(e){var t=new ks(e),n=[t,this];return Tr.scheduleRequired()?Tr.schedule(n,r):r(null,n),t},n.prototype.subscribeCore=dt,n}(Kr),Qr=$e.FlatMapObservable=function(e){function t(t,r,n,i){this.resultSelector=tt(n)?n:null,this.selector=_t(tt(r)?r:function(){return r},i,3),this.source=t,e.call(this)}function r(e,t,r,n){this.i=0,this.selector=t,this.resultSelector=r,this.source=n,this.o=e,Hr.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new r(e,this.selector,this.resultSelector,this))},Zt(r,Hr),r.prototype._wrapResult=function(e,t,r){return this.resultSelector?e.map(function(e,n){return this.resultSelector(t,e,r,n)},this):e},r.prototype.next=function(e){var t=this.i++,r=nt(this.selector)(e,t,this.source);return r===rt?this.o.onError(r.e):(et(r)&&(r=cn(r)),(yt(r)||gt(r))&&(r=Kr.from(r)),void this.o.onNext(this._wrapResult(r,e,t)))},r.prototype.error=function(e){this.o.onError(e)},r.prototype.completed=function(){this.o.onCompleted()},t}(Yr),Jr=$e.internals.Enumerable=function(){};P.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._s.isDisposed=!0)};var Zr=function(e){function t(t){this.sources=t,e.call(this)}function r(e,t){if(!e.isDisposed){var r=nt(e.e.next).call(e.e);if(r===rt)return e.o.onError(r.e);if(r.done)return e.o.onCompleted();var i=r.value;et(i)&&(i=cn(i));var o=new pr;e.subscription.setDisposable(o),o.setDisposable(i.subscribe(new n(e,t)))}}function n(e,t){this._state=e,this._recurse=t,Hr.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=new fr,n={isDisposed:!1,o:e,subscription:t,e:this.sources[mt]()},i=Tr.scheduleRecursive(n,r);return new mr([t,i,new P(n)])},Zt(n,Hr),n.prototype.next=function(e){this._state.o.onNext(e)},n.prototype.error=function(e){this._state.o.onError(e)},n.prototype.completed=function(){this._recurse(this._state)},t}(Yr);Jr.prototype.concat=function(){return new Zr(this)};var en=function(e){function t(t){this.sources=t,e.call(this)}function r(e,t){if(!e.isDisposed){var r=nt(e.e.next).call(e.e);if(r===rt)return e.o.onError(r.e);if(r.done)return null!==e.lastError?e.o.onError(e.lastError):e.o.onCompleted();var i=r.value;et(i)&&(i=cn(i));var o=new pr;e.subscription.setDisposable(o),o.setDisposable(i.subscribe(new n(e,t)))}}function n(e,t){this._state=e,this._recurse=t,Hr.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=new fr,n={isDisposed:!1,e:this.sources[mt](),subscription:t,lastError:null,o:e},i=Tr.scheduleRecursive(n,r);return new mr([t,i,new P(n)])},Zt(n,Hr),n.prototype.next=function(e){this._state.o.onNext(e)},n.prototype.error=function(e){this._state.lastError=e,this._recurse(this._state)},n.prototype.completed=function(){this._state.o.onCompleted()},t}(Yr);Jr.prototype.catchError=function(){return new en(this)};var tn=function(e){function t(e,t){this.v=e,this.c=null==t?-1:t}function r(e){this.v=e.v,this.l=e.c}return Zt(t,e),t.prototype[mt]=function(){return new r(this)},r.prototype.next=function(){return 0===this.l?vt:(this.l>0&&this.l--,{done:!1,value:this.v})},t}(Jr),rn=Jr.repeat=function(e,t){return new tn(e,t)},nn=function(e){function t(e,t,r){this.s=e,this.fn=t?_t(t,r,3):null}function r(e){this.i=-1,this.s=e.s,this.l=this.s.length,this.fn=e.fn}return Zt(t,e),t.prototype[mt]=function(){return new r(this)},r.prototype.next=function(){return++this.i<this.l?{done:!1,value:this.fn?this.fn(this.s[this.i],this.i,this.s):this.s[this.i]}:vt},t}(Jr),on=Jr.of=function(e,t,r){return new nn(e,t,r)},sn=function(e){function t(t,r){this.source=t,this._s=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new Xr(this._s,e))},t}(Yr);zr.observeOn=function(e){return new sn(this,e)};var an=function(e){function t(t,r){this.source=t,this._s=r,e.call(this)}function r(e,t){var r=t[0],n=t[1],i=t[2];n.setDisposable(new T(e,r.subscribe(i)))}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=new pr,n=new fr;return n.setDisposable(t),t.setDisposable(this._s.schedule([this.source,n,e],r)),n},t}(Yr);zr.subscribeOn=function(e){return new an(this,e)};var un=function(e){function t(t,r){this._p=t,this._s=r,e.call(this)}function r(e,t){var r=t[0],n=t[1];r.onNext(n),r.onCompleted()}function n(e,t){var r=t[0],n=t[1];r.onError(n)}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=new pr,i=this;return this._p.then(function(n){t.setDisposable(i._s.schedule([e,n],r))},function(r){t.setDisposable(i._s.schedule([e,r],n))}),t},t}(Yr),cn=Kr.fromPromise=function(e,t){return t||(t=Nr),new un(e,t)};zr.toPromise=function(e){if(e||(e=$e.config.Promise),!e)throw new pt("Promise type not provided nor in Rx.config.Promise");var t=this;return new e(function(e,r){var n;t.subscribe(function(e){n=e},r,function(){e(n)})})};var hn=function(e){function t(t){this.source=t,e.call(this)}function r(e){this.o=e,this.a=[],Hr.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new r(e))},Zt(r,Hr),r.prototype.next=function(e){this.a.push(e)},r.prototype.error=function(e){this.o.onError(e)},r.prototype.completed=function(){this.o.onNext(this.a),this.o.onCompleted()},t}(Yr);zr.toArray=function(){return new hn(this)},Kr.create=function(e,t){return new Ps(e,t)};var ln=function(e){function t(t){this._f=t,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=nt(this._f)();return t===rt?kn(t.e).subscribe(e):(et(t)&&(t=cn(t)),t.subscribe(e))},t}(Yr),pn=Kr.defer=function(e){return new ln(e)},fn=function(e){function t(t){this.scheduler=t,e.call(this)}function r(e,t){this.observer=e,this.scheduler=t}function n(e,t){return t.onCompleted(),ur}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=new r(e,this.scheduler);return t.run()},r.prototype.run=function(){var e=this.observer;return this.scheduler===Er?n(null,e):this.scheduler.schedule(e,n)},t}(Yr),dn=new fn(Er),mn=Kr.empty=function(e){return br(e)||(e=Er),e===Er?dn:new fn(e)},vn=function(e){function t(t,r,n){this._iterable=t,this._fn=r,this._scheduler=n,e.call(this)}function r(e,t,r){return function(n,i){var o=nt(t.next).call(t);if(o===rt)return e.onError(o.e);if(o.done)return e.onCompleted();var s=o.value;return tt(r)&&(s=nt(r)(s,n),s===rt)?e.onError(s.e):(e.onNext(s),void i(n+1))}}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=Object(this._iterable),n=R(t);return this._scheduler.scheduleRecursive(0,r(e,n,this._fn))},t}(Yr),gn=Math.pow(2,53)-1;k.prototype[mt]=function(){return new O(this._s)},O.prototype[mt]=function(){return this},O.prototype.next=function(){return this._i<this._l?{done:!1,value:this._s.charAt(this._i++)}:vt},N.prototype[mt]=function(){return new D(this._a)},D.prototype[mt]=function(){return this},D.prototype.next=function(){return this._i<this._l?{done:!1,value:this._a[this._i++]}:vt};var yn=Kr.from=function(e,t,r,n){if(null==e)throw new Error("iterable cannot be null.");if(t&&!tt(t))throw new Error("mapFn when provided must be a function");if(t)var i=_t(t,r,2);return br(n)||(n=Tr),new vn(e,i,n)},_n=function(e){function t(t,r){this._args=t,this._scheduler=r,e.call(this)}function r(e,t){var r=t.length;return function(n,i){r>n?(e.onNext(t[n]),i(n+1)):e.onCompleted()}}return Zt(t,e),t.prototype.subscribeCore=function(e){return this._scheduler.scheduleRecursive(0,r(e,this._args))},t}(Yr),bn=Kr.fromArray=function(e,t){return br(t)||(t=Tr),new _n(e,t)},xn=function(e){function t(t,r,n,i,o){this._initialState=t,this._cndFn=r,this._itrFn=n,this._resFn=i,this._s=o,e.call(this)}function r(e,t){if(e.first)e.first=!1;else if(e.newState=nt(e.self._itrFn)(e.newState),e.newState===rt)return e.o.onError(e.newState.e);var r=nt(e.self._cndFn)(e.newState);if(r===rt)return e.o.onError(r.e);if(r){var n=nt(e.self._resFn)(e.newState);if(n===rt)return e.o.onError(n.e);e.o.onNext(n),t(e)}else e.o.onCompleted()}return Zt(t,e),t.prototype.subscribeCore=function(e){var t={o:e,self:this,first:!0,newState:this._initialState};return this._s.scheduleRecursive(t,r)},t}(Yr);Kr.generate=function(e,t,r,n,i){return br(i)||(i=Tr),new xn(e,t,r,n,i)},Kr.of=function(){for(var e=arguments.length,t=new Array(e),r=0;e>r;r++)t[r]=arguments[r];return new _n(t,Tr)},Kr.ofWithScheduler=function(e){for(var t=arguments.length,r=new Array(t-1),n=1;t>n;n++)r[n-1]=arguments[n];return new _n(r,e)},Kr.ofArrayChanges=function(e){if(!Array.isArray(e))throw new TypeError("Array.observe only accepts arrays.");if("function"!=typeof Array.observe&&"function"!=typeof Array.unobserve)throw new TypeError("Array.observe is not supported on your platform");return new Ps(function(t){function r(e){for(var r=0,n=e.length;n>r;r++)t.onNext(e[r])}return Array.observe(e,r),function(){Array.unobserve(e,r)}})},Kr.ofObjectChanges=function(e){if(null==e)throw new TypeError("object must not be null or undefined.");if("function"!=typeof Object.observe&&"function"!=typeof Object.unobserve)throw new TypeError("Object.observe is not supported on your platform");return new Ps(function(t){function r(e){for(var r=0,n=e.length;n>r;r++)t.onNext(e[r])}return Object.observe(e,r),function(){Object.unobserve(e,r)}})};var wn=function(e){function t(){e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return ur},t}(Yr),Sn=new wn,Mn=Kr.never=function(){return Sn},En=function(e){function t(t,r){this._o=t,this._keys=Object.keys(t),this._scheduler=r,e.call(this)}function r(e,t,r){return function(n,i){if(n<r.length){var o=r[n];e.onNext([o,t[o]]),i(n+1)}else e.onCompleted()}}return Zt(t,e),t.prototype.subscribeCore=function(e){return this._scheduler.scheduleRecursive(0,r(e,this._o,this._keys))},t}(Yr);Kr.pairs=function(e,t){return t||(t=Tr),new En(e,t)};var Cn=function(e){function t(t,r,n){this.start=t,this.rangeCount=r,this.scheduler=n,e.call(this)}function r(e,t,r){return function(n,i){t>n?(r.onNext(e+n),i(n+1)):r.onCompleted()}}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.scheduler.scheduleRecursive(0,r(this.start,this.rangeCount,e))},t}(Yr);Kr.range=function(e,t,r){return br(r)||(r=Tr),new Cn(e,t,r)};var Tn=function(e){function t(t,r,n){this.value=t,this.repeatCount=null==r?-1:r,this.scheduler=n,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=new F(e,this);return t.run()},t}(Yr);F.prototype.run=function(){function e(e,n){return(-1===e||e>0)&&(t.onNext(r),e>0&&e--),0===e?t.onCompleted():void n(e)}var t=this.observer,r=this.parent.value;return this.parent.scheduler.scheduleRecursive(this.parent.repeatCount,e)},Kr.repeat=function(e,t,r){return br(r)||(r=Tr),new Tn(e,t,r)};var An=function(e){function t(t,r){this._value=t,this._scheduler=r,e.call(this)}function r(e,t){var r=t[0],n=t[1];return n.onNext(r),n.onCompleted(),ur}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=[this._value,e];return this._scheduler===Er?r(null,t):this._scheduler.schedule(t,r)},t}(Yr),Pn=(Kr["return"]=Kr.just=function(e,t){return br(t)||(t=Er),new An(e,t)},function(e){function t(t,r){this._error=t,this._scheduler=r,e.call(this)}function r(e,t){var r=t[0],n=t[1];return n.onError(r),ur}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=[this._error,e];return this._scheduler===Er?r(null,t):this._scheduler.schedule(t,r);
},t}(Yr)),kn=Kr["throw"]=function(e,t){return br(t)||(t=Er),new Pn(e,t)},On=function(e){function t(t,r){this._resFn=t,this._obsFn=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=ur,r=nt(this._resFn)();if(r===rt)return new dr(kn(r.e).subscribe(e),t);r&&(t=r);var n=nt(this._obsFn)(r);return n===rt?new dr(kn(n.e).subscribe(e),t):new dr(n.subscribe(e),t)},t}(Yr);Kr.using=function(e,t){return new On(e,t)},zr.amb=function(e){var t=this;return new Ps(function(r){function n(){o||(o=s,c.dispose())}function i(){o||(o=a,u.dispose())}var o,s="L",a="R",u=new pr,c=new pr;et(e)&&(e=cn(e));var h=Gr(function(e){n(),o===s&&r.onNext(e)},function(e){n(),o===s&&r.onError(e)},function(){n(),o===s&&r.onCompleted()}),l=Gr(function(e){i(),o===a&&r.onNext(e)},function(e){i(),o===a&&r.onError(e)},function(){i(),o===a&&r.onCompleted()});return u.setDisposable(t.subscribe(h)),c.setDisposable(e.subscribe(l)),new dr(u,c)})},Kr.amb=function(){var e,t=Mn();if(Array.isArray(arguments[0]))e=arguments[0];else{var r=arguments.length;e=new Array(e);for(var n=0;r>n;n++)e[n]=arguments[n]}for(var n=0,r=e.length;r>n;n++)t=B(t,e[n]);return t};var Nn=function(e){function t(t,r){this.source=t,this._fn=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=new pr,r=new fr;return r.setDisposable(t),t.setDisposable(this.source.subscribe(new Dn(e,r,this._fn))),r},t}(Yr),Dn=function(e){function t(t,r,n){this._o=t,this._s=r,this._fn=n,e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._o.onNext(e)},t.prototype.completed=function(){return this._o.onCompleted()},t.prototype.error=function(e){var t=nt(this._fn)(e);if(t===rt)return this._o.onError(t.e);et(t)&&(t=cn(t));var r=new pr;this._s.setDisposable(r),r.setDisposable(t.subscribe(this._o))},t}(Hr);zr["catch"]=function(e){return tt(e)?new Nn(this,e):Ln([this,e])};var Ln=Kr["catch"]=function(){var e;if(Array.isArray(arguments[0]))e=arguments[0];else{var t=arguments.length;e=new Array(t);for(var r=0;t>r;r++)e[r]=arguments[r]}return on(e).catchError()};zr.combineLatest=function(){for(var e=arguments.length,t=new Array(e),r=0;e>r;r++)t[r]=arguments[r];return Array.isArray(t[0])?t[0].unshift(this):t.unshift(this),In.apply(this,t)};var Rn=function(e){function t(t,r){this._params=t,this._cb=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){for(var t=this._params.length,r=new Array(t),n={hasValue:E(t,U),hasValueAll:!1,isDone:E(t,U),values:new Array(t)},i=0;t>i;i++){var o=this._params[i],s=new pr;r[i]=s,et(o)&&(o=cn(o)),s.setDisposable(o.subscribe(new jn(e,i,this._cb,n)))}return new mr(r)},t}(Yr),jn=function(e){function t(t,r,n,i){this._o=t,this._i=r,this._cb=n,this._state=i,e.call(this)}function r(e){return function(t,r){return r!==e}}return Zt(t,e),t.prototype.next=function(e){if(this._state.values[this._i]=e,this._state.hasValue[this._i]=!0,this._state.hasValueAll||(this._state.hasValueAll=this._state.hasValue.every(Ke))){var t=nt(this._cb).apply(null,this._state.values);if(t===rt)return this._o.onError(t.e);this._o.onNext(t)}else this._state.isDone.filter(r(this._i)).every(Ke)&&this._o.onCompleted()},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._state.isDone[this._i]=!0,this._state.isDone.every(Ke)&&this._o.onCompleted()},t}(Hr),In=Kr.combineLatest=function(){for(var e=arguments.length,t=new Array(e),r=0;e>r;r++)t[r]=arguments[r];var n=tt(t[e-1])?t.pop():G;return Array.isArray(t[0])&&(t=t[0]),new Rn(t,n)};zr.concat=function(){for(var e=[],t=0,r=arguments.length;r>t;t++)e.push(arguments[t]);return e.unshift(this),Bn.apply(null,e)};var Vn=function(e){function t(t,r){this._s=t,this._fn=r,e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._s.o.onNext(e)},t.prototype.error=function(e){this._s.o.onError(e)},t.prototype.completed=function(){this._s.i++,this._fn(this._s)},t}(Hr),Fn=function(e){function t(t){this._sources=t,e.call(this)}function r(e,t){if(!e.disposable.isDisposed){if(e.i===e.sources.length)return e.o.onCompleted();var r=e.sources[e.i];et(r)&&(r=cn(r));var n=new pr;e.subscription.setDisposable(n),n.setDisposable(r.subscribe(new Vn(e,t)))}}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=new fr,n=ar(Xe),i={o:e,i:0,subscription:t,disposable:n,sources:this._sources},o=Er.scheduleRecursive(i,r);return new mr([t,n,o])},t}(Yr),Bn=Kr.concat=function(){var e;if(Array.isArray(arguments[0]))e=arguments[0];else{e=new Array(arguments.length);for(var t=0,r=arguments.length;r>t;t++)e[t]=arguments[t]}return new Fn(e)};zr.concatAll=function(){return this.merge(1)};var Un=function(e){function t(t,r){this.source=t,this.maxConcurrent=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=new ir;return t.add(this.source.subscribe(new Gn(e,this.maxConcurrent,t))),t},t}(Yr),Gn=function(e){function t(t,r,n){this.o=t,this.max=r,this.g=n,this.done=!1,this.q=[],this.activeCount=0,e.call(this)}function r(t,r){this.parent=t,this.sad=r,e.call(this)}return Zt(t,e),t.prototype.handleSubscribe=function(e){var t=new pr;this.g.add(t),et(e)&&(e=cn(e)),t.setDisposable(e.subscribe(new r(this,t)))},t.prototype.next=function(e){this.activeCount<this.max?(this.activeCount++,this.handleSubscribe(e)):this.q.push(e)},t.prototype.error=function(e){this.o.onError(e)},t.prototype.completed=function(){this.done=!0,0===this.activeCount&&this.o.onCompleted()},Zt(r,e),r.prototype.next=function(e){this.parent.o.onNext(e)},r.prototype.error=function(e){this.parent.o.onError(e)},r.prototype.completed=function(){this.parent.g.remove(this.sad),this.parent.q.length>0?this.parent.handleSubscribe(this.parent.q.shift()):(this.parent.activeCount--,this.parent.done&&0===this.parent.activeCount&&this.parent.o.onCompleted())},t}(Hr);zr.merge=function(e){return"number"!=typeof e?zn(this,e):new Un(this,e)};var zn=Kr.merge=function(){var e,t,r=[],n=arguments.length;if(arguments[0])if(br(arguments[0]))for(e=arguments[0],t=1;n>t;t++)r.push(arguments[t]);else for(e=Er,t=0;n>t;t++)r.push(arguments[t]);else for(e=Er,t=1;n>t;t++)r.push(arguments[t]);return Array.isArray(r[0])&&(r=r[0]),V(e,r).mergeAll()},Hn=function(e){function t(t){this.source=t,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=new ir,r=new pr;return t.add(r),r.setDisposable(this.source.subscribe(new Wn(e,t))),t},t}(Yr),Wn=function(e){function t(t,r){this.o=t,this.g=r,this.done=!1,e.call(this)}function r(t,r){this.parent=t,this.sad=r,e.call(this)}return Zt(t,e),t.prototype.next=function(e){var t=new pr;this.g.add(t),et(e)&&(e=cn(e)),t.setDisposable(e.subscribe(new r(this,t)))},t.prototype.error=function(e){this.o.onError(e)},t.prototype.completed=function(){this.done=!0,1===this.g.length&&this.o.onCompleted()},Zt(r,e),r.prototype.next=function(e){this.parent.o.onNext(e)},r.prototype.error=function(e){this.parent.o.onError(e)},r.prototype.completed=function(){this.parent.g.remove(this.sad),this.parent.done&&1===this.parent.g.length&&this.parent.o.onCompleted()},t}(Hr);zr.mergeAll=function(){return new Hn(this)};var qn=$e.CompositeError=function(e){this.innerErrors=e,this.message="This contains multiple errors. Check the innerErrors",Error.call(this)};qn.prototype=Object.create(Error.prototype),qn.prototype.name="CompositeError";var $n=function(e){function t(t){this.source=t,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=new ir,r=new pr,n={isStopped:!1,errors:[],o:e};return t.add(r),r.setDisposable(this.source.subscribe(new Xn(t,n))),t},t}(Yr),Xn=function(e){function t(t,r){this._group=t,this._state=r,e.call(this)}function r(e,t){0===t.length?e.onCompleted():1===t.length?e.onError(t[0]):e.onError(new qn(t))}function n(t,r,n){this._inner=t,this._group=r,this._state=n,e.call(this)}return Zt(t,e),t.prototype.next=function(e){var t=new pr;this._group.add(t),et(e)&&(e=cn(e)),t.setDisposable(e.subscribe(new n(t,this._group,this._state)))},t.prototype.error=function(e){this._state.errors.push(e),this._state.isStopped=!0,1===this._group.length&&r(this._state.o,this._state.errors)},t.prototype.completed=function(){this._state.isStopped=!0,1===this._group.length&&r(this._state.o,this._state.errors)},Zt(n,e),n.prototype.next=function(e){this._state.o.onNext(e)},n.prototype.error=function(e){this._state.errors.push(e),this._group.remove(this._inner),this._state.isStopped&&1===this._group.length&&r(this._state.o,this._state.errors)},n.prototype.completed=function(){this._group.remove(this._inner),this._state.isStopped&&1===this._group.length&&r(this._state.o,this._state.errors)},t}(Hr);Kr.mergeDelayError=function(){var e;if(Array.isArray(arguments[0]))e=arguments[0];else{var t=arguments.length;e=new Array(t);for(var r=0;t>r;r++)e[r]=arguments[r]}var n=V(null,e);return new $n(n)},zr.onErrorResumeNext=function(e){if(!e)throw new Error("Second observable is required");return Qn([this,e])};var Kn=function(e){function t(t){this.sources=t,e.call(this)}function r(e,t){if(e.pos<e.sources.length){var r=e.sources[e.pos++];et(r)&&(r=cn(r));var n=new pr;e.subscription.setDisposable(n),n.setDisposable(r.subscribe(new Yn(e,t)))}else e.o.onCompleted()}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=new fr,n={pos:0,subscription:t,o:e,sources:this.sources},i=Er.scheduleRecursive(n,r);return new dr(t,i)},t}(Yr),Yn=function(e){function t(t,r){this._state=t,this._recurse=r,e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._state.o.onNext(e)},t.prototype.error=function(){this._recurse(this._state)},t.prototype.completed=function(){this._recurse(this._state)},t}(Hr),Qn=Kr.onErrorResumeNext=function(){var e=[];if(Array.isArray(arguments[0]))e=arguments[0];else{var t=arguments.length;e=new Array(t);for(var r=0;t>r;r++)e[r]=arguments[r]}return new Kn(e)},Jn=function(e){function t(t,r){this._s=t,this._o=et(r)?cn(r):r,this._open=!1,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=new pr;t.setDisposable(this._s.subscribe(new Zn(e,this))),et(this._o)&&(this._o=cn(this._o));var r=new pr;return r.setDisposable(this._o.subscribe(new ei(e,this,r))),new dr(t,r)},t}(Yr),Zn=function(e){function t(t,r){this._o=t,this._p=r,e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._p._open&&this._o.onNext(e)},t.prototype.error=function(e){this._o.onError(e)},t.prototype.onCompleted=function(){this._p._open&&this._o.onCompleted()},t}(Hr),ei=function(e){function t(t,r,n){this._o=t,this._p=r,this._r=n,e.call(this)}return Zt(t,e),t.prototype.next=function(){this._p._open=!0,this._r.dispose()},t.prototype.error=function(e){this._o.onError(e)},t.prototype.onCompleted=function(){this._r.dispose()},t}(Hr);zr.skipUntil=function(e){return new Jn(this,e)};var ti=function(e){function t(t){this.source=t,e.call(this)}function r(e,t){this.o=e,this.inner=t,this.stopped=!1,this.latest=0,this.hasLatest=!1,Hr.call(this)}function n(e,t){this.parent=e,this.id=t,Hr.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=new fr,n=this.source.subscribe(new r(e,t));return new dr(n,t)},Zt(r,Hr),r.prototype.next=function(e){var t=new pr,r=++this.latest;this.hasLatest=!0,this.inner.setDisposable(t),et(e)&&(e=cn(e)),t.setDisposable(e.subscribe(new n(this,r)))},r.prototype.error=function(e){this.o.onError(e)},r.prototype.completed=function(){this.stopped=!0,!this.hasLatest&&this.o.onCompleted()},Zt(n,Hr),n.prototype.next=function(e){this.parent.latest===this.id&&this.parent.o.onNext(e)},n.prototype.error=function(e){this.parent.latest===this.id&&this.parent.o.onError(e)},n.prototype.completed=function(){this.parent.latest===this.id&&(this.parent.hasLatest=!1,this.parent.stopped&&this.parent.o.onCompleted())},t}(Yr);zr["switch"]=zr.switchLatest=function(){return new ti(this)};var ri=function(e){function t(t,r){this.source=t,this.other=et(r)?cn(r):r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return new dr(this.source.subscribe(e),this.other.subscribe(new ni(e)))},t}(Yr),ni=function(e){function t(t){this._o=t,e.call(this)}return Zt(t,e),t.prototype.next=function(){this._o.onCompleted()},t.prototype.error=function(e){this._o.onError(e)},t.prototype.onCompleted=Xe,t}(Hr);zr.takeUntil=function(e){return new ri(this,e)};var ii=function(e){function t(t,r,n){this._s=t,this._ss=r,this._cb=n,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){for(var t=this._ss.length,r={hasValue:E(t,U),hasValueAll:!1,values:new Array(t)},n=this._ss.length,i=new Array(n+1),o=0;n>o;o++){var s=this._ss[o],a=new pr;et(s)&&(s=cn(s)),a.setDisposable(s.subscribe(new oi(e,o,r))),i[o]=a}var u=new pr;return u.setDisposable(this._s.subscribe(new si(e,this._cb,r))),i[n]=u,new mr(i)},t}(Yr),oi=function(e){function t(t,r,n){this._o=t,this._i=r,this._state=n,e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._state.values[this._i]=e,this._state.hasValue[this._i]=!0,this._state.hasValueAll=this._state.hasValue.every(Ke)},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=Xe,t}(Hr),si=function(e){function t(t,r,n){this._o=t,this._cb=r,this._state=n,e.call(this)}return Zt(t,e),t.prototype.next=function(e){var t=[e].concat(this._state.values);if(this._state.hasValueAll){var r=nt(this._cb).apply(null,t);return r===rt?this._o.onError(r.e):void this._o.onNext(r)}},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onCompleted()},t}(Hr);zr.withLatestFrom=function(){if(0===arguments.length)throw new Error("invalid arguments");for(var e=arguments.length,t=new Array(e),r=0;e>r;r++)t[r]=arguments[r];var n=tt(t[e-1])?t.pop():G;return Array.isArray(t[0])&&(t=t[0]),new ii(this,t,n)};var ai=function(e){function t(t,r){this._s=t,this._cb=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){for(var t=this._s.length,r=new Array(t),n=E(t,U),i=E(t,z),o=0;t>o;o++){var s=this._s[o],a=new pr;r[o]=a,et(s)&&(s=cn(s)),a.setDisposable(s.subscribe(new ui(e,o,this,i,n)))}return new mr(r)},t}(Yr),ui=function(e){function t(t,r,n,i,o){this._o=t,this._i=r,this._p=n,this._q=i,this._d=o,e.call(this)}function r(e){return e.length>0}function n(e){return e.shift()}function i(e){return function(t,r){return r!==e}}return Zt(t,e),t.prototype.next=function(e){if(this._q[this._i].push(e),this._q.every(r)){var t=this._q.map(n),o=nt(this._p._cb).apply(null,t);if(o===rt)return this._o.onError(o.e);this._o.onNext(o)}else this._d.filter(i(this._i)).every(Ke)&&this._o.onCompleted()},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._d[this._i]=!0,this._d.every(Ke)&&this._o.onCompleted()},t}(Hr);zr.zip=function(){if(0===arguments.length)throw new Error("invalid arguments");for(var e=arguments.length,t=new Array(e),r=0;e>r;r++)t[r]=arguments[r];var n=tt(t[e-1])?t.pop():G;Array.isArray(t[0])&&(t=t[0]);var i=this;return t.unshift(i),new ai(t,n)},Kr.zip=function(){for(var e=arguments.length,t=new Array(e),r=0;e>r;r++)t[r]=arguments[r];Array.isArray(t[0])&&(t=tt(t[1])?t[0].concat(t[1]):t[0]);var n=t.shift();return n.zip.apply(n,t)};var ci=function(e){function t(t,r){this.sources=t,this._cb=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){for(var t=this.sources,r=t.length,n=new Array(r),i={q:E(r,z),done:E(r,U),cb:this._cb,o:e},o=0;r>o;o++)!function(e){var r=t[e],o=new pr;(yt(r)||gt(r))&&(r=yn(r)),n[e]=o,o.setDisposable(r.subscribe(new hi(i,e)))}(o);return new mr(n)},t}(Yr),hi=function(e){function t(t,r){this._s=t,this._i=r,e.call(this)}function r(e){return e.length>0}function n(e){return e.shift()}function i(e){return function(t,r){return r!==e}}return Zt(t,e),t.prototype.next=function(e){if(this._s.q[this._i].push(e),this._s.q.every(r)){var t=this._s.q.map(n),o=nt(this._s.cb).apply(null,t);if(o===rt)return this._s.o.onError(o.e);this._s.o.onNext(o)}else this._s.done.filter(i(this._i)).every(Ke)&&this._s.o.onCompleted()},t.prototype.error=function(e){this._s.o.onError(e)},t.prototype.completed=function(){this._s.done[this._i]=!0,this._s.done.every(Ke)&&this._s.o.onCompleted()},t}(Hr);zr.zipIterable=function(){if(0===arguments.length)throw new Error("invalid arguments");for(var e=arguments.length,t=new Array(e),r=0;e>r;r++)t[r]=arguments[r];var n=tt(t[e-1])?t.pop():G,i=this;return t.unshift(i),new ci(t,n)},zr.asObservable=function(){return new Ps(H(this),this)},zr.bufferWithCount=function(e,t){return"number"!=typeof t&&(t=e),this.windowWithCount(e,t).flatMap(W).filter(q)};var li=function(e){function t(t){this.source=t,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new pi(e))},t}(Yr),pi=function(e){function t(t){this._o=t,e.call(this)}return Zt(t,e),t.prototype.next=function(e){e.accept(this._o)},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onCompleted()},t}(Hr);zr.dematerialize=function(){return new li(this)};var fi=function(e){function t(t,r,n){this.source=t,this.keyFn=r,this.comparer=n,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new di(e,this.keyFn,this.comparer))},t}(Yr),di=function(e){function t(t,r,n){this.o=t,this.keyFn=r,this.comparer=n,this.hasCurrentKey=!1,this.currentKey=null,e.call(this)}return Zt(t,e),t.prototype.next=function(e){var t,r=e;return tt(this.keyFn)&&(r=nt(this.keyFn)(e),r===rt)?this.o.onError(r.e):this.hasCurrentKey&&(t=nt(this.comparer)(this.currentKey,r),t===rt)?this.o.onError(t.e):void(this.hasCurrentKey&&t||(this.hasCurrentKey=!0,this.currentKey=r,this.o.onNext(e)))},t.prototype.error=function(e){this.o.onError(e)},t.prototype.completed=function(){this.o.onCompleted()},t}(Hr);zr.distinctUntilChanged=function(e,t){return t||(t=Qe),new fi(this,e,t)};var mi=function(e){function t(t,r,n,i){this.source=t,this._oN=r,this._oE=n,this._oC=i,e.call(this)}function r(e,t){this.o=e,this.t=!t._oN||tt(t._oN)?Gr(t._oN||Xe,t._oE||Xe,t._oC||Xe):t._oN,this.isStopped=!1,Hr.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new r(e,this))},Zt(r,Hr),r.prototype.next=function(e){var t=nt(this.t.onNext).call(this.t,e);t===rt&&this.o.onError(t.e),this.o.onNext(e)},r.prototype.error=function(e){var t=nt(this.t.onError).call(this.t,e);return t===rt?this.o.onError(t.e):void this.o.onError(e)},r.prototype.completed=function(){var e=nt(this.t.onCompleted).call(this.t);return e===rt?this.o.onError(e.e):void this.o.onCompleted()},t}(Yr);zr["do"]=zr.tap=zr.doAction=function(e,t,r){return new mi(this,e,t,r)},zr.doOnNext=zr.tapOnNext=function(e,t){return this.tap("undefined"!=typeof t?function(r){e.call(t,r)}:e)},zr.doOnError=zr.tapOnError=function(e,t){return this.tap(Xe,"undefined"!=typeof t?function(r){e.call(t,r)}:e)},zr.doOnCompleted=zr.tapOnCompleted=function(e,t){return this.tap(Xe,null,"undefined"!=typeof t?function(){e.call(t)}:e)};var vi=function(e){function t(t,r,n){this.source=t,this._fn=_t(r,n,0),e.call(this)}function r(e,t){this.isDisposed=!1,this._s=e,this._fn=t}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=nt(this.source.subscribe).call(this.source,e);return t===rt&&(this._fn(),c(t.e)),new r(t,this._fn)},r.prototype.dispose=function(){if(!this.isDisposed){var e=nt(this._s.dispose).call(this._s);this._fn(),e===rt&&c(e.e)}},t}(Yr);zr["finally"]=function(e,t){return new vi(this,e,t)};var gi=function(e){function t(t){this.source=t,e.call(this)}function r(e){this.o=e,this.isStopped=!1}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new r(e))},r.prototype.onNext=Xe,r.prototype.onError=function(e){this.isStopped||(this.isStopped=!0,this.o.onError(e))},r.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.o.onCompleted())},r.prototype.dispose=function(){this.isStopped=!0},r.prototype.fail=function(e){return this.isStopped?!1:(this.isStopped=!0,this.observer.onError(e),!0)},t}(Yr);zr.ignoreElements=function(){return new gi(this)};var yi=function(e){function t(t,r){this.source=t,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new _i(e))},t}(Yr),_i=function(e){function t(t){this._o=t,e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._o.onNext(Vr(e))},t.prototype.error=function(e){this._o.onNext(Fr(e)),this._o.onCompleted()},t.prototype.completed=function(){this._o.onNext(Br()),this._o.onCompleted()},t}(Hr);zr.materialize=function(){return new yi(this)},zr.repeat=function(e){return rn(this,e).concat()},zr.retry=function(e){return rn(this,e).catchError()};var bi=function(e){function t(e){return{isDisposed:!1,dispose:function(){this.isDisposed||(this.isDisposed=!0,e.isDisposed=!0)}}}function r(t,r){this.source=t,this._notifier=r,e.call(this)}return Zt(r,e),r.prototype.subscribeCore=function(e){var r,n=new Ds,i=new Ds,o=this._notifier(n),s=o.subscribe(i),a=this.source["@@iterator"](),u={isDisposed:!1},c=new fr,h=Tr.scheduleRecursive(null,function(t,o){if(!u.isDisposed){var s=a.next();if(s.done)return void(r?e.onError(r):e.onCompleted());var h=s.value;et(h)&&(h=cn(h));var l=new pr,p=new pr;c.setDisposable(new dr(p,l)),l.setDisposable(h.subscribe(function(t){e.onNext(t)},function(t){p.setDisposable(i.subscribe(o,function(t){e.onError(t)},function(){e.onCompleted()})),n.onNext(t),l.dispose()},function(){e.onCompleted()}))}});return new mr([s,c,h,t(u)])},r}(Yr);zr.retryWhen=function(e){return new bi($(this),e)};var xi=function(e){function t(e){return{isDisposed:!1,dispose:function(){this.isDisposed||(this.isDisposed=!0,e.isDisposed=!0)}}}function r(t,r){this.source=t,this._notifier=r,e.call(this)}return Zt(r,e),r.prototype.subscribeCore=function(e){var r,n=new Ds,i=new Ds,o=this._notifier(n),s=o.subscribe(i),a=this.source["@@iterator"](),u={isDisposed:!1},c=new fr,h=Tr.scheduleRecursive(null,function(t,o){if(!u.isDisposed){var s=a.next();if(s.done)return void(r?e.onError(r):e.onCompleted());var h=s.value;et(h)&&(h=cn(h));var l=new pr,p=new pr;c.setDisposable(new dr(p,l)),l.setDisposable(h.subscribe(function(t){e.onNext(t)},function(t){e.onError(t)},function(){p.setDisposable(i.subscribe(o,function(t){e.onError(t)},function(){e.onCompleted()})),n.onNext(null),l.dispose()}))}});return new mr([s,c,h,t(u)])},r}(Yr);zr.repeatWhen=function(e){return new xi($(this),e)};var wi=function(e){function t(t,r,n,i){this.source=t,this.accumulator=r,this.hasSeed=n,this.seed=i,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new Si(e,this))},t}(Yr),Si=function(e){function t(t,r){this._o=t,this._p=r,this._fn=r.accumulator,this._hs=r.hasSeed,this._s=r.seed,this._ha=!1,this._a=null,this._hv=!1,this._i=0,e.call(this)}return Zt(t,e),t.prototype.next=function(e){return!this._hv&&(this._hv=!0),this._ha?this._a=nt(this._fn)(this._a,e,this._i,this._p):(this._a=this._hs?nt(this._fn)(this._s,e,this._i,this._p):e,this._ha=!0),this._a===rt?this._o.onError(this._a.e):(this._o.onNext(this._a),void this._i++)},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){!this._hv&&this._hs&&this._o.onNext(this._s),this._o.onCompleted()},t}(Hr);zr.scan=function(){var e,t=!1,r=arguments[0];return 2===arguments.length&&(t=!0,e=arguments[1]),new wi(this,r,t,e)};var Mi=function(e){function t(t,r){this.source=t,this._c=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new Ei(e,this._c))},t}(Yr),Ei=function(e){function t(t,r){this._o=t,this._c=r,this._q=[],e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._q.push(e),this._q.length>this._c&&this._o.onNext(this._q.shift())},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onCompleted()},t}(Hr);zr.skipLast=function(e){if(0>e)throw new lt;return new Mi(this,e)},zr.startWith=function(){var e,t=0;arguments.length&&br(arguments[0])?(e=arguments[0],t=1):e=Er;for(var r=[],n=t,i=arguments.length;i>n;n++)r.push(arguments[n]);return on([bn(r,e),this]).concat()};var Ci=function(e){function t(t,r){this._o=t,this._c=r,this._q=[],e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._q.push(e),this._q.length>this._c&&this._q.shift()},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){for(;this._q.length>0;)this._o.onNext(this._q.shift());this._o.onCompleted()},t}(Hr);zr.takeLast=function(e){if(0>e)throw new lt;var t=this;return new Ps(function(r){return t.subscribe(new Ci(r,e))},t)};var Ti=function(e){function t(t,r){this._o=t,this._c=r,this._q=[],e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._q.push(e),this._q.length>this._c&&this._q.shift()},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onNext(this._q),this._o.onCompleted()},t}(Hr);zr.takeLastBuffer=function(e){if(0>e)throw new lt;var t=this;return new Ps(function(r){return t.subscribe(new Ti(r,e))},t)},zr.windowWithCount=function(e,t){var r=this;if(+e||(e=0),Math.abs(e)===1/0&&(e=0),0>=e)throw new lt;if(null==t&&(t=e),+t||(t=0),Math.abs(t)===1/0&&(t=0),0>=t)throw new lt;return new Ps(function(n){function i(){var e=new Ds;u.push(e),n.onNext(tr(e,s))}var o=new pr,s=new vr(o),a=0,u=[];return i(),o.setDisposable(r.subscribe(function(r){for(var n=0,o=u.length;o>n;n++)u[n].onNext(r);var s=a-e+1;s>=0&&s%t===0&&u.shift().onCompleted(),++a%t===0&&i()},function(e){for(;u.length>0;)u.shift().onError(e);n.onError(e)},function(){for(;u.length>0;)u.shift().onCompleted();n.onCompleted()})),s},r)},zr.selectConcat=zr.concatMap=function(e,t,r){return tt(e)&&tt(t)?this.concatMap(function(r,n){var i=e(r,n);return et(i)&&(i=cn(i)),(yt(i)||gt(i))&&(i=yn(i)),i.map(function(e,i){return t(r,e,n,i)})}):tt(e)?X(this,e,r):X(this,function(){return e})},zr.concatMapObserver=zr.selectConcatObserver=function(e,t,r,n){var i=this,o=_t(e,n,2),s=_t(t,n,1),a=_t(r,n,0);return new Ps(function(e){var t=0;return i.subscribe(function(r){var n;try{n=o(r,t++)}catch(i){return void e.onError(i)}et(n)&&(n=cn(n)),e.onNext(n)},function(t){var r;try{r=s(t)}catch(n){return void e.onError(n)}et(r)&&(r=cn(r)),e.onNext(r),e.onCompleted()},function(){var t;try{t=a()}catch(r){return void e.onError(r)}et(t)&&(t=cn(t)),e.onNext(t),e.onCompleted()})},this).concatAll()};var Ai=function(e){function t(t,r){this._o=t,this._d=r,this._f=!1,e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._f=!0,this._o.onNext(e)},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){!this._f&&this._o.onNext(this._d),this._o.onCompleted()},t}(Hr);zr.defaultIfEmpty=function(e){var t=this;return e===o&&(e=null),new Ps(function(r){return t.subscribe(new Ai(r,e))},t)},Y.prototype.push=function(e){var t=-1===K(this.set,e,this.comparer);return t&&this.set.push(e),t};var Pi=function(e){function t(t,r,n){this.source=t,this._keyFn=r,this._cmpFn=n,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new ki(e,this._keyFn,this._cmpFn))},t}(Yr),ki=function(e){function t(t,r,n){this._o=t,this._keyFn=r,this._h=new Y(n),e.call(this)}return Zt(t,e),t.prototype.next=function(e){var t=e;return tt(this._keyFn)&&(t=nt(this._keyFn)(e),t===rt)?this._o.onError(t.e):void(this._h.push(t)&&this._o.onNext(e))},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onCompleted()},t}(Hr);zr.distinct=function(e,t){return t||(t=Qe),new Pi(this,e,t)},zr.groupBy=function(e,t){return this.groupByUntil(e,t,Mn)},zr.groupByUntil=function(e,t,r){var n=this;return new Ps(function(i){var s=new qo,a=new ir,u=new vr(a),c=function(e){return function(t){t.onError(e)}};return a.add(n.subscribe(function(n){var h=nt(e)(n);if(h===rt)return s.forEach(c(h.e)),i.onError(h.e);var l=!1,p=s.get(h);if(p===o&&(p=new Ds,s.set(h,p),l=!0),l){var f=new Ns(h,p,u),d=new Ns(h,p),m=nt(r)(d);if(m===rt)return s.forEach(c(m.e)),i.onError(m.e);i.onNext(f);var v=new pr;a.add(v),v.setDisposable(m.take(1).subscribe(Xe,function(e){s.forEach(c(e)),i.onError(e)},function(){s["delete"](h)&&p.onCompleted(),a.remove(v)}))}var g=n;return tt(t)&&(g=nt(t)(n),g===rt)?(s.forEach(c(g.e)),i.onError(g.e)):void p.onNext(g)},function(e){s.forEach(c(e)),i.onError(e)},function(){s.forEach(function(e){e.onCompleted()}),i.onCompleted()})),u},n)};var Oi=function(e){function t(t,r,n){this.source=t,this.selector=_t(r,n,3),e.call(this)}function r(e,t){return function(r,n,i){return e.call(this,t.selector(r,n,i),n,i)}}function n(e,t,r){this.o=e,this.selector=t,this.source=r,this.i=0,Hr.call(this)}return Zt(t,e),t.prototype.internalMap=function(e,n){return new t(this.source,r(e,this),n)},t.prototype.subscribeCore=function(e){return this.source.subscribe(new n(e,this.selector,this))},Zt(n,Hr),n.prototype.next=function(e){var t=nt(this.selector)(e,this.i++,this.source);return t===rt?this.o.onError(t.e):void this.o.onNext(t)},n.prototype.error=function(e){this.o.onError(e)},n.prototype.completed=function(){this.o.onCompleted()},t}(Yr);zr.map=zr.select=function(e,t){var r="function"==typeof e?e:function(){return e};return this instanceof Oi?this.internalMap(r,t):new Oi(this,r,t)},zr.pluck=function(){var e=arguments.length,t=new Array(e);if(0===e)throw new Error("List of properties cannot be empty.");for(var r=0;e>r;r++)t[r]=arguments[r];return this.map(Q(t,e))},zr.flatMap=zr.selectMany=function(e,t,r){return new Qr(this,e,t,r).mergeAll()},zr.flatMapObserver=zr.selectManyObserver=function(e,t,r,n){var i=this;return new Ps(function(o){var s=0;return i.subscribe(function(t){var r;try{r=e.call(n,t,s++)}catch(i){return void o.onError(i)}et(r)&&(r=cn(r)),o.onNext(r)},function(e){var r;try{r=t.call(n,e)}catch(i){return void o.onError(i)}et(r)&&(r=cn(r)),o.onNext(r),o.onCompleted()},function(){var e;try{e=r.call(n)}catch(t){return void o.onError(t)}et(e)&&(e=cn(e)),o.onNext(e),o.onCompleted()})},i).mergeAll()},$e.Observable.prototype.flatMapLatest=function(e,t,r){return new Qr(this,e,t,r).switchLatest()};var Ni=function(e){function t(t,r){this.source=t,this._count=r,e.call(this)}function r(e,t){this._o=e,this._r=t,Hr.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new r(e,this._count))},Zt(r,Hr),r.prototype.next=function(e){this._r<=0?this._o.onNext(e):this._r--},r.prototype.error=function(e){this._o.onError(e)},r.prototype.completed=function(){this._o.onCompleted()},t}(Yr);zr.skip=function(e){if(0>e)throw new lt;return new Ni(this,e)};var Di=function(e){function t(t,r){this.source=t,this._fn=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new Li(e,this))},t}(Yr),Li=function(e){function t(t,r){this._o=t,this._p=r,this._i=0,this._r=!1,e.call(this)}return Zt(t,e),t.prototype.next=function(e){if(!this._r){var t=nt(this._p._fn)(e,this._i++,this._p);if(t===rt)return this._o.onError(t.e);this._r=!t}this._r&&this._o.onNext(e)},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onCompleted()},t}(Hr);zr.skipWhile=function(e,t){var r=_t(e,t,3);return new Di(this,r)};var Ri=function(e){function t(t,r){this.source=t,this._count=r,e.call(this)}function r(e,t){this._o=e,this._c=t,this._r=t,Hr.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new r(e,this._count))},Zt(r,Hr),r.prototype.next=function(e){this._r-- >0&&(this._o.onNext(e),this._r<=0&&this._o.onCompleted())},r.prototype.error=function(e){this._o.onError(e)},r.prototype.completed=function(){this._o.onCompleted()},t}(Yr);zr.take=function(e,t){if(0>e)throw new lt;return 0===e?mn(t):new Ri(this,e)};var ji=function(e){function t(t,r){this.source=t,this._fn=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new Ii(e,this))},t}(Yr),Ii=function(e){function t(t,r){this._o=t,this._p=r,this._i=0,this._r=!0,e.call(this)}return Zt(t,e),t.prototype.next=function(e){return this._r&&(this._r=nt(this._p._fn)(e,this._i++,this._p),this._r===rt)?this._o.onError(this._r.e):void(this._r?this._o.onNext(e):this._o.onCompleted())},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onCompleted()},t}(Hr);zr.takeWhile=function(e,t){
var r=_t(e,t,3);return new ji(this,r)};var Vi=function(e){function t(t,r,n){this.source=t,this.predicate=_t(r,n,3),e.call(this)}function r(e,t){return function(r,n,i){return t.predicate(r,n,i)&&e.call(this,r,n,i)}}function n(e,t,r){this.o=e,this.predicate=t,this.source=r,this.i=0,Hr.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new n(e,this.predicate,this))},t.prototype.internalFilter=function(e,n){return new t(this.source,r(e,this),n)},Zt(n,Hr),n.prototype.next=function(e){var t=nt(this.predicate)(e,this.i++,this.source);return t===rt?this.o.onError(t.e):void(t&&this.o.onNext(e))},n.prototype.error=function(e){this.o.onError(e)},n.prototype.completed=function(){this.o.onCompleted()},t}(Yr);zr.filter=zr.where=function(e,t){return this instanceof Vi?this.internalFilter(e,t):new Vi(this,e,t)};var Fi=function(e){function t(t,r,n){this.source=t,this._k=r,this._c=n,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new Bi(e,this._k,this._c))},t}(Yr),Bi=function(e){function t(t,r,n){this._o=t,this._k=r,this._c=n,this._v=null,this._hv=!1,this._l=[],e.call(this)}return Zt(t,e),t.prototype.next=function(e){var t=nt(this._k)(e);if(t===rt)return this._o.onError(t.e);var r=0;if(this._hv){if(r=nt(this._c)(t,this._v),r===rt)return this._o.onError(r.e)}else this._hv=!0,this._v=t;r>0&&(this._v=t,this._l=[]),r>=0&&this._l.push(e)},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onNext(this._l),this._o.onCompleted()},t}(Hr),Ui=function(e){function t(t,r,n,i){this.source=t,this.accumulator=r,this.hasSeed=n,this.seed=i,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new Gi(e,this))},t}(Yr),Gi=function(e){function t(t,r){this._o=t,this._p=r,this._fn=r.accumulator,this._hs=r.hasSeed,this._s=r.seed,this._ha=!1,this._a=null,this._hv=!1,this._i=0,e.call(this)}return Zt(t,e),t.prototype.next=function(e){return!this._hv&&(this._hv=!0),this._ha?this._a=nt(this._fn)(this._a,e,this._i,this._p):(this._a=this._hs?nt(this._fn)(this._s,e,this._i,this._p):e,this._ha=!0),this._a===rt?this._o.onError(this._a.e):void this._i++},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._hv&&this._o.onNext(this._a),!this._hv&&this._hs&&this._o.onNext(this._s),!this._hv&&!this._hs&&this._o.onError(new ct),this._o.onCompleted()},t}(Hr);zr.reduce=function(){var e,t=!1,r=arguments[0];return 2===arguments.length&&(t=!0,e=arguments[1]),new Ui(this,r,t,e)};var zi=function(e){function t(t,r){this.source=t,this._fn=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new Hi(e,this._fn,this.source))},t}(Yr),Hi=function(e){function t(t,r,n){this._o=t,this._fn=r,this._s=n,this._i=0,e.call(this)}return Zt(t,e),t.prototype.next=function(e){var t=nt(this._fn)(e,this._i++,this._s);return t===rt?this._o.onError(t.e):void(Boolean(t)&&(this._o.onNext(!0),this._o.onCompleted()))},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onNext(!1),this._o.onCompleted()},t}(Hr);zr.some=function(e,t){var r=_t(e,t,3);return new zi(this,r)};var Wi=function(e){function t(t){this.source=t,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new qi(e))},t}(Yr),qi=function(e){function t(t){this._o=t,e.call(this)}return Zt(t,e),t.prototype.next=function(){this._o.onNext(!1),this._o.onCompleted()},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onNext(!0),this._o.onCompleted()},t}(Hr);zr.isEmpty=function(){return new Wi(this)};var $i=function(e){function t(t,r){this.source=t,this._fn=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new Xi(e,this._fn,this.source))},t}(Yr),Xi=function(e){function t(t,r,n){this._o=t,this._fn=r,this._s=n,this._i=0,e.call(this)}return Zt(t,e),t.prototype.next=function(e){var t=nt(this._fn)(e,this._i++,this._s);return t===rt?this._o.onError(t.e):void(Boolean(t)||(this._o.onNext(!1),this._o.onCompleted()))},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onNext(!0),this._o.onCompleted()},t}(Hr);zr.every=function(e,t){var r=_t(e,t,3);return new $i(this,r)};var Ki=function(e){function t(t,r,n){var i=+n||0;Math.abs(i)===1/0&&(i=0),this.source=t,this._elem=r,this._n=i,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this._n<0?(e.onNext(!1),e.onCompleted(),ur):this.source.subscribe(new Yi(e,this._elem,this._n))},t}(Yr),Yi=function(e){function t(t,r,n){this._o=t,this._elem=r,this._n=n,this._i=0,e.call(this)}function r(e,t){return 0===e&&0===t||e===t||isNaN(e)&&isNaN(t)}return Zt(t,e),t.prototype.next=function(e){this._i++>=this._n&&r(e,this._elem)&&(this._o.onNext(!0),this._o.onCompleted())},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onNext(!1),this._o.onCompleted()},t}(Hr);zr.includes=function(e,t){return new Ki(this,e,t)};var Qi=function(e){function t(t,r){this.source=t,this._fn=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new Ji(e,this._fn,this.source))},t}(Yr),Ji=function(e){function t(t,r,n){this._o=t,this._fn=r,this._s=n,this._i=0,this._c=0,e.call(this)}return Zt(t,e),t.prototype.next=function(e){if(this._fn){var t=nt(this._fn)(e,this._i++,this._s);if(t===rt)return this._o.onError(t.e);Boolean(t)&&this._c++}else this._c++},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onNext(this._c),this._o.onCompleted()},t}(Hr);zr.count=function(e,t){var r=_t(e,t,3);return new Qi(this,r)};var Zi=function(e){function t(t,r,n){this.source=t,this._e=r,this._n=n,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this._n<0?(e.onNext(-1),e.onCompleted(),ur):this.source.subscribe(new eo(e,this._e,this._n))},t}(Yr),eo=function(e){function t(t,r,n){this._o=t,this._e=r,this._n=n,this._i=0,e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._i>=this._n&&e===this._e&&(this._o.onNext(this._i),this._o.onCompleted()),this._i++},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onNext(-1),this._o.onCompleted()},t}(Hr);zr.indexOf=function(e,t){var r=+t||0;return Math.abs(r)===1/0&&(r=0),new Zi(this,e,r)};var to=function(e){function t(t,r){this.source=t,this._fn=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new ro(e,this._fn,this.source))},t}(Yr),ro=function(e){function t(t,r,n){this._o=t,this._fn=r,this._s=n,this._i=0,this._c=0,e.call(this)}return Zt(t,e),t.prototype.next=function(e){if(this._fn){var t=nt(this._fn)(e,this._i++,this._s);if(t===rt)return this._o.onError(t.e);this._c+=t}else this._c+=e},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onNext(this._c),this._o.onCompleted()},t}(Hr);zr.sum=function(e,t){var r=_t(e,t,3);return new to(this,r)},zr.minBy=function(e,t){return t||(t=Je),new Fi(this,e,function(e,r){return-1*t(e,r)})},zr.min=function(e){return this.minBy(Ke,e).map(J)},zr.maxBy=function(e,t){return t||(t=Je),new Fi(this,e,t)},zr.max=function(e){return this.maxBy(Ke,e).map(J)};var no=function(e){function t(t,r){this.source=t,this._fn=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new io(e,this._fn,this.source))},t}(Yr),io=function(e){function t(t,r,n){this._o=t,this._fn=r,this._s=n,this._c=0,this._t=0,e.call(this)}return Zt(t,e),t.prototype.next=function(e){if(this._fn){var t=nt(this._fn)(e,this._c++,this._s);if(t===rt)return this._o.onError(t.e);this._t+=t}else this._c++,this._t+=e},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){return 0===this._c?this._o.onError(new ct):(this._o.onNext(this._t/this._c),void this._o.onCompleted())},t}(Hr);zr.average=function(e,t){var r,n=this;return tt(e)&&(r=_t(e,t,3)),new no(n,r)},zr.sequenceEqual=function(e,t){var r=this;return t||(t=Qe),new Ps(function(n){var i=!1,o=!1,s=[],a=[],u=r.subscribe(function(e){if(a.length>0){var r=a.shift(),i=nt(t)(r,e);if(i===rt)return n.onError(i.e);i||(n.onNext(!1),n.onCompleted())}else o?(n.onNext(!1),n.onCompleted()):s.push(e)},function(e){n.onError(e)},function(){i=!0,0===s.length&&(a.length>0?(n.onNext(!1),n.onCompleted()):o&&(n.onNext(!0),n.onCompleted()))});(yt(e)||gt(e))&&(e=yn(e)),et(e)&&(e=cn(e));var c=e.subscribe(function(e){if(s.length>0){var r=s.shift(),o=nt(t)(r,e);if(o===rt)return n.onError(o.e);o||(n.onNext(!1),n.onCompleted())}else i?(n.onNext(!1),n.onCompleted()):a.push(e)},function(e){n.onError(e)},function(){o=!0,0===a.length&&(s.length>0?(n.onNext(!1),n.onCompleted()):i&&(n.onNext(!0),n.onCompleted()))});return new dr(u,c)},r)};var oo=function(e){function t(t,r,n){this.source=t,this._i=r,this._d=n,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new so(e,this._i,this._d))},t}(Yr),so=function(e){function t(t,r,n){this._o=t,this._i=r,this._d=n,e.call(this)}return Zt(t,e),t.prototype.next=function(e){0===this._i--&&(this._o.onNext(e),this._o.onCompleted())},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._d===o?this._o.onError(new lt):(this._o.onNext(this._d),this._o.onCompleted())},t}(Hr);zr.elementAt=function(e,t){if(0>e)throw new lt;return new oo(this,e,t)};var ao=function(e){function t(t,r,n){this._o=t,this._obj=r,this._s=n,this._i=0,this._hv=!1,this._v=null,e.call(this)}return Zt(t,e),t.prototype.next=function(e){var t=!1;if(this._obj.predicate){var r=nt(this._obj.predicate)(e,this._i++,this._s);if(r===rt)return this._o.onError(r.e);Boolean(r)&&(t=!0)}else this._obj.predicate||(t=!0);if(t){if(this._hv)return this._o.onError(new Error("Sequence contains more than one matching element"));this._hv=!0,this._v=e}},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._hv?(this._o.onNext(this._v),this._o.onCompleted()):this._obj.defaultValue===o?this._o.onError(new ct):(this._o.onNext(this._obj.defaultValue),this._o.onCompleted())},t}(Hr);zr.single=function(e,t){var r={},n=this;if(r="object"==typeof arguments[0]?arguments[0]:{predicate:arguments[0],thisArg:arguments[1],defaultValue:arguments[2]},tt(r.predicate)){var i=r.predicate;r.predicate=_t(i,r.thisArg,3)}return new Ps(function(e){return n.subscribe(new ao(e,r,n))},n)};var uo=function(e){function t(t,r){this.source=t,this._obj=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new co(e,this._obj,this.source))},t}(Yr),co=function(e){function t(t,r,n){this._o=t,this._obj=r,this._s=n,this._i=0,e.call(this)}return Zt(t,e),t.prototype.next=function(e){if(this._obj.predicate){var t=nt(this._obj.predicate)(e,this._i++,this._s);if(t===rt)return this._o.onError(t.e);Boolean(t)&&(this._o.onNext(e),this._o.onCompleted())}else this._obj.predicate||(this._o.onNext(e),this._o.onCompleted())},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._obj.defaultValue===o?this._o.onError(new ct):(this._o.onNext(this._obj.defaultValue),this._o.onCompleted())},t}(Hr);zr.first=function(){var e={};if(e="object"==typeof arguments[0]?arguments[0]:{predicate:arguments[0],thisArg:arguments[1],defaultValue:arguments[2]},tt(e.predicate)){var t=e.predicate;e.predicate=_t(t,e.thisArg,3)}return new uo(this,e)};var ho=function(e){function t(t,r){this.source=t,this._obj=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new lo(e,this._obj,this.source))},t}(Yr),lo=function(e){function t(t,r,n){this._o=t,this._obj=r,this._s=n,this._i=0,this._hv=!1,this._v=null,e.call(this)}return Zt(t,e),t.prototype.next=function(e){var t=!1;if(this._obj.predicate){var r=nt(this._obj.predicate)(e,this._i++,this._s);if(r===rt)return this._o.onError(r.e);Boolean(r)&&(t=!0)}else this._obj.predicate||(t=!0);t&&(this._hv=!0,this._v=e)},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._hv?(this._o.onNext(this._v),this._o.onCompleted()):this._obj.defaultValue===o?this._o.onError(new ct):(this._o.onNext(this._obj.defaultValue),this._o.onCompleted())},t}(Hr);zr.last=function(){var e={};if(e="object"==typeof arguments[0]?arguments[0]:{predicate:arguments[0],thisArg:arguments[1],defaultValue:arguments[2]},tt(e.predicate)){var t=e.predicate;e.predicate=_t(t,e.thisArg,3)}return new ho(this,e)};var po=function(e){function t(t,r,n,i){this._o=t,this._s=r,this._cb=n,this._y=i,this._i=0,e.call(this)}return Zt(t,e),t.prototype.next=function(e){var t=nt(this._cb)(e,this._i,this._s);return t===rt?this._o.onError(t.e):void(t?(this._o.onNext(this._y?this._i:e),this._o.onCompleted()):this._i++)},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._y&&this._o.onNext(-1),this._o.onCompleted()},t}(Hr);zr.find=function(e,t){return Z(this,e,t,!1)},zr.findIndex=function(e,t){return Z(this,e,t,!0)};var fo=function(e){function t(t){this.source=t,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new mo(e))},t}(Yr),mo=function(e){function t(t){this._o=t,this._s=new qe.Set,e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._s.add(e)},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onNext(this._s),this._o.onCompleted()},t}(Hr);zr.toSet=function(){if("undefined"==typeof qe.Set)throw new TypeError;return new fo(this)};var vo=function(e){function t(t,r,n){this.source=t,this._k=r,this._e=n,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new go(e,this._k,this._e))},t}(Yr),go=function(e){function t(t,r,n){this._o=t,this._k=r,this._e=n,this._m=new qe.Map,e.call(this)}return Zt(t,e),t.prototype.next=function(e){var t=nt(this._k)(e);if(t===rt)return this._o.onError(t.e);var r=e;return this._e&&(r=nt(this._e)(e),r===rt)?this._o.onError(r.e):void this._m.set(t,r)},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onNext(this._m),this._o.onCompleted()},t}(Hr);zr.toMap=function(e,t){if("undefined"==typeof qe.Map)throw new TypeError;return new vo(this,e,t)};var yo=function(e){function t(t,r,n){this.source=t,this._b=r,this._e=n,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new _o(e,this._b,this._e))},t}(Yr),_o=function(e){function t(t,r,n){this._o=t,this._b=r,this._e=n,this._i=0,e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._i>=this._b&&(this._e===this._i?this._o.onCompleted():this._o.onNext(e)),this._i++},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onCompleted()},t}(Hr);zr.slice=function(e,t){var r=e||0;if(0>r)throw new $e.ArgumentOutOfRangeError;if("number"==typeof t&&r>t)throw new $e.ArgumentOutOfRangeError;return new yo(this,r,t)};var bo=function(e){function t(t,r,n){this.source=t,this._e=r,this._n=n,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this._n<0?(e.onNext(-1),e.onCompleted(),ur):this.source.subscribe(new xo(e,this._e,this._n))},t}(Yr),xo=function(e){function t(t,r,n){this._o=t,this._e=r,this._n=n,this._v=0,this._hv=!1,this._i=0,e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._i>=this._n&&e===this._e&&(this._hv=!0,this._v=this._i),this._i++},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._hv?this._o.onNext(this._v):this._o.onNext(-1),this._o.onCompleted()},t}(Hr);zr.lastIndexOf=function(e,t){var r=+t||0;return Math.abs(r)===1/0&&(r=0),new bo(this,e,r)},Kr.wrap=function(e){function t(){return Kr.spawn.call(this,e.apply(this,arguments))}return t.__generatorFunction__=e,t};var wo=Kr.spawn=function(){for(var e=arguments[0],t=this,r=[],n=1,i=arguments.length;i>n;n++)r.push(arguments[n]);return new Ps(function(n){function i(t){var r=nt(e.next).call(e,t);return r===rt?n.onError(r.e):void s(r)}function o(t){var r=nt(e.next).call(e,t);return r===rt?n.onError(r.e):void s(r)}function s(e){if(e.done)return n.onNext(e.value),void n.onCompleted();var r=ee.call(t,e.value),s=null,u=!1;Kr.isObservable(r)?a.add(r.subscribe(function(e){u=!0,s=e},o,function(){u&&i(s)})):o(new TypeError("type not supported"))}var a=new ir;return tt(e)&&(e=e.apply(t,r)),e&&tt(e.next)?(i(),a):(n.onNext(e),n.onCompleted())})};Kr.start=function(e,t,r){return So(e,t,r)()};var So=Kr.toAsync=function(e,t,r){return br(r)||(r=Nr),function(){var n=arguments,i=new Ls;return r.schedule(null,function(){var r;try{r=e.apply(t,n)}catch(o){return void i.onError(o)}i.onNext(r),i.onCompleted()}),i.asObservable()}};Kr.fromCallback=function(e,t,r){return function(){"undefined"==typeof t&&(t=this);for(var n=arguments.length,i=new Array(n),o=0;n>o;o++)i[o]=arguments[o];return ae(e,t,r,i)}},Kr.fromNodeCallback=function(e,t,r){return function(){"undefined"==typeof t&&(t=this);for(var n=arguments.length,i=new Array(n),o=0;n>o;o++)i[o]=arguments[o];return ce(e,t,r,i)}},pe.prototype.dispose=function(){this.isDisposed||(this._e.removeEventListener(this._n,this._fn,!1),this.isDisposed=!0)},$e.config.useNativeEvents=!1;var Mo=function(e){function t(t,r,n){this._el=t,this._n=r,this._fn=n,e.call(this)}function r(e,t){return function(){var r=arguments[0];return tt(t)&&(r=nt(t).apply(null,arguments),r===rt)?e.onError(r.e):void e.onNext(r)}}return Zt(t,e),t.prototype.subscribeCore=function(e){return fe(this._el,this._n,r(e,this._fn))},t}(Yr);Kr.fromEvent=function(e,t,r){return e.addListener?Co(function(r){e.addListener(t,r)},function(r){e.removeListener(t,r)},r):$e.config.useNativeEvents||"function"!=typeof e.on||"function"!=typeof e.off?new Mo(e,t,r).publish().refCount():Co(function(r){e.on(t,r)},function(r){e.off(t,r)},r)};var Eo=function(e){function t(t,r,n){this._add=t,this._del=r,this._fn=n,e.call(this)}function r(e,t){return function(){var r=arguments[0];return tt(t)&&(r=nt(t).apply(null,arguments),r===rt)?e.onError(r.e):void e.onNext(r)}}function n(e,t,r){this._del=e,this._fn=t,this._ret=r,this.isDisposed=!1}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=r(e,this._fn),i=this._add(t);return new n(this._del,t,i)},n.prototype.dispose=function(){this.isDisposed||(tt(this._del)&&this._del(this._fn,this._ret),this.isDisposed=!0)},t}(Yr),Co=Kr.fromEventPattern=function(e,t,r){return new Eo(e,t,r).publish().refCount()};Kr.startAsync=function(e){var t=nt(e)();return t===rt?kn(t.e):cn(t)};var To=function(e){function t(t,r){this.source=t,this.controller=new Ds,r&&r.subscribe?this.pauser=this.controller.merge(r):this.pauser=this.controller,e.call(this)}return Zt(t,e),t.prototype._subscribe=function(e){var t=this.source.publish(),r=t.subscribe(e),n=ur,i=this.pauser.distinctUntilChanged().subscribe(function(e){e?n=t.connect():(n.dispose(),n=ur)});return new mr([r,n,i])},t.prototype.pause=function(){this.controller.onNext(!1)},t.prototype.resume=function(){this.controller.onNext(!0)},t}(Kr);zr.pausable=function(e){return new To(this,e)};var Ao=function(e){function t(t,r){this.source=t,this.controller=new Ds,r&&r.subscribe?this.pauser=this.controller.merge(r):this.pauser=this.controller,e.call(this)}return Zt(t,e),t.prototype._subscribe=function(e){function t(){for(;n.length>0;)e.onNext(n.shift())}var r,n=[],i=de(this.source,this.pauser.startWith(!1).distinctUntilChanged(),function(e,t){return{data:e,shouldFire:t}}).subscribe(function(i){r!==o&&i.shouldFire!==r?(r=i.shouldFire,i.shouldFire&&t()):(r=i.shouldFire,i.shouldFire?e.onNext(i.data):n.push(i.data))},function(r){t(),e.onError(r)},function(){t(),e.onCompleted()});return i},t.prototype.pause=function(){this.controller.onNext(!1)},t.prototype.resume=function(){this.controller.onNext(!0)},t}(Kr);zr.pausableBuffered=function(e){return new Ao(this,e)};var Po=function(e){function t(t,r,n){e.call(this),this.subject=new ko(r,n),this.source=t.multicast(this.subject).refCount()}return Zt(t,e),t.prototype._subscribe=function(e){return this.source.subscribe(e)},t.prototype.request=function(e){return this.subject.request(null==e?-1:e)},t}(Kr),ko=function(e){function t(t,r){null==t&&(t=!0),e.call(this),this.subject=new Ds,this.enableQueue=t,this.queue=t?[]:null,this.requestedCount=0,this.requestedDisposable=null,this.error=null,this.hasFailed=!1,this.hasCompleted=!1,this.scheduler=r||Tr}return Zt(t,e),er(t.prototype,Ur,{_subscribe:function(e){return this.subject.subscribe(e)},onCompleted:function(){this.hasCompleted=!0,this.enableQueue&&0!==this.queue.length?this.queue.push(Lr.createOnCompleted()):(this.subject.onCompleted(),this.disposeCurrentRequest())},onError:function(e){this.hasFailed=!0,this.error=e,this.enableQueue&&0!==this.queue.length?this.queue.push(Lr.createOnError(e)):(this.subject.onError(e),this.disposeCurrentRequest())},onNext:function(e){this.requestedCount<=0?this.enableQueue&&this.queue.push(Lr.createOnNext(e)):(0===this.requestedCount--&&this.disposeCurrentRequest(),this.subject.onNext(e))},_processRequest:function(e){if(this.enableQueue)for(;this.queue.length>0&&(e>0||"N"!==this.queue[0].kind);){var t=this.queue.shift();t.accept(this.subject),"N"===t.kind?e--:(this.disposeCurrentRequest(),this.queue=[])}return e},request:function(e){this.disposeCurrentRequest();var t=this;return this.requestedDisposable=this.scheduler.schedule(e,function(e,r){var n=t._processRequest(r),i=t.hasCompleted||t.hasFailed;return!i&&n>0?(t.requestedCount=n,ar(function(){t.requestedCount=0})):void 0}),this.requestedDisposable},disposeCurrentRequest:function(){this.requestedDisposable&&(this.requestedDisposable.dispose(),this.requestedDisposable=null)}}),t}(Kr);zr.controlled=function(e,t){return e&&br(e)&&(t=e,e=!0),null==e&&(e=!0),new Po(this,e,t)};var Oo=function(e){function t(t){e.call(this),this.source=t}function r(e,t){t.source.request(1)}Zt(t,e),t.prototype._subscribe=function(e){return this.subscription=this.source.subscribe(new n(e,this,this.subscription)),new dr(this.subscription,Nr.schedule(this,r))};var n=function(e){function r(t,r,n){e.call(this),this.observer=t,this.observable=r,this.cancel=n,this.scheduleDisposable=null}function n(e,t){t.observable.source.request(1)}return Zt(r,e),r.prototype.completed=function(){this.observer.onCompleted(),this.dispose()},r.prototype.error=function(e){this.observer.onError(e),this.dispose()},r.prototype.next=function(e){this.observer.onNext(e),this.scheduleDisposable=Nr.schedule(this,n)},t.dispose=function(){this.observer=null,this.cancel&&(this.cancel.dispose(),this.cancel=null),this.scheduleDisposable&&(this.scheduleDisposable.dispose(),this.scheduleDisposable=null),e.prototype.dispose.call(this)},r}(Hr);return t}(Kr);Po.prototype.stopAndWait=function(){return new Oo(this)};var No=function(e){function t(t,r){e.call(this),this.source=t,this.windowSize=r}function r(e,t){t.source.request(t.windowSize)}Zt(t,e),t.prototype._subscribe=function(e){return this.subscription=this.source.subscribe(new n(e,this,this.subscription)),new dr(this.subscription,Nr.schedule(this,r))};var n=function(e){function t(t,r,n){this.observer=t,this.observable=r,this.cancel=n,this.received=0,this.scheduleDisposable=null,e.call(this)}function r(e,t){t.observable.source.request(t.observable.windowSize)}return Zt(t,e),t.prototype.completed=function(){this.observer.onCompleted(),this.dispose()},t.prototype.error=function(e){this.observer.onError(e),this.dispose()},t.prototype.next=function(e){this.observer.onNext(e),this.received=++this.received%this.observable.windowSize,0===this.received&&(this.scheduleDisposable=Nr.schedule(this,r))},t.prototype.dispose=function(){this.observer=null,this.cancel&&(this.cancel.dispose(),this.cancel=null),this.scheduleDisposable&&(this.scheduleDisposable.dispose(),this.scheduleDisposable=null),e.prototype.dispose.call(this)},t}(Hr);return t}(Kr);Po.prototype.windowed=function(e){return new No(this,e)},zr.pipe=function(e){function t(){r.resume()}var r=this.pausableBuffered();return e.addListener("drain",t),r.subscribe(function(t){!e.write(String(t))&&r.pause()},function(t){e.emit("error",t)},function(){!e._isStdio&&e.end(),e.removeListener("drain",t)}),r.resume(),e};var Do=function(e){function t(t,r,n){this.source=t,this._fn1=r,this._fn2=n,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=this.source.multicast(this._fn1());return new dr(this._fn2(t).subscribe(e),t.connect())},t}(Yr);zr.multicast=function(e,t){return tt(e)?new Do(this,e,t):new jo(this,e)},zr.publish=function(e){return e&&tt(e)?this.multicast(function(){return new Ds},e):this.multicast(new Ds)},zr.share=function(){return this.publish().refCount()},zr.publishLast=function(e){return e&&tt(e)?this.multicast(function(){return new Ls},e):this.multicast(new Ls)},zr.publishValue=function(e,t){return 2===arguments.length?this.multicast(function(){return new Rs(t)},e):this.multicast(new Rs(e))},zr.shareValue=function(e){return this.publishValue(e).refCount()},zr.replay=function(e,t,r,n){return e&&tt(e)?this.multicast(function(){return new js(t,r,n)},e):this.multicast(new js(t,r,n))},zr.shareReplay=function(e,t,r){return this.replay(null,e,t,r).refCount()};var Lo=function(e,t){this._s=e,this._o=t};Lo.prototype.dispose=function(){if(!this._s.isDisposed&&null!==this._o){var e=this._s.observers.indexOf(this._o);this._s.observers.splice(e,1),this._o=null}};var Ro=function(e){function t(t){this.source=t,this._count=0,this._connectableSubscription=null,e.call(this)}function r(e,t){this._p=e,this._s=t,this.isDisposed=!1}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=this.source.subscribe(e);return 1===++this._count&&(this._connectableSubscription=this.source.connect()),new r(this,t)},r.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._s.dispose(),0===--this._p._count&&this._p._connectableSubscription.dispose())},t}(Yr),jo=$e.ConnectableObservable=function(e){function t(t,r){this.source=t,this._connection=null,this._source=t.asObservable(),this._subject=r,e.call(this)}function r(e,t){this._p=e,this._s=t}return Zt(t,e),r.prototype.dispose=function(){this._s&&(this._s.dispose(),this._s=null,this._p._connection=null)},t.prototype.connect=function(){if(!this._connection){var e=this._source.subscribe(this._subject);this._connection=new r(this,e)}return this._connection},t.prototype._subscribe=function(e){return this._subject.subscribe(e)},t.prototype.refCount=function(){return new Ro(this)},t}(Kr);zr.singleInstance=function(){function e(){return n||(n=!0,t=r["finally"](function(){n=!1}).publish().refCount()),t}var t,r=this,n=!1;return new Ps(function(t){return e().subscribe(t)})},zr.join=function(e,t,r,n){var i=this;return new Ps(function(o){var s=new ir,a=!1,u=!1,c=0,h=0,l=new qo,p=new qo,f=function(e){o.onError(e)};return s.add(i.subscribe(function(e){var r=c++,i=new pr;l.set(r,e),s.add(i);var u=nt(t)(e);return u===rt?o.onError(u.e):(i.setDisposable(u.take(1).subscribe(Xe,f,function(){l["delete"](r)&&0===l.size&&a&&o.onCompleted(),s.remove(i)})),void p.forEach(function(t){var r=nt(n)(e,t);return r===rt?o.onError(r.e):void o.onNext(r)}))},f,function(){a=!0,(u||0===l.size)&&o.onCompleted()})),s.add(e.subscribe(function(e){var t=h++,i=new pr;p.set(t,e),s.add(i);var a=nt(r)(e);return a===rt?o.onError(a.e):(i.setDisposable(a.take(1).subscribe(Xe,f,function(){p["delete"](t)&&0===p.size&&u&&o.onCompleted(),s.remove(i)})),void l.forEach(function(t){var r=nt(n)(t,e);return r===rt?o.onError(r.e):void o.onNext(r)}))},f,function(){u=!0,(a||0===p.size)&&o.onCompleted()})),s},i)},zr.groupJoin=function(e,t,r,n){var i=this;return new Ps(function(o){function s(e){}var a=new ir,u=new vr(a),c=new qo,h=new qo,l=0,p=0,s=function(e){return function(t){t.onError(e)}};return a.add(i.subscribe(function(e){var r=new Ds,i=l++;c.set(i,r);var p=nt(n)(e,tr(r,u));if(p===rt)return c.forEach(s(p.e)),o.onError(p.e);o.onNext(p),h.forEach(function(e){r.onNext(e)});var f=new pr;a.add(f);var d=nt(t)(e);return d===rt?(c.forEach(s(d.e)),o.onError(d.e)):void f.setDisposable(d.take(1).subscribe(Xe,function(e){c.forEach(s(e)),o.onError(e)},function(){c["delete"](i)&&r.onCompleted(),a.remove(f)}))},function(e){c.forEach(s(e)),o.onError(e)},function(){o.onCompleted()})),a.add(e.subscribe(function(e){var t=p++;h.set(t,e);var n=new pr;a.add(n);var i=nt(r)(e);return i===rt?(c.forEach(s(i.e)),o.onError(i.e)):(n.setDisposable(i.take(1).subscribe(Xe,function(e){c.forEach(s(e)),o.onError(e)},function(){h["delete"](t),a.remove(n)})),void c.forEach(function(t){t.onNext(e)}))},function(e){c.forEach(s(e)),o.onError(e)})),u},i)},zr.buffer=function(){return this.window.apply(this,arguments).flatMap(W)},zr.window=function(e,t){return 1===arguments.length&&"function"!=typeof arguments[0]?ve.call(this,e):"function"==typeof e?ge.call(this,e):me.call(this,e,t)};var Io=function(e){function t(t){this.source=t,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new Vo(e))},t}(Yr),Vo=function(e){function t(t){this._o=t,this._p=null,this._hp=!1,e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._hp?this._o.onNext([this._p,e]):this._hp=!0,this._p=e},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onCompleted()},t}(Hr);zr.pairwise=function(){return new Io(this)},zr.partition=function(e,t){var r=_t(e,t,3);return[this.filter(e,t),this.filter(function(e,t,n){return!r(e,t,n)})]};var Fo=function(e){function t(e,t){this.c=e,this.s=t}return Zt(t,e),t.prototype[mt]=function(){var e=this;return{next:function(){return e.c()?{done:!1,value:e.s}:{done:!0,value:void 0}}}},t}(Jr);zr.letBind=zr.let=function(e){return e(this)},Kr["if"]=function(e,t,r){return pn(function(){return r||(r=mn()),et(t)&&(t=cn(t)),et(r)&&(r=cn(r)),"function"==typeof r.now&&(r=mn(r)),e()?t:r})},Kr["for"]=Kr.forIn=function(e,t,r){return on(e,t,r).concat()};var Bo=Kr["while"]=Kr.whileDo=function(e,t){return et(t)&&(t=cn(t)),ye(e,t).concat()};zr.doWhile=function(e){return Bn([this,Bo(e,this)])},Kr["case"]=function(e,t,r){return pn(function(){et(r)&&(r=cn(r)),r||(r=mn()),br(r)&&(r=mn(r));var n=t[e()];return et(n)&&(n=cn(n)),n||r})};var Uo=function(e){function t(t,r,n){this.source=t,this._fn=r,this._scheduler=n,e.call(this)}function r(e,t){var r,n=e[0],i=e[1];if(!(n.q.length>0))return void(n.isAcquired=!1);r=n.q.shift();var o=new pr;n.d.add(o),o.setDisposable(r.subscribe(new Go(n,i,o))),t([n,i])}return Zt(t,e),t.prototype._ensureActive=function(e){var t=!1;e.q.length>0&&(t=!e.isAcquired,e.isAcquired=!0),t&&e.m.setDisposable(this._scheduler.scheduleRecursive([e,this],r))},t.prototype.subscribeCore=function(e){var t=new fr,r=new ir(t),n={q:[],m:t,d:r,activeCount:0,isAcquired:!1,o:e};return n.q.push(this.source),n.activeCount++,this._ensureActive(n),r},t}(Yr),Go=function(e){function t(t,r,n){this._s=t,this._p=r,this._m1=n,e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._s.o.onNext(e);var t=nt(this._p._fn)(e);return t===rt?this._s.o.onError(t.e):(this._s.q.push(t),this._s.activeCount++,void this._p._ensureActive(this._s))},t.prototype.error=function(e){this._s.o.onError(e)},t.prototype.completed=function(){this._s.d.remove(this._m1),this._s.activeCount--,0===this._s.activeCount&&this._s.o.onCompleted()},t}(Hr);zr.expand=function(e,t){return br(t)||(t=Tr),new Uo(this,e,t)};var zo=function(e){function t(t,r){this._sources=t,this._cb=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){if(0===this._sources.length)return e.onCompleted(),ur;for(var t=this._sources.length,r={finished:!1,hasResults:new Array(t),hasCompleted:new Array(t),results:new Array(t)},n=new ir,i=0,o=this._sources.length;o>i;i++){var s=this._sources[i];et(s)&&(s=cn(s)),n.add(s.subscribe(new Ho(e,r,i,this._cb,n)))}return n},t}(Yr),Ho=function(e){function t(t,r,n,i,o){this._o=t,this._s=r,this._i=n,this._cb=i,this._subs=o,e.call(this)}return Zt(t,e),
t.prototype.next=function(e){this._s.finished||(this._s.hasResults[this._i]=!0,this._s.results[this._i]=e)},t.prototype.error=function(e){this._s.finished=!0,this._o.onError(e),this._subs.dispose()},t.prototype.completed=function(){if(!this._s.finished){if(!this._s.hasResults[this._i])return this._o.onCompleted();this._s.hasCompleted[this._i]=!0;for(var e=0;e<this._s.results.length;e++)if(!this._s.hasCompleted[e])return;this._s.finished=!0;var t=nt(this._cb).apply(null,this._s.results);if(t===rt)return this._o.onError(t.e);this._o.onNext(t),this._o.onCompleted()}},t}(Hr);Kr.forkJoin=function(){for(var e=arguments.length,t=new Array(e),r=0;e>r;r++)t[r]=arguments[r];var n=tt(t[e-1])?t.pop():G;return Array.isArray(t[0])&&(t=t[0]),new zo(t,n)},zr.forkJoin=function(){for(var e=arguments.length,t=new Array(e),r=0;e>r;r++)t[r]=arguments[r];return Array.isArray(t[0])?t[0].unshift(this):t.unshift(this),Kr.forkJoin.apply(null,t)},zr.manySelect=zr.extend=function(e,t){br(t)||(t=$e.Scheduler.immediate);var r=this;return pn(function(){var n;return r.map(function(e){var t=new Wo(e);return n&&n.onNext(e),n=t,t}).tap(Xe,function(e){n&&n.onError(e)},function(){n&&n.onCompleted()}).observeOn(t).map(e)},r)};var Wo=function(e){function t(t){e.call(this),this.head=t,this.tail=new Ls}return Zt(t,e),er(t.prototype,Ur,{_subscribe:function(e){var t=new ir;return t.add(Tr.schedule(this,function(r,n){e.onNext(n.head),t.add(n.tail.mergeAll().subscribe(e))})),t},onCompleted:function(){this.onNext(Kr.empty())},onError:function(e){this.onNext(Kr["throw"](e))},onNext:function(e){this.tail.onNext(e),this.tail.onCompleted()}}),t}(Kr),qo=qe.Map||function(){function e(){this.size=0,this._values=[],this._keys=[]}return e.prototype["delete"]=function(e){var t=this._keys.indexOf(e);return-1===t?!1:(this._values.splice(t,1),this._keys.splice(t,1),this.size--,!0)},e.prototype.get=function(e){var t=this._keys.indexOf(e);return-1===t?o:this._values[t]},e.prototype.set=function(e,t){var r=this._keys.indexOf(e);return-1===r?(this._keys.push(e),this._values.push(t),this.size++):this._values[r]=t,this},e.prototype.forEach=function(e,t){for(var r=0;r<this.size;r++)e.call(t,this._values[r],this._keys[r])},e}();_e.prototype.and=function(e){return new _e(this.patterns.concat(e))},_e.prototype.thenDo=function(e){return new be(this,e)},be.prototype.activate=function(e,t,r){for(var n=[],i=xe(t),o=0,s=this.expression.patterns.length;s>o;o++)n.push(Se(e,this.expression.patterns[o],i));var a=new Me(n,we(this,t),function(){for(var e=0,t=n.length;t>e;e++)n[e].removeActivePlan(a);r(a)});for(o=0,s=n.length;s>o;o++)n[o].addActivePlan(a);return a},Me.prototype.dequeue=function(){this.joinObservers.forEach(function(e){e.queue.shift()})},Me.prototype.match=function(){var e,t,r=!0;for(e=0,t=this.joinObserverArray.length;t>e;e++)if(0===this.joinObserverArray[e].queue.length){r=!1;break}if(r){var n=[],i=!1;for(e=0,t=this.joinObserverArray.length;t>e;e++)n.push(this.joinObserverArray[e].queue[0]),"C"===this.joinObserverArray[e].queue[0].kind&&(i=!0);if(i)this.onCompleted();else{this.dequeue();var o=[];for(e=0,t=n.length;e<n.length;e++)o.push(n[e].value);this.onNext.apply(this,o)}}};var $o=function(e){function t(t,r){e.call(this),this.source=t,this.onError=r,this.queue=[],this.activePlans=[],this.subscription=new pr,this.isDisposed=!1}Zt(t,e);var r=t.prototype;return r.next=function(e){if(!this.isDisposed){if("E"===e.kind)return this.onError(e.error);this.queue.push(e);for(var t=this.activePlans.slice(0),r=0,n=t.length;n>r;r++)t[r].match()}},r.error=Xe,r.completed=Xe,r.addActivePlan=function(e){this.activePlans.push(e)},r.subscribe=function(){this.subscription.setDisposable(this.source.materialize().subscribe(this))},r.removeActivePlan=function(e){this.activePlans.splice(this.activePlans.indexOf(e),1),0===this.activePlans.length&&this.dispose()},r.dispose=function(){e.prototype.dispose.call(this),this.isDisposed||(this.isDisposed=!0,this.subscription.dispose())},t}(Hr);zr.and=function(e){return new _e([this,e])},zr.thenDo=function(e){return new _e([this]).thenDo(e)},Kr.when=function(){var e,t=arguments.length;if(Array.isArray(arguments[0]))e=arguments[0];else{e=new Array(t);for(var r=0;t>r;r++)e[r]=arguments[r]}return new Ps(function(t){var r=[],n=new qo,i=Gr(function(e){t.onNext(e)},function(e){n.forEach(function(t){t.onError(e)}),t.onError(e)},function(e){t.onCompleted()});try{for(var o=0,s=e.length;s>o;o++)r.push(e[o].activate(n,i,function(e){var n=r.indexOf(e);r.splice(n,1),0===r.length&&t.onCompleted()}))}catch(a){return kn(a).subscribe(t)}var u=new ir;return n.forEach(function(e){e.subscribe(),u.add(e)}),u})};var Xo=function(e){function t(t,r){this._dt=t,this._s=r,e.call(this)}function r(e,t){t.onNext(0),t.onCompleted()}return Zt(t,e),t.prototype.subscribeCore=function(e){return this._s.scheduleFuture(e,this._dt,r)},t}(Yr),Ko=Kr.interval=function(e,t){return Te(e,e,br(t)?t:Nr)};Kr.timer=function(e,t,r){var n;return br(r)||(r=Nr),null!=t&&"number"==typeof t?n=t:br(t)&&(r=t),(e instanceof Date||"number"==typeof e)&&n===o?Ee(e,r):e instanceof Date&&n!==o?Ce(e,t,r):Te(e,n,r)},zr.delay=function(){var e=arguments[0];if("number"==typeof e||e instanceof Date){var t=e,r=arguments[1];return br(r)||(r=Nr),t instanceof Date?Pe(this,t,r):Ae(this,t,r)}if(Kr.isObservable(e)||tt(e))return ke(this,e,arguments[1]);throw new Error("Invalid arguments")};var Yo=function(e){function t(t,r,n){br(n)||(n=Nr),this.source=t,this._dt=r,this._s=n,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=new fr;return new dr(this.source.subscribe(new Qo(e,this._dt,this._s,t)),t)},t}(Yr),Qo=function(e){function t(t,r,n,i){this._o=t,this._d=r,this._scheduler=n,this._c=i,this._v=null,this._hv=!1,this._id=0,e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._hv=!0,this._v=e;var t=++this._id,r=new pr;this._c.setDisposable(r),r.setDisposable(this._scheduler.scheduleFuture(this,this._d,function(r,n){n._hv&&n._id===t&&n._o.onNext(e),n._hv=!1}))},t.prototype.error=function(e){this._c.dispose(),this._o.onError(e),this._hv=!1,this._id++},t.prototype.completed=function(){this._c.dispose(),this._hv&&this._o.onNext(this._v),this._o.onCompleted(),this._hv=!1,this._id++},t}(Hr);zr.debounce=function(){if(tt(arguments[0]))return Oe(this,arguments[0]);if("number"==typeof arguments[0])return new Yo(this,arguments[0],arguments[1]);throw new Error("Invalid arguments")},zr.windowWithTime=function(e,t,r){var n,i=this;return null==t&&(n=e),br(r)||(r=Nr),"number"==typeof t?n=t:br(t)&&(n=e,r=t),new Ps(function(t){function o(){var e=new pr,i=!1,s=!1;l.setDisposable(e),c===u?(i=!0,s=!0):u>c?i=!0:s=!0;var f=i?c:u,d=f-p;p=f,i&&(c+=n),s&&(u+=n),e.setDisposable(r.scheduleFuture(null,d,function(){if(s){var e=new Ds;h.push(e),t.onNext(tr(e,a))}i&&h.shift().onCompleted(),o()}))}var s,a,u=n,c=e,h=[],l=new fr,p=0;return s=new ir(l),a=new vr(s),h.push(new Ds),t.onNext(tr(h[0],a)),o(),s.add(i.subscribe(function(e){for(var t=0,r=h.length;r>t;t++)h[t].onNext(e)},function(e){for(var r=0,n=h.length;n>r;r++)h[r].onError(e);t.onError(e)},function(){for(var e=0,r=h.length;r>e;e++)h[e].onCompleted();t.onCompleted()})),a},i)},zr.windowWithTimeOrCount=function(e,t,r){var n=this;return br(r)||(r=Nr),new Ps(function(i){function o(t){var n=new pr;s.setDisposable(n),n.setDisposable(r.scheduleFuture(null,e,function(){if(t===h){c=0;var e=++h;l.onCompleted(),l=new Ds,i.onNext(tr(l,u)),o(e)}}))}var s=new fr,a=new ir(s),u=new vr(a),c=0,h=0,l=new Ds;return i.onNext(tr(l,u)),o(0),a.add(n.subscribe(function(e){var r=0,n=!1;l.onNext(e),++c===t&&(n=!0,c=0,r=++h,l.onCompleted(),l=new Ds,i.onNext(tr(l,u))),n&&o(r)},function(e){l.onError(e),i.onError(e)},function(){l.onCompleted(),i.onCompleted()})),u},n)},zr.bufferWithTime=function(e,t,r){return this.windowWithTime(e,t,r).flatMap(W)},zr.bufferWithTimeOrCount=function(e,t,r){return this.windowWithTimeOrCount(e,t,r).flatMap(W)};var Jo=function(e){function t(t,r){this.source=t,this._s=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new Zo(e,this._s))},t}(Yr),Zo=function(e){function t(t,r){this._o=t,this._s=r,this._l=r.now(),e.call(this)}return Zt(t,e),t.prototype.next=function(e){var t=this._s.now(),r=t-this._l;this._l=t,this._o.onNext({value:e,interval:r})},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onCompleted()},t}(Hr);zr.timeInterval=function(e){return br(e)||(e=Nr),new Jo(this,e)};var es=function(e){function t(t,r){this.source=t,this._s=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new ts(e,this._s))},t}(Yr),ts=function(e){function t(t,r){this._o=t,this._s=r,e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._o.onNext({value:e,timestamp:this._s.now()})},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onCompleted()},t}(Hr);zr.timestamp=function(e){return br(e)||(e=Nr),new es(this,e)};var rs=function(e){function t(t,r){this.source=t,this._sampler=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){var t={o:e,atEnd:!1,value:null,hasValue:!1,sourceSubscription:new pr};return t.sourceSubscription.setDisposable(this.source.subscribe(new is(t))),new dr(t.sourceSubscription,this._sampler.subscribe(new ns(t)))},t}(Yr),ns=function(e){function t(t){this._s=t,e.call(this)}return Zt(t,e),t.prototype._handleMessage=function(){this._s.hasValue&&(this._s.hasValue=!1,this._s.o.onNext(this._s.value)),this._s.atEnd&&this._s.o.onCompleted()},t.prototype.next=function(){this._handleMessage()},t.prototype.error=function(e){this._s.onError(e)},t.prototype.completed=function(){this._handleMessage()},t}(Hr),is=function(e){function t(t){this._s=t,e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._s.hasValue=!0,this._s.value=e},t.prototype.error=function(e){this._s.o.onError(e)},t.prototype.completed=function(){this._s.atEnd=!0,this._s.sourceSubscription.dispose()},t}(Hr);zr.sample=function(e,t){return br(t)||(t=Nr),"number"==typeof e?new rs(this,Ko(e,t)):new rs(this,e)};var os=$e.TimeoutError=function(e){this.message=e||"Timeout has occurred",this.name="TimeoutError",Error.call(this)};os.prototype=Object.create(Error.prototype),zr.timeout=function(){var e=arguments[0];if(e instanceof Date||"number"==typeof e)return De(this,e,arguments[1],arguments[2]);if(Kr.isObservable(e)||tt(e))return Ne(this,e,arguments[1],arguments[2]);throw new Error("Invalid arguments")};var ss=function(e){function t(t,r,n,i,o,s){this._state=t,this._cndFn=r,this._itrFn=n,this._resFn=i,this._timeFn=o,this._s=s,e.call(this)}function r(e,t){if(e.hasResult&&e.o.onNext(e.result),e.first)e.first=!1;else if(e.newState=nt(e.self._itrFn)(e.newState),e.newState===rt)return e.o.onError(e.newState.e);if(e.hasResult=nt(e.self._cndFn)(e.newState),e.hasResult===rt)return e.o.onError(e.hasResult.e);if(e.hasResult){if(e.result=nt(e.self._resFn)(e.newState),e.result===rt)return e.o.onError(e.result.e);var r=nt(e.self._timeFn)(e.newState);if(r===rt)return e.o.onError(r.e);t(e,r)}else e.o.onCompleted()}return Zt(t,e),t.prototype.subscribeCore=function(e){var t={o:e,self:this,newState:this._state,first:!0,hasResult:!1};return this._s.scheduleRecursiveFuture(t,new Date(this._s.now()),r)},t}(Yr);Kr.generateWithAbsoluteTime=function(e,t,r,n,i,o){return br(o)||(o=Nr),new ss(e,t,r,n,i,o)};var as=function(e){function t(t,r,n,i,o,s){this._state=t,this._cndFn=r,this._itrFn=n,this._resFn=i,this._timeFn=o,this._s=s,e.call(this)}function r(e,t){if(e.hasResult&&e.o.onNext(e.result),e.first)e.first=!1;else if(e.newState=nt(e.self._itrFn)(e.newState),e.newState===rt)return e.o.onError(e.newState.e);if(e.hasResult=nt(e.self._cndFn)(e.newState),e.hasResult===rt)return e.o.onError(e.hasResult.e);if(e.hasResult){if(e.result=nt(e.self._resFn)(e.newState),e.result===rt)return e.o.onError(e.result.e);var r=nt(e.self._timeFn)(e.newState);if(r===rt)return e.o.onError(r.e);t(e,r)}else e.o.onCompleted()}return Zt(t,e),t.prototype.subscribeCore=function(e){var t={o:e,self:this,newState:this._state,first:!0,hasResult:!1};return this._s.scheduleRecursiveFuture(t,0,r)},t}(Yr);Kr.generateWithRelativeTime=function(e,t,r,n,i,o){return br(o)||(o=Nr),new as(e,t,r,n,i,o)};var us=function(e){function t(t,r,n){this.source=t,this._dt=r,this._s=n,e.call(this)}function r(e,t){var r=t[0],n=t[1],i=t[2];i.setDisposable(r.subscribe(n))}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=new fr;return t.setDisposable(this._s.scheduleFuture([this.source,e,t],this._dt,r)),t},t}(Yr);zr.delaySubscription=function(e,t){return br(t)||(t=Nr),new us(this,e,t)};var cs=function(e){function t(t,r,n){this.source=t,this._d=r,this._s=n,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new hs(e,this))},t}(Yr),hs=function(e){function t(t,r){this._o=t,this._s=r._s,this._d=r._d,this._q=[],e.call(this)}return Zt(t,e),t.prototype.next=function(e){var t=this._s.now();for(this._q.push({interval:t,value:e});this._q.length>0&&t-this._q[0].interval>=this._d;)this._o.onNext(this._q.shift().value)},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){for(var e=this._s.now();this._q.length>0&&e-this._q[0].interval>=this._d;)this._o.onNext(this._q.shift().value);this._o.onCompleted()},t}(Hr);zr.skipLastWithTime=function(e,t){return br(t)||(t=Nr),new cs(this,e,t)};var ls=function(e){function t(t,r,n){this.source=t,this._d=r,this._s=n,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return this.source.subscribe(new ps(e,this._d,this._s))},t}(Yr),ps=function(e){function t(t,r,n){this._o=t,this._d=r,this._s=n,this._q=[],e.call(this)}return Zt(t,e),t.prototype.next=function(e){var t=this._s.now();for(this._q.push({interval:t,value:e});this._q.length>0&&t-this._q[0].interval>=this._d;)this._q.shift()},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){for(var e=this._s.now();this._q.length>0;){var t=this._q.shift();e-t.interval<=this._d&&this._o.onNext(t.value)}this._o.onCompleted()},t}(Hr);zr.takeLastWithTime=function(e,t){return br(t)||(t=Nr),new ls(this,e,t)},zr.takeLastBufferWithTime=function(e,t){var r=this;return br(t)||(t=Nr),new Ps(function(n){var i=[];return r.subscribe(function(r){var n=t.now();for(i.push({interval:n,value:r});i.length>0&&n-i[0].interval>=e;)i.shift()},function(e){n.onError(e)},function(){for(var r=t.now(),o=[];i.length>0;){var s=i.shift();r-s.interval<=e&&o.push(s.value)}n.onNext(o),n.onCompleted()})},r)};var fs=function(e){function t(t,r,n){this.source=t,this._d=r,this._s=n,e.call(this)}function r(e,t){t.onCompleted()}return Zt(t,e),t.prototype.subscribeCore=function(e){return new dr(this._s.scheduleFuture(e,this._d,r),this.source.subscribe(e))},t}(Yr);zr.takeWithTime=function(e,t){return br(t)||(t=Nr),new fs(this,e,t)};var ds=function(e){function t(t,r,n){this.source=t,this._d=r,this._s=n,this._open=!1,e.call(this)}function r(e,t){t._open=!0}return Zt(t,e),t.prototype.subscribeCore=function(e){return new dr(this._s.scheduleFuture(this,this._d,r),this.source.subscribe(new ms(e,this)))},t}(Yr),ms=function(e){function t(t,r){this._o=t,this._p=r,e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._p._open&&this._o.onNext(e)},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onCompleted()},t}(Hr);zr.skipWithTime=function(e,t){return br(t)||(t=Nr),new ds(this,e,t)};var vs=function(e){function t(t,r,n){this.source=t,this._st=r,this._s=n,e.call(this)}function r(e,t){t._open=!0}return Zt(t,e),t.prototype.subscribeCore=function(e){return this._open=!1,new dr(this._s.scheduleFuture(this,this._st,r),this.source.subscribe(new gs(e,this)))},t}(Yr),gs=function(e){function t(t,r){this._o=t,this._p=r,e.call(this)}return Zt(t,e),t.prototype.next=function(e){this._p._open&&this._o.onNext(e)},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._o.onCompleted()},t}(Hr);zr.skipUntilWithTime=function(e,t){return br(t)||(t=Nr),new vs(this,e,t)},zr.takeUntilWithTime=function(e,t){br(t)||(t=Nr);var r=this;return new Ps(function(n){return new dr(t.scheduleFuture(n,e,function(e,t){t.onCompleted()}),r.subscribe(n))},r)},zr.throttle=function(e,t){br(t)||(t=Nr);var r=+e||0;if(0>=r)throw new RangeError("windowDuration cannot be less or equal zero.");var n=this;return new Ps(function(e){var i=0;return n.subscribe(function(n){var o=t.now();(0===i||o-i>=r)&&(i=o,e.onNext(n))},function(t){e.onError(t)},function(){e.onCompleted()})},n)};var ys=function(e){function t(t,r){this._o=t,this._xform=r,e.call(this)}return Zt(t,e),t.prototype.next=function(e){var t=nt(this._xform["@@transducer/step"]).call(this._xform,this._o,e);t===rt&&this._o.onError(t.e)},t.prototype.error=function(e){this._o.onError(e)},t.prototype.completed=function(){this._xform["@@transducer/result"](this._o)},t}(Hr);zr.transduce=function(e){var t=this;return new Ps(function(r){var n=e(Le(r));return t.subscribe(new ys(r,n))},t)};var _s=function(e){function t(t){this.source=t,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){var t=new pr,r=new ir,n={hasCurrent:!1,isStopped:!1,o:e,g:r};return r.add(t),t.setDisposable(this.source.subscribe(new bs(n))),r},t}(Yr),bs=function(e){function t(t){this._s=t,e.call(this)}function r(t,r){this._s=t,this._i=r,e.call(this)}return Zt(t,e),t.prototype.next=function(e){if(!this._s.hasCurrent){this._s.hasCurrent=!0,et(e)&&(e=cn(e));var t=new pr;this._s.g.add(t),t.setDisposable(e.subscribe(new r(this._s,t)))}},t.prototype.error=function(e){this._s.o.onError(e)},t.prototype.completed=function(){this._s.isStopped=!0,!this._s.hasCurrent&&1===this._s.g.length&&this._s.o.onCompleted()},Zt(r,e),r.prototype.next=function(e){this._s.o.onNext(e)},r.prototype.error=function(e){this._s.o.onError(e)},r.prototype.completed=function(){this._s.g.remove(this._i),this._s.hasCurrent=!1,this._s.isStopped&&1===this._s.g.length&&this._s.o.onCompleted()},t}(Hr);zr.switchFirst=function(){return new _s(this)},zr.flatMapFirst=zr.selectManyFirst=function(e,t,r){return new Qr(this,e,t,r).switchFirst()},$e.Observable.prototype.flatMapWithMaxConcurrent=function(e,t,r,n){return new Qr(this,t,r,n).merge(e)};var xs=$e.VirtualTimeScheduler=function(e){function t(t,r){this.clock=t,this.comparer=r,this.isEnabled=!1,this.queue=new rr(1024),e.call(this)}Zt(t,e);var r=t.prototype;return r.now=function(){return this.toAbsoluteTime(this.clock)},r.schedule=function(e,t){return this.scheduleAbsolute(e,this.clock,t)},r.scheduleFuture=function(e,t,r){var n=t instanceof Date?this.toRelativeTime(t-this.now()):this.toRelativeTime(t);return this.scheduleRelative(e,n,r)},r.add=dt,r.toAbsoluteTime=dt,r.toRelativeTime=dt,r.schedulePeriodic=function(e,t,r){var n=new Sr(this,e,t,r);return n.start()},r.scheduleRelative=function(e,t,r){var n=this.add(this.clock,t);return this.scheduleAbsolute(e,n,r)},r.start=function(){if(!this.isEnabled){this.isEnabled=!0;do{var e=this.getNext();null!==e?(this.comparer(e.dueTime,this.clock)>0&&(this.clock=e.dueTime),e.invoke()):this.isEnabled=!1}while(this.isEnabled)}},r.stop=function(){this.isEnabled=!1},r.advanceTo=function(e){var t=this.comparer(this.clock,e);if(this.comparer(this.clock,e)>0)throw new lt;if(0!==t&&!this.isEnabled){this.isEnabled=!0;do{var r=this.getNext();null!==r&&this.comparer(r.dueTime,e)<=0?(this.comparer(r.dueTime,this.clock)>0&&(this.clock=r.dueTime),r.invoke()):this.isEnabled=!1}while(this.isEnabled);this.clock=e}},r.advanceBy=function(e){var t=this.add(this.clock,e),r=this.comparer(this.clock,t);if(r>0)throw new lt;0!==r&&this.advanceTo(t)},r.sleep=function(e){var t=this.add(this.clock,e);if(this.comparer(this.clock,t)>=0)throw new lt;this.clock=t},r.getNext=function(){for(;this.queue.length>0;){var e=this.queue.peek();if(!e.isCancelled())return e;this.queue.dequeue()}return null},r.scheduleAbsolute=function(e,t,r){function n(e,t){return i.queue.remove(o),r(e,t)}var i=this,o=new gr(this,e,n,t,this.comparer);return this.queue.enqueue(o),o.disposable},t}(yr);$e.HistoricalScheduler=function(e){function t(t,r){var n=null==t?0:t,i=r||Je;e.call(this,n,i)}Zt(t,e);var r=t.prototype;return r.add=function(e,t){return e+t},r.toAbsoluteTime=function(e){return new Date(e).getTime()},r.toRelativeTime=function(e){return e},t}($e.VirtualTimeScheduler),Re.prototype.equals=function(e){return e===this?!0:null==e?!1:"N"!==e.kind?!1:this.predicate(e.value)},je.prototype.equals=function(e){return e===this?!0:null==e?!1:"E"!==e.kind?!1:this.predicate(e.error)};var ws=$e.ReactiveTest={created:100,subscribed:200,disposed:1e3,onNext:function(e,t){return"function"==typeof t?new Ss(e,new Re(t)):new Ss(e,Lr.createOnNext(t))},onError:function(e,t){return"function"==typeof t?new Ss(e,new je(t)):new Ss(e,Lr.createOnError(t))},onCompleted:function(e){return new Ss(e,Lr.createOnCompleted())},subscribe:function(e,t){return new Ms(e,t)}},Ss=$e.Recorded=function(e,t,r){this.time=e,this.value=t,this.comparer=r||Qe};Ss.prototype.equals=function(e){return this.time===e.time&&this.comparer(this.value,e.value)},Ss.prototype.toString=function(){return this.value.toString()+"@"+this.time};var Ms=$e.Subscription=function(e,t){this.subscribe=e,this.unsubscribe=t||Number.MAX_VALUE};Ms.prototype.equals=function(e){return this.subscribe===e.subscribe&&this.unsubscribe===e.unsubscribe},Ms.prototype.toString=function(){return"("+this.subscribe+", "+(this.unsubscribe===Number.MAX_VALUE?"Infinite":this.unsubscribe)+")"};var Es=$e.MockDisposable=function(e){this.scheduler=e,this.disposes=[],this.disposes.push(this.scheduler.clock)};Es.prototype.dispose=function(){this.disposes.push(this.scheduler.clock)};var Cs=function(e){function t(t){e.call(this),this.scheduler=t,this.messages=[]}Zt(t,e);var r=t.prototype;return r.onNext=function(e){this.messages.push(new Ss(this.scheduler.clock,Lr.createOnNext(e)))},r.onError=function(e){this.messages.push(new Ss(this.scheduler.clock,Lr.createOnError(e)))},r.onCompleted=function(){this.messages.push(new Ss(this.scheduler.clock,Lr.createOnCompleted()))},t}(Ur);Ie.prototype.then=function(e,t){var r=this;this.subscriptions.push(new Ms(this.scheduler.clock));var n,i=this.subscriptions.length-1,s=$e.Observer.create(function(t){var a=e(t);if(a&&"function"==typeof a.then)n=a;else{var u=r.scheduler.clock;n=new Ie(r.scheduler,[$e.ReactiveTest.onNext(u,o),$e.ReactiveTest.onCompleted(u)])}var c=r.observers.indexOf(s);r.observers.splice(c,1),r.subscriptions[i]=new Ms(r.subscriptions[i].subscribe,r.scheduler.clock)},function(e){t(e);var n=r.observers.indexOf(s);r.observers.splice(n,1),r.subscriptions[i]=new Ms(r.subscriptions[i].subscribe,r.scheduler.clock)});return this.observers.push(s),n||new Ie(this.scheduler,this.messages)};var Ts=function(e){function t(t,r){e.call(this);var n,i,o=this;this.scheduler=t,this.messages=r,this.subscriptions=[],this.observers=[];for(var s=0,a=this.messages.length;a>s;s++)n=this.messages[s],i=n.value,function(e){t.scheduleAbsolute(null,n.time,function(){for(var t=o.observers.slice(0),r=0,n=t.length;n>r;r++)e.accept(t[r]);return ur})}(i)}return Zt(t,e),t.prototype._subscribe=function(e){var t=this;this.observers.push(e),this.subscriptions.push(new Ms(this.scheduler.clock));var r=this.subscriptions.length-1;return ar(function(){var n=t.observers.indexOf(e);t.observers.splice(n,1),t.subscriptions[r]=new Ms(t.subscriptions[r].subscribe,t.scheduler.clock)})},t}(Kr),As=function(e){function t(t,r){e.call(this),this.scheduler=t,this.messages=r,this.subscriptions=[]}return Zt(t,e),t.prototype._subscribe=function(e){var t,r,n=this;this.subscriptions.push(new Ms(this.scheduler.clock));for(var i=this.subscriptions.length-1,o=new ir,s=0,a=this.messages.length;a>s;s++)t=this.messages[s],r=t.value,function(r){o.add(n.scheduler.scheduleRelative(null,t.time,function(){return r.accept(e),ur}))}(r);return ar(function(){n.subscriptions[i]=new Ms(n.subscriptions[i].subscribe,n.scheduler.clock),o.dispose()})},t}(Kr);$e.TestScheduler=function(e){function t(e,t){return e>t?1:t>e?-1:0}function r(){e.call(this,0,t)}return Zt(r,e),r.prototype.scheduleAbsolute=function(t,r,n){return r<=this.clock&&(r=this.clock+1),e.prototype.scheduleAbsolute.call(this,t,r,n)},r.prototype.add=function(e,t){return e+t},r.prototype.toAbsoluteTime=function(e){return new Date(e).getTime()},r.prototype.toRelativeTime=function(e){return e},r.prototype.startScheduler=function(e,t){t||(t={}),null==t.created&&(t.created=ws.created),null==t.subscribed&&(t.subscribed=ws.subscribed),null==t.disposed&&(t.disposed=ws.disposed);var r,n,i=this.createObserver();return this.scheduleAbsolute(null,t.created,function(){return r=e(),ur}),this.scheduleAbsolute(null,t.subscribed,function(){return n=r.subscribe(i),ur}),this.scheduleAbsolute(null,t.disposed,function(){return n.dispose(),ur}),this.start(),i},r.prototype.createHotObservable=function(){var e,t=arguments.length;if(Array.isArray(arguments[0]))e=arguments[0];else{e=new Array(t);for(var r=0;t>r;r++)e[r]=arguments[r]}return new Ts(this,e)},r.prototype.createColdObservable=function(){var e,t=arguments.length;if(Array.isArray(arguments[0]))e=arguments[0];else{e=new Array(t);for(var r=0;t>r;r++)e[r]=arguments[r]}return new As(this,e)},r.prototype.createResolvedPromise=function(e,t){return new Ie(this,[$e.ReactiveTest.onNext(e,t),$e.ReactiveTest.onCompleted(e)])},r.prototype.createRejectedPromise=function(e,t){return new Ie(this,[$e.ReactiveTest.onError(e,t)])},r.prototype.createObserver=function(){return new Cs(this)},r}(xs);var Ps=$e.AnonymousObservable=function(e){function t(e){return e&&tt(e.dispose)?e:tt(e)?ar(e):ur}function r(e,r){var n=r[0],i=r[1],o=nt(i.__subscribe).call(i,n);o!==rt||n.fail(rt.e)||c(rt.e),n.setDisposable(t(o))}function n(t,r){this.source=r,this.__subscribe=t,e.call(this)}return Zt(n,e),n.prototype._subscribe=function(e){var t=new ks(e),n=[t,this];return Tr.scheduleRequired()?Tr.schedule(n,r):r(null,n),t},n}(Kr),ks=function(e){function t(t){e.call(this),this.observer=t,this.m=new pr}Zt(t,e);var r=t.prototype;return r.next=function(e){var t=nt(this.observer.onNext).call(this.observer,e);t===rt&&(this.dispose(),c(t.e))},r.error=function(e){var t=nt(this.observer.onError).call(this.observer,e);this.dispose(),t===rt&&c(t.e)},r.completed=function(){var e=nt(this.observer.onCompleted).call(this.observer);this.dispose(),e===rt&&c(e.e)},r.setDisposable=function(e){this.m.setDisposable(e)},r.getDisposable=function(){return this.m.getDisposable()},r.dispose=function(){e.prototype.dispose.call(this),this.m.dispose()},t}(Hr),Os=function(e){function t(t,r){this._m=t,this._u=r,e.call(this)}return Zt(t,e),t.prototype.subscribeCore=function(e){return new dr(this._m.getDisposable(),this._u.subscribe(e))},t}(Yr),Ns=function(e){function t(t,r,n){e.call(this),this.key=t,this.underlyingObservable=n?new Os(n,r):r}return Zt(t,e),t.prototype._subscribe=function(e){return this.underlyingObservable.subscribe(e)},t}(Kr),Ds=$e.Subject=function(e){function t(){e.call(this),this.isDisposed=!1,this.isStopped=!1,this.observers=[],this.hasError=!1}return Zt(t,e),er(t.prototype,Ur.prototype,{_subscribe:function(e){return hr(this),this.isStopped?this.hasError?(e.onError(this.error),ur):(e.onCompleted(),ur):(this.observers.push(e),new Lo(this,e))},hasObservers:function(){return hr(this),this.observers.length>0},onCompleted:function(){if(hr(this),!this.isStopped){this.isStopped=!0;for(var e=0,t=a(this.observers),r=t.length;r>e;e++)t[e].onCompleted();this.observers.length=0}},onError:function(e){if(hr(this),!this.isStopped){this.isStopped=!0,this.error=e,this.hasError=!0;for(var t=0,r=a(this.observers),n=r.length;n>t;t++)r[t].onError(e);this.observers.length=0}},onNext:function(e){if(hr(this),!this.isStopped)for(var t=0,r=a(this.observers),n=r.length;n>t;t++)r[t].onNext(e)},dispose:function(){this.isDisposed=!0,this.observers=null}}),t.create=function(e,t){return new Is(e,t)},t}(Kr),Ls=$e.AsyncSubject=function(e){function t(){e.call(this),this.isDisposed=!1,this.isStopped=!1,this.hasValue=!1,this.observers=[],this.hasError=!1}return Zt(t,e),er(t.prototype,Ur.prototype,{_subscribe:function(e){return hr(this),this.isStopped?(this.hasError?e.onError(this.error):this.hasValue?(e.onNext(this.value),e.onCompleted()):e.onCompleted(),ur):(this.observers.push(e),new Lo(this,e))},hasObservers:function(){return hr(this),this.observers.length>0},onCompleted:function(){var e,t;if(hr(this),!this.isStopped){this.isStopped=!0;var r=a(this.observers),t=r.length;if(this.hasValue)for(e=0;t>e;e++){var n=r[e];n.onNext(this.value),n.onCompleted()}else for(e=0;t>e;e++)r[e].onCompleted();this.observers.length=0}},onError:function(e){if(hr(this),!this.isStopped){this.isStopped=!0,this.hasError=!0,this.error=e;for(var t=0,r=a(this.observers),n=r.length;n>t;t++)r[t].onError(e);this.observers.length=0}},onNext:function(e){hr(this),this.isStopped||(this.value=e,this.hasValue=!0)},dispose:function(){this.isDisposed=!0,this.observers=null,this.error=null,this.value=null}}),t}(Kr),Rs=$e.BehaviorSubject=function(e){function t(t){e.call(this),this.value=t,this.observers=[],this.isDisposed=!1,this.isStopped=!1,this.hasError=!1}return Zt(t,e),er(t.prototype,Ur.prototype,{_subscribe:function(e){return hr(this),this.isStopped?(this.hasError?e.onError(this.error):e.onCompleted(),ur):(this.observers.push(e),e.onNext(this.value),new Lo(this,e))},getValue:function(){return hr(this),this.hasError&&c(this.error),this.value},hasObservers:function(){return hr(this),this.observers.length>0},onCompleted:function(){if(hr(this),!this.isStopped){this.isStopped=!0;for(var e=0,t=a(this.observers),r=t.length;r>e;e++)t[e].onCompleted();this.observers.length=0}},onError:function(e){if(hr(this),!this.isStopped){this.isStopped=!0,this.hasError=!0,this.error=e;for(var t=0,r=a(this.observers),n=r.length;n>t;t++)r[t].onError(e);this.observers.length=0}},onNext:function(e){if(hr(this),!this.isStopped){this.value=e;for(var t=0,r=a(this.observers),n=r.length;n>t;t++)r[t].onNext(e)}},dispose:function(){this.isDisposed=!0,this.observers=null,this.value=null,this.error=null}}),t}(Kr),js=$e.ReplaySubject=function(e){function t(e,t){return ar(function(){t.dispose(),!e.isDisposed&&e.observers.splice(e.observers.indexOf(t),1)})}function r(t,r,i){this.bufferSize=null==t?n:t,this.windowSize=null==r?n:r,this.scheduler=i||Tr,this.q=[],this.observers=[],this.isStopped=!1,this.isDisposed=!1,this.hasError=!1,this.error=null,e.call(this)}var n=Math.pow(2,53)-1;return Zt(r,e),er(r.prototype,Ur.prototype,{_subscribe:function(e){hr(this);var r=new $r(this.scheduler,e),n=t(this,r);this._trim(this.scheduler.now()),this.observers.push(r);for(var i=0,o=this.q.length;o>i;i++)r.onNext(this.q[i].value);return this.hasError?r.onError(this.error):this.isStopped&&r.onCompleted(),r.ensureActive(),n},hasObservers:function(){return hr(this),this.observers.length>0},_trim:function(e){for(;this.q.length>this.bufferSize;)this.q.shift();for(;this.q.length>0&&e-this.q[0].interval>this.windowSize;)this.q.shift()},onNext:function(e){if(hr(this),!this.isStopped){var t=this.scheduler.now();this.q.push({interval:t,value:e}),this._trim(t);for(var r=0,n=a(this.observers),i=n.length;i>r;r++){var o=n[r];o.onNext(e),o.ensureActive()}}},onError:function(e){if(hr(this),!this.isStopped){this.isStopped=!0,this.error=e,this.hasError=!0;var t=this.scheduler.now();this._trim(t);for(var r=0,n=a(this.observers),i=n.length;i>r;r++){var o=n[r];o.onError(e),o.ensureActive()}this.observers.length=0}},onCompleted:function(){if(hr(this),!this.isStopped){this.isStopped=!0;var e=this.scheduler.now();this._trim(e);for(var t=0,r=a(this.observers),n=r.length;n>t;t++){var i=r[t];i.onCompleted(),i.ensureActive()}this.observers.length=0}},dispose:function(){this.isDisposed=!0,this.observers=null}}),r}(Kr),Is=$e.AnonymousSubject=function(e){function t(t,r){this.observer=t,this.observable=r,e.call(this)}return Zt(t,e),er(t.prototype,Ur.prototype,{_subscribe:function(e){return this.observable.subscribe(e)},onCompleted:function(){
this.observer.onCompleted()},onError:function(e){this.observer.onError(e)},onNext:function(e){this.observer.onNext(e)}}),t}(Kr);$e.Pauser=function(e){function t(){e.call(this)}return Zt(t,e),t.prototype.pause=function(){this.onNext(!1)},t.prototype.resume=function(){this.onNext(!0)},t}(Ds),"function"==typeof e&&"object"==typeof e.amd&&e.amd?(qe.Rx=$e,e(function(){return $e})):Fe&&Be?He?(Be.exports=$e).Rx=$e:Fe.Rx=$e:qe.Rx=$e;var Vs=d()}).call(this)}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:3}],196:[function(t,r,n){var i=i||{},o={REVISION:"73"};"function"==typeof e&&e.amd?e("three",o):"undefined"!=typeof n&&"undefined"!=typeof r&&(r.exports=o),void 0!==i.requestAnimationFrame&&void 0!==i.cancelAnimationFrame||function(){for(var e=0,t=["ms","moz","webkit","o"],r=0;r<t.length&&!i.requestAnimationFrame;++r)i.requestAnimationFrame=i[t[r]+"RequestAnimationFrame"],i.cancelAnimationFrame=i[t[r]+"CancelAnimationFrame"]||i[t[r]+"CancelRequestAnimationFrame"];void 0===i.requestAnimationFrame&&void 0!==i.setTimeout&&(i.requestAnimationFrame=function(t){var r=Date.now(),n=Math.max(0,16-(r-e)),o=i.setTimeout(function(){t(r+n)},n);return e=r+n,o}),void 0===i.cancelAnimationFrame&&void 0!==i.clearTimeout&&(i.cancelAnimationFrame=function(e){i.clearTimeout(e)})}(),void 0===i.performance&&(i.performance={}),void 0===i.performance.now&&function(){var e=Date.now();i.performance.now=function(){return Date.now()-e}}(),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(e){return 0>e?-1:e>0?1:+e}),void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}}),o.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},o.CullFaceNone=0,o.CullFaceBack=1,o.CullFaceFront=2,o.CullFaceFrontBack=3,o.FrontFaceDirectionCW=0,o.FrontFaceDirectionCCW=1,o.BasicShadowMap=0,o.PCFShadowMap=1,o.PCFSoftShadowMap=2,o.FrontSide=0,o.BackSide=1,o.DoubleSide=2,o.FlatShading=1,o.SmoothShading=2,o.NoColors=0,o.FaceColors=1,o.VertexColors=2,o.NoBlending=0,o.NormalBlending=1,o.AdditiveBlending=2,o.SubtractiveBlending=3,o.MultiplyBlending=4,o.CustomBlending=5,o.AddEquation=100,o.SubtractEquation=101,o.ReverseSubtractEquation=102,o.MinEquation=103,o.MaxEquation=104,o.ZeroFactor=200,o.OneFactor=201,o.SrcColorFactor=202,o.OneMinusSrcColorFactor=203,o.SrcAlphaFactor=204,o.OneMinusSrcAlphaFactor=205,o.DstAlphaFactor=206,o.OneMinusDstAlphaFactor=207,o.DstColorFactor=208,o.OneMinusDstColorFactor=209,o.SrcAlphaSaturateFactor=210,o.NeverDepth=0,o.AlwaysDepth=1,o.LessDepth=2,o.LessEqualDepth=3,o.EqualDepth=4,o.GreaterEqualDepth=5,o.GreaterDepth=6,o.NotEqualDepth=7,o.MultiplyOperation=0,o.MixOperation=1,o.AddOperation=2,o.UVMapping=300,o.CubeReflectionMapping=301,o.CubeRefractionMapping=302,o.EquirectangularReflectionMapping=303,o.EquirectangularRefractionMapping=304,o.SphericalReflectionMapping=305,o.RepeatWrapping=1e3,o.ClampToEdgeWrapping=1001,o.MirroredRepeatWrapping=1002,o.NearestFilter=1003,o.NearestMipMapNearestFilter=1004,o.NearestMipMapLinearFilter=1005,o.LinearFilter=1006,o.LinearMipMapNearestFilter=1007,o.LinearMipMapLinearFilter=1008,o.UnsignedByteType=1009,o.ByteType=1010,o.ShortType=1011,o.UnsignedShortType=1012,o.IntType=1013,o.UnsignedIntType=1014,o.FloatType=1015,o.HalfFloatType=1025,o.UnsignedShort4444Type=1016,o.UnsignedShort5551Type=1017,o.UnsignedShort565Type=1018,o.AlphaFormat=1019,o.RGBFormat=1020,o.RGBAFormat=1021,o.LuminanceFormat=1022,o.LuminanceAlphaFormat=1023,o.RGBEFormat=o.RGBAFormat,o.RGB_S3TC_DXT1_Format=2001,o.RGBA_S3TC_DXT1_Format=2002,o.RGBA_S3TC_DXT3_Format=2003,o.RGBA_S3TC_DXT5_Format=2004,o.RGB_PVRTC_4BPPV1_Format=2100,o.RGB_PVRTC_2BPPV1_Format=2101,o.RGBA_PVRTC_4BPPV1_Format=2102,o.RGBA_PVRTC_2BPPV1_Format=2103,o.LoopOnce=2200,o.LoopRepeat=2201,o.LoopPingPong=2202,o.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},o.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElement("canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},o.Color=function(e){return 3===arguments.length?this.fromArray(arguments):this.set(e)},o.Color.prototype={constructor:o.Color,r:1,g:1,b:1,set:function(e){return e instanceof o.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(){function e(e,t,r){return 0>r&&(r+=1),r>1&&(r-=1),1/6>r?e+6*(t-e)*r:.5>r?t:2/3>r?e+6*(t-e)*(2/3-r):e}return function(t,r,n){return t=o.Math.euclideanModulo(t,1),r=o.Math.clamp(r,0,1),n=o.Math.clamp(n,0,1),0===r?this.r=this.g=this.b=n:(r=.5>=n?n*(1+r):n+r-n*r,n=2*n-r,this.r=e(n,r,t+1/3),this.g=e(n,r,t),this.b=e(n,r,t-1/3)),this}}(),setStyle:function(e){function t(t){void 0!==t&&1>parseFloat(t)&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var n=r[2];switch(r[1]){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n)){var n=parseFloat(r[1])/360,i=parseInt(r[2],10)/100,s=parseInt(r[3],10)/100;return t(r[5]),this.setHSL(n,i,s)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(e)){if(r=r[1],n=r.length,3===n)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,this;if(6===n)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,this}return e&&0<e.length&&(r=o.ColorKeywords[e],void 0!==r?this.setHex(r):console.warn("THREE.Color: Unknown color "+e)),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;return this.r=e*e,this.g=t*t,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){e=e||{h:0,s:0,l:0};var t,r=this.r,n=this.g,i=this.b,o=Math.max(r,n,i),s=Math.min(r,n,i),a=(s+o)/2;if(s===o)s=t=0;else{var u=o-s,s=.5>=a?u/(o+s):u/(2-o-s);switch(o){case r:t=(n-i)/u+(i>n?6:0);break;case n:t=(i-r)/u+2;break;case i:t=(r-n)/u+4}t/=6}return e.h=t,e.s=s,e.l=a,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,r){var n=this.getHSL();return n.h+=e,n.s+=t,n.l+=r,this.setHSL(n.h,n.s,n.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},o.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},o.Quaternion=function(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==n?n:1},o.Quaternion.prototype={constructor:o.Quaternion,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!1==e instanceof o.Euler)throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var r=Math.cos(e._x/2),n=Math.cos(e._y/2),i=Math.cos(e._z/2),s=Math.sin(e._x/2),a=Math.sin(e._y/2),u=Math.sin(e._z/2),c=e.order;return"XYZ"===c?(this._x=s*n*i+r*a*u,this._y=r*a*i-s*n*u,this._z=r*n*u+s*a*i,this._w=r*n*i-s*a*u):"YXZ"===c?(this._x=s*n*i+r*a*u,this._y=r*a*i-s*n*u,this._z=r*n*u-s*a*i,this._w=r*n*i+s*a*u):"ZXY"===c?(this._x=s*n*i-r*a*u,this._y=r*a*i+s*n*u,this._z=r*n*u+s*a*i,this._w=r*n*i-s*a*u):"ZYX"===c?(this._x=s*n*i-r*a*u,this._y=r*a*i+s*n*u,this._z=r*n*u-s*a*i,this._w=r*n*i+s*a*u):"YZX"===c?(this._x=s*n*i+r*a*u,this._y=r*a*i+s*n*u,this._z=r*n*u-s*a*i,this._w=r*n*i-s*a*u):"XZY"===c&&(this._x=s*n*i-r*a*u,this._y=r*a*i-s*n*u,this._z=r*n*u+s*a*i,this._w=r*n*i+s*a*u),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t=e.elements,r=t[0];e=t[4];var n=t[8],i=t[1],o=t[5],s=t[9],a=t[2],u=t[6],t=t[10],c=r+o+t;return c>0?(r=.5/Math.sqrt(c+1),this._w=.25/r,this._x=(u-s)*r,this._y=(n-a)*r,this._z=(i-e)*r):r>o&&r>t?(r=2*Math.sqrt(1+r-o-t),this._w=(u-s)/r,this._x=.25*r,this._y=(e+i)/r,this._z=(n+a)/r):o>t?(r=2*Math.sqrt(1+o-r-t),this._w=(n-a)/r,this._x=(e+i)/r,this._y=.25*r,this._z=(s+u)/r):(r=2*Math.sqrt(1+t-r-o),this._w=(i-e)/r,this._x=(n+a)/r,this._y=(s+u)/r,this._z=.25*r),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t;return function(r,n){return void 0===e&&(e=new o.Vector3),t=r.dot(n)+1,1e-6>t?(t=0,Math.abs(r.x)>Math.abs(r.z)?e.set(-r.y,r.x,0):e.set(0,-r.z,r.y)):e.crossVectors(r,n),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._z=this._y=this._x=0,this._w=1):(e=1/e,this._x*=e,this._y*=e,this._z*=e,this._w*=e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var r=e._x,n=e._y,i=e._z,o=e._w,s=t._x,a=t._y,u=t._z,c=t._w;return this._x=r*c+o*s+n*u-i*a,this._y=n*c+o*a+i*s-r*u,this._z=i*c+o*u+r*a-n*s,this._w=o*c-r*s-n*a-i*u,this.onChangeCallback(),this},multiplyVector3:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,n=this._y,i=this._z,o=this._w,s=o*e._w+r*e._x+n*e._y+i*e._z;if(0>s?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=r,this._y=n,this._z=i,this;var a=Math.acos(s),u=Math.sqrt(1-s*s);return.001>Math.abs(u)?(this._w=.5*(o+this._w),this._x=.5*(r+this._x),this._y=.5*(n+this._y),this._z=.5*(i+this._z),this):(s=Math.sin((1-t)*a)/u,a=Math.sin(t*a)/u,this._w=o*s+this._w*a,this._x=r*s+this._x*a,this._y=n*s+this._y*a,this._z=i*s+this._z*a,this.onChangeCallback(),this)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}},o.Quaternion.slerp=function(e,t,r,n){return r.copy(e).slerp(t,n)},o.Vector2=function(e,t){this.x=e||0,this.y=t||0},o.Vector2.prototype={constructor:o.Vector2,get width(){return this.x},set width(e){this.x=e},get height(){return this.y},set height(e){this.y=e},set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e):this.y=this.x=0,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(){var e,t;return function(r,n){return void 0===e&&(e=new o.Vector2,t=new o.Vector2),e.set(r,r),t.set(n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.multiplyScalar(Math.max(e,Math.min(t,r))/r),this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x;return e=this.y-e.y,t*t+e*e},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromAttribute:function(e,t,r){return void 0===r&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this},rotateAround:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*r-o*n+e.x,this.y=i*n+o*r+e.y,this}},o.Vector3=function(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0},o.Vector3.prototype={constructor:o.Vector3,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e,this.z*=e):this.z=this.y=this.x=0,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e;return function(t){return!1==t instanceof o.Euler&&console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===e&&(e=new o.Quaternion),this.applyQuaternion(e.setFromEuler(t)),this}}(),applyAxisAngle:function(){var e;return function(t,r){return void 0===e&&(e=new o.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,r)),this}}(),applyMatrix3:function(e){var t=this.x,r=this.y,n=this.z;return e=e.elements,this.x=e[0]*t+e[3]*r+e[6]*n,this.y=e[1]*t+e[4]*r+e[7]*n,this.z=e[2]*t+e[5]*r+e[8]*n,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z;return e=e.elements,this.x=e[0]*t+e[4]*r+e[8]*n+e[12],this.y=e[1]*t+e[5]*r+e[9]*n+e[13],this.z=e[2]*t+e[6]*r+e[10]*n+e[14],this},applyProjection:function(e){var t=this.x,r=this.y,n=this.z;e=e.elements;var i=1/(e[3]*t+e[7]*r+e[11]*n+e[15]);return this.x=(e[0]*t+e[4]*r+e[8]*n+e[12])*i,this.y=(e[1]*t+e[5]*r+e[9]*n+e[13])*i,this.z=(e[2]*t+e[6]*r+e[10]*n+e[14])*i,this},applyQuaternion:function(e){var t=this.x,r=this.y,n=this.z,i=e.x,o=e.y,s=e.z;e=e.w;var a=e*t+o*n-s*r,u=e*r+s*t-i*n,c=e*n+i*r-o*t,t=-i*t-o*r-s*n;return this.x=a*e+t*-i+u*-s-c*-o,this.y=u*e+t*-o+c*-i-a*-s,this.z=c*e+t*-s+a*-o-u*-i,this},project:function(){var e;return function(t){return void 0===e&&(e=new o.Matrix4),e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyProjection(e)}}(),unproject:function(){var e;return function(t){return void 0===e&&(e=new o.Matrix4),e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,r=this.y,n=this.z;return e=e.elements,this.x=e[0]*t+e[4]*r+e[8]*n,this.y=e[1]*t+e[5]*r+e[9]*n,this.z=e[2]*t+e[6]*r+e[10]*n,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e,t;return function(r,n){return void 0===e&&(e=new o.Vector3,t=new o.Vector3),e.set(r,r,r),t.set(n,n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.multiplyScalar(Math.max(e,Math.min(t,r))/r),this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e),this},cross:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var r=this.x,n=this.y,i=this.z;return this.x=n*e.z-i*e.y,this.y=i*e.x-r*e.z,this.z=r*e.y-n*e.x,this},crossVectors:function(e,t){var r=e.x,n=e.y,i=e.z,o=t.x,s=t.y,a=t.z;return this.x=n*a-i*s,this.y=i*o-r*a,this.z=r*s-n*o,this},projectOnVector:function(){var e,t;return function(r){return void 0===e&&(e=new o.Vector3),e.copy(r).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new o.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new o.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){return e=this.dot(e)/(this.length()*e.length()),Math.acos(o.Math.clamp(e,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return e=this.z-e.z,t*t+r*r+e*e},setEulerFromRotationMatrix:function(e,t){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),r=this.set(e.elements[4],e.elements[5],e.elements[6]).length();return e=this.set(e.elements[8],e.elements[9],e.elements[10]).length(),this.x=t,this.y=r,this.z=e,this},setFromMatrixColumn:function(e,t){var r=4*e,n=t.elements;return this.x=n[r],this.y=n[r+1],this.z=n[r+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,r){return void 0===r&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this}},o.Vector4=function(e,t,r,n){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==n?n:1},o.Vector4.prototype={constructor:o.Vector4,set:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e,this.z*=e,this.w*=e):this.w=this.z=this.y=this.x=0,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=this.w;return e=e.elements,this.x=e[0]*t+e[4]*r+e[8]*n+e[12]*i,this.y=e[1]*t+e[5]*r+e[9]*n+e[13]*i,this.z=e[2]*t+e[6]*r+e[10]*n+e[14]*i,this.w=e[3]*t+e[7]*r+e[11]*n+e[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.z=this.y=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,n;e=e.elements;var i=e[0];n=e[4];var o=e[8],s=e[1],a=e[5],u=e[9];r=e[2],t=e[6];var c=e[10];return.01>Math.abs(n-s)&&.01>Math.abs(o-r)&&.01>Math.abs(u-t)?.1>Math.abs(n+s)&&.1>Math.abs(o+r)&&.1>Math.abs(u+t)&&.1>Math.abs(i+a+c-3)?(this.set(1,0,0,0),this):(e=Math.PI,i=(i+1)/2,a=(a+1)/2,c=(c+1)/2,n=(n+s)/4,o=(o+r)/4,u=(u+t)/4,i>a&&i>c?.01>i?(t=0,n=r=.707106781):(t=Math.sqrt(i),r=n/t,n=o/t):a>c?.01>a?(t=.707106781,r=0,n=.707106781):(r=Math.sqrt(a),t=n/r,n=u/r):.01>c?(r=t=.707106781,n=0):(n=Math.sqrt(c),t=o/n,r=u/n),this.set(t,r,n,e),this):(e=Math.sqrt((t-u)*(t-u)+(o-r)*(o-r)+(s-n)*(s-n)),.001>Math.abs(e)&&(e=1),this.x=(t-u)/e,this.y=(o-r)/e,this.z=(s-n)/e,this.w=Math.acos((i+a+c-1)/2),this)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),
this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(r,n){return void 0===e&&(e=new o.Vector4,t=new o.Vector4),e.set(r,r,r,r),t.set(n,n,n,n),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromAttribute:function(e,t,r){return void 0===r&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this.w=e.array[t+3],this}},o.Euler=function(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._order=n||o.Euler.DefaultOrder},o.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" "),o.Euler.DefaultOrder="XYZ",o.Euler.prototype={constructor:o.Euler,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var n=o.Math.clamp,i=e.elements;e=i[0];var s=i[4],a=i[8],u=i[1],c=i[5],h=i[9],l=i[2],p=i[6],i=i[10];return t=t||this._order,"XYZ"===t?(this._y=Math.asin(n(a,-1,1)),.99999>Math.abs(a)?(this._x=Math.atan2(-h,i),this._z=Math.atan2(-s,e)):(this._x=Math.atan2(p,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(h,-1,1)),.99999>Math.abs(h)?(this._y=Math.atan2(a,i),this._z=Math.atan2(u,c)):(this._y=Math.atan2(-l,e),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(p,-1,1)),.99999>Math.abs(p)?(this._y=Math.atan2(-l,i),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(u,e))):"ZYX"===t?(this._y=Math.asin(-n(l,-1,1)),.99999>Math.abs(l)?(this._x=Math.atan2(p,i),this._z=Math.atan2(u,e)):(this._x=0,this._z=Math.atan2(-s,c))):"YZX"===t?(this._z=Math.asin(n(u,-1,1)),.99999>Math.abs(u)?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-l,e)):(this._x=0,this._y=Math.atan2(a,i))):"XZY"===t?(this._z=Math.asin(-n(s,-1,1)),.99999>Math.abs(s)?(this._x=Math.atan2(p,c),this._y=Math.atan2(a,e)):(this._x=Math.atan2(-h,i),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==r&&this.onChangeCallback(),this},setFromQuaternion:function(){var e;return function(t,r,n){return void 0===e&&(e=new o.Matrix4),e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,r,n),this}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new o.Quaternion;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new o.Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}},o.Line3=function(e,t){this.start=void 0!==e?e:new o.Vector3,this.end=void 0!==t?t:new o.Vector3},o.Line3.prototype={constructor:o.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){return(e||new o.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new o.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var r=t||new o.Vector3;return this.delta(r).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new o.Vector3,t=new o.Vector3;return function(r,n){e.subVectors(r,this.start),t.subVectors(this.end,this.start);var i=t.dot(t),i=t.dot(e)/i;return n&&(i=o.Math.clamp(i,0,1)),i}}(),closestPointToPoint:function(e,t,r){return e=this.closestPointToPointParameter(e,t),r=r||new o.Vector3,this.delta(r).multiplyScalar(e).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},o.Box2=function(e,t){this.min=void 0!==e?e:new o.Vector2(1/0,1/0),this.max=void 0!==t?t:new o.Vector2(-(1/0),-(1/0))},o.Box2.prototype={constructor:o.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;r>t;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new o.Vector2;return function(t,r){var n=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){return(e||new o.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new o.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(e,t){return(t||new o.Vector2).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){return(t||new o.Vector2).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new o.Vector2;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},o.Box3=function(e,t){this.min=void 0!==e?e:new o.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new o.Vector3(-(1/0),-(1/0),-(1/0))},o.Box3.prototype={constructor:o.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;r>t;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new o.Vector3;return function(t,r){var n=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),setFromObject:function(){var e=new o.Vector3;return function(t){var r=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){var n=t.geometry;if(void 0!==n)if(n instanceof o.Geometry)for(var i=n.vertices,n=0,s=i.length;s>n;n++)e.copy(i[n]),e.applyMatrix4(t.matrixWorld),r.expandByPoint(e);else if(n instanceof o.BufferGeometry&&void 0!==n.attributes.position)for(i=n.attributes.position.array,n=0,s=i.length;s>n;n+=3)e.set(i[n],i[n+1],i[n+2]),e.applyMatrix4(t.matrixWorld),r.expandByPoint(e)}),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return(e||new o.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new o.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(e,t){return(t||new o.Vector3).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(e,t){return(t||new o.Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new o.Vector3;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new o.Vector3;return function(t){return t=t||new o.Sphere,t.center=this.center(),t.radius=.5*this.size(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},o.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},o.Matrix3.prototype={constructor:o.Matrix3,set:function(e,t,r,n,i,o,s,a,u){var c=this.elements;return c[0]=e,c[3]=t,c[6]=r,c[1]=n,c[4]=i,c[7]=o,c[2]=s,c[5]=a,c[8]=u,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){return e=e.elements,this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]),this},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e;return function(t,r,n){void 0===e&&(e=new o.Vector3),void 0===r&&(r=0),void 0===n&&(n=t.length);for(var i=0;n>i;i+=3,r+=3)e.fromArray(t,r),e.applyMatrix3(this),e.toArray(t,r);return t}}(),applyToBuffer:function(){var e;return function(t,r,n){void 0===e&&(e=new o.Vector3),void 0===r&&(r=0),void 0===n&&(n=t.length/t.itemSize);for(var i=0;n>i;i++,r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix3(this),t.setXYZ(e.x,e.y,e.z);return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],s=e[5],a=e[6],u=e[7],e=e[8];return t*o*e-t*s*u-r*i*e+r*s*a+n*i*u-n*o*a},getInverse:function(e,t){var r=e.elements,n=this.elements;if(n[0]=r[10]*r[5]-r[6]*r[9],n[1]=-r[10]*r[1]+r[2]*r[9],n[2]=r[6]*r[1]-r[2]*r[5],n[3]=-r[10]*r[4]+r[6]*r[8],n[4]=r[10]*r[0]-r[2]*r[8],n[5]=-r[6]*r[0]+r[2]*r[4],n[6]=r[9]*r[4]-r[5]*r[8],n[7]=-r[9]*r[0]+r[1]*r[8],n[8]=r[5]*r[0]-r[1]*r[4],r=r[0]*n[0]+r[1]*n[3]+r[2]*n[6],0===r){if(t)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/r),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}},o.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},o.Matrix4.prototype={constructor:o.Matrix4,set:function(e,t,r,n,i,o,s,a,u,c,h,l,p,f,d,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=r,v[12]=n,v[1]=i,v[5]=o,v[9]=s,v[13]=a,v[2]=u,v[6]=c,v[10]=h,v[14]=l,v[3]=p,v[7]=f,v[11]=d,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new o.Matrix4).fromArray(this.elements)},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements;return e=e.elements,t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractBasis:function(e,t,r){var n=this.elements;return e.set(n[0],n[1],n[2]),t.set(n[4],n[5],n[6]),r.set(n[8],n[9],n[10]),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(){var e;return function(t){void 0===e&&(e=new o.Vector3);var r=this.elements;t=t.elements;var n=1/e.set(t[0],t[1],t[2]).length(),i=1/e.set(t[4],t[5],t[6]).length(),s=1/e.set(t[8],t[9],t[10]).length();return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[4]=t[4]*i,r[5]=t[5]*i,r[6]=t[6]*i,r[8]=t[8]*s,r[9]=t[9]*s,r[10]=t[10]*s,this}}(),makeRotationFromEuler:function(e){!1==e instanceof o.Euler&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,n=e.y,i=e.z,s=Math.cos(r),r=Math.sin(r),a=Math.cos(n),n=Math.sin(n),u=Math.cos(i),i=Math.sin(i);if("XYZ"===e.order){e=s*u;var c=s*i,h=r*u,l=r*i;t[0]=a*u,t[4]=-a*i,t[8]=n,t[1]=c+h*n,t[5]=e-l*n,t[9]=-r*a,t[2]=l-e*n,t[6]=h+c*n,t[10]=s*a}else"YXZ"===e.order?(e=a*u,c=a*i,h=n*u,l=n*i,t[0]=e+l*r,t[4]=h*r-c,t[8]=s*n,t[1]=s*i,t[5]=s*u,t[9]=-r,t[2]=c*r-h,t[6]=l+e*r,t[10]=s*a):"ZXY"===e.order?(e=a*u,c=a*i,h=n*u,l=n*i,t[0]=e-l*r,t[4]=-s*i,t[8]=h+c*r,t[1]=c+h*r,t[5]=s*u,t[9]=l-e*r,t[2]=-s*n,t[6]=r,t[10]=s*a):"ZYX"===e.order?(e=s*u,c=s*i,h=r*u,l=r*i,t[0]=a*u,t[4]=h*n-c,t[8]=e*n+l,t[1]=a*i,t[5]=l*n+e,t[9]=c*n-h,t[2]=-n,t[6]=r*a,t[10]=s*a):"YZX"===e.order?(e=s*a,c=s*n,h=r*a,l=r*n,t[0]=a*u,t[4]=l-e*i,t[8]=h*i+c,t[1]=i,t[5]=s*u,t[9]=-r*u,t[2]=-n*u,t[6]=c*i+h,t[10]=e-l*i):"XZY"===e.order&&(e=s*a,c=s*n,h=r*a,l=r*n,t[0]=a*u,t[4]=-i,t[8]=n*u,t[1]=e*i+l,t[5]=s*u,t[9]=c*i-h,t[2]=h*i-c,t[6]=r*u,t[10]=l*i+e);return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,r=e.x,n=e.y,i=e.z,o=e.w,s=r+r,a=n+n,u=i+i;e=r*s;var c=r*a,r=r*u,h=n*a,n=n*u,i=i*u,s=o*s,a=o*a,o=o*u;return t[0]=1-(h+i),t[4]=c-o,t[8]=r+a,t[1]=c+o,t[5]=1-(e+i),t[9]=n-s,t[2]=r-a,t[6]=n+s,t[10]=1-(e+h),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e,t,r;return function(n,i,s){void 0===e&&(e=new o.Vector3),void 0===t&&(t=new o.Vector3),void 0===r&&(r=new o.Vector3);var a=this.elements;return r.subVectors(n,i).normalize(),0===r.lengthSq()&&(r.z=1),e.crossVectors(s,r).normalize(),0===e.lengthSq()&&(r.x+=1e-4,e.crossVectors(s,r).normalize()),t.crossVectors(r,e),a[0]=e.x,a[4]=t.x,a[8]=r.x,a[1]=e.y,a[5]=t.y,a[9]=r.y,a[2]=e.z,a[6]=t.z,a[10]=r.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,i=this.elements,o=r[0],s=r[4],a=r[8],u=r[12],c=r[1],h=r[5],l=r[9],p=r[13],f=r[2],d=r[6],m=r[10],v=r[14],g=r[3],y=r[7],_=r[11],r=r[15],b=n[0],x=n[4],w=n[8],S=n[12],M=n[1],E=n[5],C=n[9],T=n[13],A=n[2],P=n[6],k=n[10],O=n[14],N=n[3],D=n[7],L=n[11],n=n[15];return i[0]=o*b+s*M+a*A+u*N,i[4]=o*x+s*E+a*P+u*D,i[8]=o*w+s*C+a*k+u*L,i[12]=o*S+s*T+a*O+u*n,i[1]=c*b+h*M+l*A+p*N,i[5]=c*x+h*E+l*P+p*D,i[9]=c*w+h*C+l*k+p*L,i[13]=c*S+h*T+l*O+p*n,i[2]=f*b+d*M+m*A+v*N,i[6]=f*x+d*E+m*P+v*D,i[10]=f*w+d*C+m*k+v*L,i[14]=f*S+d*T+m*O+v*n,i[3]=g*b+y*M+_*A+r*N,i[7]=g*x+y*E+_*P+r*D,i[11]=g*w+y*C+_*k+r*L,i[15]=g*S+y*T+_*O+r*n,this},multiplyToArray:function(e,t,r){var n=this.elements;return this.multiplyMatrices(e,t),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e;return function(t,r,n){void 0===e&&(e=new o.Vector3),void 0===r&&(r=0),void 0===n&&(n=t.length);for(var i=0;n>i;i+=3,r+=3)e.fromArray(t,r),e.applyMatrix4(this),e.toArray(t,r);return t}}(),applyToBuffer:function(){var e;return function(t,r,n){void 0===e&&(e=new o.Vector3),void 0===r&&(r=0),void 0===n&&(n=t.length/t.itemSize);for(var i=0;n>i;i++,r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix4(this),t.setXYZ(e.x,e.y,e.z);return t}}(),rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],o=e[1],s=e[5],a=e[9],u=e[13],c=e[2],h=e[6],l=e[10],p=e[14];return e[3]*(+i*a*h-n*u*h-i*s*l+r*u*l+n*s*p-r*a*p)+e[7]*(+t*a*p-t*u*l+i*o*l-n*o*p+n*u*c-i*a*c)+e[11]*(+t*u*h-t*s*p-i*o*h+r*o*p+i*s*c-r*u*c)+e[15]*(-n*s*c-t*a*h+t*s*l+n*o*h-r*o*l+r*a*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e},getPosition:function(){var e;return function(){void 0===e&&(e=new o.Vector3),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,n=e.elements,i=n[0],o=n[4],s=n[8],a=n[12],u=n[1],c=n[5],h=n[9],l=n[13],p=n[2],f=n[6],d=n[10],m=n[14],v=n[3],g=n[7],y=n[11],n=n[15];if(r[0]=h*m*g-l*d*g+l*f*y-c*m*y-h*f*n+c*d*n,r[4]=a*d*g-s*m*g-a*f*y+o*m*y+s*f*n-o*d*n,r[8]=s*l*g-a*h*g+a*c*y-o*l*y-s*c*n+o*h*n,r[12]=a*h*f-s*l*f-a*c*d+o*l*d+s*c*m-o*h*m,r[1]=l*d*v-h*m*v-l*p*y+u*m*y+h*p*n-u*d*n,r[5]=s*m*v-a*d*v+a*p*y-i*m*y-s*p*n+i*d*n,r[9]=a*h*v-s*l*v-a*u*y+i*l*y+s*u*n-i*h*n,r[13]=s*l*p-a*h*p+a*u*d-i*l*d-s*u*m+i*h*m,r[2]=c*m*v-l*f*v+l*p*g-u*m*g-c*p*n+u*f*n,r[6]=a*f*v-o*m*v-a*p*g+i*m*g+o*p*n-i*f*n,r[10]=o*l*v-a*c*v+a*u*g-i*l*g-o*u*n+i*c*n,r[14]=a*c*p-o*l*p-a*u*f+i*l*f+o*u*m-i*c*m,r[3]=h*f*v-c*d*v-h*p*g+u*d*g+c*p*y-u*f*y,r[7]=o*d*v-s*f*v+s*p*g-i*d*g-o*p*y+i*f*y,r[11]=s*c*v-o*h*v-s*u*g+i*h*g+o*u*y-i*c*y,r[15]=o*h*p-s*c*p+s*u*f-i*h*f-o*u*d+i*c*d,r=i*r[0]+u*r[4]+p*r[8]+v*r[12],0===r){if(t)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");return console.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/r),this},translate:function(e){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,r=e.x,n=e.y;return e=e.z,t[0]*=r,t[4]*=n,t[8]*=e,t[1]*=r,t[5]*=n,t[9]*=e,t[2]*=r,t[6]*=n,t[10]*=e,t[3]*=r,t[7]*=n,t[11]*=e,this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=1-r,o=e.x,s=e.y,a=e.z,u=i*o,c=i*s;return this.set(u*o+r,u*s-n*a,u*a+n*s,0,u*s+n*a,c*s+r,c*a-n*o,0,u*a-n*s,c*a+n*o,i*a*a+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},compose:function(e,t,r){return this.makeRotationFromQuaternion(t),this.scale(r),this.setPosition(e),this},decompose:function(){var e,t;return function(r,n,i){void 0===e&&(e=new o.Vector3),void 0===t&&(t=new o.Matrix4);var s=this.elements,a=e.set(s[0],s[1],s[2]).length(),u=e.set(s[4],s[5],s[6]).length(),c=e.set(s[8],s[9],s[10]).length();0>this.determinant()&&(a=-a),r.x=s[12],r.y=s[13],r.z=s[14],t.elements.set(this.elements),r=1/a;var s=1/u,h=1/c;return t.elements[0]*=r,t.elements[1]*=r,t.elements[2]*=r,t.elements[4]*=s,t.elements[5]*=s,t.elements[6]*=s,t.elements[8]*=h,t.elements[9]*=h,t.elements[10]*=h,n.setFromRotationMatrix(t),i.x=a,i.y=u,i.z=c,this}}(),makeFrustum:function(e,t,r,n,i,o){var s=this.elements;return s[0]=2*i/(t-e),s[4]=0,s[8]=(t+e)/(t-e),s[12]=0,s[1]=0,s[5]=2*i/(n-r),s[9]=(n+r)/(n-r),s[13]=0,s[2]=0,s[6]=0,s[10]=-(o+i)/(o-i),s[14]=-2*o*i/(o-i),s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makePerspective:function(e,t,r,n){e=r*Math.tan(o.Math.degToRad(.5*e));var i=-e;return this.makeFrustum(i*t,e*t,i,e,r,n)},makeOrthographic:function(e,t,r,n,i,o){var s=this.elements,a=t-e,u=r-n,c=o-i;return s[0]=2/a,s[4]=0,s[8]=0,s[12]=-((t+e)/a),s[1]=0,s[5]=2/u,s[9]=0,s[13]=-((r+n)/u),s[2]=0,s[6]=0,s[10]=-2/c,s[14]=-((o+i)/c),s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(e){var t=this.elements;e=e.elements;for(var r=0;16>r;r++)if(t[r]!==e[r])return!1;return!0},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}},o.Ray=function(e,t){this.origin=void 0!==e?e:new o.Vector3,this.direction=void 0!==t?t:new o.Vector3},o.Ray.prototype={constructor:o.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new o.Vector3).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new o.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var r=t||new o.Vector3;r.subVectors(e,this.origin);var n=r.dot(this.direction);return 0>n?r.copy(this.origin):r.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new o.Vector3;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return 0>r?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new o.Vector3,t=new o.Vector3,r=new o.Vector3;return function(n,i,o,s){e.copy(n).add(i).multiplyScalar(.5),t.copy(i).sub(n).normalize(),r.copy(this.origin).sub(e);var a,u=.5*n.distanceTo(i),c=-this.direction.dot(t),h=r.dot(this.direction),l=-r.dot(t),p=r.lengthSq(),f=Math.abs(1-c*c);return f>0?(n=c*l-h,i=c*h-l,a=u*f,n>=0?i>=-a?a>=i?(u=1/f,n*=u,i*=u,c=n*(n+c*i+2*h)+i*(c*n+i+2*l)+p):(i=u,n=Math.max(0,-(c*i+h)),c=-n*n+i*(i+2*l)+p):(i=-u,n=Math.max(0,-(c*i+h)),c=-n*n+i*(i+2*l)+p):-a>=i?(n=Math.max(0,-(-c*u+h)),i=n>0?-u:Math.min(Math.max(-u,-l),u),c=-n*n+i*(i+2*l)+p):a>=i?(n=0,i=Math.min(Math.max(-u,-l),u),c=i*(i+2*l)+p):(n=Math.max(0,-(c*u+h)),i=n>0?u:Math.min(Math.max(-u,-l),u),c=-n*n+i*(i+2*l)+p)):(i=c>0?-u:u,n=Math.max(0,-(c*i+h)),c=-n*n+i*(i+2*l)+p),o&&o.copy(this.direction).multiplyScalar(n).add(this.origin),s&&s.copy(t).multiplyScalar(i).add(e),c}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new o.Vector3;return function(t,r){e.subVectors(t.center,this.origin);var n=e.dot(this.direction),i=e.dot(e)-n*n,o=t.radius*t.radius;return i>o?null:(o=Math.sqrt(o-i),i=n-o,n+=o,0>i&&0>n?null:0>i?this.at(n,r):this.at(i,r))}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);return 0===t?0===e.distanceToPoint(this.origin)?0:null:(e=-(this.origin.dot(e.normal)+e.constant)/t,e>=0?e:null)},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},isIntersectionBox:function(){var e=new o.Vector3;return function(t){return null!==this.intersectBox(t,e)}}(),intersectBox:function(e,t){var r,n,i,o,s;n=1/this.direction.x,o=1/this.direction.y,s=1/this.direction.z;var a=this.origin;return n>=0?(r=(e.min.x-a.x)*n,n*=e.max.x-a.x):(r=(e.max.x-a.x)*n,n*=e.min.x-a.x),o>=0?(i=(e.min.y-a.y)*o,o*=e.max.y-a.y):(i=(e.max.y-a.y)*o,o*=e.min.y-a.y),r>o||i>n?null:((i>r||r!==r)&&(r=i),(n>o||n!==n)&&(n=o),s>=0?(i=(e.min.z-a.z)*s,s*=e.max.z-a.z):(i=(e.max.z-a.z)*s,s*=e.min.z-a.z),r>s||i>n?null:((i>r||r!==r)&&(r=i),(n>s||n!==n)&&(n=s),0>n?null:this.at(r>=0?r:n,t)))},intersectTriangle:function(){var e=new o.Vector3,t=new o.Vector3,r=new o.Vector3,n=new o.Vector3;return function(i,o,s,a,u){if(t.subVectors(o,i),r.subVectors(s,i),n.crossVectors(t,r),o=this.direction.dot(n),o>0){if(a)return null;a=1}else{if(!(0>o))return null;a=-1,o=-o}return e.subVectors(this.origin,i),i=a*this.direction.dot(r.crossVectors(e,r)),0>i?null:(s=a*this.direction.dot(t.cross(e)),0>s||i+s>o?null:(i=-a*e.dot(n),0>i?null:this.at(i/o,u)))}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},o.Sphere=function(e,t){this.center=void 0!==e?e:new o.Vector3,this.radius=void 0!==t?t:0},o.Sphere.prototype={constructor:o.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new o.Box3;return function(t,r){var n=this.center;void 0!==r?n.copy(r):e.setFromPoints(t).center(n);for(var i=0,o=0,s=t.length;s>o;o++)i=Math.max(i,n.distanceToSquared(t[o]));return this.radius=Math.sqrt(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;
return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var r=this.center.distanceToSquared(e),n=t||new o.Vector3;return n.copy(e),r>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n},getBoundingBox:function(e){return e=e||new o.Box3,e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius*=e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},o.Frustum=function(e,t,r,n,i,s){this.planes=[void 0!==e?e:new o.Plane,void 0!==t?t:new o.Plane,void 0!==r?r:new o.Plane,void 0!==n?n:new o.Plane,void 0!==i?i:new o.Plane,void 0!==s?s:new o.Plane]},o.Frustum.prototype={constructor:o.Frustum,set:function(e,t,r,n,i,o){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(r),s[3].copy(n),s[4].copy(i),s[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,r=0;6>r;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements;e=r[0];var n=r[1],i=r[2],o=r[3],s=r[4],a=r[5],u=r[6],c=r[7],h=r[8],l=r[9],p=r[10],f=r[11],d=r[12],m=r[13],v=r[14],r=r[15];return t[0].setComponents(o-e,c-s,f-h,r-d).normalize(),t[1].setComponents(o+e,c+s,f+h,r+d).normalize(),t[2].setComponents(o+n,c+a,f+l,r+m).normalize(),t[3].setComponents(o-n,c-a,f-l,r-m).normalize(),t[4].setComponents(o-i,c-u,f-p,r-v).normalize(),t[5].setComponents(o+i,c+u,f+p,r+v).normalize(),this},intersectsObject:function(){var e=new o.Sphere;return function(t){var r=t.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),e.copy(r.boundingSphere),e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){var t=this.planes,r=e.center;e=-e.radius;for(var n=0;6>n;n++)if(t[n].distanceToPoint(r)<e)return!1;return!0},intersectsBox:function(){var e=new o.Vector3,t=new o.Vector3;return function(r){for(var n=this.planes,i=0;6>i;i++){var o=n[i];e.x=0<o.normal.x?r.min.x:r.max.x,t.x=0<o.normal.x?r.max.x:r.min.x,e.y=0<o.normal.y?r.min.y:r.max.y,t.y=0<o.normal.y?r.max.y:r.min.y,e.z=0<o.normal.z?r.min.z:r.max.z,t.z=0<o.normal.z?r.max.z:r.min.z;var s=o.distanceToPoint(e),o=o.distanceToPoint(t);if(0>s&&0>o)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,r=0;6>r;r++)if(0>t[r].distanceToPoint(e))return!1;return!0}},o.Plane=function(e,t){this.normal=void 0!==e?e:new o.Vector3(1,0,0),this.constant=void 0!==t?t:0},o.Plane.prototype={constructor:o.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new o.Vector3,t=new o.Vector3;return function(r,n,i){return n=e.subVectors(i,n).cross(t.subVectors(r,n)).normalize(),this.setFromNormalAndCoplanarPoint(n,r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var r=this.distanceToPoint(e);return(t||new o.Vector3).copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start);return e=this.distanceToPoint(e.end),0>t&&e>0||0>e&&t>0},intersectLine:function(){var e=new o.Vector3;return function(t,r){var n=r||new o.Vector3,i=t.delta(e),s=this.normal.dot(i);return 0!==s?(s=-(t.start.dot(this.normal)+this.constant)/s,0>s||s>1?void 0:n.copy(i).multiplyScalar(s).add(t.start)):0===this.distanceToPoint(t.start)?n.copy(t.start):void 0}}(),coplanarPoint:function(e){return(e||new o.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new o.Vector3,t=new o.Vector3,r=new o.Matrix3;return function(n,i){var o=i||r.getNormalMatrix(n),o=e.copy(this.normal).applyMatrix3(o),s=this.coplanarPoint(t);return s.applyMatrix4(n),this.setFromNormalAndCoplanarPoint(o,s),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},o.Math={generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=Array(36),n=0;return function(){for(var i=0;36>i;i++)8===i||13===i||18===i||23===i?r[i]="-":14===i?r[i]="4":(2>=n&&(n=33554432+16777216*Math.random()|0),e=15&n,n>>=4,r[i]=t[19===i?3&e|8:e]);return r.join("")}}(),clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,n,i){return n+(e-t)*(i-n)/(r-t)},smoothstep:function(e,t,r){return t>=e?0:e>=r?1:(e=(e-t)/(r-t),e*e*(3-2*e))},smootherstep:function(e,t,r){return t>=e?0:e>=r?1:(e=(e-t)/(r-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}},o.Spline=function(e){function t(e,t,r,n,i,o,s){return e=.5*(r-e),n=.5*(n-t),(2*(t-r)+e+n)*s+(-3*(t-r)-2*e-n)*o+e*i+t}this.points=e;var r,n,i,s,a,u,c,h,l,p=[],f={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return r=(this.points.length-1)*e,n=Math.floor(r),i=r-n,p[0]=0===n?n:n-1,p[1]=n,p[2]=n>this.points.length-2?this.points.length-1:n+1,p[3]=n>this.points.length-3?this.points.length-1:n+2,u=this.points[p[0]],c=this.points[p[1]],h=this.points[p[2]],l=this.points[p[3]],s=i*i,a=i*s,f.x=t(u.x,c.x,h.x,l.x,i,s,a),f.y=t(u.y,c.y,h.y,l.y,i,s,a),f.z=t(u.z,c.z,h.z,l.z,i,s,a),f},this.getControlPointsArray=function(){var e,t,r=this.points.length,n=[];for(e=0;r>e;e++)t=this.points[e],n[e]=[t.x,t.y,t.z];return n},this.getLength=function(e){var t,r,n,i=t=t=0,s=new o.Vector3,a=new o.Vector3,u=[],c=0;for(u[0]=0,e||(e=100),r=this.points.length*e,s.copy(this.points[0]),e=1;r>e;e++)t=e/r,n=this.getPoint(t),a.copy(n),c+=a.distanceTo(s),s.copy(n),t*=this.points.length-1,t=Math.floor(t),t!==i&&(u[t]=c,i=t);return u[u.length]=c,{chunks:u,total:c}},this.reparametrizeByArcLength=function(e){var t,r,n,i,s,a,u=[],c=new o.Vector3,h=this.getLength();for(u.push(c.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(r=h.chunks[t]-h.chunks[t-1],a=Math.ceil(e*r/h.total),i=(t-1)/(this.points.length-1),s=t/(this.points.length-1),r=1;a-1>r;r++)n=i+1/a*r*(s-i),n=this.getPoint(n),u.push(c.copy(n).clone());u.push(c.copy(this.points[t]).clone())}this.points=u}},o.Triangle=function(e,t,r){this.a=void 0!==e?e:new o.Vector3,this.b=void 0!==t?t:new o.Vector3,this.c=void 0!==r?r:new o.Vector3},o.Triangle.normal=function(){var e=new o.Vector3;return function(t,r,n,i){return i=i||new o.Vector3,i.subVectors(n,r),e.subVectors(t,r),i.cross(e),t=i.lengthSq(),t>0?i.multiplyScalar(1/Math.sqrt(t)):i.set(0,0,0)}}(),o.Triangle.barycoordFromPoint=function(){var e=new o.Vector3,t=new o.Vector3,r=new o.Vector3;return function(n,i,s,a,u){e.subVectors(a,i),t.subVectors(s,i),r.subVectors(n,i),n=e.dot(e),i=e.dot(t),s=e.dot(r);var c=t.dot(t);a=t.dot(r);var h=n*c-i*i;return u=u||new o.Vector3,0===h?u.set(-2,-1,-1):(h=1/h,c=(c*s-i*a)*h,n=(n*a-i*s)*h,u.set(1-c-n,n,c))}}(),o.Triangle.containsPoint=function(){var e=new o.Vector3;return function(t,r,n,i){return t=o.Triangle.barycoordFromPoint(t,r,n,i,e),0<=t.x&&0<=t.y&&1>=t.x+t.y}}(),o.Triangle.prototype={constructor:o.Triangle,set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,n){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new o.Vector3,t=new o.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){return(e||new o.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return o.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new o.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return o.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return o.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},o.Channels=function(){this.mask=1},o.Channels.prototype={constructor:o.Channels,set:function(e){this.mask=1<<e},enable:function(e){this.mask|=1<<e},toggle:function(e){this.mask^=1<<e},disable:function(e){this.mask&=~(1<<e)}},o.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1},o.Clock.prototype={constructor:o.Clock,start:function(){this.oldTime=this.startTime=i.performance.now(),this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=i.performance.now(),e=.001*(t-this.oldTime);this.oldTime=t,this.elapsedTime+=e}return e}},o.EventDispatcher=function(){},o.EventDispatcher.prototype={constructor:o.EventDispatcher,apply:function(e){e.addEventListener=o.EventDispatcher.prototype.addEventListener,e.hasEventListener=o.EventDispatcher.prototype.hasEventListener,e.removeEventListener=o.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=o.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)?!0:!1},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var n=r.indexOf(t);-1!==n&&r.splice(n,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=[],n=t.length,i=0;n>i;i++)r[i]=t[i];for(i=0;n>i;i++)r[i].call(this,e)}}}},function(e){function t(e,t){return e.distance-t.distance}function r(e,t,n,i){if(!1!==e.visible&&(e.raycast(t,n),!0===i)){e=e.children,i=0;for(var o=e.length;o>i;i++)r(e[i],t,n,!0)}}e.Raycaster=function(t,r,n,i){this.ray=new e.Ray(t,r),this.near=n||0,this.far=i||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})},e.Raycaster.prototype={constructor:e.Raycaster,linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(t,r){r instanceof e.PerspectiveCamera?(this.ray.origin.setFromMatrixPosition(r.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(r).sub(this.ray.origin).normalize()):r instanceof e.OrthographicCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(r),this.ray.direction.set(0,0,-1).transformDirection(r.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,n){var i=[];return r(e,this,i,n),i.sort(t),i},intersectObjects:function(e,n){var i=[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var o=0,s=e.length;s>o;o++)r(e[o],this,i,n);return i.sort(t),i}}}(o),o.Object3D=function(){Object.defineProperty(this,"id",{value:o.Object3DIdCount++}),this.uuid=o.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.channels=new o.Channels,this.children=[],this.up=o.Object3D.DefaultUp.clone();var e=new o.Vector3,t=new o.Euler,r=new o.Quaternion,n=new o.Vector3(1,1,1);t.onChange(function(){r.setFromEuler(t,!1)}),r.onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:n},modelViewMatrix:{value:new o.Matrix4},normalMatrix:{value:new o.Matrix3}}),this.rotationAutoUpdate=!0,this.matrix=new o.Matrix4,this.matrixWorld=new o.Matrix4,this.matrixAutoUpdate=o.Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},o.Object3D.DefaultUp=new o.Vector3(0,1,0),o.Object3D.DefaultMatrixAutoUpdate=!0,o.Object3D.prototype={constructor:o.Object3D,get eulerOrder(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set eulerOrder(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set renderDepth(e){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new o.Quaternion;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new o.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new o.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new o.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new o.Vector3;return function(t,r){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},translateX:function(){var e=new o.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new o.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new o.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new o.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new o.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e instanceof o.Object3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(1<arguments.length)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);t=this.children.indexOf(e),-1!==t&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(t,1))},getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,n=this.children.length;n>r;r++){var i=this.children[r].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){return e=e||new o.Vector3,this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new o.Vector3,t=new o.Vector3;return function(r){return r=r||new o.Quaternion,this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,r,t),r}}(),getWorldRotation:function(){var e=new o.Quaternion;return function(t){return t=t||new o.Euler,this.getWorldQuaternion(e),t.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new o.Vector3,t=new o.Quaternion;return function(r){return r=r||new o.Vector3,this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,r),r}}(),getWorldDirection:function(){var e=new o.Quaternion;return function(t){return t=t||new o.Vector3,this.getWorldQuaternion(e),t.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,n=t.length;n>r;r++)t[r].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,r=0,n=t.length;n>r;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),(!0===this.matrixWorldNeedsUpdate||!0===e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;r>t;t++)this.children[t].updateMatrixWorld(e)},toJSON:function(e){function t(e){var t,r=[];for(t in e){var n=e[t];delete n.metadata,r.push(n)}return r}var r=void 0===e,n={};r&&(e={geometries:{},materials:{},textures:{},images:{}},n.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var i={};if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),i.matrix=this.matrix.toArray(),void 0!==this.geometry&&(void 0===e.geometries[this.geometry.uuid]&&(e.geometries[this.geometry.uuid]=this.geometry.toJSON(e)),i.geometry=this.geometry.uuid),void 0!==this.material&&(void 0===e.materials[this.material.uuid]&&(e.materials[this.material.uuid]=this.material.toJSON(e)),i.material=this.material.uuid),0<this.children.length){i.children=[];for(var o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(e).object)}if(r){var r=t(e.geometries),o=t(e.materials),s=t(e.textures);e=t(e.images),0<r.length&&(n.geometries=r),0<o.length&&(n.materials=o),0<s.length&&(n.textures=s),0<e.length&&(n.images=e)}return n.object=i,n},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.rotationAutoUpdate=e.rotationAutoUpdate,this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var r=0;r<e.children.length;r++)this.add(e.children[r].clone());return this}},o.EventDispatcher.prototype.apply(o.Object3D.prototype),o.Object3DIdCount=0,o.Face3=function(e,t,r,n,i,s){this.a=e,this.b=t,this.c=r,this.normal=n instanceof o.Vector3?n:new o.Vector3,this.vertexNormals=Array.isArray(n)?n:[],this.color=i instanceof o.Color?i:new o.Color,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==s?s:0},o.Face3.prototype={constructor:o.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;r>t;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,r=e.vertexColors.length;r>t;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}},o.Face4=function(e,t,r,n,i,s,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new o.Face3(e,t,r,i,s,a)},o.BufferAttribute=function(e,t){this.uuid=o.Math.generateUUID(),this.array=e,this.itemSize=t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},o.BufferAttribute.prototype={constructor:o.BufferAttribute,get length(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."),this.array.length},get count(){return this.array.length/this.itemSize},set needsUpdate(e){!0===e&&this.version++},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var n=0,i=this.itemSize;i>n;n++)this.array[e+n]=t.array[r+n];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;i>n;n++){var s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),s=new o.Color),t[r++]=s.r,t[r++]=s.g,t[r++]=s.b}return this},copyIndicesArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;i>n;n++){var o=e[n];t[r++]=o.a,t[r++]=o.b,t[r++]=o.c}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;i>n;n++){var s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),s=new o.Vector2),t[r++]=s.x,t[r++]=s.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;i>n;n++){var s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),s=new o.Vector3),t[r++]=s.x,t[r++]=s.y,t[r++]=s.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;i>n;n++){var s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),s=new o.Vector4),t[r++]=s.x,t[r++]=s.y,t[r++]=s.z,t[r++]=s.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=i,this},clone:function(){return(new this.constructor).copy(this)}},o.Int8Attribute=function(e,t){return new o.BufferAttribute(new Int8Array(e),t)},o.Uint8Attribute=function(e,t){return new o.BufferAttribute(new Uint8Array(e),t)},o.Uint8ClampedAttribute=function(e,t){return new o.BufferAttribute(new Uint8ClampedArray(e),t)},o.Int16Attribute=function(e,t){return new o.BufferAttribute(new Int16Array(e),t)},o.Uint16Attribute=function(e,t){return new o.BufferAttribute(new Uint16Array(e),t)},o.Int32Attribute=function(e,t){return new o.BufferAttribute(new Int32Array(e),t)},o.Uint32Attribute=function(e,t){return new o.BufferAttribute(new Uint32Array(e),t)},o.Float32Attribute=function(e,t){return new o.BufferAttribute(new Float32Array(e),t)},o.Float64Attribute=function(e,t){return new o.BufferAttribute(new Float64Array(e),t)},o.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new o.BufferAttribute(e,t).setDynamic(!0)},o.InstancedBufferAttribute=function(e,t,r){o.BufferAttribute.call(this,e,t),this.meshPerAttribute=r||1},o.InstancedBufferAttribute.prototype=Object.create(o.BufferAttribute.prototype),o.InstancedBufferAttribute.prototype.constructor=o.InstancedBufferAttribute,o.InstancedBufferAttribute.prototype.copy=function(e){return o.BufferAttribute.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},o.InterleavedBuffer=function(e,t){this.uuid=o.Math.generateUUID(),this.array=e,this.stride=t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},o.InterleavedBuffer.prototype={constructor:o.InterleavedBuffer,get length(){return this.array.length},get count(){return this.array.length/this.stride},set needsUpdate(e){!0===e&&this.version++},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){this.array=new e.array.constructor(e.array),this.stride=e.stride,this.dynamic=e.dynamic},copyAt:function(e,t,r){e*=this.stride,r*=t.stride;for(var n=0,i=this.stride;i>n;n++)this.array[e+n]=t.array[r+n];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)}},o.InstancedInterleavedBuffer=function(e,t,r){o.InterleavedBuffer.call(this,e,t),this.meshPerAttribute=r||1},o.InstancedInterleavedBuffer.prototype=Object.create(o.InterleavedBuffer.prototype),o.InstancedInterleavedBuffer.prototype.constructor=o.InstancedInterleavedBuffer,o.InstancedInterleavedBuffer.prototype.copy=function(e){return o.InterleavedBuffer.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},o.InterleavedBufferAttribute=function(e,t,r){this.uuid=o.Math.generateUUID(),this.data=e,this.itemSize=t,this.offset=r},o.InterleavedBufferAttribute.prototype={constructor:o.InterleavedBufferAttribute,get length(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."),this.array.length},get count(){return this.data.array.length/this.data.stride},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this.data.array[e+3]=i,this}},o.Geometry=function(){Object.defineProperty(this,"id",{value:o.GeometryIdCount++}),this.uuid=o.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=this.verticesNeedUpdate=!1},o.Geometry.prototype={constructor:o.Geometry,applyMatrix:function(e){for(var t=(new o.Matrix3).getNormalMatrix(e),r=0,n=this.vertices.length;n>r;r++)this.vertices[r].applyMatrix4(e);for(r=0,n=this.faces.length;n>r;r++){e=this.faces[r],e.normal.applyMatrix3(t).normalize();for(var i=0,s=e.vertexNormals.length;s>i;i++)e.vertexNormals[i].applyMatrix3(t).normalize()}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.normalsNeedUpdate=this.verticesNeedUpdate=!0},rotateX:function(){var e;return function(t){return void 0===e&&(e=new o.Matrix4),e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e;return function(t){return void 0===e&&(e=new o.Matrix4),e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e;return function(t){return void 0===e&&(e=new o.Matrix4),e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e;return function(t,r,n){return void 0===e&&(e=new o.Matrix4),e.makeTranslation(t,r,n),this.applyMatrix(e),this}}(),scale:function(){var e;return function(t,r,n){return void 0===e&&(e=new o.Matrix4),e.makeScale(t,r,n),this.applyMatrix(e),this}}(),lookAt:function(){var e;return function(t){void 0===e&&(e=new o.Object3D),e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){function t(e,t,n){var i=void 0!==a?[l[e].clone(),l[t].clone(),l[n].clone()]:[],s=void 0!==u?[r.colors[e].clone(),r.colors[t].clone(),r.colors[n].clone()]:[],i=new o.Face3(e,t,n,i,s);r.faces.push(i),void 0!==c&&r.faceVertexUvs[0].push([p[e].clone(),p[t].clone(),p[n].clone()]),void 0!==h&&r.faceVertexUvs[1].push([f[e].clone(),f[t].clone(),f[n].clone()])}var r=this,n=null!==e.index?e.index.array:void 0,i=e.attributes,s=i.position.array,a=void 0!==i.normal?i.normal.array:void 0,u=void 0!==i.color?i.color.array:void 0,c=void 0!==i.uv?i.uv.array:void 0,h=void 0!==i.uv2?i.uv2.array:void 0;void 0!==h&&(this.faceVertexUvs[1]=[]);for(var l=[],p=[],f=[],d=i=0;i<s.length;i+=3,d+=2)r.vertices.push(new o.Vector3(s[i],s[i+1],s[i+2])),void 0!==a&&l.push(new o.Vector3(a[i],a[i+1],a[i+2])),void 0!==u&&r.colors.push(new o.Color(u[i],u[i+1],u[i+2])),void 0!==c&&p.push(new o.Vector2(c[d],c[d+1])),void 0!==h&&f.push(new o.Vector2(h[d],h[d+1]));if(void 0!==n)if(s=e.groups,0<s.length)for(i=0;i<s.length;i++)for(var d=s[i],m=d.start,v=d.count,d=m,m=m+v;m>d;d+=3)t(n[d],n[d+1],n[d+2]);else for(i=0;i<n.length;i+=3)t(n[i],n[i+1],n[i+2]);else for(i=0;i<s.length/3;i+=3)t(i,i+1,i+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.translate(e.x,e.y,e.z),e},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,t=0===t?1:1/t,r=new o.Matrix4;return r.set(t,0,0,-t*e.x,0,t,0,-t*e.y,0,0,t,-t*e.z,0,0,0,1),
this.applyMatrix(r),this},computeFaceNormals:function(){for(var e=new o.Vector3,t=new o.Vector3,r=0,n=this.faces.length;n>r;r++){var i=this.faces[r],s=this.vertices[i.a],a=this.vertices[i.b];e.subVectors(this.vertices[i.c],a),t.subVectors(s,a),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,r,n;for(n=Array(this.vertices.length),t=0,r=this.vertices.length;r>t;t++)n[t]=new o.Vector3;if(e){var i,s,a,u=new o.Vector3,c=new o.Vector3;for(e=0,t=this.faces.length;t>e;e++)r=this.faces[e],i=this.vertices[r.a],s=this.vertices[r.b],a=this.vertices[r.c],u.subVectors(a,s),c.subVectors(i,s),u.cross(c),n[r.a].add(u),n[r.b].add(u),n[r.c].add(u)}else for(e=0,t=this.faces.length;t>e;e++)r=this.faces[e],n[r.a].add(r.normal),n[r.b].add(r.normal),n[r.c].add(r.normal);for(t=0,r=this.vertices.length;r>t;t++)n[t].normalize();for(e=0,t=this.faces.length;t>e;e++)r=this.faces[e],i=r.vertexNormals,3===i.length?(i[0].copy(n[r.a]),i[1].copy(n[r.b]),i[2].copy(n[r.c])):(i[0]=n[r.a].clone(),i[1]=n[r.b].clone(),i[2]=n[r.c].clone())},computeMorphNormals:function(){var e,t,r,n,i;for(r=0,n=this.faces.length;n>r;r++)for(i=this.faces[r],i.__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;t>e;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var s=new o.Geometry;for(s.faces=this.faces,e=0,t=this.morphTargets.length;t>e;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[],i=this.morphNormals[e].faceNormals;var a,u,c=this.morphNormals[e].vertexNormals;for(r=0,n=this.faces.length;n>r;r++)a=new o.Vector3,u={a:new o.Vector3,b:new o.Vector3,c:new o.Vector3},i.push(a),c.push(u)}for(c=this.morphNormals[e],s.vertices=this.morphTargets[e].vertices,s.computeFaceNormals(),s.computeVertexNormals(),r=0,n=this.faces.length;n>r;r++)i=this.faces[r],a=c.faceNormals[r],u=c.vertexNormals[r],a.copy(i.normal),u.a.copy(i.vertexNormals[0]),u.b.copy(i.vertexNormals[1]),u.c.copy(i.vertexNormals[2])}for(r=0,n=this.faces.length;n>r;r++)i=this.faces[r],i.normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){for(var e=0,t=this.vertices,r=0,n=t.length;n>r;r++)r>0&&(e+=t[r].distanceTo(t[r-1])),this.lineDistances[r]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new o.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new o.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(!1==e instanceof o.Geometry)console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);else{var n,i=this.vertices.length,s=this.vertices,a=e.vertices,u=this.faces,c=e.faces,h=this.faceVertexUvs[0];e=e.faceVertexUvs[0],void 0===r&&(r=0),void 0!==t&&(n=(new o.Matrix3).getNormalMatrix(t));for(var l=0,p=a.length;p>l;l++){var f=a[l].clone();void 0!==t&&f.applyMatrix4(t),s.push(f)}for(l=0,p=c.length;p>l;l++){var d,a=c[l],m=a.vertexNormals,v=a.vertexColors,f=new o.Face3(a.a+i,a.b+i,a.c+i);for(f.normal.copy(a.normal),void 0!==n&&f.normal.applyMatrix3(n).normalize(),t=0,s=m.length;s>t;t++)d=m[t].clone(),void 0!==n&&d.applyMatrix3(n).normalize(),f.vertexNormals.push(d);for(f.color.copy(a.color),t=0,s=v.length;s>t;t++)d=v[t],f.vertexColors.push(d.clone());f.materialIndex=a.materialIndex+r,u.push(f)}for(l=0,p=e.length;p>l;l++)if(r=e[l],n=[],void 0!==r){for(t=0,s=r.length;s>t;t++)n.push(r[t].clone());h.push(n)}}},mergeMesh:function(e){!1==e instanceof o.Mesh?console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e):(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix))},mergeVertices:function(){var e,t,r,n={},i=[],o=[],s=Math.pow(10,4);for(t=0,r=this.vertices.length;r>t;t++)e=this.vertices[t],e=Math.round(e.x*s)+"_"+Math.round(e.y*s)+"_"+Math.round(e.z*s),void 0===n[e]?(n[e]=t,i.push(this.vertices[t]),o[t]=i.length-1):o[t]=o[n[e]];for(n=[],t=0,r=this.faces.length;r>t;t++)for(s=this.faces[t],s.a=o[s.a],s.b=o[s.b],s.c=o[s.c],s=[s.a,s.b,s.c],e=0;3>e;e++)if(s[e]===s[(e+1)%3]){n.push(t);break}for(t=n.length-1;t>=0;t--)for(s=n[t],this.faces.splice(s,1),o=0,r=this.faceVertexUvs.length;r>o;o++)this.faceVertexUvs[o].splice(s,1);return t=this.vertices.length-i.length,this.vertices=i,t},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,r=0;t>r;r++)e[r]._id=r;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var n,i,o=this.faceVertexUvs[0],s=this.faceVertexUvs[1];for(o&&o.length===t&&(n=[]),s&&s.length===t&&(i=[]),r=0;t>r;r++){var a=e[r]._id;n&&n.push(o[a]),i&&i.push(s[a])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){function e(e,t,r){return r?e|1<<t:e&~(1<<t)}function t(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==c[t]?c[t]:(c[t]=u.length/3,u.push(e.x,e.y,e.z),c[t])}function r(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==l[t]?l[t]:(l[t]=h.length,h.push(e.getHex()),l[t])}function n(e){var t=e.x.toString()+e.y.toString();return void 0!==f[t]?f[t]:(f[t]=p.length/2,p.push(e.x,e.y),f[t])}var i={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),void 0!==this.parameters){var o,s=this.parameters;for(o in s)void 0!==s[o]&&(i[o]=s[o]);return i}for(s=[],o=0;o<this.vertices.length;o++){var a=this.vertices[o];s.push(a.x,a.y,a.z)}var a=[],u=[],c={},h=[],l={},p=[],f={};for(o=0;o<this.faces.length;o++){var d=this.faces[o],m=void 0!==this.faceVertexUvs[0][o],v=0<d.normal.length(),g=0<d.vertexNormals.length,y=1!==d.color.r||1!==d.color.g||1!==d.color.b,_=0<d.vertexColors.length,b=0,b=e(b,0,0),b=e(b,1,!1),b=e(b,2,!1),b=e(b,3,m),b=e(b,4,v),b=e(b,5,g),b=e(b,6,y),b=e(b,7,_);a.push(b),a.push(d.a,d.b,d.c),m&&(m=this.faceVertexUvs[0][o],a.push(n(m[0]),n(m[1]),n(m[2]))),v&&a.push(t(d.normal)),g&&(v=d.vertexNormals,a.push(t(v[0]),t(v[1]),t(v[2]))),y&&a.push(r(d.color)),_&&(d=d.vertexColors,a.push(r(d[0]),r(d[1]),r(d[2])))}return i.data={},i.data.vertices=s,i.data.normals=u,0<h.length&&(i.data.colors=h),0<p.length&&(i.data.uvs=[p]),i.data.faces=a,i},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]];for(var t=e.vertices,r=0,n=t.length;n>r;r++)this.vertices.push(t[r].clone());for(t=e.faces,r=0,n=t.length;n>r;r++)this.faces.push(t[r].clone());for(r=0,n=e.faceVertexUvs.length;n>r;r++){t=e.faceVertexUvs[r],void 0===this.faceVertexUvs[r]&&(this.faceVertexUvs[r]=[]);for(var i=0,o=t.length;o>i;i++){for(var s=t[i],a=[],u=0,c=s.length;c>u;u++)a.push(s[u].clone());this.faceVertexUvs[r].push(a)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},o.EventDispatcher.prototype.apply(o.Geometry.prototype),o.GeometryIdCount=0,o.DirectGeometry=function(){Object.defineProperty(this,"id",{value:o.GeometryIdCount++}),this.uuid=o.Math.generateUUID(),this.name="",this.type="DirectGeometry",this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1},o.DirectGeometry.prototype={constructor:o.DirectGeometry,computeBoundingBox:o.Geometry.prototype.computeBoundingBox,computeBoundingSphere:o.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},computeGroups:function(e){var t,r,n=[];e=e.faces;for(var i=0;i<e.length;i++){var o=e[i];o.materialIndex!==r&&(r=o.materialIndex,void 0!==t&&(t.count=3*i-t.start,n.push(t)),t={start:3*i,materialIndex:r})}void 0!==t&&(t.count=3*i-t.start,n.push(t)),this.groups=n},fromGeometry:function(e){var t=e.faces,r=e.vertices,n=e.faceVertexUvs,i=n[0]&&0<n[0].length,s=n[1]&&0<n[1].length,a=e.morphTargets,u=a.length;if(u>0){for(var c=[],h=0;u>h;h++)c[h]=[];this.morphTargets.position=c}var l=e.morphNormals,p=l.length;if(p>0){for(var f=[],h=0;p>h;h++)f[h]=[];this.morphTargets.normal=f}for(var d=e.skinIndices,m=e.skinWeights,v=d.length===r.length,g=m.length===r.length,h=0;h<t.length;h++){var y=t[h];this.vertices.push(r[y.a],r[y.b],r[y.c]);var _=y.vertexNormals;for(3===_.length?this.normals.push(_[0],_[1],_[2]):(_=y.normal,this.normals.push(_,_,_)),_=y.vertexColors,3===_.length?this.colors.push(_[0],_[1],_[2]):(_=y.color,this.colors.push(_,_,_)),!0===i&&(_=n[0][h],void 0!==_?this.uvs.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",h),this.uvs.push(new o.Vector2,new o.Vector2,new o.Vector2))),!0===s&&(_=n[1][h],void 0!==_?this.uvs2.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",h),this.uvs2.push(new o.Vector2,new o.Vector2,new o.Vector2))),_=0;u>_;_++){var b=a[_].vertices;c[_].push(b[y.a],b[y.b],b[y.c])}for(_=0;p>_;_++)b=l[_].vertexNormals[h],f[_].push(b.a,b.b,b.c);v&&this.skinIndices.push(d[y.a],d[y.b],d[y.c]),g&&this.skinWeights.push(m[y.a],m[y.b],m[y.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},o.EventDispatcher.prototype.apply(o.DirectGeometry.prototype),o.BufferGeometry=function(){Object.defineProperty(this,"id",{value:o.GeometryIdCount++}),this.uuid=o.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingSphere=this.boundingBox=null,this.drawRange={start:0,count:1/0}},o.BufferGeometry.prototype={constructor:o.BufferGeometry,addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},getIndex:function(){return this.index},setIndex:function(e){this.index=e},addAttribute:function(e,t,r){!1==t instanceof o.BufferAttribute&&!1==t instanceof o.InterleavedBufferAttribute?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new o.BufferAttribute(t,r))):"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t)):this.attributes[e]=t},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){delete this.attributes[e]},get drawcalls(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups},get offsets(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups},addDrawCall:function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToVector3Array(t.array),t.needsUpdate=!0),t=this.attributes.normal,void 0!==t&&((new o.Matrix3).getNormalMatrix(e).applyToVector3Array(t.array),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere()},rotateX:function(){var e;return function(t){return void 0===e&&(e=new o.Matrix4),e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e;return function(t){return void 0===e&&(e=new o.Matrix4),e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e;return function(t){return void 0===e&&(e=new o.Matrix4),e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e;return function(t,r,n){return void 0===e&&(e=new o.Matrix4),e.makeTranslation(t,r,n),this.applyMatrix(e),this}}(),scale:function(){var e;return function(t,r,n){return void 0===e&&(e=new o.Matrix4),e.makeScale(t,r,n),this.applyMatrix(e),this}}(),lookAt:function(){var e;return function(t){void 0===e&&(e=new o.Object3D),e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.translate(e.x,e.y,e.z),e},setFromObject:function(e){var t=e.geometry;if(e instanceof o.Points||e instanceof o.Line){e=new o.Float32Attribute(3*t.vertices.length,3);var r=new o.Float32Attribute(3*t.colors.length,3);this.addAttribute("position",e.copyVector3sArray(t.vertices)),this.addAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length&&(e=new o.Float32Attribute(t.lineDistances.length,1),this.addAttribute("lineDistance",e.copyArray(t.lineDistances))),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e instanceof o.Mesh&&t instanceof o.Geometry&&this.fromGeometry(t);return this},updateFromObject:function(e){var t=e.geometry;if(e instanceof o.Mesh){var r=t.__directGeometry;if(void 0===r)return this.fromGeometry(t);r.verticesNeedUpdate=t.verticesNeedUpdate,r.normalsNeedUpdate=t.normalsNeedUpdate,r.colorsNeedUpdate=t.colorsNeedUpdate,r.uvsNeedUpdate=t.uvsNeedUpdate,r.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=r}return!0===t.verticesNeedUpdate&&(r=this.attributes.position,void 0!==r&&(r.copyVector3sArray(t.vertices),r.needsUpdate=!0),t.verticesNeedUpdate=!1),!0===t.normalsNeedUpdate&&(r=this.attributes.normal,void 0!==r&&(r.copyVector3sArray(t.normals),r.needsUpdate=!0),t.normalsNeedUpdate=!1),!0===t.colorsNeedUpdate&&(r=this.attributes.color,void 0!==r&&(r.copyColorsArray(t.colors),r.needsUpdate=!0),t.colorsNeedUpdate=!1),t.uvsNeedUpdate&&(r=this.attributes.uv,void 0!==r&&(r.copyVector2sArray(t.uvs),r.needsUpdate=!0),t.uvsNeedUpdate=!1),t.lineDistancesNeedUpdate&&(r=this.attributes.lineDistance,void 0!==r&&(r.copyArray(t.lineDistances),r.needsUpdate=!0),t.lineDistancesNeedUpdate=!1),t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new o.DirectGeometry).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);this.addAttribute("position",new o.BufferAttribute(t,3).copyVector3sArray(e.vertices)),0<e.normals.length&&(t=new Float32Array(3*e.normals.length),this.addAttribute("normal",new o.BufferAttribute(t,3).copyVector3sArray(e.normals))),0<e.colors.length&&(t=new Float32Array(3*e.colors.length),this.addAttribute("color",new o.BufferAttribute(t,3).copyColorsArray(e.colors))),0<e.uvs.length&&(t=new Float32Array(2*e.uvs.length),this.addAttribute("uv",new o.BufferAttribute(t,2).copyVector2sArray(e.uvs))),0<e.uvs2.length&&(t=new Float32Array(2*e.uvs2.length),this.addAttribute("uv2",new o.BufferAttribute(t,2).copyVector2sArray(e.uvs2))),0<e.indices.length&&(t=new(65535<e.vertices.length?Uint32Array:Uint16Array)(3*e.indices.length),this.setIndex(new o.BufferAttribute(t,1).copyIndicesArray(e.indices))),this.groups=e.groups;for(var r in e.morphTargets){for(var t=[],n=e.morphTargets[r],i=0,s=n.length;s>i;i++){var a=n[i],u=new o.Float32Attribute(3*a.length,3);t.push(u.copyVector3sArray(a))}this.morphAttributes[r]=t}return 0<e.skinIndices.length&&(r=new o.Float32Attribute(4*e.skinIndices.length,4),this.addAttribute("skinIndex",r.copyVector4sArray(e.skinIndices))),0<e.skinWeights.length&&(r=new o.Float32Attribute(4*e.skinWeights.length,4),this.addAttribute("skinWeight",r.copyVector4sArray(e.skinWeights))),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){var e=new o.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new o.Box3);var t=this.attributes.position.array;if(t){var r=this.boundingBox;r.makeEmpty();for(var n=0,i=t.length;i>n;n+=3)e.fromArray(t,n),r.expandByPoint(e)}(void 0===t||0===t.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}(),computeBoundingSphere:function(){var e=new o.Box3,t=new o.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new o.Sphere);var r=this.attributes.position.array;if(r){e.makeEmpty();for(var n=this.boundingSphere.center,i=0,s=r.length;s>i;i+=3)t.fromArray(r,i),e.expandByPoint(t);e.center(n);for(var a=0,i=0,s=r.length;s>i;i+=3)t.fromArray(r,i),a=Math.max(a,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes,r=this.groups;if(t.position){var n=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new o.BufferAttribute(new Float32Array(n.length),3));else for(var i=t.normal.array,s=0,a=i.length;a>s;s++)i[s]=0;var u,c,h,i=t.normal.array,l=new o.Vector3,p=new o.Vector3,f=new o.Vector3,d=new o.Vector3,m=new o.Vector3;if(e){e=e.array,0===r.length&&this.addGroup(0,e.length);for(var v=0,g=r.length;g>v;++v)for(s=r[v],a=s.start,u=s.count,s=a,a+=u;a>s;s+=3)u=3*e[s+0],c=3*e[s+1],h=3*e[s+2],l.fromArray(n,u),p.fromArray(n,c),f.fromArray(n,h),d.subVectors(f,p),m.subVectors(l,p),d.cross(m),i[u]+=d.x,i[u+1]+=d.y,i[u+2]+=d.z,i[c]+=d.x,i[c+1]+=d.y,i[c+2]+=d.z,i[h]+=d.x,i[h+1]+=d.y,i[h+2]+=d.z}else for(s=0,a=n.length;a>s;s+=9)l.fromArray(n,s),p.fromArray(n,s+3),f.fromArray(n,s+6),d.subVectors(f,p),m.subVectors(l,p),d.cross(m),i[s]=d.x,i[s+1]=d.y,i[s+2]=d.z,i[s+3]=d.x,i[s+4]=d.y,i[s+5]=d.z,i[s+6]=d.x,i[s+7]=d.y,i[s+8]=d.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(e){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},merge:function(e,t){if(!1!=e instanceof o.BufferGeometry){void 0===t&&(t=0);var r,n=this.attributes;for(r in n)if(void 0!==e.attributes[r])for(var i=n[r].array,s=e.attributes[r],a=s.array,u=0,s=s.itemSize*t;u<a.length;u++,s++)i[s]=a[u];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e,t,r,n=this.attributes.normal.array,i=0,o=n.length;o>i;i+=3)e=n[i],t=n[i+1],r=n[i+2],e=1/Math.sqrt(e*e+t*t+r*r),n[i]*=e,n[i+1]*=e,n[i+2]*=e},toJSON:function(){var e={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t,r=this.parameters;for(t in r)void 0!==r[t]&&(e[t]=r[t]);return e}e.data={attributes:{}};var n=this.index;null!==n&&(r=Array.prototype.slice.call(n.array),e.data.index={type:n.array.constructor.name,array:r}),n=this.attributes;for(t in n){var i=n[t],r=Array.prototype.slice.call(i.array);e.data.attributes[t]={itemSize:i.itemSize,type:i.array.constructor.name,array:r}}return t=this.groups,0<t.length&&(e.data.groups=JSON.parse(JSON.stringify(t))),t=this.boundingSphere,null!==t&&(e.data.boundingSphere={center:t.center.toArray(),radius:t.radius}),e},clone:function(){return(new this.constructor).copy(this)},copy:function(e){var t=e.index;null!==t&&this.setIndex(t.clone());var r,t=e.attributes;for(r in t)this.addAttribute(r,t[r].clone());for(e=e.groups,r=0,t=e.length;t>r;r++){var n=e[r];this.addGroup(n.start,n.count)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},o.EventDispatcher.prototype.apply(o.BufferGeometry.prototype),o.BufferGeometry.MaxIndex=65535,o.InstancedBufferGeometry=function(){o.BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0},o.InstancedBufferGeometry.prototype=Object.create(o.BufferGeometry.prototype),o.InstancedBufferGeometry.prototype.constructor=o.InstancedBufferGeometry,o.InstancedBufferGeometry.prototype.addGroup=function(e,t,r){this.groups.push({start:e,count:t,instances:r})},o.InstancedBufferGeometry.prototype.copy=function(e){var t=e.index;null!==t&&this.setIndex(t.clone());var r,t=e.attributes;for(r in t)this.addAttribute(r,t[r].clone());for(e=e.groups,r=0,t=e.length;t>r;r++){var n=e[r];this.addGroup(n.start,n.count,n.instances)}return this},o.EventDispatcher.prototype.apply(o.InstancedBufferGeometry.prototype),o.AnimationAction=function(e,t,r,n,i){if(void 0===e)throw Error("clip is null");this.clip=e,this.localRoot=null,this.startTime=t||0,this.timeScale=r||1,this.weight=n||1,this.loop=i||o.LoopRepeat,this.loopCount=0,this.enabled=!0,this.actionTime=-this.startTime,this.clipTime=0,this.propertyBindings=[]},o.AnimationAction.prototype={constructor:o.AnimationAction,setLocalRoot:function(e){return this.localRoot=e,this},updateTime:function(e){var t=this.clipTime,r=this.loopCount,n=this.clip.duration;return this.actionTime+=e,this.loop===o.LoopOnce?(this.loopCount=0,this.clipTime=Math.min(Math.max(this.actionTime,0),n),this.clipTime!==t&&(this.clipTime===n?this.mixer.dispatchEvent({type:"finished",action:this,direction:1}):0===this.clipTime&&this.mixer.dispatchEvent({type:"finished",action:this,direction:-1})),this.clipTime):(this.loopCount=Math.floor(this.actionTime/n),e=this.actionTime-this.loopCount*n,e%=n,this.loop==o.LoopPingPong&&1===Math.abs(this.loopCount%2)&&(e=n-e),this.clipTime=e,this.loopCount!==r&&this.mixer.dispatchEvent({type:"loop",action:this,loopDelta:this.loopCount-this.loopCount}),this.clipTime)},syncWith:function(e){return this.actionTime=e.actionTime,this.timeScale=e.timeScale,this},warpToDuration:function(e){return this.timeScale=this.clip.duration/e,this},init:function(e){return this.clipTime=e-this.startTime,this},update:function(e){return this.updateTime(e),this.clip.getAt(this.clipTime)},getTimeScaleAt:function(e){return this.timeScale.getAt?this.timeScale.getAt(e):this.timeScale},getWeightAt:function(e){return this.weight.getAt?this.weight.getAt(e):this.weight}},o.AnimationClip=function(e,t,r){if(this.name=e,this.tracks=r,this.duration=void 0!==t?t:-1,0>this.duration)for(e=0;e<this.tracks.length;e++)t=this.tracks[e],this.duration=Math.max(t.keys[t.keys.length-1].time);this.trim(),this.optimize(),this.results=[]},o.AnimationClip.prototype={constructor:o.AnimationClip,getAt:function(e){e=Math.max(0,Math.min(e,this.duration));for(var t=0;t<this.tracks.length;t++)this.results[t]=this.tracks[t].getAt(e);return this.results},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},o.AnimationClip.CreateFromMorphTargetSequence=function(e,t,r){for(var n=t.length,i=[],s=0;n>s;s++){var a=[];a.push({time:(s+n-1)%n,value:0}),a.push({time:s,value:1}),a.push({time:(s+1)%n,value:0}),a.sort(o.KeyframeTrack.keyComparer),0===a[0].time&&a.push({time:n,value:a[0].value}),i.push(new o.NumberKeyframeTrack(".morphTargetInfluences["+t[s].name+"]",a).scale(1/r))}return new o.AnimationClip(e,-1,i)},o.AnimationClip.findByName=function(e,t){for(var r=0;r<e.length;r++)if(e[r].name===t)return e[r];return null},o.AnimationClip.CreateClipsFromMorphTargetSequences=function(e,t){for(var r={},n=/^([\w-]*?)([\d]+)$/,i=0,s=e.length;s>i;i++){var a=e[i],u=a.name.match(n);if(u&&1<u.length){var c=u[1];(u=r[c])||(r[c]=u=[]),u.push(a)}}n=[];for(c in r)n.push(o.AnimationClip.CreateFromMorphTargetSequence(c,r[c],t));return n},o.AnimationClip.parse=function(e){for(var t=[],r=0;r<e.tracks.length;r++)t.push(o.KeyframeTrack.parse(e.tracks[r]).scale(1/e.fps));return new o.AnimationClip(e.name,e.duration,t)},o.AnimationClip.parseAnimation=function(e,t,r){if(!e)return console.error("  no animation in JSONLoader data"),null;var n=function(e,t,r,n,i){for(var o=[],s=0;s<t.length;s++){var a=t[s];void 0!==a[r]&&o.push({time:a.time,value:i(a)})}return 0<o.length?new n(e,o):null},i=[],s=e.name||"default",a=e.length||-1,u=e.fps||30;e=e.hierarchy||[];for(var c=0;c<e.length;c++){var h=e[c].keys;if(h&&0!=h.length)if(h[0].morphTargets){for(var a={},l=0;l<h.length;l++)if(h[l].morphTargets)for(var p=0;p<h[l].morphTargets.length;p++)a[h[l].morphTargets[p]]=-1;for(var f in a){for(var d=[],p=0;p<h[l].morphTargets.length;p++){var m=h[l];d.push({time:m.time,value:m.morphTarget===f?1:0})}i.push(new o.NumberKeyframeTrack(r+".morphTargetInfluence["+f+"]",d))}a=a.length*(u||1)}else l=r+".bones["+t[c].name+"]",(p=n(l+".position",h,"pos",o.VectorKeyframeTrack,function(e){return(new o.Vector3).fromArray(e.pos)}))&&i.push(p),(p=n(l+".quaternion",h,"rot",o.QuaternionKeyframeTrack,function(e){return e.rot.slerp?e.rot.clone():(new o.Quaternion).fromArray(e.rot)}))&&i.push(p),(h=n(l+".scale",h,"scl",o.VectorKeyframeTrack,function(e){return(new o.Vector3).fromArray(e.scl)}))&&i.push(h)}return 0===i.length?null:new o.AnimationClip(s,a,i)},o.AnimationMixer=function(e){this.root=e,this.time=0,this.timeScale=1,this.actions=[],this.propertyBindingMap={}},o.AnimationMixer.prototype={constructor:o.AnimationMixer,addAction:function(e){this.actions.push(e),e.init(this.time),e.mixer=this;for(var t=e.clip.tracks,r=e.localRoot||this.root,n=0;n<t.length;n++){var i=t[n],s=r.uuid+"-"+i.name,a=this.propertyBindingMap[s];void 0===a&&(a=new o.PropertyBinding(r,i.name),this.propertyBindingMap[s]=a),e.propertyBindings.push(a),a.referenceCount+=1}},removeAllActions:function(){for(var e=0;e<this.actions.length;e++)this.actions[e].mixer=null;for(var t in this.propertyBindingMap)this.propertyBindingMap[t].unbind();return this.actions=[],this.propertyBindingMap={},this},removeAction:function(e){var t=this.actions.indexOf(e);-1!==t&&(this.actions.splice(t,1),e.mixer=null),t=e.localRoot||this.root,e=e.clip.tracks;for(var r=0;r<e.length;r++){var n=t.uuid+"-"+e[r].name,i=this.propertyBindingMap[n];i.referenceCount-=1,0>=i.referenceCount&&(i.unbind(),delete this.propertyBindingMap[n])}return this},findActionByName:function(e){for(var t=0;t<this.actions.length;t++)if(this.actions[t].name===e)return this.actions[t];return null},play:function(e,t){return e.startTime=this.time,this.addAction(e),this},fadeOut:function(e,t){var r=[];return r.push({time:this.time,value:1}),r.push({time:this.time+t,value:0}),e.weight=new o.NumberKeyframeTrack("weight",r),this},fadeIn:function(e,t){var r=[];return r.push({time:this.time,value:0}),r.push({time:this.time+t,value:1}),e.weight=new o.NumberKeyframeTrack("weight",r),this},warp:function(e,t,r,n){var i=[];return i.push({time:this.time,value:t}),i.push({time:this.time+n,value:r}),e.timeScale=new o.NumberKeyframeTrack("timeScale",i),this},crossFade:function(e,t,r,n){if(this.fadeOut(e,r),this.fadeIn(t,r),n){n=e.clip.duration/t.clip.duration;var i=1/n;this.warp(e,1,n,r),this.warp(t,i,1,r)}return this},update:function(e){e*=this.timeScale,this.time+=e;for(var t=0;t<this.actions.length;t++){var r=this.actions[t],n=r.getWeightAt(this.time),i=r.getTimeScaleAt(this.time),i=r.update(e*i);if(!(0>=r.weight)&&r.enabled)for(var o=0;o<i.length;o++)r.propertyBindings[o].accumulate(i[o],n)}for(var s in this.propertyBindingMap)this.propertyBindingMap[s].apply();return this}},o.EventDispatcher.prototype.apply(o.AnimationMixer.prototype),o.AnimationUtils={getEqualsFunc:function(e){return e.equals?function(e,t){return e.equals(t)}:function(e,t){return e===t}},clone:function(e){if("object"==typeof e){if(e.clone)return e.clone();console.error("can not figure out how to copy exemplarValue",e)}return e},lerp:function(e,t,r,n){return o.AnimationUtils.getLerpFunc(e,n)(e,t,r)},lerp_object:function(e,t,r){return e.lerp(t,r)},slerp_object:function(e,t,r){return e.slerp(t,r)},lerp_number:function(e,t,r){return e*(1-r)+t*r},lerp_boolean:function(e,t,r){return.5>r?e:t},lerp_boolean_immediate:function(e,t,r){return e},lerp_string:function(e,t,r){return.5>r?e:t},lerp_string_immediate:function(e,t,r){return e},getLerpFunc:function(e,t){if(void 0===e||null===e)throw Error("examplarValue is null");switch(typeof e){case"object":if(e.lerp)return o.AnimationUtils.lerp_object;if(e.slerp)return o.AnimationUtils.slerp_object;break;case"number":return o.AnimationUtils.lerp_number;case"boolean":return t?o.AnimationUtils.lerp_boolean:o.AnimationUtils.lerp_boolean_immediate;case"string":return t?o.AnimationUtils.lerp_string:o.AnimationUtils.lerp_string_immediate}}},o.KeyframeTrack=function(e,t){if(void 0===e)throw Error("track name is undefined");if(void 0===t||0===t.length)throw Error("no keys in track named "+e);this.name=e,this.keys=t,this.lastIndex=0,this.validate(),this.optimize()},o.KeyframeTrack.prototype={constructor:o.KeyframeTrack,getAt:function(e){for(;this.lastIndex<this.keys.length&&e>=this.keys[this.lastIndex].time;)this.lastIndex++;for(;0<this.lastIndex&&e<this.keys[this.lastIndex-1].time;)this.lastIndex--;if(this.lastIndex>=this.keys.length)return this.setResult(this.keys[this.keys.length-1].value),this.result;if(0===this.lastIndex)return this.setResult(this.keys[0].value),this.result;var t=this.keys[this.lastIndex-1];if(this.setResult(t.value),t.constantToNext)return this.result;var r=this.keys[this.lastIndex];return this.result=this.lerpValues(this.result,r.value,(e-t.time)/(r.time-t.time))},shift:function(e){if(0!==e)for(var t=0;t<this.keys.length;t++)this.keys[t].time+=e;return this},scale:function(e){if(1!==e)for(var t=0;t<this.keys.length;t++)this.keys[t].time*=e;return this},trim:function(e,t){for(var r=0,n=1;n<this.keys.length;n++)this.keys[n]<=e&&r++;for(var i=0,n=this.keys.length-2;n>0&&this.keys[n]>=t;n++)i++;return r+i>0&&(this.keys=this.keys.splice(r,this.keys.length-i-r)),this},validate:function(){var e=null;if(0!==this.keys.length){for(var t=0;t<this.keys.length;t++){var r=this.keys[t];if(!r)return void console.error("  key is null in track",this,t);if("number"!=typeof r.time||isNaN(r.time))return void console.error("  key.time is not a valid number",this,t,r);if(void 0===r.value||null===r.value)return void console.error("  key.value is null in track",this,t,r);if(e&&e.time>r.time)return void console.error("  key.time is less than previous key time, out of order keys",this,t,r,e);e=r}return this}console.error("  track is empty, no keys",this)},optimize:function(){var e=[],t=this.keys[0];e.push(t),o.AnimationUtils.getEqualsFunc(t.value);for(var r=1;r<this.keys.length-1;r++){var n=this.keys[r],i=this.keys[r+1];t.time===n.time||this.compareValues(t.value,n.value)&&this.compareValues(n.value,i.value)||(t.constantToNext=this.compareValues(t.value,n.value),e.push(n),t=n)}return e.push(this.keys[this.keys.length-1]),this.keys=e,this}},o.KeyframeTrack.keyComparer=function(e,t){return e.time-t.time},o.KeyframeTrack.parse=function(e){if(void 0===e.type)throw Error("track type undefined, can not parse");
return o.KeyframeTrack.GetTrackTypeForTypeName(e.type).parse(e)},o.KeyframeTrack.GetTrackTypeForTypeName=function(e){switch(e.toLowerCase()){case"vector":case"vector2":case"vector3":case"vector4":return o.VectorKeyframeTrack;case"quaternion":return o.QuaternionKeyframeTrack;case"integer":case"scalar":case"double":case"float":case"number":return o.NumberKeyframeTrack;case"bool":case"boolean":return o.BooleanKeyframeTrack;case"string":return o.StringKeyframeTrack}throw Error("Unsupported typeName: "+e)},o.PropertyBinding=function(e,t){this.rootNode=e,this.trackName=t,this.referenceCount=0,this.originalValue=null;var r=o.PropertyBinding.parseTrackName(t);this.directoryName=r.directoryName,this.nodeName=r.nodeName,this.objectName=r.objectName,this.objectIndex=r.objectIndex,this.propertyName=r.propertyName,this.propertyIndex=r.propertyIndex,this.node=o.PropertyBinding.findNode(e,this.nodeName)||e,this.cumulativeValue=null,this.cumulativeWeight=0},o.PropertyBinding.prototype={constructor:o.PropertyBinding,reset:function(){this.cumulativeValue=null,this.cumulativeWeight=0},accumulate:function(e,t){this.isBound||this.bind(),0===this.cumulativeWeight?t>0&&(null===this.cumulativeValue&&(this.cumulativeValue=o.AnimationUtils.clone(e)),this.cumulativeWeight=t):(this.cumulativeValue=this.lerpValue(this.cumulativeValue,e,t/(this.cumulativeWeight+t)),this.cumulativeWeight+=t)},unbind:function(){this.isBound&&(this.setValue(this.originalValue),this.triggerDirty=this.equalsValue=this.lerpValue=this.getValue=this.setValue=null,this.isBound=!1)},bind:function(){if(!this.isBound){var e=this.node;if(e){if(this.objectName){if("materials"===this.objectName){if(!e.material)return void console.error("  can not bind to material as node does not have a material",this);if(!e.material.materials)return void console.error("  can not bind to material.materials as node.material does not have a materials array",this);e=e.material.materials}else if("bones"===this.objectName){if(!e.skeleton)return void console.error("  can not bind to bones as node does not have a skeleton",this);for(var e=e.skeleton.bones,t=0;t<e.length;t++)if(e[t].name===this.objectIndex){this.objectIndex=t;break}}else{if(void 0===e[this.objectName])return void console.error("  can not bind to objectName of node, undefined",this);e=e[this.objectName]}if(void 0!==this.objectIndex){if(void 0===e[this.objectIndex])return void console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,e);e=e[this.objectIndex]}}var r=e[this.propertyName];if(r){if(void 0!==this.propertyIndex){if("morphTargetInfluences"===this.propertyName)for(e.geometry||console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this),e.geometry.morphTargets||console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this),t=0;t<this.node.geometry.morphTargets.length;t++)if(e.geometry.morphTargets[t].name===this.propertyIndex){this.propertyIndex=t;break}this.setValue=function(e){return this.equalsValue(r[this.propertyIndex],e)?!1:(r[this.propertyIndex]=e,!0)},this.getValue=function(){return r[this.propertyIndex]}}else r.copy?(this.setValue=function(e){return this.equalsValue(r,e)?!1:(r.copy(e),!0)},this.getValue=function(){return r}):(this.setValue=function(t){return this.equalsValue(e[this.propertyName],t)?!1:(e[this.propertyName]=t,!0)},this.getValue=function(){return e[this.propertyName]});void 0!==e.needsUpdate?this.triggerDirty=function(){this.node.needsUpdate=!0}:void 0!==e.matrixWorldNeedsUpdate&&(this.triggerDirty=function(){e.matrixWorldNeedsUpdate=!0}),this.originalValue=this.getValue(),this.equalsValue=o.AnimationUtils.getEqualsFunc(this.originalValue),this.lerpValue=o.AnimationUtils.getLerpFunc(this.originalValue,!0),this.isBound=!0}else console.error("  trying to update property for track: "+this.nodeName+"."+this.propertyName+" but it wasn't found.",e)}else console.error("  trying to update node for track: "+this.trackName+" but it wasn't found.")}},apply:function(){if(this.isBound||this.bind(),0<this.cumulativeWeight){if(1>this.cumulativeWeight){var e=1-this.cumulativeWeight;this.cumulativeValue=this.lerpValue(this.cumulativeValue,this.originalValue,e/(this.cumulativeWeight+e))}this.setValue(this.cumulativeValue)&&this.triggerDirty&&this.triggerDirty(),this.cumulativeValue=null,this.cumulativeWeight=0}}},o.PropertyBinding.parseTrackName=function(e){var t=/^(([\w]+\/)*)([\w-\d]+)?(\.([\w]+)(\[([\w\d\[\]\_. ]+)\])?)?(\.([\w.]+)(\[([\w\d\[\]\_. ]+)\])?)$/,r=t.exec(e);if(!r)throw Error("cannot parse trackName at all: "+e);if(r.index===t.lastIndex&&t.lastIndex++,t={directoryName:r[1],nodeName:r[3],objectName:r[5],objectIndex:r[7],propertyName:r[9],propertyIndex:r[11]},null===t.propertyName||0===t.propertyName.length)throw Error("can not parse propertyName from trackName: "+e);return t},o.PropertyBinding.findNode=function(e,t){function r(e){for(var r=0;r<e.bones.length;r++){var n=e.bones[r];if(n.name===t)return n}return null}function n(e){for(var r=0;r<e.length;r++){var i=e[r];if(i.name===t||i.uuid===t||(i=n(i.children)))return i}return null}if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var i=r(e.skeleton);if(i)return i}return e.children&&(i=n(e.children))?i:null},o.VectorKeyframeTrack=function(e,t){o.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value.clone()},o.VectorKeyframeTrack.prototype=Object.create(o.KeyframeTrack.prototype),o.VectorKeyframeTrack.prototype.constructor=o.VectorKeyframeTrack,o.VectorKeyframeTrack.prototype.setResult=function(e){this.result.copy(e)},o.VectorKeyframeTrack.prototype.lerpValues=function(e,t,r){return e.lerp(t,r)},o.VectorKeyframeTrack.prototype.compareValues=function(e,t){return e.equals(t)},o.VectorKeyframeTrack.prototype.clone=function(){for(var e=[],t=0;t<this.keys.length;t++){var r=this.keys[t];e.push({time:r.time,value:r.value.clone()})}return new o.VectorKeyframeTrack(this.name,e)},o.VectorKeyframeTrack.parse=function(e){for(var t=o["Vector"+e.keys[0].value.length],r=[],n=0;n<e.keys.length;n++){var i=e.keys[n];r.push({value:(new t).fromArray(i.value),time:i.time})}return new o.VectorKeyframeTrack(e.name,r)},o.QuaternionKeyframeTrack=function(e,t){o.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value.clone()},o.QuaternionKeyframeTrack.prototype=Object.create(o.KeyframeTrack.prototype),o.QuaternionKeyframeTrack.prototype.constructor=o.QuaternionKeyframeTrack,o.QuaternionKeyframeTrack.prototype.setResult=function(e){this.result.copy(e)},o.QuaternionKeyframeTrack.prototype.lerpValues=function(e,t,r){return e.slerp(t,r)},o.QuaternionKeyframeTrack.prototype.compareValues=function(e,t){return e.equals(t)},o.QuaternionKeyframeTrack.prototype.multiply=function(e){for(var t=0;t<this.keys.length;t++)this.keys[t].value.multiply(e);return this},o.QuaternionKeyframeTrack.prototype.clone=function(){for(var e=[],t=0;t<this.keys.length;t++){var r=this.keys[t];e.push({time:r.time,value:r.value.clone()})}return new o.QuaternionKeyframeTrack(this.name,e)},o.QuaternionKeyframeTrack.parse=function(e){for(var t=[],r=0;r<e.keys.length;r++){var n=e.keys[r];t.push({value:(new o.Quaternion).fromArray(n.value),time:n.time})}return new o.QuaternionKeyframeTrack(e.name,t)},o.StringKeyframeTrack=function(e,t){o.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value},o.StringKeyframeTrack.prototype=Object.create(o.KeyframeTrack.prototype),o.StringKeyframeTrack.prototype.constructor=o.StringKeyframeTrack,o.StringKeyframeTrack.prototype.setResult=function(e){this.result=e},o.StringKeyframeTrack.prototype.lerpValues=function(e,t,r){return 1>r?e:t},o.StringKeyframeTrack.prototype.compareValues=function(e,t){return e===t},o.StringKeyframeTrack.prototype.clone=function(){for(var e=[],t=0;t<this.keys.length;t++){var r=this.keys[t];e.push({time:r.time,value:r.value})}return new o.StringKeyframeTrack(this.name,e)},o.StringKeyframeTrack.parse=function(e){return new o.StringKeyframeTrack(e.name,e.keys)},o.BooleanKeyframeTrack=function(e,t){o.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value},o.BooleanKeyframeTrack.prototype=Object.create(o.KeyframeTrack.prototype),o.BooleanKeyframeTrack.prototype.constructor=o.BooleanKeyframeTrack,o.BooleanKeyframeTrack.prototype.setResult=function(e){this.result=e},o.BooleanKeyframeTrack.prototype.lerpValues=function(e,t,r){return 1>r?e:t},o.BooleanKeyframeTrack.prototype.compareValues=function(e,t){return e===t},o.BooleanKeyframeTrack.prototype.clone=function(){for(var e=[],t=0;t<this.keys.length;t++){var r=this.keys[t];e.push({time:r.time,value:r.value})}return new o.BooleanKeyframeTrack(this.name,e)},o.BooleanKeyframeTrack.parse=function(e){return new o.BooleanKeyframeTrack(e.name,e.keys)},o.NumberKeyframeTrack=function(e,t){o.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value},o.NumberKeyframeTrack.prototype=Object.create(o.KeyframeTrack.prototype),o.NumberKeyframeTrack.prototype.constructor=o.NumberKeyframeTrack,o.NumberKeyframeTrack.prototype.setResult=function(e){this.result=e},o.NumberKeyframeTrack.prototype.lerpValues=function(e,t,r){return e*(1-r)+t*r},o.NumberKeyframeTrack.prototype.compareValues=function(e,t){return e===t},o.NumberKeyframeTrack.prototype.clone=function(){for(var e=[],t=0;t<this.keys.length;t++){var r=this.keys[t];e.push({time:r.time,value:r.value})}return new o.NumberKeyframeTrack(this.name,e)},o.NumberKeyframeTrack.parse=function(e){return new o.NumberKeyframeTrack(e.name,e.keys)},o.Camera=function(){o.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new o.Matrix4,this.projectionMatrix=new o.Matrix4},o.Camera.prototype=Object.create(o.Object3D.prototype),o.Camera.prototype.constructor=o.Camera,o.Camera.prototype.getWorldDirection=function(){var e=new o.Quaternion;return function(t){return t=t||new o.Vector3,this.getWorldQuaternion(e),t.set(0,0,-1).applyQuaternion(e)}}(),o.Camera.prototype.lookAt=function(){var e=new o.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),o.Camera.prototype.clone=function(){return(new this.constructor).copy(this)},o.Camera.prototype.copy=function(e){return o.Object3D.prototype.copy.call(this,e),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},o.CubeCamera=function(e,t,r){o.Object3D.call(this),this.type="CubeCamera";var n=new o.PerspectiveCamera(90,1,e,t);n.up.set(0,-1,0),n.lookAt(new o.Vector3(1,0,0)),this.add(n);var i=new o.PerspectiveCamera(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new o.Vector3(-1,0,0)),this.add(i);var s=new o.PerspectiveCamera(90,1,e,t);s.up.set(0,0,1),s.lookAt(new o.Vector3(0,1,0)),this.add(s);var a=new o.PerspectiveCamera(90,1,e,t);a.up.set(0,0,-1),a.lookAt(new o.Vector3(0,-1,0)),this.add(a);var u=new o.PerspectiveCamera(90,1,e,t);u.up.set(0,-1,0),u.lookAt(new o.Vector3(0,0,1)),this.add(u);var c=new o.PerspectiveCamera(90,1,e,t);c.up.set(0,-1,0),c.lookAt(new o.Vector3(0,0,-1)),this.add(c),this.renderTarget=new o.WebGLRenderTargetCube(r,r,{format:o.RGBFormat,magFilter:o.LinearFilter,minFilter:o.LinearFilter}),this.updateCubeMap=function(e,t){null===this.parent&&this.updateMatrixWorld();var r=this.renderTarget,o=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,n,r),r.activeCubeFace=1,e.render(t,i,r),r.activeCubeFace=2,e.render(t,s,r),r.activeCubeFace=3,e.render(t,a,r),r.activeCubeFace=4,e.render(t,u,r),r.texture.generateMipmaps=o,r.activeCubeFace=5,e.render(t,c,r),e.setRenderTarget(null)}},o.CubeCamera.prototype=Object.create(o.Object3D.prototype),o.CubeCamera.prototype.constructor=o.CubeCamera,o.OrthographicCamera=function(e,t,r,n,i,s){o.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=e,this.right=t,this.top=r,this.bottom=n,this.near=void 0!==i?i:.1,this.far=void 0!==s?s:2e3,this.updateProjectionMatrix()},o.OrthographicCamera.prototype=Object.create(o.Camera.prototype),o.OrthographicCamera.prototype.constructor=o.OrthographicCamera,o.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(r-e,r+e,n+t,n-t,this.near,this.far)},o.OrthographicCamera.prototype.copy=function(e){return o.Camera.prototype.copy.call(this,e),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this},o.OrthographicCamera.prototype.toJSON=function(e){return e=o.Object3D.prototype.toJSON.call(this,e),e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,e},o.PerspectiveCamera=function(e,t,r,n){o.Camera.call(this),this.type="PerspectiveCamera",this.zoom=1,this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.updateProjectionMatrix()},o.PerspectiveCamera.prototype=Object.create(o.Camera.prototype),o.PerspectiveCamera.prototype.constructor=o.PerspectiveCamera,o.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*o.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},o.PerspectiveCamera.prototype.setViewOffset=function(e,t,r,n,i,o){this.fullWidth=e,this.fullHeight=t,this.x=r,this.y=n,this.width=i,this.height=o,this.updateProjectionMatrix()},o.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=o.Math.radToDeg(2*Math.atan(Math.tan(.5*o.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var t=this.fullWidth/this.fullHeight,e=Math.tan(o.Math.degToRad(.5*e))*this.near,r=-e,n=t*r,t=Math.abs(t*e-n),r=Math.abs(e-r);this.projectionMatrix.makeFrustum(n+this.x*t/this.fullWidth,n+(this.x+this.width)*t/this.fullWidth,e-(this.y+this.height)*r/this.fullHeight,e-this.y*r/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)},o.PerspectiveCamera.prototype.copy=function(e){return o.Camera.prototype.copy.call(this,e),this.fov=e.fov,this.aspect=e.aspect,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this},o.PerspectiveCamera.prototype.toJSON=function(e){return e=o.Object3D.prototype.toJSON.call(this,e),e.object.zoom=this.zoom,e.object.fov=this.fov,e.object.aspect=this.aspect,e.object.near=this.near,e.object.far=this.far,e},o.Light=function(e){o.Object3D.call(this),this.type="Light",this.color=new o.Color(e),this.receiveShadow=void 0},o.Light.prototype=Object.create(o.Object3D.prototype),o.Light.prototype.constructor=o.Light,Object.defineProperties(o.Light.prototype,{onlyShadow:{set:function(e){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){this.shadow.camera.far=e}},shadowCameraVisible:{set:function(e){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow ) instead.")}},shadowBias:{set:function(e){this.shadow.bias=e}},shadowDarkness:{set:function(e){this.shadow.darkness=e}},shadowMapWidth:{set:function(e){this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){this.shadow.mapSize.height=e}}}),o.Light.prototype.copy=function(e){return o.Object3D.prototype.copy.call(this,e),this.color.copy(e.color),this},o.Light.prototype.toJSON=function(e){return e=o.Object3D.prototype.toJSON.call(this,e),e.object.color=this.color.getHex(),void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.intensity&&(e.object.intensity=this.intensity),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.exponent&&(e.object.exponent=this.exponent),e},o.LightShadow=function(e){this.camera=e,this.bias=0,this.darkness=1,this.mapSize=new o.Vector2(512,512),this.matrix=this.map=null},o.LightShadow.prototype={constructor:o.LightShadow,copy:function(e){this.camera=e.camera.clone(),this.bias=e.bias,this.darkness=e.darkness,this.mapSize.copy(e.mapSize)},clone:function(){return(new this.constructor).copy(this)}},o.AmbientLight=function(e){o.Light.call(this,e),this.type="AmbientLight",this.castShadow=void 0},o.AmbientLight.prototype=Object.create(o.Light.prototype),o.AmbientLight.prototype.constructor=o.AmbientLight,o.DirectionalLight=function(e,t){o.Light.call(this,e),this.type="DirectionalLight",this.position.set(0,1,0),this.updateMatrix(),this.target=new o.Object3D,this.intensity=void 0!==t?t:1,this.shadow=new o.LightShadow(new o.OrthographicCamera(-500,500,500,-500,50,5e3))},o.DirectionalLight.prototype=Object.create(o.Light.prototype),o.DirectionalLight.prototype.constructor=o.DirectionalLight,o.DirectionalLight.prototype.copy=function(e){return o.Light.prototype.copy.call(this,e),this.intensity=e.intensity,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this},o.HemisphereLight=function(e,t,r){o.Light.call(this,e),this.type="HemisphereLight",this.castShadow=void 0,this.position.set(0,1,0),this.updateMatrix(),this.groundColor=new o.Color(t),this.intensity=void 0!==r?r:1},o.HemisphereLight.prototype=Object.create(o.Light.prototype),o.HemisphereLight.prototype.constructor=o.HemisphereLight,o.HemisphereLight.prototype.copy=function(e){return o.Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this.intensity=e.intensity,this},o.PointLight=function(e,t,r,n){o.Light.call(this,e),this.type="PointLight",this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.decay=void 0!==n?n:1,this.shadow=new o.LightShadow(new o.PerspectiveCamera(90,1,1,500))},o.PointLight.prototype=Object.create(o.Light.prototype),o.PointLight.prototype.constructor=o.PointLight,o.PointLight.prototype.copy=function(e){return o.Light.prototype.copy.call(this,e),this.intensity=e.intensity,this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this},o.SpotLight=function(e,t,r,n,i,s){o.Light.call(this,e),this.type="SpotLight",this.position.set(0,1,0),this.updateMatrix(),this.target=new o.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.exponent=void 0!==i?i:10,this.decay=void 0!==s?s:1,this.shadow=new o.LightShadow(new o.PerspectiveCamera(50,1,50,5e3))},o.SpotLight.prototype=Object.create(o.Light.prototype),o.SpotLight.prototype.constructor=o.SpotLight,o.SpotLight.prototype.copy=function(e){return o.Light.prototype.copy.call(this,e),this.intensity=e.intensity,this.distance=e.distance,this.angle=e.angle,this.exponent=e.exponent,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this},o.Cache={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){return!1!==this.enabled?this.files[e]:void 0},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},o.Loader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},o.Loader.prototype={constructor:o.Loader,crossOrigin:void 0,extractUrlBase:function(e){return e=e.split("/"),1===e.length?"./":(e.pop(),e.join("/")+"/")},initMaterials:function(e,t,r){for(var n=[],i=0;i<e.length;++i)n[i]=this.createMaterial(e[i],t,r);return n},createMaterial:function(){var e,t,r;return function(n,i,s){function a(e,r,n,a,u){e=i+e;var h=o.Loader.Handlers.get(e);return null!==h?e=h.load(e):(t.setCrossOrigin(s),e=t.load(e)),void 0!==r&&(e.repeat.fromArray(r),1!==r[0]&&(e.wrapS=o.RepeatWrapping),1!==r[1]&&(e.wrapT=o.RepeatWrapping)),void 0!==n&&e.offset.fromArray(n),void 0!==a&&("repeat"===a[0]&&(e.wrapS=o.RepeatWrapping),"mirror"===a[0]&&(e.wrapS=o.MirroredRepeatWrapping),"repeat"===a[1]&&(e.wrapT=o.RepeatWrapping),"mirror"===a[1]&&(e.wrapT=o.MirroredRepeatWrapping)),void 0!==u&&(e.anisotropy=u),r=o.Math.generateUUID(),c[r]=e,r}void 0===e&&(e=new o.Color),void 0===t&&(t=new o.TextureLoader),void 0===r&&(r=new o.MaterialLoader);var u,c={},h={uuid:o.Math.generateUUID(),type:"MeshLambertMaterial"};for(u in n){var l=n[u];switch(u){case"DbgColor":h.color=l;break;case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":h.name=l;break;case"blending":h.blending=o[l];break;case"colorDiffuse":h.color=e.fromArray(l).getHex();break;case"colorSpecular":h.specular=e.fromArray(l).getHex();break;case"colorEmissive":h.emissive=e.fromArray(l).getHex();break;case"specularCoef":h.shininess=l;break;case"shading":"basic"===l.toLowerCase()&&(h.type="MeshBasicMaterial"),"phong"===l.toLowerCase()&&(h.type="MeshPhongMaterial");break;case"mapDiffuse":h.map=a(l,n.mapDiffuseRepeat,n.mapDiffuseOffset,n.mapDiffuseWrap,n.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapLight":h.lightMap=a(l,n.mapLightRepeat,n.mapLightOffset,n.mapLightWrap,n.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":h.aoMap=a(l,n.mapAORepeat,n.mapAOOffset,n.mapAOWrap,n.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":h.bumpMap=a(l,n.mapBumpRepeat,n.mapBumpOffset,n.mapBumpWrap,n.mapBumpAnisotropy);break;case"mapBumpScale":h.bumpScale=l;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":h.normalMap=a(l,n.mapNormalRepeat,n.mapNormalOffset,n.mapNormalWrap,n.mapNormalAnisotropy);break;case"mapNormalFactor":h.normalScale=[l,l];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":h.specularMap=a(l,n.mapSpecularRepeat,n.mapSpecularOffset,n.mapSpecularWrap,n.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapAlpha":h.alphaMap=a(l,n.mapAlphaRepeat,n.mapAlphaOffset,n.mapAlphaWrap,n.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":h.side=o.BackSide;break;case"doubleSided":h.side=o.DoubleSide;break;case"transparency":console.warn("THREE.Loader: transparency has been renamed to opacity"),h.opacity=l;break;case"opacity":case"transparent":case"depthTest":case"depthWrite":case"transparent":case"visible":case"wireframe":h[u]=l;break;case"vertexColors":!0===l&&(h.vertexColors=o.VertexColors),"face"===l&&(h.vertexColors=o.FaceColors);break;default:console.error("Loader.createMaterial: Unsupported",u,l)}}return"MeshPhongMaterial"!==h.type&&delete h.specular,1>h.opacity&&(h.transparent=!0),r.setTextures(c),r.parse(h)}}()},o.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,r=0,n=t.length;n>r;r+=2){var i=t[r+1];if(t[r].test(e))return i}return null}},o.XHRLoader=function(e){this.manager=void 0!==e?e:o.DefaultLoadingManager},o.XHRLoader.prototype={constructor:o.XHRLoader,load:function(e,t,r,n){var i=this,s=o.Cache.get(e);if(void 0!==s)return t&&setTimeout(function(){t(s)},0),s;var a=new XMLHttpRequest;return a.open("GET",e,!0),a.addEventListener("load",function(r){r=r.target.response,o.Cache.add(e,r),t&&t(r),i.manager.itemEnd(e)},!1),void 0!==r&&a.addEventListener("progress",function(e){r(e)},!1),a.addEventListener("error",function(t){n&&n(t),i.manager.itemError(e)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.send(null),i.manager.itemStart(e),a},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e},setWithCredentials:function(e){this.withCredentials=e}},o.ImageLoader=function(e){this.manager=void 0!==e?e:o.DefaultLoadingManager},o.ImageLoader.prototype={constructor:o.ImageLoader,load:function(e,t,r,n){var i=this,s=o.Cache.get(e);if(void 0!==s)return i.manager.itemStart(e),t?setTimeout(function(){t(s),i.manager.itemEnd(e)},0):i.manager.itemEnd(e),s;var a=document.createElement("img");return a.addEventListener("load",function(r){o.Cache.add(e,this),t&&t(this),i.manager.itemEnd(e)},!1),void 0!==r&&a.addEventListener("progress",function(e){r(e)},!1),a.addEventListener("error",function(t){n&&n(t),i.manager.itemError(e)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(e),a.src=e,a},setCrossOrigin:function(e){this.crossOrigin=e}},o.JSONLoader=function(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:o.DefaultLoadingManager,this.withCredentials=!1},o.JSONLoader.prototype={constructor:o.JSONLoader,get statusDomElement(){return void 0===this._statusDomElement&&(this._statusDomElement=document.createElement("div")),console.warn("THREE.JSONLoader: .statusDomElement has been removed."),this._statusDomElement},load:function(e,t,r,n){var i=this,s=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:o.Loader.prototype.extractUrlBase(e);r=new o.XHRLoader(this.manager),r.setCrossOrigin(this.crossOrigin),r.setWithCredentials(this.withCredentials),r.load(e,function(r){r=JSON.parse(r);var n=r.metadata;if(void 0!==n){if("object"===n.type)return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.");if("scene"===n.type)return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.SceneLoader instead.")}r=i.parse(r,s),t(r.geometry,r.materials)})},setCrossOrigin:function(e){this.crossOrigin=e},setTexturePath:function(e){this.texturePath=e},parse:function(e,t){var r=new o.Geometry,n=void 0!==e.scale?1/e.scale:1;return function(t){var n,i,s,a,u,c,h,l,p,f,d,m,v,g=e.faces;c=e.vertices;var y=e.normals,_=e.colors,b=0;if(void 0!==e.uvs){for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&b++;for(n=0;b>n;n++)r.faceVertexUvs[n]=[]}for(a=0,u=c.length;u>a;)n=new o.Vector3,n.x=c[a++]*t,n.y=c[a++]*t,n.z=c[a++]*t,r.vertices.push(n);for(a=0,u=g.length;u>a;)if(t=g[a++],p=1&t,s=2&t,n=8&t,h=16&t,f=32&t,c=64&t,t&=128,p){if(p=new o.Face3,p.a=g[a],p.b=g[a+1],p.c=g[a+3],d=new o.Face3,d.a=g[a+1],d.b=g[a+2],d.c=g[a+3],a+=4,s&&(s=g[a++],p.materialIndex=s,d.materialIndex=s),s=r.faces.length,n)for(n=0;b>n;n++)for(m=e.uvs[n],r.faceVertexUvs[n][s]=[],r.faceVertexUvs[n][s+1]=[],i=0;4>i;i++)l=g[a++],v=m[2*l],l=m[2*l+1],v=new o.Vector2(v,l),2!==i&&r.faceVertexUvs[n][s].push(v),0!==i&&r.faceVertexUvs[n][s+1].push(v);if(h&&(h=3*g[a++],p.normal.set(y[h++],y[h++],y[h]),d.normal.copy(p.normal)),f)for(n=0;4>n;n++)h=3*g[a++],f=new o.Vector3(y[h++],y[h++],y[h]),2!==n&&p.vertexNormals.push(f),0!==n&&d.vertexNormals.push(f);if(c&&(c=g[a++],c=_[c],p.color.setHex(c),d.color.setHex(c)),t)for(n=0;4>n;n++)c=g[a++],c=_[c],2!==n&&p.vertexColors.push(new o.Color(c)),0!==n&&d.vertexColors.push(new o.Color(c));r.faces.push(p),r.faces.push(d)}else{if(p=new o.Face3,p.a=g[a++],p.b=g[a++],p.c=g[a++],s&&(s=g[a++],p.materialIndex=s),s=r.faces.length,n)for(n=0;b>n;n++)for(m=e.uvs[n],r.faceVertexUvs[n][s]=[],i=0;3>i;i++)l=g[a++],v=m[2*l],l=m[2*l+1],v=new o.Vector2(v,l),r.faceVertexUvs[n][s].push(v);if(h&&(h=3*g[a++],p.normal.set(y[h++],y[h++],y[h])),f)for(n=0;3>n;n++)h=3*g[a++],f=new o.Vector3(y[h++],y[h++],y[h]),p.vertexNormals.push(f);if(c&&(c=g[a++],p.color.setHex(_[c])),t)for(n=0;3>n;n++)c=g[a++],p.vertexColors.push(new o.Color(_[c]));r.faces.push(p)}}(n),function(){var t=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var n=0,i=e.skinWeights.length;i>n;n+=t)r.skinWeights.push(new o.Vector4(e.skinWeights[n],t>1?e.skinWeights[n+1]:0,t>2?e.skinWeights[n+2]:0,t>3?e.skinWeights[n+3]:0));if(e.skinIndices)for(n=0,i=e.skinIndices.length;i>n;n+=t)r.skinIndices.push(new o.Vector4(e.skinIndices[n],t>1?e.skinIndices[n+1]:0,t>2?e.skinIndices[n+2]:0,t>3?e.skinIndices[n+3]:0));r.bones=e.bones,r.bones&&0<r.bones.length&&(r.skinWeights.length!==r.skinIndices.length||r.skinIndices.length!==r.vertices.length)&&console.warn("When skinning, number of vertices ("+r.vertices.length+"), skinIndices ("+r.skinIndices.length+"), and skinWeights ("+r.skinWeights.length+") should match.")}(),function(t){if(void 0!==e.morphTargets)for(var n=0,i=e.morphTargets.length;i>n;n++){r.morphTargets[n]={},r.morphTargets[n].name=e.morphTargets[n].name,r.morphTargets[n].vertices=[];for(var s=r.morphTargets[n].vertices,a=e.morphTargets[n].vertices,u=0,c=a.length;c>u;u+=3){var h=new o.Vector3;h.x=a[u]*t,h.y=a[u+1]*t,h.z=a[u+2]*t,s.push(h)}}if(void 0!==e.morphColors&&0<e.morphColors.length)for(console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.'),t=r.faces,s=e.morphColors[0].colors,n=0,i=t.length;i>n;n++)t[n].color.fromArray(s,3*n)}(n),function(){var t=[],n=[];void 0!==e.animation&&n.push(e.animation),void 0!==e.animations&&(e.animations.length?n=n.concat(e.animations):n.push(e.animations));for(var i=0;i<n.length;i++){var s=o.AnimationClip.parseAnimation(n[i],r.bones);s&&t.push(s)}r.morphTargets&&(n=o.AnimationClip.CreateClipsFromMorphTargetSequences(r.morphTargets,10),t=t.concat(n)),0<t.length&&(r.animations=t)}(),r.computeFaceNormals(),r.computeBoundingSphere(),void 0===e.materials||0===e.materials.length?{geometry:r}:(n=o.Loader.prototype.initMaterials(e.materials,t,this.crossOrigin),{geometry:r,materials:n})}},o.LoadingManager=function(e,t,r){var n=this,i=!1,o=0,s=0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){s++,!1===i&&void 0!==n.onStart&&n.onStart(e,o,s),i=!0},this.itemEnd=function(e){o++,void 0!==n.onProgress&&n.onProgress(e,o,s),o===s&&(i=!1,void 0!==n.onLoad)&&n.onLoad()},this.itemError=function(e){void 0!==n.onError&&n.onError(e)}},o.DefaultLoadingManager=new o.LoadingManager,o.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:o.DefaultLoadingManager},o.BufferGeometryLoader.prototype={constructor:o.BufferGeometryLoader,load:function(e,t,r,n){var i=this,s=new o.XHRLoader(i.manager);s.setCrossOrigin(this.crossOrigin),s.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new o.BufferGeometry,r=e.data.index;void 0!==r&&(r=new i[r.type](r.array),t.setIndex(new o.BufferAttribute(r,1)));var n,s=e.data.attributes;for(n in s){var a=s[n],r=new i[a.type](a.array);t.addAttribute(n,new o.BufferAttribute(r,a.itemSize))}if(n=e.data.groups||e.data.drawcalls||e.data.offsets,void 0!==n)for(r=0,s=n.length;r!==s;++r)a=n[r],t.addGroup(a.start,a.count);return e=e.data.boundingSphere,void 0!==e&&(n=new o.Vector3,void 0!==e.center&&n.fromArray(e.center),t.boundingSphere=new o.Sphere(n,e.radius)),t}},o.MaterialLoader=function(e){this.manager=void 0!==e?e:o.DefaultLoadingManager,this.textures={}},o.MaterialLoader.prototype={constructor:o.MaterialLoader,load:function(e,t,r,n){var i=this,s=new o.XHRLoader(i.manager);s.setCrossOrigin(this.crossOrigin),s.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},setTextures:function(e){this.textures=e},getTexture:function(e){var t=this.textures;return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]},parse:function(e){var t=new o[e.type];if(t.uuid=e.uuid,void 0!==e.name&&(t.name=e.name),void 0!==e.color&&t.color.setHex(e.color),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.uniforms&&(t.uniforms=e.uniforms),void 0!==e.vertexShader&&(t.vertexShader=e.vertexShader),
void 0!==e.fragmentShader&&(t.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.shading&&(t.shading=e.shading),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.alphaTest&&(t.alphaTest=e.alphaTest),void 0!==e.depthTest&&(t.depthTest=e.depthTest),void 0!==e.depthWrite&&(t.depthWrite=e.depthWrite),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(t.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.size&&(t.size=e.size),void 0!==e.sizeAttenuation&&(t.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(t.map=this.getTexture(e.map)),void 0!==e.alphaMap&&(t.alphaMap=this.getTexture(e.alphaMap),t.transparent=!0),void 0!==e.bumpMap&&(t.bumpMap=this.getTexture(e.bumpMap)),void 0!==e.bumpScale&&(t.bumpScale=e.bumpScale),void 0!==e.normalMap&&(t.normalMap=this.getTexture(e.normalMap)),e.normalScale&&(t.normalScale=new o.Vector2(e.normalScale,e.normalScale)),void 0!==e.displacementMap&&(t.displacementMap=this.getTexture(e.displacementMap)),void 0!==e.displacementScale&&(t.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(t.displacementBias=e.displacementBias),void 0!==e.specularMap&&(t.specularMap=this.getTexture(e.specularMap)),void 0!==e.envMap&&(t.envMap=this.getTexture(e.envMap),t.combine=o.MultiplyOperation),e.reflectivity&&(t.reflectivity=e.reflectivity),void 0!==e.lightMap&&(t.lightMap=this.getTexture(e.lightMap)),void 0!==e.lightMapIntensity&&(t.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(t.aoMap=this.getTexture(e.aoMap)),void 0!==e.aoMapIntensity&&(t.aoMapIntensity=e.aoMapIntensity),void 0!==e.materials)for(var r=0,n=e.materials.length;n>r;r++)t.materials.push(this.parse(e.materials[r]));return t}},o.ObjectLoader=function(e){this.manager=void 0!==e?e:o.DefaultLoadingManager,this.texturePath=""},o.ObjectLoader.prototype={constructor:o.ObjectLoader,load:function(e,t,r,n){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var i=this,s=new o.XHRLoader(i.manager);s.setCrossOrigin(this.crossOrigin),s.load(e,function(e){i.parse(JSON.parse(e),t)},r,n)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var r=this.parseGeometries(e.geometries),n=this.parseImages(e.images,function(){void 0!==t&&t(i)}),n=this.parseTextures(e.textures,n),n=this.parseMaterials(e.materials,n),i=this.parseObject(e.object,r,n);return e.animations&&(i.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0===t||t(i),i},parseGeometries:function(e){var t={};if(void 0!==e)for(var r=new o.JSONLoader,n=new o.BufferGeometryLoader,i=0,s=e.length;s>i;i++){var a,u=e[i];switch(u.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new o[u.type](u.width,u.height,u.widthSegments,u.heightSegments);break;case"BoxGeometry":case"CubeGeometry":a=new o.BoxGeometry(u.width,u.height,u.depth,u.widthSegments,u.heightSegments,u.depthSegments);break;case"CircleBufferGeometry":a=new o.CircleBufferGeometry(u.radius,u.segments,u.thetaStart,u.thetaLength);break;case"CircleGeometry":a=new o.CircleGeometry(u.radius,u.segments,u.thetaStart,u.thetaLength);break;case"CylinderGeometry":a=new o.CylinderGeometry(u.radiusTop,u.radiusBottom,u.height,u.radialSegments,u.heightSegments,u.openEnded,u.thetaStart,u.thetaLength);break;case"SphereGeometry":a=new o.SphereGeometry(u.radius,u.widthSegments,u.heightSegments,u.phiStart,u.phiLength,u.thetaStart,u.thetaLength);break;case"SphereBufferGeometry":a=new o.SphereBufferGeometry(u.radius,u.widthSegments,u.heightSegments,u.phiStart,u.phiLength,u.thetaStart,u.thetaLength);break;case"DodecahedronGeometry":a=new o.DodecahedronGeometry(u.radius,u.detail);break;case"IcosahedronGeometry":a=new o.IcosahedronGeometry(u.radius,u.detail);break;case"OctahedronGeometry":a=new o.OctahedronGeometry(u.radius,u.detail);break;case"TetrahedronGeometry":a=new o.TetrahedronGeometry(u.radius,u.detail);break;case"RingGeometry":a=new o.RingGeometry(u.innerRadius,u.outerRadius,u.thetaSegments,u.phiSegments,u.thetaStart,u.thetaLength);break;case"TorusGeometry":a=new o.TorusGeometry(u.radius,u.tube,u.radialSegments,u.tubularSegments,u.arc);break;case"TorusKnotGeometry":a=new o.TorusKnotGeometry(u.radius,u.tube,u.radialSegments,u.tubularSegments,u.p,u.q,u.heightScale);break;case"BufferGeometry":a=n.parse(u);break;case"Geometry":a=r.parse(u.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+u.type+'"');continue}a.uuid=u.uuid,void 0!==u.name&&(a.name=u.name),t[u.uuid]=a}return t},parseMaterials:function(e,t){var r={};if(void 0!==e){var n=new o.MaterialLoader;n.setTextures(t);for(var i=0,s=e.length;s>i;i++){var a=n.parse(e[i]);r[a.uuid]=a}}return r},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var n=o.AnimationClip.parse(e[r]);t.push(n)}return t},parseImages:function(e,t){function r(e){return n.manager.itemStart(e),a.load(e,function(){n.manager.itemEnd(e)})}var n=this,i={};if(void 0!==e&&0<e.length){var s=new o.LoadingManager(t),a=new o.ImageLoader(s);a.setCrossOrigin(this.crossOrigin);for(var s=0,u=e.length;u>s;s++){var c=e[s],h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:n.texturePath+c.url;i[c.uuid]=r(h)}}return i},parseTextures:function(e,t){function r(e){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),o[e])}var n={};if(void 0!==e)for(var i=0,s=e.length;s>i;i++){var a=e[i];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===t[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);var u=new o.Texture(t[a.image]);u.needsUpdate=!0,u.uuid=a.uuid,void 0!==a.name&&(u.name=a.name),void 0!==a.mapping&&(u.mapping=r(a.mapping)),void 0!==a.offset&&(u.offset=new o.Vector2(a.offset[0],a.offset[1])),void 0!==a.repeat&&(u.repeat=new o.Vector2(a.repeat[0],a.repeat[1])),void 0!==a.minFilter&&(u.minFilter=r(a.minFilter)),void 0!==a.magFilter&&(u.magFilter=r(a.magFilter)),void 0!==a.anisotropy&&(u.anisotropy=a.anisotropy),Array.isArray(a.wrap)&&(u.wrapS=r(a.wrap[0]),u.wrapT=r(a.wrap[1])),n[a.uuid]=u}return n},parseObject:function(){var e=new o.Matrix4;return function(t,r,n){function i(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),r[e]}function s(e){return void 0!==e?(void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]):void 0}var a;switch(t.type){case"Scene":a=new o.Scene;break;case"PerspectiveCamera":a=new o.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":a=new o.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":a=new o.AmbientLight(t.color);break;case"DirectionalLight":a=new o.DirectionalLight(t.color,t.intensity);break;case"PointLight":a=new o.PointLight(t.color,t.intensity,t.distance,t.decay);break;case"SpotLight":a=new o.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent,t.decay);break;case"HemisphereLight":a=new o.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":a=new o.Mesh(i(t.geometry),s(t.material));break;case"LOD":a=new o.LOD;break;case"Line":a=new o.Line(i(t.geometry),s(t.material),t.mode);break;case"PointCloud":case"Points":a=new o.Points(i(t.geometry),s(t.material));break;case"Sprite":a=new o.Sprite(s(t.material));break;case"Group":a=new o.Group;break;default:a=new o.Object3D}if(a.uuid=t.uuid,void 0!==t.name&&(a.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(a.position,a.quaternion,a.scale)):(void 0!==t.position&&a.position.fromArray(t.position),void 0!==t.rotation&&a.rotation.fromArray(t.rotation),void 0!==t.scale&&a.scale.fromArray(t.scale)),void 0!==t.castShadow&&(a.castShadow=t.castShadow),void 0!==t.receiveShadow&&(a.receiveShadow=t.receiveShadow),void 0!==t.visible&&(a.visible=t.visible),void 0!==t.userData&&(a.userData=t.userData),void 0!==t.children)for(var u in t.children)a.add(this.parseObject(t.children[u],r,n));if("LOD"===t.type){t=t.levels;for(var c=0;c<t.length;c++){var h=t[c];u=a.getObjectByProperty("uuid",h.object),void 0!==u&&a.addLevel(u,h.distance)}}return a}}()},o.TextureLoader=function(e){this.manager=void 0!==e?e:o.DefaultLoadingManager},o.TextureLoader.prototype={constructor:o.TextureLoader,load:function(e,t,r,n){var i=new o.Texture,s=new o.ImageLoader(this.manager);return s.setCrossOrigin(this.crossOrigin),s.load(e,function(e){i.image=e,i.needsUpdate=!0,void 0!==t&&t(i)},r,n),i},setCrossOrigin:function(e){this.crossOrigin=e}},o.CubeTextureLoader=function(e){this.manager=void 0!==e?e:o.DefaultLoadingManager},o.CubeTextureLoader.prototype={constructor:o.CubeTextureLoader,load:function(e,t,r,n){function i(r){a.load(e[r],function(e){s.images[r]=e,u++,6===u&&(s.needsUpdate=!0,t&&t(s))},void 0,n)}var s=new o.CubeTexture([]),a=new o.ImageLoader;a.setCrossOrigin(this.crossOrigin);var u=0;for(r=0;r<e.length;++r)i(r);return s},setCrossOrigin:function(e){this.crossOrigin=e}},o.DataTextureLoader=o.BinaryTextureLoader=function(e){this.manager=void 0!==e?e:o.DefaultLoadingManager,this._parser=null},o.BinaryTextureLoader.prototype={constructor:o.BinaryTextureLoader,load:function(e,t,r,n){var i=this,s=new o.DataTexture,a=new o.XHRLoader(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setResponseType("arraybuffer"),a.load(e,function(e){(e=i._parser(e))&&(void 0!==e.image?s.image=e.image:void 0!==e.data&&(s.image.width=e.width,s.image.height=e.height,s.image.data=e.data),s.wrapS=void 0!==e.wrapS?e.wrapS:o.ClampToEdgeWrapping,s.wrapT=void 0!==e.wrapT?e.wrapT:o.ClampToEdgeWrapping,s.magFilter=void 0!==e.magFilter?e.magFilter:o.LinearFilter,s.minFilter=void 0!==e.minFilter?e.minFilter:o.LinearMipMapLinearFilter,s.anisotropy=void 0!==e.anisotropy?e.anisotropy:1,void 0!==e.format&&(s.format=e.format),void 0!==e.type&&(s.type=e.type),void 0!==e.mipmaps&&(s.mipmaps=e.mipmaps),1===e.mipmapCount&&(s.minFilter=o.LinearFilter),s.needsUpdate=!0,t&&t(s,e))},r,n),s},setCrossOrigin:function(e){this.crossOrigin=e}},o.CompressedTextureLoader=function(e){this.manager=void 0!==e?e:o.DefaultLoadingManager,this._parser=null},o.CompressedTextureLoader.prototype={constructor:o.CompressedTextureLoader,load:function(e,t,r,n){var i=this,s=[],a=new o.CompressedTexture;a.image=s;var u=new o.XHRLoader(this.manager);if(u.setCrossOrigin(this.crossOrigin),u.setResponseType("arraybuffer"),Array.isArray(e))for(var c=0,h=function(h){u.load(e[h],function(e){e=i._parser(e,!0),s[h]={width:e.width,height:e.height,format:e.format,mipmaps:e.mipmaps},c+=1,6===c&&(1===e.mipmapCount&&(a.minFilter=o.LinearFilter),a.format=e.format,a.needsUpdate=!0,t&&t(a))},r,n)},l=0,p=e.length;p>l;++l)h(l);else u.load(e,function(e){if(e=i._parser(e,!0),e.isCubemap)for(var r=e.mipmaps.length/e.mipmapCount,n=0;r>n;n++){s[n]={mipmaps:[]};for(var u=0;u<e.mipmapCount;u++)s[n].mipmaps.push(e.mipmaps[n*e.mipmapCount+u]),s[n].format=e.format,s[n].width=e.width,s[n].height=e.height}else a.image.width=e.width,a.image.height=e.height,a.mipmaps=e.mipmaps;1===e.mipmapCount&&(a.minFilter=o.LinearFilter),a.format=e.format,a.needsUpdate=!0,t&&t(a)},r,n);return a},setCrossOrigin:function(e){this.crossOrigin=e}},o.Material=function(){Object.defineProperty(this,"id",{value:o.MaterialIdCount++}),this.uuid=o.Math.generateUUID(),this.name="",this.type="Material",this.side=o.FrontSide,this.opacity=1,this.transparent=!1,this.blending=o.NormalBlending,this.blendSrc=o.SrcAlphaFactor,this.blendDst=o.OneMinusSrcAlphaFactor,this.blendEquation=o.AddEquation,this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null,this.depthFunc=o.LessEqualDepth,this.colorWrite=this.depthWrite=this.depthTest=!0,this.precision=null,this.polygonOffset=!1,this.overdraw=this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0,this._needsUpdate=this.visible=!0},o.Material.prototype={constructor:o.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0===r)console.warn("THREE.Material: '"+t+"' parameter is undefined.");else{var n=this[t];void 0===n?console.warn("THREE."+this.type+": '"+t+"' is not a property of this material."):n instanceof o.Color?n.set(r):n instanceof o.Vector3&&r instanceof o.Vector3?n.copy(r):this[t]="overdraw"===t?Number(r):r}}},toJSON:function(e){var t={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};return t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),this.color instanceof o.Color&&(t.color=this.color.getHex()),this.emissive instanceof o.Color&&(t.emissive=this.emissive.getHex()),this.specular instanceof o.Color&&(t.specular=this.specular.getHex()),void 0!==this.shininess&&(t.shininess=this.shininess),this.map instanceof o.Texture&&(t.map=this.map.toJSON(e).uuid),this.alphaMap instanceof o.Texture&&(t.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap instanceof o.Texture&&(t.lightMap=this.lightMap.toJSON(e).uuid),this.bumpMap instanceof o.Texture&&(t.bumpMap=this.bumpMap.toJSON(e).uuid,t.bumpScale=this.bumpScale),this.normalMap instanceof o.Texture&&(t.normalMap=this.normalMap.toJSON(e).uuid,t.normalScale=this.normalScale),this.displacementMap instanceof o.Texture&&(t.displacementMap=this.displacementMap.toJSON(e).uuid,t.displacementScale=this.displacementScale,t.displacementBias=this.displacementBias),this.specularMap instanceof o.Texture&&(t.specularMap=this.specularMap.toJSON(e).uuid),this.envMap instanceof o.Texture&&(t.envMap=this.envMap.toJSON(e).uuid,t.reflectivity=this.reflectivity),void 0!==this.size&&(t.size=this.size),void 0!==this.sizeAttenuation&&(t.sizeAttenuation=this.sizeAttenuation),void 0!==this.vertexColors&&this.vertexColors!==o.NoColors&&(t.vertexColors=this.vertexColors),void 0!==this.shading&&this.shading!==o.SmoothShading&&(t.shading=this.shading),void 0!==this.blending&&this.blending!==o.NormalBlending&&(t.blending=this.blending),void 0!==this.side&&this.side!==o.FrontSide&&(t.side=this.side),1>this.opacity&&(t.opacity=this.opacity),!0===this.transparent&&(t.transparent=this.transparent),0<this.alphaTest&&(t.alphaTest=this.alphaTest),!0===this.wireframe&&(t.wireframe=this.wireframe),1<this.wireframeLinewidth&&(t.wireframeLinewidth=this.wireframeLinewidth),t},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.side=e.side,this.opacity=e.opacity,this.transparent=e.transparent,this.blending=e.blending,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.alphaTest=e.alphaTest,this.overdraw=e.overdraw,this.visible=e.visible,this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})},get wrapAround(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set wrapAround(e){console.warn("THREE."+this.type+": .wrapAround has been removed.")},get wrapRGB(){return console.warn("THREE."+this.type+": .wrapRGB has been removed."),new o.Color}},o.EventDispatcher.prototype.apply(o.Material.prototype),o.MaterialIdCount=0,o.LineBasicMaterial=function(e){o.Material.call(this),this.type="LineBasicMaterial",this.color=new o.Color(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.vertexColors=o.NoColors,this.fog=!0,this.setValues(e)},o.LineBasicMaterial.prototype=Object.create(o.Material.prototype),o.LineBasicMaterial.prototype.constructor=o.LineBasicMaterial,o.LineBasicMaterial.prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.vertexColors=e.vertexColors,this.fog=e.fog,this},o.LineDashedMaterial=function(e){o.Material.call(this),this.type="LineDashedMaterial",this.color=new o.Color(16777215),this.scale=this.linewidth=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},o.LineDashedMaterial.prototype=Object.create(o.Material.prototype),o.LineDashedMaterial.prototype.constructor=o.LineDashedMaterial,o.LineDashedMaterial.prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this.vertexColors=e.vertexColors,this.fog=e.fog,this},o.MeshBasicMaterial=function(e){o.Material.call(this),this.type="MeshBasicMaterial",this.color=new o.Color(16777215),this.aoMap=this.map=null,this.aoMapIntensity=1,this.envMap=this.alphaMap=this.specularMap=null,this.combine=o.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=o.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=o.NoColors,this.morphTargets=this.skinning=!1,this.setValues(e)},o.MeshBasicMaterial.prototype=Object.create(o.Material.prototype),o.MeshBasicMaterial.prototype.constructor=o.MeshBasicMaterial,o.MeshBasicMaterial.prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},o.MeshLambertMaterial=function(e){o.Material.call(this),this.type="MeshLambertMaterial",this.color=new o.Color(16777215),this.emissive=new o.Color(0),this.envMap=this.alphaMap=this.specularMap=this.map=null,this.combine=o.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=o.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)},o.MeshLambertMaterial.prototype=Object.create(o.Material.prototype),o.MeshLambertMaterial.prototype.constructor=o.MeshLambertMaterial,o.MeshLambertMaterial.prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.emissive.copy(e.emissive),this.map=e.map,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},o.MeshPhongMaterial=function(e){o.Material.call(this),this.type="MeshPhongMaterial",this.color=new o.Color(16777215),this.emissive=new o.Color(0),this.specular=new o.Color(1118481),this.shininess=30,this.metal=!1,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new o.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.specularMap=null,this.combine=o.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=o.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=o.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)},o.MeshPhongMaterial.prototype=Object.create(o.Material.prototype),o.MeshPhongMaterial.prototype.constructor=o.MeshPhongMaterial,o.MeshPhongMaterial.prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.emissive.copy(e.emissive),this.specular.copy(e.specular),this.shininess=e.shininess,this.metal=e.metal,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissiveMap=e.emissiveMap,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},o.MeshDepthMaterial=function(e){o.Material.call(this),this.type="MeshDepthMaterial",this.wireframe=this.morphTargets=!1,this.wireframeLinewidth=1,this.setValues(e)},o.MeshDepthMaterial.prototype=Object.create(o.Material.prototype),o.MeshDepthMaterial.prototype.constructor=o.MeshDepthMaterial,o.MeshDepthMaterial.prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},o.MeshNormalMaterial=function(e){o.Material.call(this,e),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},o.MeshNormalMaterial.prototype=Object.create(o.Material.prototype),o.MeshNormalMaterial.prototype.constructor=o.MeshNormalMaterial,o.MeshNormalMaterial.prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},o.MultiMaterial=function(e){this.uuid=o.Math.generateUUID(),this.type="MultiMaterial",this.materials=e instanceof Array?e:[],this.visible=!0},o.MultiMaterial.prototype={constructor:o.MultiMaterial,toJSON:function(){for(var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},t=0,r=this.materials.length;r>t;t++)e.materials.push(this.materials[t].toJSON());return e.visible=this.visible,e},clone:function(){for(var e=new this.constructor,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e.visible=this.visible,e}},o.MeshFaceMaterial=o.MultiMaterial,o.PointsMaterial=function(e){o.Material.call(this),this.type="PointsMaterial",this.color=new o.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=o.NoColors,this.fog=!0,this.setValues(e)},o.PointsMaterial.prototype=Object.create(o.Material.prototype),o.PointsMaterial.prototype.constructor=o.PointsMaterial,o.PointsMaterial.prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.vertexColors=e.vertexColors,this.fog=e.fog,this},o.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new o.PointsMaterial(e)},o.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new o.PointsMaterial(e)},o.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new o.PointsMaterial(e)},o.ShaderMaterial=function(e){o.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=o.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=this.fog=!1,this.vertexColors=o.NoColors,this.derivatives=this.morphNormals=this.morphTargets=this.skinning=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))},o.ShaderMaterial.prototype=Object.create(o.Material.prototype),o.ShaderMaterial.prototype.constructor=o.ShaderMaterial,o.ShaderMaterial.prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=o.UniformsUtils.clone(e.uniforms),this.attributes=e.attributes,this.defines=e.defines,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.derivatives=e.derivatives,this},o.ShaderMaterial.prototype.toJSON=function(e){return e=o.Material.prototype.toJSON.call(this,e),e.uniforms=this.uniforms,e.attributes=this.attributes,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e},o.RawShaderMaterial=function(e){o.ShaderMaterial.call(this,e),this.type="RawShaderMaterial"},o.RawShaderMaterial.prototype=Object.create(o.ShaderMaterial.prototype),o.RawShaderMaterial.prototype.constructor=o.RawShaderMaterial,o.SpriteMaterial=function(e){o.Material.call(this),this.type="SpriteMaterial",this.color=new o.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},o.SpriteMaterial.prototype=Object.create(o.Material.prototype),o.SpriteMaterial.prototype.constructor=o.SpriteMaterial,o.SpriteMaterial.prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.fog=e.fog,this},o.Texture=function(e,t,r,n,i,s,a,u,c){Object.defineProperty(this,"id",{value:o.TextureIdCount++}),this.uuid=o.Math.generateUUID(),this.sourceFile=this.name="",this.image=void 0!==e?e:o.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:o.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:o.ClampToEdgeWrapping,this.wrapT=void 0!==n?n:o.ClampToEdgeWrapping,this.magFilter=void 0!==i?i:o.LinearFilter,this.minFilter=void 0!==s?s:o.LinearMipMapLinearFilter,this.anisotropy=void 0!==c?c:1,this.format=void 0!==a?a:o.RGBAFormat,this.type=void 0!==u?u:o.UnsignedByteType,this.offset=new o.Vector2(0,0),this.repeat=new o.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.version=0,this.onUpdate=null},o.Texture.DEFAULT_IMAGE=void 0,o.Texture.DEFAULT_MAPPING=o.UVMapping,o.Texture.prototype={constructor:o.Texture,set needsUpdate(e){!0===e&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this},toJSON:function(e){if(void 0!==e.textures[this.uuid])return e.textures[this.uuid];var t={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=o.Math.generateUUID()),void 0===e.images[r.uuid]){var n,i=e.images,s=r.uuid,a=r.uuid;void 0!==r.toDataURL?n=r:(n=document.createElement("canvas"),n.width=r.width,n.height=r.height,n.getContext("2d").drawImage(r,0,0,r.width,r.height)),n=2048<n.width||2048<n.height?n.toDataURL("image/jpeg",.6):n.toDataURL("image/png"),i[s]={uuid:a,url:n}}t.image=r.uuid}return e.textures[this.uuid]=t},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping===o.UVMapping){if(e.multiply(this.repeat),e.add(this.offset),0>e.x||1<e.x)switch(this.wrapS){case o.RepeatWrapping:e.x-=Math.floor(e.x);break;case o.ClampToEdgeWrapping:e.x=0>e.x?0:1;break;case o.MirroredRepeatWrapping:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x-=Math.floor(e.x)}if(0>e.y||1<e.y)switch(this.wrapT){case o.RepeatWrapping:e.y-=Math.floor(e.y);break;case o.ClampToEdgeWrapping:e.y=0>e.y?0:1;break;case o.MirroredRepeatWrapping:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y-=Math.floor(e.y)}this.flipY&&(e.y=1-e.y)}}},o.EventDispatcher.prototype.apply(o.Texture.prototype),o.TextureIdCount=0,o.CanvasTexture=function(e,t,r,n,i,s,a,u,c){o.Texture.call(this,e,t,r,n,i,s,a,u,c),this.needsUpdate=!0},o.CanvasTexture.prototype=Object.create(o.Texture.prototype),o.CanvasTexture.prototype.constructor=o.CanvasTexture,o.CubeTexture=function(e,t,r,n,i,s,a,u,c){t=void 0!==t?t:o.CubeReflectionMapping,o.Texture.call(this,e,t,r,n,i,s,a,u,c),this.images=e,this.flipY=!1},o.CubeTexture.prototype=Object.create(o.Texture.prototype),o.CubeTexture.prototype.constructor=o.CubeTexture,o.CubeTexture.prototype.copy=function(e){return o.Texture.prototype.copy.call(this,e),this.images=e.images,this},o.CompressedTexture=function(e,t,r,n,i,s,a,u,c,h,l){o.Texture.call(this,null,s,a,u,c,h,n,i,l),this.image={width:t,height:r},this.mipmaps=e,this.generateMipmaps=this.flipY=!1},o.CompressedTexture.prototype=Object.create(o.Texture.prototype),o.CompressedTexture.prototype.constructor=o.CompressedTexture,o.DataTexture=function(e,t,r,n,i,s,a,u,c,h,l){o.Texture.call(this,null,s,a,u,c,h,n,i,l),this.image={data:e,width:t,height:r},this.magFilter=void 0!==c?c:o.NearestFilter,this.minFilter=void 0!==h?h:o.NearestFilter,this.generateMipmaps=this.flipY=!1},o.DataTexture.prototype=Object.create(o.Texture.prototype),o.DataTexture.prototype.constructor=o.DataTexture,o.VideoTexture=function(e,t,r,n,i,s,a,u,c){function h(){requestAnimationFrame(h),e.readyState===e.HAVE_ENOUGH_DATA&&(l.needsUpdate=!0)}o.Texture.call(this,e,t,r,n,i,s,a,u,c),this.generateMipmaps=!1;var l=this;h()},o.VideoTexture.prototype=Object.create(o.Texture.prototype),o.VideoTexture.prototype.constructor=o.VideoTexture,o.Group=function(){o.Object3D.call(this),this.type="Group"},o.Group.prototype=Object.create(o.Object3D.prototype),o.Group.prototype.constructor=o.Group,o.Points=function(e,t){o.Object3D.call(this),this.type="Points",this.geometry=void 0!==e?e:new o.Geometry,this.material=void 0!==t?t:new o.PointsMaterial({color:16777215*Math.random()})},o.Points.prototype=Object.create(o.Object3D.prototype),o.Points.prototype.constructor=o.Points,o.Points.prototype.raycast=function(){var e=new o.Matrix4,t=new o.Ray;return function(r,n){function i(e,i){var o=t.distanceSqToPoint(e);if(c>o){var a=t.closestPointToPoint(e);a.applyMatrix4(s.matrixWorld);var u=r.ray.origin.distanceTo(a);u<r.near||u>r.far||n.push({distance:u,distanceToRay:Math.sqrt(o),point:a.clone(),index:i,face:null,object:s})}}var s=this,a=s.geometry,u=r.params.Points.threshold;if(e.getInverse(this.matrixWorld),t.copy(r.ray).applyMatrix4(e),null===a.boundingBox||!1!==t.isIntersectionBox(a.boundingBox)){
var u=u/((this.scale.x+this.scale.y+this.scale.z)/3),c=u*u,u=new o.Vector3;if(a instanceof o.BufferGeometry){var h=a.index,a=a.attributes.position.array;if(null!==h)for(var l=h.array,h=0,p=l.length;p>h;h++){var f=l[h];u.fromArray(a,3*f),i(u,f)}else for(h=0,l=a.length/3;l>h;h++)u.fromArray(a,3*h),i(u,h)}else for(u=a.vertices,h=0,l=u.length;l>h;h++)i(u[h],h)}}}(),o.Points.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},o.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new o.Points(e,t)},o.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new o.Points(e,t)},o.Line=function(e,t,r){return 1===r?(console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new o.LineSegments(e,t)):(o.Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new o.Geometry,void(this.material=void 0!==t?t:new o.LineBasicMaterial({color:16777215*Math.random()})))},o.Line.prototype=Object.create(o.Object3D.prototype),o.Line.prototype.constructor=o.Line,o.Line.prototype.raycast=function(){var e=new o.Matrix4,t=new o.Ray,r=new o.Sphere;return function(n,i){var s=n.linePrecision,s=s*s,a=this.geometry;if(null===a.boundingSphere&&a.computeBoundingSphere(),r.copy(a.boundingSphere),r.applyMatrix4(this.matrixWorld),!1!==n.ray.isIntersectionSphere(r)){e.getInverse(this.matrixWorld),t.copy(n.ray).applyMatrix4(e);var u=new o.Vector3,c=new o.Vector3,h=new o.Vector3,l=new o.Vector3,p=this instanceof o.LineSegments?2:1;if(a instanceof o.BufferGeometry){var f=a.index,d=a.attributes;if(null!==f)for(var a=f.array,d=d.position.array,f=0,m=a.length-1;m>f;f+=p){var v=a[f+1];u.fromArray(d,3*a[f]),c.fromArray(d,3*v),v=t.distanceSqToSegment(u,c,l,h),v>s||(l.applyMatrix4(this.matrixWorld),v=n.ray.origin.distanceTo(l),v<n.near||v>n.far||i.push({distance:v,point:h.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}))}else for(d=d.position.array,f=0,m=d.length/3-1;m>f;f+=p)u.fromArray(d,3*f),c.fromArray(d,3*f+3),v=t.distanceSqToSegment(u,c,l,h),v>s||(l.applyMatrix4(this.matrixWorld),v=n.ray.origin.distanceTo(l),v<n.near||v>n.far||i.push({distance:v,point:h.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}))}else if(a instanceof o.Geometry)for(u=a.vertices,c=u.length,f=0;c-1>f;f+=p)v=t.distanceSqToSegment(u[f],u[f+1],l,h),v>s||(l.applyMatrix4(this.matrixWorld),v=n.ray.origin.distanceTo(l),v<n.near||v>n.far||i.push({distance:v,point:h.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}))}}}(),o.Line.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},o.LineStrip=0,o.LinePieces=1,o.LineSegments=function(e,t){o.Line.call(this,e,t),this.type="LineSegments"},o.LineSegments.prototype=Object.create(o.Line.prototype),o.LineSegments.prototype.constructor=o.LineSegments,o.Mesh=function(e,t){o.Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new o.Geometry,this.material=void 0!==t?t:new o.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},o.Mesh.prototype=Object.create(o.Object3D.prototype),o.Mesh.prototype.constructor=o.Mesh,o.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1,this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;t>e;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},o.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},o.Mesh.prototype.raycast=function(){function e(e,t,r,n,i,s,a){return o.Triangle.barycoordFromPoint(e,t,r,n,v),i.multiplyScalar(v.x),s.multiplyScalar(v.y),a.multiplyScalar(v.z),i.add(s).add(a),i.clone()}function t(e,t,r,n,i,s,a){var u=e.material;return null===(u.side===o.BackSide?r.intersectTriangle(s,i,n,!0,a):r.intersectTriangle(n,i,s,u.side!==o.DoubleSide,a))?null:(y.copy(a),y.applyMatrix4(e.matrixWorld),r=t.ray.origin.distanceTo(y),r<t.near||r>t.far?null:{distance:r,point:y.clone(),object:e})}function r(r,n,i,s,h,l,p,v){return a.fromArray(s,3*l),u.fromArray(s,3*p),c.fromArray(s,3*v),(r=t(r,n,i,a,u,c,g))&&(h&&(f.fromArray(h,2*l),d.fromArray(h,2*p),m.fromArray(h,2*v),r.uv=e(g,a,u,c,f,d,m)),r.face=new o.Face3(l,p,v,o.Triangle.normal(a,u,c)),r.faceIndex=l),r}var n=new o.Matrix4,i=new o.Ray,s=new o.Sphere,a=new o.Vector3,u=new o.Vector3,c=new o.Vector3,h=new o.Vector3,l=new o.Vector3,p=new o.Vector3,f=new o.Vector2,d=new o.Vector2,m=new o.Vector2,v=new o.Vector3,g=new o.Vector3,y=new o.Vector3;return function(v,y){var _=this.geometry,b=this.material;if(void 0!==b){null===_.boundingSphere&&_.computeBoundingSphere();var x=this.matrixWorld;if(s.copy(_.boundingSphere),s.applyMatrix4(x),!1!==v.ray.isIntersectionSphere(s)&&(n.getInverse(x),i.copy(v.ray).applyMatrix4(n),null===_.boundingBox||!1!==i.isIntersectionBox(_.boundingBox))){var w,S;if(_ instanceof o.BufferGeometry){var M,E,b=_.index,x=_.attributes,_=x.position.array;if(void 0!==x.uv&&(w=x.uv.array),null!==b)for(var x=b.array,C=0,T=x.length;T>C;C+=3)b=x[C],M=x[C+1],E=x[C+2],(S=r(this,v,i,_,w,b,M,E))&&(S.faceIndex=Math.floor(C/3),y.push(S));else for(C=0,T=_.length;T>C;C+=9)b=C/3,M=b+1,E=b+2,(S=r(this,v,i,_,w,b,M,E))&&(S.index=b,y.push(S))}else if(_ instanceof o.Geometry){var A,P,x=b instanceof o.MeshFaceMaterial,C=!0===x?b.materials:null,T=_.vertices;M=_.faces,E=_.faceVertexUvs[0],0<E.length&&(w=E);for(var k=0,O=M.length;O>k;k++){var N=M[k];if(S=!0===x?C[N.materialIndex]:b,void 0!==S){if(E=T[N.a],A=T[N.b],P=T[N.c],!0===S.morphTargets){S=_.morphTargets;var D=this.morphTargetInfluences;a.set(0,0,0),u.set(0,0,0),c.set(0,0,0);for(var L=0,R=S.length;R>L;L++){var j=D[L];if(0!==j){var I=S[L].vertices;a.addScaledVector(h.subVectors(I[N.a],E),j),u.addScaledVector(l.subVectors(I[N.b],A),j),c.addScaledVector(p.subVectors(I[N.c],P),j)}}a.add(E),u.add(A),c.add(P),E=a,A=u,P=c}(S=t(this,v,i,E,A,P,g))&&(w&&(D=w[k],f.copy(D[0]),d.copy(D[1]),m.copy(D[2]),S.uv=e(g,E,A,P,f,d,m)),S.face=N,S.faceIndex=k,y.push(S))}}}}}}}(),o.Mesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},o.Bone=function(e){o.Object3D.call(this),this.type="Bone",this.skin=e},o.Bone.prototype=Object.create(o.Object3D.prototype),o.Bone.prototype.constructor=o.Bone,o.Bone.prototype.copy=function(e){return o.Object3D.prototype.copy.call(this,e),this.skin=e.skin,this},o.Skeleton=function(e,t,r){if(this.useVertexTexture=void 0!==r?r:!0,this.identityMatrix=new o.Matrix4,e=e||[],this.bones=e.slice(0),this.useVertexTexture?(e=Math.sqrt(4*this.bones.length),e=o.Math.nextPowerOfTwo(Math.ceil(e)),this.boneTextureHeight=this.boneTextureWidth=e=Math.max(e,4),this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new o.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,o.RGBAFormat,o.FloatType)):this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else for(console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[],t=0,e=this.bones.length;e>t;t++)this.boneInverses.push(new o.Matrix4)},o.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;t>e;e++){var r=new o.Matrix4;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},o.Skeleton.prototype.pose=function(){for(var e,t=0,r=this.bones.length;r>t;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,r=this.bones.length;r>t;t++)(e=this.bones[t])&&(e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},o.Skeleton.prototype.update=function(){var e=new o.Matrix4;return function(){for(var t=0,r=this.bones.length;r>t;t++)e.multiplyMatrices(this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix,this.boneInverses[t]),e.flattenToArrayOffset(this.boneMatrices,16*t);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),o.Skeleton.prototype.clone=function(){return new o.Skeleton(this.bones,this.boneInverses,this.useVertexTexture)},o.SkinnedMesh=function(e,t,r){if(o.Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new o.Matrix4,this.bindMatrixInverse=new o.Matrix4,e=[],this.geometry&&void 0!==this.geometry.bones){for(var n,i=0,s=this.geometry.bones.length;s>i;++i)n=this.geometry.bones[i],t=new o.Bone(this),e.push(t),t.name=n.name,t.position.fromArray(n.pos),t.quaternion.fromArray(n.rotq),void 0!==n.scl&&t.scale.fromArray(n.scl);for(i=0,s=this.geometry.bones.length;s>i;++i)n=this.geometry.bones[i],-1!==n.parent&&null!==n.parent?e[n.parent].add(e[i]):this.add(e[i])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new o.Skeleton(e,void 0,r),this.matrixWorld)},o.SkinnedMesh.prototype=Object.create(o.Mesh.prototype),o.SkinnedMesh.prototype.constructor=o.SkinnedMesh,o.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},o.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},o.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof o.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],r=1/t.lengthManhattan();1/0!==r?t.multiplyScalar(r):t.set(1)}},o.SkinnedMesh.prototype.updateMatrixWorld=function(e){o.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},o.SkinnedMesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material,this.useVertexTexture).copy(this)},o.LOD=function(){o.Object3D.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}})},o.LOD.prototype=Object.create(o.Object3D.prototype),o.LOD.prototype.constructor=o.LOD,o.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=this.levels,n=0;n<r.length&&!(t<r[n].distance);n++);r.splice(n,0,{distance:t,object:e}),this.add(e)},o.LOD.prototype.getObjectForDistance=function(e){for(var t=this.levels,r=1,n=t.length;n>r&&!(e<t[r].distance);r++);return t[r-1].object},o.LOD.prototype.raycast=function(){var e=new o.Vector3;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var n=t.ray.origin.distanceTo(e);this.getObjectForDistance(n).raycast(t,r)}}(),o.LOD.prototype.update=function(){var e=new o.Vector3,t=new o.Vector3;return function(r){var n=this.levels;if(1<n.length){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(this.matrixWorld),r=e.distanceTo(t),n[0].object.visible=!0;for(var i=1,o=n.length;o>i&&r>=n[i].distance;i++)n[i-1].object.visible=!1,n[i].object.visible=!0;for(;o>i;i++)n[i].object.visible=!1}}}(),o.LOD.prototype.copy=function(e){o.Object3D.prototype.copy.call(this,e,!1),e=e.levels;for(var t=0,r=e.length;r>t;t++){var n=e[t];this.addLevel(n.object.clone(),n.distance)}return this},o.LOD.prototype.toJSON=function(e){e=o.Object3D.prototype.toJSON.call(this,e),e.object.levels=[];for(var t=this.levels,r=0,n=t.length;n>r;r++){var i=t[r];e.object.levels.push({object:i.object.uuid,distance:i.distance})}return e},o.Sprite=function(){var e=new Uint16Array([0,1,2,0,2,3]),t=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),r=new Float32Array([0,0,1,0,1,1,0,1]),n=new o.BufferGeometry;return n.setIndex(new o.BufferAttribute(e,1)),n.addAttribute("position",new o.BufferAttribute(t,3)),n.addAttribute("uv",new o.BufferAttribute(r,2)),function(e){o.Object3D.call(this),this.type="Sprite",this.geometry=n,this.material=void 0!==e?e:new o.SpriteMaterial}}(),o.Sprite.prototype=Object.create(o.Object3D.prototype),o.Sprite.prototype.constructor=o.Sprite,o.Sprite.prototype.raycast=function(){var e=new o.Vector3;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var n=t.ray.distanceSqToPoint(e);n>this.scale.x*this.scale.y||r.push({distance:Math.sqrt(n),point:this.position,face:null,object:this})}}(),o.Sprite.prototype.clone=function(){return new this.constructor(this.material).copy(this)},o.Particle=o.Sprite,o.LensFlare=function(e,t,r,n,i){o.Object3D.call(this),this.lensFlares=[],this.positionScreen=new o.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,r,n,i)},o.LensFlare.prototype=Object.create(o.Object3D.prototype),o.LensFlare.prototype.constructor=o.LensFlare,o.LensFlare.prototype.add=function(e,t,r,n,i,s){void 0===t&&(t=-1),void 0===r&&(r=0),void 0===s&&(s=1),void 0===i&&(i=new o.Color(16777215)),void 0===n&&(n=o.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:e,size:t,distance:r,x:0,y:0,z:0,scale:1,rotation:0,opacity:s,color:i,blending:n})},o.LensFlare.prototype.updateLensFlares=function(){var e,t,r=this.lensFlares.length,n=2*-this.positionScreen.x,i=2*-this.positionScreen.y;for(e=0;r>e;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+n*t.distance,t.y=this.positionScreen.y+i*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},o.LensFlare.prototype.copy=function(e){o.Object3D.prototype.copy.call(this,e),this.positionScreen.copy(e.positionScreen),this.customUpdateCallback=e.customUpdateCallback;for(var t=0,r=e.lensFlares.length;r>t;t++)this.lensFlares.push(e.lensFlares[t]);return this},o.Scene=function(){o.Object3D.call(this),this.type="Scene",this.overrideMaterial=this.fog=null,this.autoUpdate=!0},o.Scene.prototype=Object.create(o.Object3D.prototype),o.Scene.prototype.constructor=o.Scene,o.Scene.prototype.copy=function(e){return o.Object3D.prototype.copy.call(this,e),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},o.Fog=function(e,t,r){this.name="",this.color=new o.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3},o.Fog.prototype.clone=function(){return new o.Fog(this.color.getHex(),this.near,this.far)},o.FogExp2=function(e,t){this.name="",this.color=new o.Color(e),this.density=void 0!==t?t:25e-5},o.FogExp2.prototype.clone=function(){return new o.FogExp2(this.color.getHex(),this.density)},o.ShaderChunk={},o.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n	diffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",o.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n	uniform sampler2D alphaMap;\n\n#endif\n",o.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n	if ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",o.ShaderChunk.aomap_fragment="#ifdef USE_AOMAP\n\n	totalAmbientLight *= ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n#endif\n",o.ShaderChunk.aomap_pars_fragment="#ifdef USE_AOMAP\n\n	uniform sampler2D aoMap;\n	uniform float aoMapIntensity;\n\n#endif",o.ShaderChunk.begin_vertex="\nvec3 transformed = vec3( position );\n",o.ShaderChunk.beginnormal_vertex="\nvec3 objectNormal = vec3( normal );\n",o.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n\n\n\n	vec2 dHdxy_fwd() {\n\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n		return vec2( dBx, dBy );\n\n	}\n\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n\n		float fDet = dot( vSigmaX, R1 );\n\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n\n	}\n\n#endif\n",o.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n	diffuseColor.rgb *= vColor;\n\n#endif",o.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif\n",o.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif",o.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n	vColor.xyz = color.xyz;\n\n#endif",o.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n\n	return normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n\n}\n\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\n	return normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	float distance = dot( planeNormal, point - pointOnPlane );\n\n	return - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	return sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n\n	if ( decayExponent > 0.0 ) {\n\n	  return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n	}\n\n	return 1.0;\n\n}\n\nvec3 F_Schlick( in vec3 specularColor, in float dotLH ) {\n\n\n	float fresnel = exp2( ( -5.55437 * dotLH - 6.98316 ) * dotLH );\n\n	return ( 1.0 - specularColor ) * fresnel + specularColor;\n\n}\n\nfloat G_BlinnPhong_Implicit( /* in float dotNL, in float dotNV */ ) {\n\n\n	return 0.25;\n\n}\n\nfloat D_BlinnPhong( in float shininess, in float dotNH ) {\n\n\n	return ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_BlinnPhong( in vec3 specularColor, in float shininess, in vec3 normal, in vec3 lightDir, in vec3 viewDir ) {\n\n	vec3 halfDir = normalize( lightDir + viewDir );\n\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotLH = saturate( dot( lightDir, halfDir ) );\n\n	vec3 F = F_Schlick( specularColor, dotLH );\n\n	float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n	float D = D_BlinnPhong( shininess, dotNH );\n\n	return F * G * D;\n\n}\n\nvec3 inputToLinear( in vec3 a ) {\n\n	#ifdef GAMMA_INPUT\n\n		return pow( a, vec3( float( GAMMA_FACTOR ) ) );\n\n	#else\n\n		return a;\n\n	#endif\n\n}\n\nvec3 linearToOutput( in vec3 a ) {\n\n	#ifdef GAMMA_OUTPUT\n\n		return pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n\n	#else\n\n		return a;\n\n	#endif\n\n}\n",o.ShaderChunk.defaultnormal_vertex="#ifdef FLIP_SIDED\n\n	objectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n",o.ShaderChunk.displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\n	transformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n\n#endif\n",o.ShaderChunk.displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\n	uniform sampler2D displacementMap;\n	uniform float displacementScale;\n	uniform float displacementBias;\n\n#endif\n",o.ShaderChunk.emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\n	vec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n	emissiveColor.rgb = inputToLinear( emissiveColor.rgb );\n\n	totalEmissiveLight *= emissiveColor.rgb;\n\n#endif\n",o.ShaderChunk.emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\n	uniform sampler2D emissiveMap;\n\n#endif\n",o.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n		#ifdef ENVMAP_MODE_REFLECTION\n\n			vec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n		#else\n\n			vec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n		#endif\n\n	#else\n\n		vec3 reflectVec = vReflect;\n\n	#endif\n\n	#ifdef DOUBLE_SIDED\n		float flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n	#else\n		float flipNormal = 1.0;\n	#endif\n\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#elif defined( ENVMAP_TYPE_EQUIREC )\n		vec2 sampleUV;\n		sampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n		sampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n		vec4 envColor = texture2D( envMap, sampleUV );\n\n	#elif defined( ENVMAP_TYPE_SPHERE )\n		vec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n	#endif\n\n	envColor.xyz = inputToLinear( envColor.xyz );\n\n	#ifdef ENVMAP_BLENDING_MULTIPLY\n\n		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_MIX )\n\n		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_ADD )\n\n		outgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n	#endif\n\n#endif\n",o.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n	uniform float reflectivity;\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	uniform float flipEnvMap;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		uniform float refractionRatio;\n\n	#else\n\n		varying vec3 vReflect;\n\n	#endif\n\n#endif\n",o.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	varying vec3 vReflect;\n\n	uniform float refractionRatio;\n\n#endif\n",o.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n	vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n	#ifdef ENVMAP_MODE_REFLECTION\n\n		vReflect = reflect( cameraToVertex, worldNormal );\n\n	#else\n\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n	#endif\n\n#endif\n",o.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n	#else\n\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n\n	#endif\n\n	#ifdef FOG_EXP2\n\n		float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\n	#else\n\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n\n	#endif\n	\n	outgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif",o.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n	uniform vec3 fogColor;\n\n	#ifdef FOG_EXP2\n\n		uniform float fogDensity;\n\n	#else\n\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n\n#endif",o.ShaderChunk.hemilight_fragment="#if MAX_HEMI_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec3 lightDir = hemisphereLightDirection[ i ];\n\n		float dotProduct = dot( normal, lightDir );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vec3 lightColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		totalAmbientLight += lightColor;\n\n	}\n\n#endif\n\n",o.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n	totalAmbientLight += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\n#endif\n",o.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n	uniform sampler2D lightMap;\n	uniform float lightMapIntensity;\n\n#endif",o.ShaderChunk.lights_lambert_pars_vertex="#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n",o.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vec3( 0.0 );\n\n#endif\n\nvec3 normal = normalize( transformedNormal );\n\n#if MAX_POINT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = pointLightColor[ i ];\n\n		vec3 lVector = pointLightPosition[ i ] - mvPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n\n		float attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\n		float dotProduct = dot( normal, lightDir );\n\n		vLightFront += lightColor * attenuation * saturate( dotProduct );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += lightColor * attenuation * saturate( - dotProduct );\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = spotLightColor[ i ];\n\n		vec3 lightPosition = spotLightPosition[ i ];\n		vec3 lVector = lightPosition - mvPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], lightDir );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\n\n\n			float attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n			attenuation *= spotEffect;\n\n\n			float dotProduct = dot( normal, lightDir );\n\n			vLightFront += lightColor * attenuation * saturate( dotProduct );\n\n			#ifdef DOUBLE_SIDED\n\n				vLightBack += lightColor * attenuation * saturate( - dotProduct );\n\n			#endif\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec3 lightColor = directionalLightColor[ i ];\n\n		vec3 lightDir = directionalLightDirection[ i ];\n\n\n		float dotProduct = dot( normal, lightDir );\n\n		vLightFront += lightColor * saturate( dotProduct );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += lightColor * saturate( - dotProduct );\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec3 lightDir = hemisphereLightDirection[ i ];\n\n\n		float dotProduct = dot( normal, lightDir );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		#ifdef DOUBLE_SIDED\n\n			float hemiDiffuseWeightBack = - 0.5 * dotProduct + 0.5;\n\n			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n		#endif\n\n	}\n\n#endif\n",o.ShaderChunk.lights_phong_fragment="vec3 viewDir = normalize( vViewPosition );\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = pointLightColor[ i ];\n\n		vec3 lightPosition = pointLightPosition[ i ];\n		vec3 lVector = lightPosition + vViewPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n\n		float attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\n		float cosineTerm = saturate( dot( normal, lightDir ) );\n\n		totalDiffuseLight += lightColor * attenuation * cosineTerm;\n\n\n		vec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n		totalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\n\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = spotLightColor[ i ];\n\n		vec3 lightPosition = spotLightPosition[ i ];\n		vec3 lVector = lightPosition + vViewPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], lightDir );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\n\n\n			float attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n			attenuation *= spotEffect;\n\n\n			float cosineTerm = saturate( dot( normal, lightDir ) );\n\n			totalDiffuseLight += lightColor * attenuation * cosineTerm;\n\n\n			vec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n			totalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec3 lightColor = directionalLightColor[ i ];\n\n		vec3 lightDir = directionalLightDirection[ i ];\n\n\n		float cosineTerm = saturate( dot( normal, lightDir ) );\n\n		totalDiffuseLight += lightColor * cosineTerm;\n\n\n		vec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n		totalSpecularLight += brdf * specularStrength * lightColor * cosineTerm;\n\n	}\n\n#endif\n",o.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n	varying vec3 vNormal;\n\n#endif\n",o.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\n#endif\n",
o.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n	vWorldPosition = worldPosition.xyz;\n\n#endif\n",o.ShaderChunk.linear_to_gamma_fragment="\n	outgoingLight = linearToOutput( outgoingLight );\n",o.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",o.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n	uniform float logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n#endif\n",o.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n	uniform float logDepthBufFC;\n\n#endif",o.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n	gl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		vFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n	#endif\n\n#endif",o.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n	vec4 texelColor = texture2D( map, vUv );\n\n	texelColor.xyz = inputToLinear( texelColor.xyz );\n\n	diffuseColor *= texelColor;\n\n#endif\n",o.ShaderChunk.map_pars_fragment="#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif",o.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n	diffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n",o.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n	uniform vec4 offsetRepeat;\n	uniform sampler2D map;\n\n#endif\n",o.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n	objectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	objectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	objectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	objectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n#endif\n",o.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n	#ifndef USE_MORPHNORMALS\n\n	uniform float morphTargetInfluences[ 8 ];\n\n	#else\n\n	uniform float morphTargetInfluences[ 4 ];\n\n	#endif\n\n#endif",o.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n	transformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	transformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	transformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	transformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n	#ifndef USE_MORPHNORMALS\n\n	transformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	transformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	transformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	transformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n	#endif\n\n#endif\n",o.ShaderChunk.normal_phong_fragment="#ifndef FLAT_SHADED\n\n	vec3 normal = normalize( vNormal );\n\n	#ifdef DOUBLE_SIDED\n\n		normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n	#endif\n\n#else\n\n	vec3 fdx = dFdx( vViewPosition );\n	vec3 fdy = dFdy( vViewPosition );\n	vec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\n",o.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n\n\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n\n		vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n\n	}\n\n#endif\n",o.ShaderChunk.project_vertex="#ifdef USE_SKINNING\n\n	vec4 mvPosition = modelViewMatrix * skinned;\n\n#else\n\n	vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n",o.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n	for ( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		float texelSizeY =  1.0 / shadowMapSize[ i ].y;\n\n		float shadow = 0.0;\n\n#if defined( POINT_LIGHT_SHADOWS )\n\n		bool isPointLight = shadowDarkness[ i ] < 0.0;\n\n		if ( isPointLight ) {\n\n			float realShadowDarkness = abs( shadowDarkness[ i ] );\n\n			vec3 lightToPosition = vShadowCoord[ i ].xyz;\n\n	#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n			vec3 bd3D = normalize( lightToPosition );\n			float dp = length( lightToPosition );\n\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D, texelSizeY ) ), shadowBias[ i ], shadow );\n\n\n	#if defined( SHADOWMAP_TYPE_PCF )\n			const float Dr = 1.25;\n	#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n			const float Dr = 2.25;\n	#endif\n\n			float os = Dr *  2.0 * texelSizeY;\n\n			const vec3 Gsd = vec3( - 1, 0, 1 );\n\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zzz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zxz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xxz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xzz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zzx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zxx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xxx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xzx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zzy * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zxy * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xxy * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xzy * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zyz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xyz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zyx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xyx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.yzz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.yxz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.yxx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.yzx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\n			shadow *= realShadowDarkness * ( 1.0 / 21.0 );\n\n	#else \n			vec3 bd3D = normalize( lightToPosition );\n			float dp = length( lightToPosition );\n\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D, texelSizeY ) ), shadowBias[ i ], shadow );\n\n			shadow *= realShadowDarkness;\n\n	#endif\n\n		} else {\n\n#endif \n			float texelSizeX =  1.0 / shadowMapSize[ i ].x;\n\n			vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\n			bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n			bool inFrustum = all( inFrustumVec );\n\n			bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n			bool frustumTest = all( frustumTestVec );\n\n			if ( frustumTest ) {\n\n	#if defined( SHADOWMAP_TYPE_PCF )\n\n\n				/*\n					for ( float y = -1.25; y <= 1.25; y += 1.25 )\n						for ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n							vec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n							float fDepth = unpackDepth( rgbaDepth );\n							if ( fDepth < shadowCoord.z )\n								shadow += 1.0;\n					}\n					shadow /= 9.0;\n				*/\n\n				shadowCoord.z += shadowBias[ i ];\n\n				const float ShadowDelta = 1.0 / 9.0;\n\n				float xPixelOffset = texelSizeX;\n				float yPixelOffset = texelSizeY;\n\n				float dx0 = - 1.25 * xPixelOffset;\n				float dy0 = - 1.25 * yPixelOffset;\n				float dx1 = 1.25 * xPixelOffset;\n				float dy1 = 1.25 * yPixelOffset;\n\n				float fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				shadow *= shadowDarkness[ i ];\n\n	#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\n				shadowCoord.z += shadowBias[ i ];\n\n				float xPixelOffset = texelSizeX;\n				float yPixelOffset = texelSizeY;\n\n				float dx0 = - 1.0 * xPixelOffset;\n				float dy0 = - 1.0 * yPixelOffset;\n				float dx1 = 1.0 * xPixelOffset;\n				float dy1 = 1.0 * yPixelOffset;\n\n				mat3 shadowKernel;\n				mat3 depthKernel;\n\n				depthKernel[ 0 ][ 0 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				depthKernel[ 0 ][ 1 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				depthKernel[ 0 ][ 2 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				depthKernel[ 1 ][ 0 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				depthKernel[ 1 ][ 1 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				depthKernel[ 1 ][ 2 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				depthKernel[ 2 ][ 0 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				depthKernel[ 2 ][ 1 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				depthKernel[ 2 ][ 2 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n				vec3 shadowZ = vec3( shadowCoord.z );\n				shadowKernel[ 0 ] = vec3( lessThan( depthKernel[ 0 ], shadowZ ) );\n				shadowKernel[ 0 ] *= vec3( 0.25 );\n\n				shadowKernel[ 1 ] = vec3( lessThan( depthKernel[ 1 ], shadowZ ) );\n				shadowKernel[ 1 ] *= vec3( 0.25 );\n\n				shadowKernel[ 2 ] = vec3( lessThan( depthKernel[ 2 ], shadowZ ) );\n				shadowKernel[ 2 ] *= vec3( 0.25 );\n\n				vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[ i ].xy );\n\n				shadowKernel[ 0 ] = mix( shadowKernel[ 1 ], shadowKernel[ 0 ], fractionalCoord.x );\n				shadowKernel[ 1 ] = mix( shadowKernel[ 2 ], shadowKernel[ 1 ], fractionalCoord.x );\n\n				vec4 shadowValues;\n				shadowValues.x = mix( shadowKernel[ 0 ][ 1 ], shadowKernel[ 0 ][ 0 ], fractionalCoord.y );\n				shadowValues.y = mix( shadowKernel[ 0 ][ 2 ], shadowKernel[ 0 ][ 1 ], fractionalCoord.y );\n				shadowValues.z = mix( shadowKernel[ 1 ][ 1 ], shadowKernel[ 1 ][ 0 ], fractionalCoord.y );\n				shadowValues.w = mix( shadowKernel[ 1 ][ 2 ], shadowKernel[ 1 ][ 1 ], fractionalCoord.y );\n\n				shadow = dot( shadowValues, vec4( 1.0 ) ) * shadowDarkness[ i ];\n\n	#else \n				shadowCoord.z += shadowBias[ i ];\n\n				vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n				float fDepth = unpackDepth( rgbaDepth );\n\n				if ( fDepth < shadowCoord.z )\n					shadow = shadowDarkness[ i ];\n\n	#endif\n\n			}\n\n#ifdef SHADOWMAP_DEBUG\n\n			if ( inFrustum ) {\n\n				if ( i == 0 ) {\n\n					outgoingLight *= vec3( 1.0, 0.5, 0.0 );\n\n				} else if ( i == 1 ) {\n\n					outgoingLight *= vec3( 0.0, 1.0, 0.8 );\n\n				} else {\n\n					outgoingLight *= vec3( 0.0, 0.5, 1.0 );\n\n				}\n\n			}\n\n#endif\n\n#if defined( POINT_LIGHT_SHADOWS )\n\n		}\n\n#endif\n\n		shadowMask = shadowMask * vec3( 1.0 - shadow );\n\n	}\n\n#endif\n",o.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n	uniform sampler2D shadowMap[ MAX_SHADOWS ];\n	uniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform float shadowBias[ MAX_SHADOWS ];\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n	float unpackDepth( const in vec4 rgba_depth ) {\n\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		float depth = dot( rgba_depth, bit_shift );\n		return depth;\n\n	}\n\n	#if defined(POINT_LIGHT_SHADOWS)\n\n\n		void adjustShadowValue1K( const float testDepth, const vec4 textureData, const float bias, inout float shadowValue ) {\n\n			const vec4 bitSh = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n			if ( testDepth >= dot( textureData, bitSh ) * 1000.0 + bias )\n				shadowValue += 1.0;\n\n		}\n\n\n		vec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n\n			vec3 absV = abs( v );\n\n\n			float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n			absV *= scaleToCube;\n\n\n			v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n\n\n			vec2 planar = v.xy;\n\n			float almostATexel = 1.5 * texelSizeY;\n			float almostOne = 1.0 - almostATexel;\n\n			if ( absV.z >= almostOne ) {\n\n				if ( v.z > 0.0 )\n					planar.x = 4.0 - v.x;\n\n			} else if ( absV.x >= almostOne ) {\n\n				float signX = sign( v.x );\n				planar.x = v.z * signX + 2.0 * signX;\n\n			} else if ( absV.y >= almostOne ) {\n\n				float signY = sign( v.y );\n				planar.x = v.x + 2.0 * signY + 2.0;\n				planar.y = v.z * signY - 2.0;\n\n			}\n\n\n			return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n		}\n\n	#endif\n\n#endif\n",o.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n#endif",o.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n	for ( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n			vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n	}\n\n#endif",o.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",o.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n\n	#ifdef BONE_TEXTURE\n\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n\n			y = dy * ( y + 0.5 );\n\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n			mat4 bone = mat4( v1, v2, v3, v4 );\n\n			return bone;\n\n		}\n\n	#else\n\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n\n		}\n\n	#endif\n\n#endif\n",o.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	skinned  = bindMatrixInverse * skinned;\n\n#endif\n",o.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n#endif\n",o.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n\n#else\n\n	specularStrength = 1.0;\n\n#endif",o.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n	uniform sampler2D specularMap;\n\n#endif",o.ShaderChunk.uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	varying vec2 vUv2;\n\n#endif",o.ShaderChunk.uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	attribute vec2 uv2;\n	varying vec2 vUv2;\n\n#endif",o.ShaderChunk.uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	vUv2 = uv2;\n\n#endif",o.ShaderChunk.uv_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n	varying vec2 vUv;\n\n#endif",o.ShaderChunk.uv_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n\n#endif\n",o.ShaderChunk.uv_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",o.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n	#ifdef USE_SKINNING\n\n		vec4 worldPosition = modelMatrix * skinned;\n\n	#else\n\n		vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\n	#endif\n\n#endif\n",o.UniformsUtils={merge:function(e){for(var t={},r=0;r<e.length;r++){var n,i=this.clone(e[r]);for(n in i)t[n]=i[n]}return t},clone:function(e){var t,r={};for(t in e){r[t]={};for(var n in e[t]){var i=e[t][n];i instanceof o.Color||i instanceof o.Vector2||i instanceof o.Vector3||i instanceof o.Vector4||i instanceof o.Matrix3||i instanceof o.Matrix4||i instanceof o.Texture?r[t][n]=i.clone():Array.isArray(i)?r[t][n]=i.slice():r[t][n]=i}}return r}},o.UniformsLib={common:{diffuse:{type:"c",value:new o.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new o.Vector4(0,0,1,1)},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98}},aomap:{aoMap:{type:"t",value:null},aoMapIntensity:{type:"f",value:1}},lightmap:{lightMap:{type:"t",value:null},lightMapIntensity:{type:"f",value:1}},emissivemap:{emissiveMap:{type:"t",value:null}},bumpmap:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new o.Vector2(1,1)}},displacementmap:{displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:1},displacementBias:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new o.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},points:{psColor:{type:"c",value:new o.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new o.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new o.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},o.ShaderLib={basic:{uniforms:o.UniformsUtils.merge([o.UniformsLib.common,o.UniformsLib.aomap,o.UniformsLib.fog,o.UniformsLib.shadowmap]),vertexShader:[o.ShaderChunk.common,o.ShaderChunk.uv_pars_vertex,o.ShaderChunk.uv2_pars_vertex,o.ShaderChunk.envmap_pars_vertex,o.ShaderChunk.color_pars_vertex,o.ShaderChunk.morphtarget_pars_vertex,o.ShaderChunk.skinning_pars_vertex,o.ShaderChunk.shadowmap_pars_vertex,o.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",o.ShaderChunk.uv_vertex,o.ShaderChunk.uv2_vertex,o.ShaderChunk.color_vertex,o.ShaderChunk.skinbase_vertex,"	#ifdef USE_ENVMAP",o.ShaderChunk.beginnormal_vertex,o.ShaderChunk.morphnormal_vertex,o.ShaderChunk.skinnormal_vertex,o.ShaderChunk.defaultnormal_vertex,"	#endif",o.ShaderChunk.begin_vertex,o.ShaderChunk.morphtarget_vertex,o.ShaderChunk.skinning_vertex,o.ShaderChunk.project_vertex,o.ShaderChunk.logdepthbuf_vertex,o.ShaderChunk.worldpos_vertex,o.ShaderChunk.envmap_vertex,o.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",o.ShaderChunk.common,o.ShaderChunk.color_pars_fragment,o.ShaderChunk.uv_pars_fragment,o.ShaderChunk.uv2_pars_fragment,o.ShaderChunk.map_pars_fragment,o.ShaderChunk.alphamap_pars_fragment,o.ShaderChunk.aomap_pars_fragment,o.ShaderChunk.envmap_pars_fragment,o.ShaderChunk.fog_pars_fragment,o.ShaderChunk.shadowmap_pars_fragment,o.ShaderChunk.specularmap_pars_fragment,o.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	vec3 outgoingLight = vec3( 0.0 );\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	vec3 totalAmbientLight = vec3( 1.0 );\n	vec3 shadowMask = vec3( 1.0 );",o.ShaderChunk.logdepthbuf_fragment,o.ShaderChunk.map_fragment,o.ShaderChunk.color_fragment,o.ShaderChunk.alphamap_fragment,o.ShaderChunk.alphatest_fragment,o.ShaderChunk.specularmap_fragment,o.ShaderChunk.aomap_fragment,o.ShaderChunk.shadowmap_fragment,"	outgoingLight = diffuseColor.rgb * totalAmbientLight * shadowMask;",o.ShaderChunk.envmap_fragment,o.ShaderChunk.linear_to_gamma_fragment,o.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n}"].join("\n")},lambert:{uniforms:o.UniformsUtils.merge([o.UniformsLib.common,o.UniformsLib.fog,o.UniformsLib.lights,o.UniformsLib.shadowmap,{emissive:{type:"c",value:new o.Color(0)}}]),vertexShader:["#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n	varying vec3 vLightBack;\n#endif",o.ShaderChunk.common,o.ShaderChunk.uv_pars_vertex,o.ShaderChunk.uv2_pars_vertex,o.ShaderChunk.envmap_pars_vertex,o.ShaderChunk.lights_lambert_pars_vertex,o.ShaderChunk.color_pars_vertex,o.ShaderChunk.morphtarget_pars_vertex,o.ShaderChunk.skinning_pars_vertex,o.ShaderChunk.shadowmap_pars_vertex,o.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",o.ShaderChunk.uv_vertex,o.ShaderChunk.uv2_vertex,o.ShaderChunk.color_vertex,o.ShaderChunk.beginnormal_vertex,o.ShaderChunk.morphnormal_vertex,o.ShaderChunk.skinbase_vertex,o.ShaderChunk.skinnormal_vertex,o.ShaderChunk.defaultnormal_vertex,o.ShaderChunk.begin_vertex,o.ShaderChunk.morphtarget_vertex,o.ShaderChunk.skinning_vertex,o.ShaderChunk.project_vertex,o.ShaderChunk.logdepthbuf_vertex,o.ShaderChunk.worldpos_vertex,o.ShaderChunk.envmap_vertex,o.ShaderChunk.lights_lambert_vertex,o.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nuniform vec3 ambientLightColor;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n	varying vec3 vLightBack;\n#endif",o.ShaderChunk.common,o.ShaderChunk.color_pars_fragment,o.ShaderChunk.uv_pars_fragment,o.ShaderChunk.uv2_pars_fragment,o.ShaderChunk.map_pars_fragment,o.ShaderChunk.alphamap_pars_fragment,o.ShaderChunk.envmap_pars_fragment,o.ShaderChunk.fog_pars_fragment,o.ShaderChunk.shadowmap_pars_fragment,o.ShaderChunk.specularmap_pars_fragment,o.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	vec3 outgoingLight = vec3( 0.0 );\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	vec3 totalAmbientLight = ambientLightColor;\n	vec3 shadowMask = vec3( 1.0 );",o.ShaderChunk.logdepthbuf_fragment,o.ShaderChunk.map_fragment,o.ShaderChunk.color_fragment,o.ShaderChunk.alphamap_fragment,o.ShaderChunk.alphatest_fragment,o.ShaderChunk.specularmap_fragment,o.ShaderChunk.shadowmap_fragment,"	#ifdef DOUBLE_SIDED\n		if ( gl_FrontFacing )\n			outgoingLight += diffuseColor.rgb * ( vLightFront * shadowMask + totalAmbientLight ) + emissive;\n		else\n			outgoingLight += diffuseColor.rgb * ( vLightBack * shadowMask + totalAmbientLight ) + emissive;\n	#else\n		outgoingLight += diffuseColor.rgb * ( vLightFront * shadowMask + totalAmbientLight ) + emissive;\n	#endif",o.ShaderChunk.envmap_fragment,o.ShaderChunk.linear_to_gamma_fragment,o.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n}"].join("\n")},phong:{uniforms:o.UniformsUtils.merge([o.UniformsLib.common,o.UniformsLib.aomap,o.UniformsLib.lightmap,o.UniformsLib.emissivemap,o.UniformsLib.bumpmap,o.UniformsLib.normalmap,o.UniformsLib.displacementmap,o.UniformsLib.fog,o.UniformsLib.lights,o.UniformsLib.shadowmap,{emissive:{type:"c",value:new o.Color(0)},specular:{type:"c",value:new o.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:["#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n#endif",o.ShaderChunk.common,o.ShaderChunk.uv_pars_vertex,o.ShaderChunk.uv2_pars_vertex,o.ShaderChunk.displacementmap_pars_vertex,o.ShaderChunk.envmap_pars_vertex,o.ShaderChunk.lights_phong_pars_vertex,o.ShaderChunk.color_pars_vertex,o.ShaderChunk.morphtarget_pars_vertex,o.ShaderChunk.skinning_pars_vertex,o.ShaderChunk.shadowmap_pars_vertex,o.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",o.ShaderChunk.uv_vertex,o.ShaderChunk.uv2_vertex,o.ShaderChunk.color_vertex,o.ShaderChunk.beginnormal_vertex,o.ShaderChunk.morphnormal_vertex,o.ShaderChunk.skinbase_vertex,o.ShaderChunk.skinnormal_vertex,o.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED\n	vNormal = normalize( transformedNormal );\n#endif",o.ShaderChunk.begin_vertex,o.ShaderChunk.displacementmap_vertex,o.ShaderChunk.morphtarget_vertex,o.ShaderChunk.skinning_vertex,o.ShaderChunk.project_vertex,o.ShaderChunk.logdepthbuf_vertex,"	vViewPosition = - mvPosition.xyz;",o.ShaderChunk.worldpos_vertex,o.ShaderChunk.envmap_vertex,o.ShaderChunk.lights_phong_vertex,o.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;",o.ShaderChunk.common,o.ShaderChunk.color_pars_fragment,o.ShaderChunk.uv_pars_fragment,o.ShaderChunk.uv2_pars_fragment,o.ShaderChunk.map_pars_fragment,o.ShaderChunk.alphamap_pars_fragment,o.ShaderChunk.aomap_pars_fragment,o.ShaderChunk.lightmap_pars_fragment,o.ShaderChunk.emissivemap_pars_fragment,o.ShaderChunk.envmap_pars_fragment,o.ShaderChunk.fog_pars_fragment,o.ShaderChunk.lights_phong_pars_fragment,o.ShaderChunk.shadowmap_pars_fragment,o.ShaderChunk.bumpmap_pars_fragment,o.ShaderChunk.normalmap_pars_fragment,o.ShaderChunk.specularmap_pars_fragment,o.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	vec3 outgoingLight = vec3( 0.0 );\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	vec3 totalAmbientLight = ambientLightColor;\n	vec3 totalEmissiveLight = emissive;\n	vec3 shadowMask = vec3( 1.0 );",o.ShaderChunk.logdepthbuf_fragment,o.ShaderChunk.map_fragment,o.ShaderChunk.color_fragment,o.ShaderChunk.alphamap_fragment,o.ShaderChunk.alphatest_fragment,o.ShaderChunk.specularmap_fragment,o.ShaderChunk.normal_phong_fragment,o.ShaderChunk.lightmap_fragment,o.ShaderChunk.hemilight_fragment,o.ShaderChunk.aomap_fragment,o.ShaderChunk.emissivemap_fragment,o.ShaderChunk.lights_phong_fragment,o.ShaderChunk.shadowmap_fragment,"totalDiffuseLight *= shadowMask;\ntotalSpecularLight *= shadowMask;\n#ifdef METAL\n	outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) * specular + totalSpecularLight + totalEmissiveLight;\n#else\n	outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) + totalSpecularLight + totalEmissiveLight;\n#endif",o.ShaderChunk.envmap_fragment,o.ShaderChunk.linear_to_gamma_fragment,o.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n}"].join("\n")},points:{uniforms:o.UniformsUtils.merge([o.UniformsLib.points,o.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",o.ShaderChunk.common,o.ShaderChunk.color_pars_vertex,o.ShaderChunk.shadowmap_pars_vertex,o.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",o.ShaderChunk.color_vertex,"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n	#ifdef USE_SIZEATTENUATION\n		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n	#else\n		gl_PointSize = size;\n	#endif\n	gl_Position = projectionMatrix * mvPosition;",o.ShaderChunk.logdepthbuf_vertex,o.ShaderChunk.worldpos_vertex,o.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",o.ShaderChunk.common,o.ShaderChunk.color_pars_fragment,o.ShaderChunk.map_particle_pars_fragment,o.ShaderChunk.fog_pars_fragment,o.ShaderChunk.shadowmap_pars_fragment,o.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	vec3 outgoingLight = vec3( 0.0 );\n	vec4 diffuseColor = vec4( psColor, opacity );\n	vec3 shadowMask = vec3( 1.0 );",o.ShaderChunk.logdepthbuf_fragment,o.ShaderChunk.map_particle_fragment,o.ShaderChunk.color_fragment,o.ShaderChunk.alphatest_fragment,o.ShaderChunk.shadowmap_fragment,"	outgoingLight = diffuseColor.rgb * shadowMask;",o.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n}"].join("\n")
},dashed:{uniforms:o.UniformsUtils.merge([o.UniformsLib.common,o.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;",o.ShaderChunk.common,o.ShaderChunk.color_pars_vertex,o.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",o.ShaderChunk.color_vertex,"	vLineDistance = scale * lineDistance;\n	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n	gl_Position = projectionMatrix * mvPosition;",o.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;",o.ShaderChunk.common,o.ShaderChunk.color_pars_fragment,o.ShaderChunk.fog_pars_fragment,o.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	if ( mod( vLineDistance, totalSize ) > dashSize ) {\n		discard;\n	}\n	vec3 outgoingLight = vec3( 0.0 );\n	vec4 diffuseColor = vec4( diffuse, opacity );",o.ShaderChunk.logdepthbuf_fragment,o.ShaderChunk.color_fragment,"	outgoingLight = diffuseColor.rgb;",o.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[o.ShaderChunk.common,o.ShaderChunk.morphtarget_pars_vertex,o.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",o.ShaderChunk.begin_vertex,o.ShaderChunk.morphtarget_vertex,o.ShaderChunk.project_vertex,o.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;\nuniform float mFar;\nuniform float opacity;",o.ShaderChunk.common,o.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",o.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n	#else\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n	#endif\n	float color = 1.0 - smoothstep( mNear, mFar, depth );\n	gl_FragColor = vec4( vec3( color ), opacity );\n}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",o.ShaderChunk.common,o.ShaderChunk.morphtarget_pars_vertex,o.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n	vNormal = normalize( normalMatrix * normal );",o.ShaderChunk.begin_vertex,o.ShaderChunk.morphtarget_vertex,o.ShaderChunk.project_vertex,o.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vNormal;",o.ShaderChunk.common,o.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",o.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",o.ShaderChunk.common,o.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n	vWorldPosition = transformDirection( position, modelMatrix );\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",o.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;",o.ShaderChunk.common,o.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",o.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",o.ShaderChunk.common,o.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n	vWorldPosition = transformDirection( position, modelMatrix );\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",o.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;",o.ShaderChunk.common,o.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\nvec3 direction = normalize( vWorldPosition );\nvec2 sampleUV;\nsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\nsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\ngl_FragColor = texture2D( tEquirect, sampleUV );",o.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[o.ShaderChunk.common,o.ShaderChunk.morphtarget_pars_vertex,o.ShaderChunk.skinning_pars_vertex,o.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",o.ShaderChunk.skinbase_vertex,o.ShaderChunk.begin_vertex,o.ShaderChunk.morphtarget_vertex,o.ShaderChunk.skinning_vertex,o.ShaderChunk.project_vertex,o.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[o.ShaderChunk.common,o.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {\n	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n	const vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\n	res -= res.xxyz * bit_mask;\n	return res;\n}\nvoid main() {",o.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT\n		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );\n	#else\n		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n	#endif\n}"].join("\n")},distanceRGBA:{uniforms:{lightPos:{type:"v3",value:new o.Vector3(0,0,0)}},vertexShader:["varying vec4 vWorldPosition;",o.ShaderChunk.common,o.ShaderChunk.morphtarget_pars_vertex,o.ShaderChunk.skinning_pars_vertex,"void main() {",o.ShaderChunk.skinbase_vertex,o.ShaderChunk.begin_vertex,o.ShaderChunk.morphtarget_vertex,o.ShaderChunk.skinning_vertex,o.ShaderChunk.project_vertex,o.ShaderChunk.worldpos_vertex,"vWorldPosition = worldPosition;\n}"].join("\n"),fragmentShader:["uniform vec3 lightPos;\nvarying vec4 vWorldPosition;",o.ShaderChunk.common,"vec4 pack1K ( float depth ) {\n   depth /= 1000.0;\n   const vec4 bitSh = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n	const vec4 bitMsk = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n	vec4 res = fract( depth * bitSh );\n	res -= res.xxyz * bitMsk;\n	return res; \n}\nfloat unpack1K ( vec4 color ) {\n	const vec4 bitSh = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n	return dot( color, bitSh ) * 1000.0;\n}\nvoid main () {\n	gl_FragColor = pack1K( length( vWorldPosition.xyz - lightPos.xyz ) );\n}"].join("\n")}},o.WebGLRenderer=function(e){function t(e,t,r,n){!0===F&&(e*=n,t*=n,r*=n),ye.clearColor(e,t,r,n)}function r(){we.init(),ye.viewport(ie,oe,se,ae),t(U.r,U.g,U.b,G)}function n(){re=J=null,te="",ee=-1,de=!0,we.reset()}function i(e){e.preventDefault(),n(),r(),Se.clear()}function s(e){e=e.target,e.removeEventListener("dispose",s);e:{var t=Se.get(e);if(e.image&&t.__image__webglTextureCube)ye.deleteTexture(t.__image__webglTextureCube);else{if(void 0===t.__webglInit)break e;ye.deleteTexture(t.__webglTexture)}Se["delete"](e)}ve.textures--}function a(e){e=e.target,e.removeEventListener("dispose",a);var t=Se.get(e),r=Se.get(e.texture);if(e&&void 0!==r.__webglTexture){if(ye.deleteTexture(r.__webglTexture),e instanceof o.WebGLRenderTargetCube)for(r=0;6>r;r++)ye.deleteFramebuffer(t.__webglFramebuffer[r]),ye.deleteRenderbuffer(t.__webglRenderbuffer[r]);else ye.deleteFramebuffer(t.__webglFramebuffer),ye.deleteRenderbuffer(t.__webglRenderbuffer);Se["delete"](e.texture),Se["delete"](e)}ve.textures--}function u(e){e=e.target,e.removeEventListener("dispose",u),c(e),Se["delete"](e)}function c(e){var t=Se.get(e).program;e.program=void 0,void 0!==t&&Ee.releaseProgram(t)}function h(e,t){return t[0]-e[0]}function l(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function p(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function f(e,t,r,n,i){var o;r.transparent?(n=q,o=++$):(n=H,o=++W),o=n[o],void 0!==o?(o.id=e.id,o.object=e,o.geometry=t,o.material=r,o.z=pe.z,o.group=i):(o={id:e.id,object:e,geometry:t,material:r,z:pe.z,group:i},n.push(o))}function d(e,t){if(!1!==e.visible){if(0!==(e.channels.mask&t.channels.mask))if(e instanceof o.Light)z.push(e);else if(e instanceof o.Sprite)K.push(e);else if(e instanceof o.LensFlare)Y.push(e);else if(e instanceof o.ImmediateRenderObject)!0===Q.sortObjects&&(pe.setFromMatrixPosition(e.matrixWorld),pe.applyProjection(le)),f(e,null,e.material,pe.z,null);else if((e instanceof o.Mesh||e instanceof o.Line||e instanceof o.Points)&&(e instanceof o.SkinnedMesh&&e.skeleton.update(),!1===e.frustumCulled||!0===he.intersectsObject(e))){var r=e.material;if(!0===r.visible){!0===Q.sortObjects&&(pe.setFromMatrixPosition(e.matrixWorld),pe.applyProjection(le));var n=Me.update(e);if(r instanceof o.MeshFaceMaterial)for(var i=n.groups,s=r.materials,r=0,a=i.length;a>r;r++){var u=i[r],c=s[u.materialIndex];!0===c.visible&&f(e,n,c,pe.z,u)}else f(e,n,r,pe.z,null)}}for(n=e.children,r=0,a=n.length;a>r;r++)d(n[r],t)}}function m(e,t,r,n,i){for(var s=0,a=e.length;a>s;s++){var u=e[s],c=u.object,h=u.geometry,l=void 0===i?u.material:i,u=u.group;if(c.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,c.matrixWorld),c.normalMatrix.getNormalMatrix(c.modelViewMatrix),c instanceof o.ImmediateRenderObject){v(l);var p=g(t,r,n,l,c);te="",c.render(function(e){Q.renderBufferImmediate(e,p,l)})}else Q.renderBufferDirect(t,r,n,h,l,c,u)}}function v(e){e.side!==o.DoubleSide?we.enable(ye.CULL_FACE):we.disable(ye.CULL_FACE),we.setFlipSided(e.side===o.BackSide),!0===e.transparent?we.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha):we.setBlending(o.NoBlending),we.setDepthFunc(e.depthFunc),we.setDepthTest(e.depthTest),we.setDepthWrite(e.depthWrite),we.setColorWrite(e.colorWrite),we.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function g(e,t,r,n,i){ne=0;var s=Se.get(n);if(n.needsUpdate||!s.program){e:{var a=Se.get(n),h=Ee.getParameters(n,t,r,i),l=Ee.getProgramCode(n,h),p=a.program,f=!0;if(void 0===p)n.addEventListener("dispose",u);else if(p.code!==l)c(n);else{if(void 0!==h.shaderID)break e;f=!1}if(f&&(h.shaderID?(p=o.ShaderLib[h.shaderID],a.__webglShader={name:n.type,uniforms:o.UniformsUtils.clone(p.uniforms),vertexShader:p.vertexShader,fragmentShader:p.fragmentShader}):a.__webglShader={name:n.type,uniforms:n.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader},n.__webglShader=a.__webglShader,p=Ee.acquireProgram(n,h,l),a.program=p,n.program=p),h=p.getAttributes(),n.morphTargets)for(l=n.numSupportedMorphTargets=0;l<Q.maxMorphTargets;l++)0<=h["morphTarget"+l]&&n.numSupportedMorphTargets++;if(n.morphNormals)for(l=n.numSupportedMorphNormals=0;l<Q.maxMorphNormals;l++)0<=h["morphNormal"+l]&&n.numSupportedMorphNormals++;a.uniformsList=[];var d,h=a.program.getUniforms();for(d in a.__webglShader.uniforms)(l=h[d])&&a.uniformsList.push([a.__webglShader.uniforms[d],l])}n.needsUpdate=!1}if(l=p=f=!1,a=s.program,d=a.getUniforms(),h=s.__webglShader.uniforms,a.id!==J&&(ye.useProgram(a.program),J=a.id,l=p=f=!0),n.id!==ee&&(-1===ee&&(l=!0),ee=n.id,p=!0),(f||e!==re)&&(ye.uniformMatrix4fv(d.projectionMatrix,!1,e.projectionMatrix.elements),xe.logarithmicDepthBuffer&&ye.uniform1f(d.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==re&&(re=e),(n instanceof o.ShaderMaterial||n instanceof o.MeshPhongMaterial||n.envMap)&&void 0!==d.cameraPosition&&(pe.setFromMatrixPosition(e.matrixWorld),ye.uniform3f(d.cameraPosition,pe.x,pe.y,pe.z)),(n instanceof o.MeshPhongMaterial||n instanceof o.MeshLambertMaterial||n instanceof o.MeshBasicMaterial||n instanceof o.ShaderMaterial||n.skinning)&&void 0!==d.viewMatrix&&ye.uniformMatrix4fv(d.viewMatrix,!1,e.matrixWorldInverse.elements)),n.skinning&&(i.bindMatrix&&void 0!==d.bindMatrix&&ye.uniformMatrix4fv(d.bindMatrix,!1,i.bindMatrix.elements),i.bindMatrixInverse&&void 0!==d.bindMatrixInverse&&ye.uniformMatrix4fv(d.bindMatrixInverse,!1,i.bindMatrixInverse.elements),xe.floatVertexTextures&&i.skeleton&&i.skeleton.useVertexTexture?(void 0!==d.boneTexture&&(f=_(),ye.uniform1i(d.boneTexture,f),Q.setTexture(i.skeleton.boneTexture,f)),void 0!==d.boneTextureWidth&&ye.uniform1i(d.boneTextureWidth,i.skeleton.boneTextureWidth),void 0!==d.boneTextureHeight&&ye.uniform1i(d.boneTextureHeight,i.skeleton.boneTextureHeight)):i.skeleton&&i.skeleton.boneMatrices&&void 0!==d.boneGlobalMatrices&&ye.uniformMatrix4fv(d.boneGlobalMatrices,!1,i.skeleton.boneMatrices)),p){if(r&&n.fog&&(h.fogColor.value=r.color,r instanceof o.Fog?(h.fogNear.value=r.near,h.fogFar.value=r.far):r instanceof o.FogExp2&&(h.fogDensity.value=r.density)),n instanceof o.MeshPhongMaterial||n instanceof o.MeshLambertMaterial||n.lights){if(de){var m,v,g,x,l=!0,w=f=0,S=0,C=me,T=e.matrixWorldInverse,A=C.directional.colors,P=C.directional.positions,O=C.point.colors,N=C.point.positions,D=C.point.distances,L=C.point.decays,R=C.spot.colors,j=C.spot.positions,I=C.spot.distances,V=C.spot.directions,F=C.spot.anglesCos,B=C.spot.exponents,U=C.spot.decays,G=C.hemi.skyColors,z=C.hemi.groundColors,H=C.hemi.positions,W=0,q=0,$=0,X=0,K=0,Y=0,Z=0,te=0,ie=m=0;for(r=x=ie=0,p=t.length;p>r;r++)m=t[r],v=m.color,g=m.intensity,x=m.distance,m instanceof o.AmbientLight?m.visible&&(f+=v.r,w+=v.g,S+=v.b):m instanceof o.DirectionalLight?(K+=1,m.visible&&(fe.setFromMatrixPosition(m.matrixWorld),pe.setFromMatrixPosition(m.target.matrixWorld),fe.sub(pe),fe.transformDirection(T),m=3*W,P[m+0]=fe.x,P[m+1]=fe.y,P[m+2]=fe.z,b(A,m,v,g),W+=1)):m instanceof o.PointLight?(Y+=1,m.visible&&(ie=3*q,b(O,ie,v,g),pe.setFromMatrixPosition(m.matrixWorld),pe.applyMatrix4(T),N[ie+0]=pe.x,N[ie+1]=pe.y,N[ie+2]=pe.z,D[q]=x,L[q]=0===m.distance?0:m.decay,q+=1)):m instanceof o.SpotLight?(Z+=1,m.visible&&(ie=3*$,b(R,ie,v,g),fe.setFromMatrixPosition(m.matrixWorld),pe.copy(fe).applyMatrix4(T),j[ie+0]=pe.x,j[ie+1]=pe.y,j[ie+2]=pe.z,I[$]=x,pe.setFromMatrixPosition(m.target.matrixWorld),fe.sub(pe),fe.transformDirection(T),V[ie+0]=fe.x,V[ie+1]=fe.y,V[ie+2]=fe.z,F[$]=Math.cos(m.angle),B[$]=m.exponent,U[$]=0===m.distance?0:m.decay,$+=1)):m instanceof o.HemisphereLight&&(te+=1,m.visible&&(fe.setFromMatrixPosition(m.matrixWorld),fe.transformDirection(T),x=3*X,H[x+0]=fe.x,H[x+1]=fe.y,H[x+2]=fe.z,v=m.color,m=m.groundColor,b(G,x,v,g),b(z,x,m,g),X+=1));for(r=3*W,p=Math.max(A.length,3*K);p>r;r++)A[r]=0;for(r=3*q,p=Math.max(O.length,3*Y);p>r;r++)O[r]=0;for(r=3*$,p=Math.max(R.length,3*Z);p>r;r++)R[r]=0;for(r=3*X,p=Math.max(G.length,3*te);p>r;r++)G[r]=0;for(r=3*X,p=Math.max(z.length,3*te);p>r;r++)z[r]=0;C.directional.length=W,C.point.length=q,C.spot.length=$,C.hemi.length=X,C.ambient[0]=f,C.ambient[1]=w,C.ambient[2]=S,de=!1}l?(l=me,h.ambientLightColor.value=l.ambient,h.directionalLightColor.value=l.directional.colors,h.directionalLightDirection.value=l.directional.positions,h.pointLightColor.value=l.point.colors,h.pointLightPosition.value=l.point.positions,h.pointLightDistance.value=l.point.distances,h.pointLightDecay.value=l.point.decays,h.spotLightColor.value=l.spot.colors,h.spotLightPosition.value=l.spot.positions,h.spotLightDistance.value=l.spot.distances,h.spotLightDirection.value=l.spot.directions,h.spotLightAngleCos.value=l.spot.anglesCos,h.spotLightExponent.value=l.spot.exponents,h.spotLightDecay.value=l.spot.decays,h.hemisphereLightSkyColor.value=l.hemi.skyColors,h.hemisphereLightGroundColor.value=l.hemi.groundColors,h.hemisphereLightDirection.value=l.hemi.positions,y(h,!0)):y(h,!1)}if(n instanceof o.MeshBasicMaterial||n instanceof o.MeshLambertMaterial||n instanceof o.MeshPhongMaterial){h.opacity.value=n.opacity,h.diffuse.value=n.color,n.emissive&&(h.emissive.value=n.emissive),h.map.value=n.map,h.specularMap.value=n.specularMap,h.alphaMap.value=n.alphaMap,n.aoMap&&(h.aoMap.value=n.aoMap,h.aoMapIntensity.value=n.aoMapIntensity);var oe;n.map?oe=n.map:n.specularMap?oe=n.specularMap:n.displacementMap?oe=n.displacementMap:n.normalMap?oe=n.normalMap:n.bumpMap?oe=n.bumpMap:n.alphaMap?oe=n.alphaMap:n.emissiveMap&&(oe=n.emissiveMap),void 0!==oe&&(oe instanceof o.WebGLRenderTarget&&(oe=oe.texture),l=oe.offset,oe=oe.repeat,h.offsetRepeat.value.set(l.x,l.y,oe.x,oe.y)),h.envMap.value=n.envMap,h.flipEnvMap.value=n.envMap instanceof o.WebGLRenderTargetCube?1:-1,h.reflectivity.value=n.reflectivity,h.refractionRatio.value=n.refractionRatio}if(n instanceof o.LineBasicMaterial?(h.diffuse.value=n.color,h.opacity.value=n.opacity):n instanceof o.LineDashedMaterial?(h.diffuse.value=n.color,h.opacity.value=n.opacity,h.dashSize.value=n.dashSize,h.totalSize.value=n.dashSize+n.gapSize,h.scale.value=n.scale):n instanceof o.PointsMaterial?(h.psColor.value=n.color,h.opacity.value=n.opacity,h.size.value=n.size,h.scale.value=k.height/2,h.map.value=n.map,null!==n.map&&(e=n.map.offset,oe=n.map.repeat,h.offsetRepeat.value.set(e.x,e.y,oe.x,oe.y))):n instanceof o.MeshPhongMaterial?(h.specular.value=n.specular,h.shininess.value=Math.max(n.shininess,1e-4),n.lightMap&&(h.lightMap.value=n.lightMap,h.lightMapIntensity.value=n.lightMapIntensity),n.emissiveMap&&(h.emissiveMap.value=n.emissiveMap),n.bumpMap&&(h.bumpMap.value=n.bumpMap,h.bumpScale.value=n.bumpScale),n.normalMap&&(h.normalMap.value=n.normalMap,h.normalScale.value.copy(n.normalScale)),n.displacementMap&&(h.displacementMap.value=n.displacementMap,h.displacementScale.value=n.displacementScale,h.displacementBias.value=n.displacementBias)):n instanceof o.MeshDepthMaterial?(h.mNear.value=e.near,h.mFar.value=e.far,h.opacity.value=n.opacity):n instanceof o.MeshNormalMaterial&&(h.opacity.value=n.opacity),i.receiveShadow&&!n._shadowPass&&h.shadowMatrix)for(e=n=0,oe=t.length;oe>e;e++)l=t[e],!0===l.castShadow&&(l instanceof o.PointLight||l instanceof o.SpotLight||l instanceof o.DirectionalLight)&&(r=l.shadow,l instanceof o.PointLight?(pe.setFromMatrixPosition(l.matrixWorld).negate(),r.matrix.identity().setPosition(pe),h.shadowDarkness.value[n]=-r.darkness):h.shadowDarkness.value[n]=r.darkness,h.shadowMatrix.value[n]=r.matrix,h.shadowMap.value[n]=r.map,h.shadowMapSize.value[n]=r.mapSize,h.shadowBias.value[n]=r.bias,n++);for(t=s.uniformsList,s=0,n=t.length;n>s;s++)if(e=t[s][0],!1!==e.needsUpdate)switch(h=e.type,r=e.value,oe=t[s][1],h){case"1i":ye.uniform1i(oe,r);break;case"1f":ye.uniform1f(oe,r);break;case"2f":ye.uniform2f(oe,r[0],r[1]);break;case"3f":ye.uniform3f(oe,r[0],r[1],r[2]);break;case"4f":ye.uniform4f(oe,r[0],r[1],r[2],r[3]);break;case"1iv":ye.uniform1iv(oe,r);break;case"3iv":ye.uniform3iv(oe,r);break;case"1fv":ye.uniform1fv(oe,r);break;case"2fv":ye.uniform2fv(oe,r);break;case"3fv":ye.uniform3fv(oe,r);break;case"4fv":ye.uniform4fv(oe,r);break;case"Matrix3fv":ye.uniformMatrix3fv(oe,!1,r);break;case"Matrix4fv":ye.uniformMatrix4fv(oe,!1,r);break;case"i":ye.uniform1i(oe,r);break;case"f":ye.uniform1f(oe,r);break;case"v2":ye.uniform2f(oe,r.x,r.y);break;case"v3":ye.uniform3f(oe,r.x,r.y,r.z);break;case"v4":ye.uniform4f(oe,r.x,r.y,r.z,r.w);break;case"c":ye.uniform3f(oe,r.r,r.g,r.b);break;case"iv1":ye.uniform1iv(oe,r);break;case"iv":ye.uniform3iv(oe,r);break;case"fv1":ye.uniform1fv(oe,r);break;case"fv":ye.uniform3fv(oe,r);break;case"v2v":for(void 0===e._array&&(e._array=new Float32Array(2*r.length)),p=h=0,l=r.length;l>h;h++,p+=2)e._array[p+0]=r[h].x,e._array[p+1]=r[h].y;ye.uniform2fv(oe,e._array);break;case"v3v":for(void 0===e._array&&(e._array=new Float32Array(3*r.length)),p=h=0,l=r.length;l>h;h++,p+=3)e._array[p+0]=r[h].x,e._array[p+1]=r[h].y,e._array[p+2]=r[h].z;ye.uniform3fv(oe,e._array);break;case"v4v":for(void 0===e._array&&(e._array=new Float32Array(4*r.length)),p=h=0,l=r.length;l>h;h++,p+=4)e._array[p+0]=r[h].x,e._array[p+1]=r[h].y,e._array[p+2]=r[h].z,e._array[p+3]=r[h].w;ye.uniform4fv(oe,e._array);break;case"m3":ye.uniformMatrix3fv(oe,!1,r.elements);break;case"m3v":for(void 0===e._array&&(e._array=new Float32Array(9*r.length)),h=0,l=r.length;l>h;h++)r[h].flattenToArrayOffset(e._array,9*h);ye.uniformMatrix3fv(oe,!1,e._array);break;case"m4":ye.uniformMatrix4fv(oe,!1,r.elements);break;case"m4v":for(void 0===e._array&&(e._array=new Float32Array(16*r.length)),h=0,l=r.length;l>h;h++)r[h].flattenToArrayOffset(e._array,16*h);ye.uniformMatrix4fv(oe,!1,e._array);break;case"t":if(p=_(),ye.uniform1i(oe,p),!r)continue;r instanceof o.CubeTexture||Array.isArray(r.image)&&6===r.image.length?M(r,p):r instanceof o.WebGLRenderTargetCube?E(r.texture,p):r instanceof o.WebGLRenderTarget?Q.setTexture(r.texture,p):Q.setTexture(r,p);break;case"tv":for(void 0===e._array&&(e._array=[]),h=0,l=e.value.length;l>h;h++)e._array[h]=_();for(ye.uniform1iv(oe,e._array),h=0,l=e.value.length;l>h;h++)r=e.value[h],p=e._array[h],r&&(r instanceof o.CubeTexture||r.image instanceof Array&&6===r.image.length?M(r,p):r instanceof o.WebGLRenderTarget?Q.setTexture(r.texture,p):r instanceof o.WebGLRenderTargetCube?E(r.texture,p):Q.setTexture(r,p));break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+h)}}return ye.uniformMatrix4fv(d.modelViewMatrix,!1,i.modelViewMatrix.elements),d.normalMatrix&&ye.uniformMatrix3fv(d.normalMatrix,!1,i.normalMatrix.elements),void 0!==d.modelMatrix&&ye.uniformMatrix4fv(d.modelMatrix,!1,i.matrixWorld.elements),a}function y(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.pointLightDecay.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.spotLightDecay.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function _(){var e=ne;return e>=xe.maxTextures&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+xe.maxTextures),ne+=1,e}function b(e,t,r,n){e[t+0]=r.r*n,e[t+1]=r.g*n,e[t+2]=r.b*n}function x(e,t,r){r?(ye.texParameteri(e,ye.TEXTURE_WRAP_S,P(t.wrapS)),ye.texParameteri(e,ye.TEXTURE_WRAP_T,P(t.wrapT)),ye.texParameteri(e,ye.TEXTURE_MAG_FILTER,P(t.magFilter)),ye.texParameteri(e,ye.TEXTURE_MIN_FILTER,P(t.minFilter))):(ye.texParameteri(e,ye.TEXTURE_WRAP_S,ye.CLAMP_TO_EDGE),ye.texParameteri(e,ye.TEXTURE_WRAP_T,ye.CLAMP_TO_EDGE),t.wrapS===o.ClampToEdgeWrapping&&t.wrapT===o.ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",t),ye.texParameteri(e,ye.TEXTURE_MAG_FILTER,A(t.magFilter)),ye.texParameteri(e,ye.TEXTURE_MIN_FILTER,A(t.minFilter)),t.minFilter!==o.NearestFilter&&t.minFilter!==o.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",t)),!(r=be.get("EXT_texture_filter_anisotropic"))||t.type===o.FloatType&&null===be.get("OES_texture_float_linear")||t.type===o.HalfFloatType&&null===be.get("OES_texture_half_float_linear")||!(1<t.anisotropy||Se.get(t).__currentAnisotropy)||(ye.texParameterf(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,Q.getMaxAnisotropy())),Se.get(t).__currentAnisotropy=t.anisotropy)}function w(e,t){if(e.width>t||e.height>t){var r=t/Math.max(e.width,e.height),n=document.createElement("canvas");return n.width=Math.floor(e.width*r),n.height=Math.floor(e.height*r),n.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+n.width+"x"+n.height,e),n}return e}function S(e){return o.Math.isPowerOfTwo(e.width)&&o.Math.isPowerOfTwo(e.height)}function M(e,t){var r=Se.get(e);if(6===e.image.length)if(0<e.version&&r.__version!==e.version){r.__image__webglTextureCube||(e.addEventListener("dispose",s),r.__image__webglTextureCube=ye.createTexture(),ve.textures++),we.activeTexture(ye.TEXTURE0+t),we.bindTexture(ye.TEXTURE_CUBE_MAP,r.__image__webglTextureCube),ye.pixelStorei(ye.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var n=e instanceof o.CompressedTexture,i=e.image[0]instanceof o.DataTexture,a=[],u=0;6>u;u++)a[u]=!Q.autoScaleCubemaps||n||i?i?e.image[u].image:e.image[u]:w(e.image[u],xe.maxCubemapSize);var c=S(a[0]),h=P(e.format),l=P(e.type);for(x(ye.TEXTURE_CUBE_MAP,e,c),u=0;6>u;u++)if(n)for(var p,f=a[u].mipmaps,d=0,m=f.length;m>d;d++)p=f[d],e.format!==o.RGBAFormat&&e.format!==o.RGBFormat?-1<we.getCompressedTextureFormats().indexOf(h)?we.compressedTexImage2D(ye.TEXTURE_CUBE_MAP_POSITIVE_X+u,d,h,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):we.texImage2D(ye.TEXTURE_CUBE_MAP_POSITIVE_X+u,d,h,p.width,p.height,0,h,l,p.data);else i?we.texImage2D(ye.TEXTURE_CUBE_MAP_POSITIVE_X+u,0,h,a[u].width,a[u].height,0,h,l,a[u].data):we.texImage2D(ye.TEXTURE_CUBE_MAP_POSITIVE_X+u,0,h,h,l,a[u]);e.generateMipmaps&&c&&ye.generateMipmap(ye.TEXTURE_CUBE_MAP),r.__version=e.version,e.onUpdate&&e.onUpdate(e)}else we.activeTexture(ye.TEXTURE0+t),we.bindTexture(ye.TEXTURE_CUBE_MAP,r.__image__webglTextureCube)}function E(e,t){we.activeTexture(ye.TEXTURE0+t),we.bindTexture(ye.TEXTURE_CUBE_MAP,Se.get(e).__webglTexture)}function C(e,t,r){ye.bindFramebuffer(ye.FRAMEBUFFER,e),ye.framebufferTexture2D(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,r,Se.get(t.texture).__webglTexture,0)}function T(e,t){ye.bindRenderbuffer(ye.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(ye.renderbufferStorage(ye.RENDERBUFFER,ye.DEPTH_COMPONENT16,t.width,t.height),ye.framebufferRenderbuffer(ye.FRAMEBUFFER,ye.DEPTH_ATTACHMENT,ye.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(ye.renderbufferStorage(ye.RENDERBUFFER,ye.DEPTH_STENCIL,t.width,t.height),ye.framebufferRenderbuffer(ye.FRAMEBUFFER,ye.DEPTH_STENCIL_ATTACHMENT,ye.RENDERBUFFER,e)):ye.renderbufferStorage(ye.RENDERBUFFER,ye.RGBA4,t.width,t.height)}function A(e){return e===o.NearestFilter||e===o.NearestMipMapNearestFilter||e===o.NearestMipMapLinearFilter?ye.NEAREST:ye.LINEAR}function P(e){var t;if(e===o.RepeatWrapping)return ye.REPEAT;if(e===o.ClampToEdgeWrapping)return ye.CLAMP_TO_EDGE;if(e===o.MirroredRepeatWrapping)return ye.MIRRORED_REPEAT;if(e===o.NearestFilter)return ye.NEAREST;if(e===o.NearestMipMapNearestFilter)return ye.NEAREST_MIPMAP_NEAREST;if(e===o.NearestMipMapLinearFilter)return ye.NEAREST_MIPMAP_LINEAR;if(e===o.LinearFilter)return ye.LINEAR;if(e===o.LinearMipMapNearestFilter)return ye.LINEAR_MIPMAP_NEAREST;if(e===o.LinearMipMapLinearFilter)return ye.LINEAR_MIPMAP_LINEAR;if(e===o.UnsignedByteType)return ye.UNSIGNED_BYTE;if(e===o.UnsignedShort4444Type)return ye.UNSIGNED_SHORT_4_4_4_4;if(e===o.UnsignedShort5551Type)return ye.UNSIGNED_SHORT_5_5_5_1;if(e===o.UnsignedShort565Type)return ye.UNSIGNED_SHORT_5_6_5;if(e===o.ByteType)return ye.BYTE;if(e===o.ShortType)return ye.SHORT;if(e===o.UnsignedShortType)return ye.UNSIGNED_SHORT;if(e===o.IntType)return ye.INT;if(e===o.UnsignedIntType)return ye.UNSIGNED_INT;if(e===o.FloatType)return ye.FLOAT;if(t=be.get("OES_texture_half_float"),null!==t&&e===o.HalfFloatType)return t.HALF_FLOAT_OES;if(e===o.AlphaFormat)return ye.ALPHA;if(e===o.RGBFormat)return ye.RGB;if(e===o.RGBAFormat)return ye.RGBA;if(e===o.LuminanceFormat)return ye.LUMINANCE;if(e===o.LuminanceAlphaFormat)return ye.LUMINANCE_ALPHA;if(e===o.AddEquation)return ye.FUNC_ADD;if(e===o.SubtractEquation)return ye.FUNC_SUBTRACT;if(e===o.ReverseSubtractEquation)return ye.FUNC_REVERSE_SUBTRACT;if(e===o.ZeroFactor)return ye.ZERO;if(e===o.OneFactor)return ye.ONE;if(e===o.SrcColorFactor)return ye.SRC_COLOR;if(e===o.OneMinusSrcColorFactor)return ye.ONE_MINUS_SRC_COLOR;if(e===o.SrcAlphaFactor)return ye.SRC_ALPHA;if(e===o.OneMinusSrcAlphaFactor)return ye.ONE_MINUS_SRC_ALPHA;if(e===o.DstAlphaFactor)return ye.DST_ALPHA;if(e===o.OneMinusDstAlphaFactor)return ye.ONE_MINUS_DST_ALPHA;if(e===o.DstColorFactor)return ye.DST_COLOR;if(e===o.OneMinusDstColorFactor)return ye.ONE_MINUS_DST_COLOR;if(e===o.SrcAlphaSaturateFactor)return ye.SRC_ALPHA_SATURATE;if(t=be.get("WEBGL_compressed_texture_s3tc"),null!==t){if(e===o.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===o.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===o.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===o.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t=be.get("WEBGL_compressed_texture_pvrtc"),null!==t){if(e===o.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===o.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===o.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===o.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t=be.get("EXT_blend_minmax"),null!==t){if(e===o.MinEquation)return t.MIN_EXT;if(e===o.MaxEquation)return t.MAX_EXT}return 0}console.log("THREE.WebGLRenderer",o.REVISION),e=e||{};var k=void 0!==e.canvas?e.canvas:document.createElement("canvas"),O=void 0!==e.context?e.context:null,N=k.width,D=k.height,L=1,R=void 0!==e.alpha?e.alpha:!1,j=void 0!==e.depth?e.depth:!0,I=void 0!==e.stencil?e.stencil:!0,V=void 0!==e.antialias?e.antialias:!1,F=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,B=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,U=new o.Color(0),G=0,z=[],H=[],W=-1,q=[],$=-1,X=new Float32Array(8),K=[],Y=[];this.domElement=k,this.context=null,this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.gammaFactor=2,this.gammaOutput=this.gammaInput=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0;var Q=this,J=null,Z=null,ee=-1,te="",re=null,ne=0,ie=0,oe=0,se=k.width,ae=k.height,ue=0,ce=0,he=new o.Frustum,le=new o.Matrix4,pe=new o.Vector3,fe=new o.Vector3,de=!0,me={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},ve={geometries:0,textures:0},ge={calls:0,vertices:0,faces:0,points:0};this.info={render:ge,memory:ve,programs:null};var ye;try{if(R={alpha:R,depth:j,stencil:I,antialias:V,premultipliedAlpha:F,preserveDrawingBuffer:B},ye=O||k.getContext("webgl",R)||k.getContext("experimental-webgl",R),null===ye){if(null!==k.getContext("webgl"))throw"Error creating WebGL context with your selected attributes.";throw"Error creating WebGL context."}k.addEventListener("webglcontextlost",i,!1)}catch(_e){console.error("THREE.WebGLRenderer: "+_e)}var be=new o.WebGLExtensions(ye);be.get("OES_texture_float"),be.get("OES_texture_float_linear"),be.get("OES_texture_half_float"),be.get("OES_texture_half_float_linear"),be.get("OES_standard_derivatives"),be.get("ANGLE_instanced_arrays"),be.get("OES_element_index_uint")&&(o.BufferGeometry.MaxIndex=4294967296);var xe=new o.WebGLCapabilities(ye,be,e),we=new o.WebGLState(ye,be,P),Se=new o.WebGLProperties,Me=new o.WebGLObjects(ye,Se,this.info),Ee=new o.WebGLPrograms(this,xe);this.info.programs=Ee.programs;var Ce=new o.WebGLBufferRenderer(ye,be,ge),Te=new o.WebGLIndexedBufferRenderer(ye,be,ge);r(),this.context=ye,this.capabilities=xe,this.extensions=be,this.state=we;var Ae=new o.WebGLShadowMap(this,z,Me);this.shadowMap=Ae;var Pe=new o.SpritePlugin(this,K),ke=new o.LensFlarePlugin(this,Y);this.getContext=function(){return ye},this.getContextAttributes=function(){return ye.getContextAttributes()},this.forceContextLoss=function(){be.get("WEBGL_lose_context").loseContext()},this.getMaxAnisotropy=function(){var e;return function(){if(void 0!==e)return e;var t=be.get("EXT_texture_filter_anisotropic");return e=null!==t?ye.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}(),this.getPrecision=function(){return xe.precision},this.getPixelRatio=function(){return L},this.setPixelRatio=function(e){void 0!==e&&(L=e)},this.getSize=function(){return{
width:N,height:D}},this.setSize=function(e,t,r){N=e,D=t,k.width=e*L,k.height=t*L,!1!==r&&(k.style.width=e+"px",k.style.height=t+"px"),this.setViewport(0,0,e,t)},this.setViewport=function(e,t,r,n){ie=e*L,oe=t*L,se=r*L,ae=n*L,ye.viewport(ie,oe,se,ae)},this.getViewport=function(e){e.x=ie/L,e.y=oe/L,e.z=se/L,e.w=ae/L},this.setScissor=function(e,t,r,n){ye.scissor(e*L,t*L,r*L,n*L)},this.enableScissorTest=function(e){we.setScissorTest(e)},this.getClearColor=function(){return U},this.setClearColor=function(e,r){U.set(e),G=void 0!==r?r:1,t(U.r,U.g,U.b,G)},this.getClearAlpha=function(){return G},this.setClearAlpha=function(e){G=e,t(U.r,U.g,U.b,G)},this.clear=function(e,t,r){var n=0;(void 0===e||e)&&(n|=ye.COLOR_BUFFER_BIT),(void 0===t||t)&&(n|=ye.DEPTH_BUFFER_BIT),(void 0===r||r)&&(n|=ye.STENCIL_BUFFER_BIT),ye.clear(n)},this.clearColor=function(){ye.clear(ye.COLOR_BUFFER_BIT)},this.clearDepth=function(){ye.clear(ye.DEPTH_BUFFER_BIT)},this.clearStencil=function(){ye.clear(ye.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,r,n){this.setRenderTarget(e),this.clear(t,r,n)},this.resetGLState=n,this.dispose=function(){k.removeEventListener("webglcontextlost",i,!1)},this.renderBufferImmediate=function(e,t,r){we.initAttributes();var n=Se.get(e);if(e.hasPositions&&!n.position&&(n.position=ye.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=ye.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=ye.createBuffer()),e.hasColors&&!n.color&&(n.color=ye.createBuffer()),t=t.getAttributes(),e.hasPositions&&(ye.bindBuffer(ye.ARRAY_BUFFER,n.position),ye.bufferData(ye.ARRAY_BUFFER,e.positionArray,ye.DYNAMIC_DRAW),we.enableAttribute(t.position),ye.vertexAttribPointer(t.position,3,ye.FLOAT,!1,0,0)),e.hasNormals){if(ye.bindBuffer(ye.ARRAY_BUFFER,n.normal),"MeshPhongMaterial"!==r.type&&r.shading===o.FlatShading)for(var i=0,s=3*e.count;s>i;i+=9){var a=e.normalArray,u=(a[i+0]+a[i+3]+a[i+6])/3,c=(a[i+1]+a[i+4]+a[i+7])/3,h=(a[i+2]+a[i+5]+a[i+8])/3;a[i+0]=u,a[i+1]=c,a[i+2]=h,a[i+3]=u,a[i+4]=c,a[i+5]=h,a[i+6]=u,a[i+7]=c,a[i+8]=h}ye.bufferData(ye.ARRAY_BUFFER,e.normalArray,ye.DYNAMIC_DRAW),we.enableAttribute(t.normal),ye.vertexAttribPointer(t.normal,3,ye.FLOAT,!1,0,0)}e.hasUvs&&r.map&&(ye.bindBuffer(ye.ARRAY_BUFFER,n.uv),ye.bufferData(ye.ARRAY_BUFFER,e.uvArray,ye.DYNAMIC_DRAW),we.enableAttribute(t.uv),ye.vertexAttribPointer(t.uv,2,ye.FLOAT,!1,0,0)),e.hasColors&&r.vertexColors!==o.NoColors&&(ye.bindBuffer(ye.ARRAY_BUFFER,n.color),ye.bufferData(ye.ARRAY_BUFFER,e.colorArray,ye.DYNAMIC_DRAW),we.enableAttribute(t.color),ye.vertexAttribPointer(t.color,3,ye.FLOAT,!1,0,0)),we.disableUnusedAttributes(),ye.drawArrays(ye.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,n,i,s,a){v(i);var u=g(e,t,r,i,s),c=!1;if(e=n.id+"_"+u.id+"_"+i.wireframe,e!==te&&(te=e,c=!0),t=s.morphTargetInfluences,void 0!==t){for(e=[],r=0,c=t.length;c>r;r++){var l=t[r];e.push([l,r])}e.sort(h),8<e.length&&(e.length=8);var p=n.morphAttributes;for(r=0,c=e.length;c>r;r++)l=e[r],X[r]=l[0],0!==l[0]?(t=l[1],!0===i.morphTargets&&p.position&&n.addAttribute("morphTarget"+r,p.position[t]),!0===i.morphNormals&&p.normal&&n.addAttribute("morphNormal"+r,p.normal[t])):(!0===i.morphTargets&&n.removeAttribute("morphTarget"+r),!0===i.morphNormals&&n.removeAttribute("morphNormal"+r));e=u.getUniforms(),null!==e.morphTargetInfluences&&ye.uniform1fv(e.morphTargetInfluences,X),c=!0}if(t=n.index,r=n.attributes.position,!0===i.wireframe&&(t=Me.getWireframeAttribute(n)),null!==t?(e=Te,e.setIndex(t)):e=Ce,c){var f,c=void 0;if(n instanceof o.InstancedBufferGeometry&&(f=be.get("ANGLE_instanced_arrays"),null===f))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{void 0===c&&(c=0),we.initAttributes();var d,l=n.attributes,u=u.getAttributes(),p=i.defaultAttributeValues;for(d in u){var m=u[d];if(m>=0){var y=l[d];if(void 0!==y){var _=y.itemSize,b=Me.getAttributeBuffer(y);if(y instanceof o.InterleavedBufferAttribute){var x=y.data,w=x.stride,y=y.offset;x instanceof o.InstancedInterleavedBuffer?(we.enableAttributeAndDivisor(m,x.meshPerAttribute,f),void 0===n.maxInstancedCount&&(n.maxInstancedCount=x.meshPerAttribute*x.count)):we.enableAttribute(m),ye.bindBuffer(ye.ARRAY_BUFFER,b),ye.vertexAttribPointer(m,_,ye.FLOAT,!1,w*x.array.BYTES_PER_ELEMENT,(c*w+y)*x.array.BYTES_PER_ELEMENT)}else y instanceof o.InstancedBufferAttribute?(we.enableAttributeAndDivisor(m,y.meshPerAttribute,f),void 0===n.maxInstancedCount&&(n.maxInstancedCount=y.meshPerAttribute*y.count)):we.enableAttribute(m),ye.bindBuffer(ye.ARRAY_BUFFER,b),ye.vertexAttribPointer(m,_,ye.FLOAT,!1,0,c*_*4)}else if(void 0!==p&&(_=p[d],void 0!==_))switch(_.length){case 2:ye.vertexAttrib2fv(m,_);break;case 3:ye.vertexAttrib3fv(m,_);break;case 4:ye.vertexAttrib4fv(m,_);break;default:ye.vertexAttrib1fv(m,_)}}}we.disableUnusedAttributes()}null!==t&&ye.bindBuffer(ye.ELEMENT_ARRAY_BUFFER,Me.getAttributeBuffer(t))}f=1/0,null!==t?f=t.count:void 0!==r&&(f=r.count),d=n.drawRange.start,t=n.drawRange.count,r=null!==a?a.start:0,c=null!==a?a.count:1/0,a=Math.max(0,d,r),f=Math.min(0+f,d+t,r+c)-1,f=Math.max(0,f-a+1),s instanceof o.Mesh?(!0===i.wireframe?(we.setLineWidth(i.wireframeLinewidth*L),e.setMode(ye.LINES)):e.setMode(ye.TRIANGLES),n instanceof o.InstancedBufferGeometry&&0<n.maxInstancedCount?e.renderInstances(n):e.render(a,f)):s instanceof o.Line?(n=i.linewidth,void 0===n&&(n=1),we.setLineWidth(n*L),s instanceof o.LineSegments?e.setMode(ye.LINES):e.setMode(ye.LINE_STRIP),e.render(a,f)):s instanceof o.Points&&(e.setMode(ye.POINTS),e.render(a,f))},this.render=function(e,t,r,n){if(!1==t instanceof o.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var i=e.fog;te="",ee=-1,re=null,de=!0,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),le.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),he.setFromMatrix(le),z.length=0,$=W=-1,K.length=0,Y.length=0,d(e,t),H.length=W+1,q.length=$+1,!0===Q.sortObjects&&(H.sort(l),q.sort(p)),Ae.render(e),ge.calls=0,ge.vertices=0,ge.faces=0,ge.points=0,this.setRenderTarget(r),(this.autoClear||n)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),e.overrideMaterial?(n=e.overrideMaterial,m(H,t,z,i,n),m(q,t,z,i,n)):(we.setBlending(o.NoBlending),m(H,t,z,i),m(q,t,z,i)),Pe.render(e,t),ke.render(e,t,ue,ce),r&&(e=r.texture,t=S(r),e.generateMipmaps&&t&&e.minFilter!==o.NearestFilter&&e.minFilter!==o.LinearFilter&&(e=r instanceof o.WebGLRenderTargetCube?ye.TEXTURE_CUBE_MAP:ye.TEXTURE_2D,r=Se.get(r.texture).__webglTexture,we.bindTexture(e,r),ye.generateMipmap(e),we.bindTexture(e,null))),we.setDepthTest(!0),we.setDepthWrite(!0),we.setColorWrite(!0)}},this.setFaceCulling=function(e,t){e===o.CullFaceNone?we.disable(ye.CULL_FACE):(t===o.FrontFaceDirectionCW?ye.frontFace(ye.CW):ye.frontFace(ye.CCW),e===o.CullFaceBack?ye.cullFace(ye.BACK):e===o.CullFaceFront?ye.cullFace(ye.FRONT):ye.cullFace(ye.FRONT_AND_BACK),we.enable(ye.CULL_FACE))},this.setTexture=function(e,t){var r=Se.get(e);if(0<e.version&&r.__version!==e.version){var n=e.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",e);else if(!1===n.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",e);else{if(void 0===r.__webglInit&&(r.__webglInit=!0,e.addEventListener("dispose",s),r.__webglTexture=ye.createTexture(),ve.textures++),we.activeTexture(ye.TEXTURE0+t),we.bindTexture(ye.TEXTURE_2D,r.__webglTexture),ye.pixelStorei(ye.UNPACK_FLIP_Y_WEBGL,e.flipY),ye.pixelStorei(ye.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),ye.pixelStorei(ye.UNPACK_ALIGNMENT,e.unpackAlignment),e.image=w(e.image,xe.maxTextureSize),(e.wrapS!==o.ClampToEdgeWrapping||e.wrapT!==o.ClampToEdgeWrapping||e.minFilter!==o.NearestFilter&&e.minFilter!==o.LinearFilter)&&!1===S(e.image)){if(n=e.image,n instanceof HTMLImageElement||n instanceof HTMLCanvasElement){var i=document.createElement("canvas");i.width=o.Math.nearestPowerOfTwo(n.width),i.height=o.Math.nearestPowerOfTwo(n.height),i.getContext("2d").drawImage(n,0,0,i.width,i.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+n.width+"x"+n.height+"). Resized to "+i.width+"x"+i.height,n),n=i}e.image=n}var a=e.image,n=S(a),i=P(e.format),u=P(e.type);x(ye.TEXTURE_2D,e,n);var c=e.mipmaps;if(e instanceof o.DataTexture)if(0<c.length&&n){for(var h=0,l=c.length;l>h;h++)a=c[h],we.texImage2D(ye.TEXTURE_2D,h,i,a.width,a.height,0,i,u,a.data);e.generateMipmaps=!1}else we.texImage2D(ye.TEXTURE_2D,0,i,a.width,a.height,0,i,u,a.data);else if(e instanceof o.CompressedTexture)for(h=0,l=c.length;l>h;h++)a=c[h],e.format!==o.RGBAFormat&&e.format!==o.RGBFormat?-1<we.getCompressedTextureFormats().indexOf(i)?we.compressedTexImage2D(ye.TEXTURE_2D,h,i,a.width,a.height,0,a.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):we.texImage2D(ye.TEXTURE_2D,h,i,a.width,a.height,0,i,u,a.data);else if(0<c.length&&n){for(h=0,l=c.length;l>h;h++)a=c[h],we.texImage2D(ye.TEXTURE_2D,h,i,i,u,a);e.generateMipmaps=!1}else we.texImage2D(ye.TEXTURE_2D,0,i,i,u,e.image);e.generateMipmaps&&n&&ye.generateMipmap(ye.TEXTURE_2D),r.__version=e.version,e.onUpdate&&e.onUpdate(e)}}else we.activeTexture(ye.TEXTURE0+t),we.bindTexture(ye.TEXTURE_2D,r.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof o.WebGLRenderTargetCube;if(e&&void 0===Se.get(e).__webglFramebuffer){var r=Se.get(e),n=Se.get(e.texture);void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",a),n.__webglTexture=ye.createTexture(),ve.textures++;var i=S(e),s=P(e.texture.format),u=P(e.texture.type);if(t){for(r.__webglFramebuffer=[],r.__webglRenderbuffer=[],we.bindTexture(ye.TEXTURE_CUBE_MAP,n.__webglTexture),x(ye.TEXTURE_CUBE_MAP,e.texture,i),n=0;6>n;n++)r.__webglFramebuffer[n]=ye.createFramebuffer(),r.__webglRenderbuffer[n]=ye.createRenderbuffer(),we.texImage2D(ye.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,s,e.width,e.height,0,s,u,null),C(r.__webglFramebuffer[n],e,ye.TEXTURE_CUBE_MAP_POSITIVE_X+n),T(r.__webglRenderbuffer[n],e);e.texture.generateMipmaps&&i&&ye.generateMipmap(ye.TEXTURE_CUBE_MAP)}else r.__webglFramebuffer=ye.createFramebuffer(),r.__webglRenderbuffer=e.shareDepthFrom?e.shareDepthFrom.__webglRenderbuffer:ye.createRenderbuffer(),we.bindTexture(ye.TEXTURE_2D,n.__webglTexture),x(ye.TEXTURE_2D,e.texture,i),we.texImage2D(ye.TEXTURE_2D,0,s,e.width,e.height,0,s,u,null),C(r.__webglFramebuffer,e,ye.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?ye.framebufferRenderbuffer(ye.FRAMEBUFFER,ye.DEPTH_ATTACHMENT,ye.RENDERBUFFER,r.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&ye.framebufferRenderbuffer(ye.FRAMEBUFFER,ye.DEPTH_STENCIL_ATTACHMENT,ye.RENDERBUFFER,r.__webglRenderbuffer):T(r.__webglRenderbuffer,e),e.texture.generateMipmaps&&i&&ye.generateMipmap(ye.TEXTURE_2D);t?we.bindTexture(ye.TEXTURE_CUBE_MAP,null):we.bindTexture(ye.TEXTURE_2D,null),ye.bindRenderbuffer(ye.RENDERBUFFER,null),ye.bindFramebuffer(ye.FRAMEBUFFER,null)}e?(r=Se.get(e),n=t?r.__webglFramebuffer[e.activeCubeFace]:r.__webglFramebuffer,r=e.width,i=e.height,u=s=0):(n=null,r=se,i=ae,s=ie,u=oe),n!==Z&&(ye.bindFramebuffer(ye.FRAMEBUFFER,n),ye.viewport(s,u,r,i),Z=n),t&&(n=Se.get(e.texture),ye.framebufferTexture2D(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,n.__webglTexture,0)),ue=r,ce=i},this.readRenderTargetPixels=function(e,t,r,n,i,s){if(!1==e instanceof o.WebGLRenderTarget)console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");else{var a=Se.get(e).__webglFramebuffer;if(a){var u=!1;a!==Z&&(ye.bindFramebuffer(ye.FRAMEBUFFER,a),u=!0);try{var c=e.texture;c.format!==o.RGBAFormat&&P(c.format)!==ye.getParameter(ye.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):c.type===o.UnsignedByteType||P(c.type)===ye.getParameter(ye.IMPLEMENTATION_COLOR_READ_TYPE)||c.type===o.FloatType&&be.get("WEBGL_color_buffer_float")||c.type===o.HalfFloatType&&be.get("EXT_color_buffer_half_float")?ye.checkFramebufferStatus(ye.FRAMEBUFFER)===ye.FRAMEBUFFER_COMPLETE?ye.readPixels(t,r,n,i,P(c.format),P(c.type),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{u&&ye.bindFramebuffer(ye.FRAMEBUFFER,Z)}}}},this.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),be.get("OES_texture_float")},this.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),be.get("OES_texture_half_float")},this.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),be.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),be.get("WEBGL_compressed_texture_s3tc")},this.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),be.get("WEBGL_compressed_texture_pvrtc")},this.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),be.get("EXT_blend_minmax")},this.supportsVertexTextures=function(){return xe.vertexTextures},this.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),be.get("ANGLE_instanced_arrays")},this.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},this.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},this.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},this.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Object.defineProperties(this,{shadowMapEnabled:{get:function(){return Ae.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),Ae.enabled=e}},shadowMapType:{get:function(){return Ae.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),Ae.type=e}},shadowMapCullFace:{get:function(){return Ae.cullFace},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),Ae.cullFace=e}},shadowMapDebug:{get:function(){return Ae.debug},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapDebug is now .shadowMap.debug."),Ae.debug=e}}})},o.WebGLRenderTarget=function(e,t,r){this.uuid=o.Math.generateUUID(),this.width=e,this.height=t,r=r||{},void 0===r.minFilter&&(r.minFilter=o.LinearFilter),this.texture=new o.Texture(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy),this.depthBuffer=void 0!==r.depthBuffer?r.depthBuffer:!0,this.stencilBuffer=void 0!==r.stencilBuffer?r.stencilBuffer:!0,this.shareDepthFrom=void 0!==r.shareDepthFrom?r.shareDepthFrom:null},o.WebGLRenderTarget.prototype={constructor:o.WebGLRenderTarget,get wrapS(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set wrapS(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e},get wrapT(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set wrapT(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e},get magFilter(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set magFilter(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e},get minFilter(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set minFilter(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e},get anisotropy(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set anisotropy(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e},get offset(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set offset(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e},get repeat(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set repeat(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e},get format(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set format(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e},get type(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set type(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e},get generateMipmaps(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set generateMipmaps(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e},setSize:function(e,t){(this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.dispose())},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.shareDepthFrom=e.shareDepthFrom,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},o.EventDispatcher.prototype.apply(o.WebGLRenderTarget.prototype),o.WebGLRenderTargetCube=function(e,t,r){o.WebGLRenderTarget.call(this,e,t,r),this.activeCubeFace=0},o.WebGLRenderTargetCube.prototype=Object.create(o.WebGLRenderTarget.prototype),o.WebGLRenderTargetCube.prototype.constructor=o.WebGLRenderTargetCube,o.WebGLBufferRenderer=function(e,t,r){var n;this.setMode=function(e){n=e},this.render=function(t,i){e.drawArrays(n,t,i),r.calls++,r.vertices+=i,n===e.TRIANGLES&&(r.faces+=i/3)},this.renderInstances=function(e){var r=t.get("ANGLE_instanced_arrays");if(null===r)console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{var i=e.attributes.position;i instanceof o.InterleavedBufferAttribute?r.drawArraysInstancedANGLE(n,0,i.data.count,e.maxInstancedCount):r.drawArraysInstancedANGLE(n,0,i.count,e.maxInstancedCount)}}},o.WebGLIndexedBufferRenderer=function(e,t,r){var n,i,o;this.setMode=function(e){n=e},this.setIndex=function(r){r.array instanceof Uint32Array&&t.get("OES_element_index_uint")?(i=e.UNSIGNED_INT,o=4):(i=e.UNSIGNED_SHORT,o=2)},this.render=function(t,s){e.drawElements(n,s,i,t*o),r.calls++,r.vertices+=s,n===e.TRIANGLES&&(r.faces+=s/3)},this.renderInstances=function(e){var r=t.get("ANGLE_instanced_arrays");null===r?console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):r.drawElementsInstancedANGLE(n,e.index.array.length,i,0,e.maxInstancedCount)}},o.WebGLExtensions=function(e){var t={};this.get=function(r){if(void 0!==t[r])return t[r];var n;switch(r){case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return null===n&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=n}},o.WebGLCapabilities=function(e,t,r){function n(t){if("highp"===t){if(0<e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision&&0<e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision)return"highp";t="mediump"}return"mediump"===t&&0<e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision&&0<e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision?"mediump":"lowp"}this.getMaxPrecision=n,this.precision=void 0!==r.precision?r.precision:"highp",this.logarithmicDepthBuffer=void 0!==r.logarithmicDepthBuffer?r.logarithmicDepthBuffer:!1,this.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxVertexUniforms=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this.maxVaryings=e.getParameter(e.MAX_VARYING_VECTORS),this.maxFragmentUniforms=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),this.vertexTextures=0<this.maxVertexTextures,this.floatFragmentTextures=!!t.get("OES_texture_float"),this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures,r=n(this.precision),r!==this.precision&&(console.warn("THREE.WebGLRenderer:",this.precision,"not supported, using",r,"instead."),this.precision=r),this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!t.get("EXT_frag_depth"))},o.WebGLGeometries=function(e,t,r){function n(e){e=e.target;var o,a=s[e.id].attributes;for(o in a)i(a[o]);e.removeEventListener("dispose",n),delete s[e.id],o=t.get(e),o.wireframe&&i(o.wireframe),r.memory.geometries--}function i(r){var n;n=r instanceof o.InterleavedBufferAttribute?t.get(r.data).__webglBuffer:t.get(r).__webglBuffer,void 0!==n&&(e.deleteBuffer(n),r instanceof o.InterleavedBufferAttribute?t["delete"](r.data):t["delete"](r))}var s={};this.get=function(e){var t=e.geometry;if(void 0!==s[t.id])return s[t.id];t.addEventListener("dispose",n);var i;return t instanceof o.BufferGeometry?i=t:t instanceof o.Geometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new o.BufferGeometry).setFromObject(e)),i=t._bufferGeometry),s[t.id]=i,r.memory.geometries++,i}},o.WebGLObjects=function(e,t,r){function n(r,n){var i=r instanceof o.InterleavedBufferAttribute?r.data:r,s=t.get(i);void 0===s.__webglBuffer?(s.__webglBuffer=e.createBuffer(),e.bindBuffer(n,s.__webglBuffer),e.bufferData(n,i.array,i.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW),s.version=i.version):s.version!==i.version&&(e.bindBuffer(n,s.__webglBuffer),!1===i.dynamic||-1===i.updateRange.count?e.bufferSubData(n,0,i.array):0===i.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(n,i.updateRange.offset*i.array.BYTES_PER_ELEMENT,i.array.subarray(i.updateRange.offset,i.updateRange.offset+i.updateRange.count)),i.updateRange.count=0),s.version=i.version)}function i(e,t,r){if(t>r){var n=t;t=r,r=n}return n=e[t],void 0===n?(e[t]=[r],!0):-1===n.indexOf(r)?(n.push(r),!0):!1}var s=new o.WebGLGeometries(e,t,r);this.getAttributeBuffer=function(e){return e instanceof o.InterleavedBufferAttribute?t.get(e.data).__webglBuffer:t.get(e).__webglBuffer},this.getWireframeAttribute=function(r){var s=t.get(r);if(void 0!==s.wireframe)return s.wireframe;var a=[],u=r.index,c=r.attributes;if(r=c.position,null!==u)for(var c={},u=u.array,h=0,l=u.length;l>h;h+=3){var p=u[h+0],f=u[h+1],d=u[h+2];i(c,p,f)&&a.push(p,f),i(c,f,d)&&a.push(f,d),i(c,d,p)&&a.push(d,p)}else for(u=c.position.array,h=0,l=u.length/3-1;l>h;h+=3)p=h+0,f=h+1,d=h+2,a.push(p,f,f,d,d,p);return a=new o.BufferAttribute(new(65535<r.count?Uint32Array:Uint16Array)(a),1),n(a,e.ELEMENT_ARRAY_BUFFER),s.wireframe=a},this.update=function(t){var r=s.get(t);t.geometry instanceof o.Geometry&&r.updateFromObject(t),t=r.index;var i=r.attributes;null!==t&&n(t,e.ELEMENT_ARRAY_BUFFER);for(var a in i)n(i[a],e.ARRAY_BUFFER);t=r.morphAttributes;for(a in t)for(var i=t[a],u=0,c=i.length;c>u;u++)n(i[u],e.ARRAY_BUFFER);return r}},o.WebGLProgram=function(){function e(e){var t,r=[];for(t in e){var n=e[t];!1!==n&&r.push("#define "+t+" "+n)}return r.join("\n")}function t(e){return""!==e}var r=0;return function(n,i,s,a){var u=n.context,c=s.defines,h=s.__webglShader.vertexShader,l=s.__webglShader.fragmentShader,p="SHADOWMAP_TYPE_BASIC";a.shadowMapType===o.PCFShadowMap?p="SHADOWMAP_TYPE_PCF":a.shadowMapType===o.PCFSoftShadowMap&&(p="SHADOWMAP_TYPE_PCF_SOFT");var f="ENVMAP_TYPE_CUBE",d="ENVMAP_MODE_REFLECTION",m="ENVMAP_BLENDING_MULTIPLY";if(a.envMap){switch(s.envMap.mapping){case o.CubeReflectionMapping:case o.CubeRefractionMapping:f="ENVMAP_TYPE_CUBE";break;case o.EquirectangularReflectionMapping:case o.EquirectangularRefractionMapping:f="ENVMAP_TYPE_EQUIREC";break;case o.SphericalReflectionMapping:f="ENVMAP_TYPE_SPHERE"}switch(s.envMap.mapping){case o.CubeRefractionMapping:case o.EquirectangularRefractionMapping:d="ENVMAP_MODE_REFRACTION"}switch(s.combine){case o.MultiplyOperation:m="ENVMAP_BLENDING_MULTIPLY";break;case o.MixOperation:m="ENVMAP_BLENDING_MIX";break;case o.AddOperation:m="ENVMAP_BLENDING_ADD"}}var v=0<n.gammaFactor?n.gammaFactor:1,g=e(c),y=u.createProgram();s instanceof o.RawShaderMaterial?n=c="":(c=["precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+s.__webglShader.name,g,a.supportsVertexTextures?"#define VERTEX_TEXTURES":"",n.gammaInput?"#define GAMMA_INPUT":"",n.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+v,"#define MAX_DIR_LIGHTS "+a.maxDirLights,"#define MAX_POINT_LIGHTS "+a.maxPointLights,"#define MAX_SPOT_LIGHTS "+a.maxSpotLights,"#define MAX_HEMI_LIGHTS "+a.maxHemiLights,"#define MAX_SHADOWS "+a.maxShadows,"#define MAX_BONES "+a.maxBones,a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+d:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+p:"",a.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",0<a.pointLightShadows?"#define POINT_LIGHT_SHADOWS":"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&n.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif","\n"].filter(t).join("\n"),n=[a.bumpMap||a.normalMap||a.flatShading||s.derivatives?"#extension GL_OES_standard_derivatives : enable":"",a.logarithmicDepthBuffer&&n.extensions.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"","precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+s.__webglShader.name,g,"#define MAX_DIR_LIGHTS "+a.maxDirLights,"#define MAX_POINT_LIGHTS "+a.maxPointLights,"#define MAX_SPOT_LIGHTS "+a.maxSpotLights,"#define MAX_HEMI_LIGHTS "+a.maxHemiLights,"#define MAX_SHADOWS "+a.maxShadows,a.alphaTest?"#define ALPHATEST "+a.alphaTest:"",n.gammaInput?"#define GAMMA_INPUT":"",n.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+v,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+f:"",a.envMap?"#define "+d:"",a.envMap?"#define "+m:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.flatShading?"#define FLAT_SHADED":"",a.metal?"#define METAL":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+p:"",a.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",0<a.pointLightShadows?"#define POINT_LIGHT_SHADOWS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&n.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","\n"].filter(t).join("\n")),l=n+l,h=o.WebGLShader(u,u.VERTEX_SHADER,c+h),l=o.WebGLShader(u,u.FRAGMENT_SHADER,l),u.attachShader(y,h),u.attachShader(y,l),void 0!==s.index0AttributeName?u.bindAttribLocation(y,0,s.index0AttributeName):!0===a.morphTargets&&u.bindAttribLocation(y,0,"position"),u.linkProgram(y),a=u.getProgramInfoLog(y),p=u.getShaderInfoLog(h),f=u.getShaderInfoLog(l),m=d=!0,!1===u.getProgramParameter(y,u.LINK_STATUS)?(d=!1,console.error("THREE.WebGLProgram: shader error: ",u.getError(),"gl.VALIDATE_STATUS",u.getProgramParameter(y,u.VALIDATE_STATUS),"gl.getProgramInfoLog",a,p,f)):""!==a?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",a):(""===p||""===f)&&(m=!1),m&&(this.diagnostics={runnable:d,material:s,programLog:a,vertexShader:{log:p,prefix:c},fragmentShader:{log:f,prefix:n}}),u.deleteShader(h),u.deleteShader(l);var _;this.getUniforms=function(){if(void 0===_){for(var e={},t=u.getProgramParameter(y,u.ACTIVE_UNIFORMS),r=0;t>r;r++){var n=u.getActiveUniform(y,r).name,i=u.getUniformLocation(y,n),o=n.lastIndexOf("[0]");-1!==o&&o===n.length-3&&(e[n.substr(0,o)]=i),e[n]=i}_=e}return _};var b;return this.getAttributes=function(){if(void 0===b){for(var e={},t=u.getProgramParameter(y,u.ACTIVE_ATTRIBUTES),r=0;t>r;r++){var n=u.getActiveAttrib(y,r).name;e[n]=u.getAttribLocation(y,n)}b=e}return b},this.destroy=function(){u.deleteProgram(y),
this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=r++,this.code=i,this.usedTimes=1,this.program=y,this.vertexShader=h,this.fragmentShader=l,this}}(),o.WebGLPrograms=function(e,t){var r=[],n={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},i="precision supportsVertexTextures map envMap envMapMode lightMap aoMap emissiveMap bumpMap normalMap displacementMap specularMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals maxDirLights maxPointLights maxSpotLights maxHemiLights maxShadows shadowMapEnabled pointLightShadows shadowMapType shadowMapDebug alphaTest metal doubleSided flipSided".split(" ");this.getParameters=function(r,i,s,a){var u,c,h,l,p,f=n[r.type];u=p=l=h=c=0;for(var d=i.length;d>u;u++){var m=i[u];!1!==m.visible&&(m instanceof o.DirectionalLight&&c++,m instanceof o.PointLight&&h++,m instanceof o.SpotLight&&l++,m instanceof o.HemisphereLight&&p++)}for(var m=u=d=0,v=i.length;v>m;m++){var g=i[m];g.castShadow&&((g instanceof o.SpotLight||g instanceof o.DirectionalLight)&&d++,g instanceof o.PointLight&&(d++,u++))}return i=d,t.floatVertexTextures&&a&&a.skeleton&&a.skeleton.useVertexTexture?d=1024:(d=Math.floor((t.maxVertexUniforms-20)/4),void 0!==a&&a instanceof o.SkinnedMesh&&(d=Math.min(a.skeleton.bones.length,d),d<a.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+a.skeleton.bones.length+", this GPU supports just "+d+" (try OpenGL instead of ANGLE)"))),m=e.getPrecision(),null!==r.precision&&(m=t.getMaxPrecision(r.precision),m!==r.precision&&console.warn("THREE.WebGLRenderer.initMaterial:",r.precision,"not supported, using",m,"instead.")),{shaderID:f,precision:m,supportsVertexTextures:t.vertexTextures,map:!!r.map,envMap:!!r.envMap,envMapMode:r.envMap&&r.envMap.mapping,lightMap:!!r.lightMap,aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,displacementMap:!!r.displacementMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,combine:r.combine,vertexColors:r.vertexColors,fog:s,useFog:r.fog,fogExp:s instanceof o.FogExp2,flatShading:r.shading===o.FlatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:t.logarithmicDepthBuffer,skinning:r.skinning,maxBones:d,useVertexTexture:t.floatVertexTextures&&a&&a.skeleton&&a.skeleton.useVertexTexture,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,maxDirLights:c,maxPointLights:h,maxSpotLights:l,maxHemiLights:p,maxShadows:i,pointLightShadows:u,shadowMapEnabled:e.shadowMap.enabled&&a.receiveShadow&&i>0,shadowMapType:e.shadowMap.type,shadowMapDebug:e.shadowMap.debug,alphaTest:r.alphaTest,metal:r.metal,doubleSided:r.side===o.DoubleSide,flipSided:r.side===o.BackSide}},this.getProgramCode=function(e,t){var r=[];if(t.shaderID?r.push(t.shaderID):(r.push(e.fragmentShader),r.push(e.vertexShader)),void 0!==e.defines)for(var n in e.defines)r.push(n),r.push(e.defines[n]);for(n=0;n<i.length;n++){var o=i[n];r.push(o),r.push(t[o])}return r.join()},this.acquireProgram=function(t,n,i){for(var s,a=0,u=r.length;u>a;a++){var c=r[a];if(c.code===i){s=c,++s.usedTimes;break}}return void 0===s&&(s=new o.WebGLProgram(e,i,t,n),r.push(s)),s},this.releaseProgram=function(e){if(0===--e.usedTimes){var t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),e.destroy()}},this.programs=r},o.WebGLProperties=function(){var e={};this.get=function(t){t=t.uuid;var r=e[t];return void 0===r&&(r={},e[t]=r),r},this["delete"]=function(t){delete e[t.uuid]},this.clear=function(){e={}}},o.WebGLShader=function(){function e(e){e=e.split("\n");for(var t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}return function(t,r,n){var i=t.createShader(r);return t.shaderSource(i,n),t.compileShader(i),!1===t.getShaderParameter(i,t.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(i)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",r===t.VERTEX_SHADER?"vertex":"fragment",t.getShaderInfoLog(i),e(n)),i}}(),o.WebGLShadowMap=function(e,t,r){function n(e,t,r,n){var i=e.geometry,s=null,s=f,a=e.customDepthMaterial;return r&&(s=d,a=e.customDistanceMaterial),a?s=a:(e=e instanceof o.SkinnedMesh&&t.skinning,a=0,void 0!==i.morphTargets&&0<i.morphTargets.length&&t.morphTargets&&(a|=1),e&&(a|=2),s=s[a]),s.visible=t.visible,s.wireframe=t.wireframe,s.wireframeLinewidth=t.wireframeLinewidth,r&&void 0!==s.uniforms.lightPos&&s.uniforms.lightPos.value.copy(n),s}function i(e,t){if(!1!==e.visible){(e instanceof o.Mesh||e instanceof o.Line||e instanceof o.Points)&&e.castShadow&&(!1===e.frustumCulled||!0===u.intersectsObject(e))&&!0===e.material.visible&&(e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),p.push(e));for(var r=e.children,n=0,s=r.length;s>n;n++)i(r[n],t)}}var s=e.context,a=e.state,u=new o.Frustum,c=new o.Matrix4;new o.Vector3,new o.Vector3;for(var h=new o.Vector3,l=new o.Vector3,p=[],f=Array(4),d=Array(4),m=[new o.Vector3(1,0,0),new o.Vector3(-1,0,0),new o.Vector3(0,0,1),new o.Vector3(0,0,-1),new o.Vector3(0,1,0),new o.Vector3(0,-1,0)],v=[new o.Vector3(0,1,0),new o.Vector3(0,1,0),new o.Vector3(0,1,0),new o.Vector3(0,1,0),new o.Vector3(0,0,1),new o.Vector3(0,0,-1)],g=[new o.Vector4,new o.Vector4,new o.Vector4,new o.Vector4,new o.Vector4,new o.Vector4],y=new o.Vector4,_=o.ShaderLib.depthRGBA,b=o.UniformsUtils.clone(_.uniforms),x=o.ShaderLib.distanceRGBA,w=o.UniformsUtils.clone(x.uniforms),S=0;4!==S;++S){var M=0!==(1&S),E=0!==(2&S),C=new o.ShaderMaterial({uniforms:b,vertexShader:_.vertexShader,fragmentShader:_.fragmentShader,morphTargets:M,skinning:E});C._shadowPass=!0,f[S]=C,M=new o.ShaderMaterial({uniforms:w,vertexShader:x.vertexShader,fragmentShader:x.fragmentShader,morphTargets:M,skinning:E}),M._shadowPass=!0,d[S]=M}var T=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=o.PCFShadowMap,this.cullFace=o.CullFaceFront,this.render=function(f){var d,_;if(!1!==T.enabled&&(!1!==T.autoUpdate||!1!==T.needsUpdate)){s.clearColor(1,1,1,1),a.disable(s.BLEND),a.enable(s.CULL_FACE),s.frontFace(s.CCW),s.cullFace(T.cullFace===o.CullFaceFront?s.FRONT:s.BACK),a.setDepthTest(!0),e.getViewport(y);for(var b=0,x=t.length;x>b;b++){var w=t[b];if(!0===w.castShadow){var S=w.shadow,M=S.camera,E=S.mapSize;if(w instanceof o.PointLight){d=6,_=!0;var C=E.x/4,A=E.y/2;g[0].set(2*C,A,C,A),g[1].set(0,A,C,A),g[2].set(3*C,A,C,A),g[3].set(C,A,C,A),g[4].set(3*C,0,C,A),g[5].set(C,0,C,A)}else d=1,_=!1;for(null===S.map&&(C=o.LinearFilter,T.type===o.PCFSoftShadowMap&&(C=o.NearestFilter),S.map=new o.WebGLRenderTarget(E.x,E.y,{minFilter:C,magFilter:C,format:o.RGBAFormat}),S.matrix=new o.Matrix4,w instanceof o.SpotLight&&(M.aspect=E.x/E.y),M.updateProjectionMatrix()),E=S.map,S=S.matrix,l.setFromMatrixPosition(w.matrixWorld),M.position.copy(l),e.setRenderTarget(E),e.clear(),E=0;d>E;E++)for(_?(h.copy(M.position),h.add(m[E]),M.up.copy(v[E]),M.lookAt(h),C=g[E],e.setViewport(C.x,C.y,C.z,C.w)):(h.setFromMatrixPosition(w.target.matrixWorld),M.lookAt(h)),M.updateMatrixWorld(),M.matrixWorldInverse.getInverse(M.matrixWorld),S.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),S.multiply(M.projectionMatrix),S.multiply(M.matrixWorldInverse),c.multiplyMatrices(M.projectionMatrix,M.matrixWorldInverse),u.setFromMatrix(c),p.length=0,i(f,M),C=0,A=p.length;A>C;C++){var P=p[C],k=r.update(P),O=P.material;if(O instanceof o.MeshFaceMaterial)for(var N=k.groups,O=O.materials,D=0,L=N.length;L>D;D++){var R=N[D],j=O[R.materialIndex];!0===j.visible&&(j=n(P,j,_,l),e.renderBufferDirect(M,t,null,k,j,P,R))}else j=n(P,O,_,l),e.renderBufferDirect(M,t,null,k,j,P,null)}e.resetGLState()}}e.setViewport(y.x,y.y,y.z,y.w),f=e.getClearColor(),d=e.getClearAlpha(),e.setClearColor(f,d),a.enable(s.BLEND),T.cullFace===o.CullFaceFront&&s.cullFace(s.BACK),e.resetGLState(),T.needsUpdate=!1}}},o.WebGLState=function(e,t,r){var n=this,i=new Uint8Array(16),s=new Uint8Array(16),a=new Uint8Array(16),u={},c=null,h=null,l=null,p=null,f=null,d=null,m=null,v=null,g=null,y=null,_=null,b=null,x=null,w=null,S=null,M=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),E=void 0,C={};this.init=function(){e.clearColor(0,0,0,1),e.clearDepth(1),e.clearStencil(0),this.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.frontFace(e.CCW),e.cullFace(e.BACK),this.enable(e.CULL_FACE),this.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)},this.initAttributes=function(){for(var e=0,t=i.length;t>e;e++)i[e]=0},this.enableAttribute=function(r){i[r]=1,0===s[r]&&(e.enableVertexAttribArray(r),s[r]=1),0!==a[r]&&(t.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(r,0),a[r]=0)},this.enableAttributeAndDivisor=function(t,r,n){i[t]=1,0===s[t]&&(e.enableVertexAttribArray(t),s[t]=1),a[t]!==r&&(n.vertexAttribDivisorANGLE(t,r),a[t]=r)},this.disableUnusedAttributes=function(){for(var t=0,r=s.length;r>t;t++)s[t]!==i[t]&&(e.disableVertexAttribArray(t),s[t]=0)},this.enable=function(t){!0!==u[t]&&(e.enable(t),u[t]=!0)},this.disable=function(t){!1!==u[t]&&(e.disable(t),u[t]=!1)},this.getCompressedTextureFormats=function(){if(null===c&&(c=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")))for(var r=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),n=0;n<r.length;n++)c.push(r[n]);return c},this.setBlending=function(t,n,i,s,a,u,c){t!==h&&(t===o.NoBlending?this.disable(e.BLEND):t===o.AdditiveBlending?(this.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)):t===o.SubtractiveBlending?(this.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)):t===o.MultiplyBlending?(this.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR)):t===o.CustomBlending?this.enable(e.BLEND):(this.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)),h=t),t===o.CustomBlending?(a=a||n,u=u||i,c=c||s,(n!==l||a!==d)&&(e.blendEquationSeparate(r(n),r(a)),l=n,d=a),(i!==p||s!==f||u!==m||c!==v)&&(e.blendFuncSeparate(r(i),r(s),r(u),r(c)),p=i,f=s,m=u,v=c)):v=m=d=f=p=l=null},this.setDepthFunc=function(t){if(g!==t){if(t)switch(t){case o.NeverDepth:e.depthFunc(e.NEVER);break;case o.AlwaysDepth:e.depthFunc(e.ALWAYS);break;case o.LessDepth:e.depthFunc(e.LESS);break;case o.LessEqualDepth:e.depthFunc(e.LEQUAL);break;case o.EqualDepth:e.depthFunc(e.EQUAL);break;case o.GreaterEqualDepth:e.depthFunc(e.GEQUAL);break;case o.GreaterDepth:e.depthFunc(e.GREATER);break;case o.NotEqualDepth:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);g=t}},this.setDepthTest=function(t){t?this.enable(e.DEPTH_TEST):this.disable(e.DEPTH_TEST)},this.setDepthWrite=function(t){y!==t&&(e.depthMask(t),y=t)},this.setColorWrite=function(t){_!==t&&(e.colorMask(t,t,t,t),_=t)},this.setFlipSided=function(t){b!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),b=t)},this.setLineWidth=function(t){t!==x&&(e.lineWidth(t),x=t)},this.setPolygonOffset=function(t,r,n){t?this.enable(e.POLYGON_OFFSET_FILL):this.disable(e.POLYGON_OFFSET_FILL),!t||w===r&&S===n||(e.polygonOffset(r,n),w=r,S=n)},this.setScissorTest=function(t){t?this.enable(e.SCISSOR_TEST):this.disable(e.SCISSOR_TEST)},this.activeTexture=function(t){void 0===t&&(t=e.TEXTURE0+M-1),E!==t&&(e.activeTexture(t),E=t)},this.bindTexture=function(t,r){void 0===E&&n.activeTexture();var i=C[E];void 0===i&&(i={type:void 0,texture:void 0},C[E]=i),(i.type!==t||i.texture!==r)&&(e.bindTexture(t,r),i.type=t,i.texture=r)},this.compressedTexImage2D=function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error(t)}},this.texImage2D=function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error(t)}},this.reset=function(){for(var t=0;t<s.length;t++)1===s[t]&&(e.disableVertexAttribArray(t),s[t]=0);u={},b=_=y=h=c=null}},o.LensFlarePlugin=function(e,t){var r,n,i,s,a,u,c,h,l,p,f,d,m,v,g,y,_=e.context,b=e.state;this.render=function(x,w,S,M){if(0!==t.length){x=new o.Vector3;var E=M/S,C=.5*S,T=.5*M,A=16/M,P=new o.Vector2(A*E,A),k=new o.Vector3(1,1,0),O=new o.Vector2(1,1);if(void 0===m){var A=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),N=new Uint16Array([0,1,2,0,2,3]);f=_.createBuffer(),d=_.createBuffer(),_.bindBuffer(_.ARRAY_BUFFER,f),_.bufferData(_.ARRAY_BUFFER,A,_.STATIC_DRAW),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,d),_.bufferData(_.ELEMENT_ARRAY_BUFFER,N,_.STATIC_DRAW),g=_.createTexture(),y=_.createTexture(),b.bindTexture(_.TEXTURE_2D,g),_.texImage2D(_.TEXTURE_2D,0,_.RGB,16,16,0,_.RGB,_.UNSIGNED_BYTE,null),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.NEAREST),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.NEAREST),b.bindTexture(_.TEXTURE_2D,y),_.texImage2D(_.TEXTURE_2D,0,_.RGBA,16,16,0,_.RGBA,_.UNSIGNED_BYTE,null),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.NEAREST),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.NEAREST);var A=(v=0<_.getParameter(_.MAX_VERTEX_TEXTURE_IMAGE_UNITS))?{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform lowp int renderType;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},N=_.createProgram(),D=_.createShader(_.FRAGMENT_SHADER),L=_.createShader(_.VERTEX_SHADER),R="precision "+e.getPrecision()+" float;\n";_.shaderSource(D,R+A.fragmentShader),_.shaderSource(L,R+A.vertexShader),_.compileShader(D),_.compileShader(L),_.attachShader(N,D),_.attachShader(N,L),_.linkProgram(N),m=N,l=_.getAttribLocation(m,"position"),p=_.getAttribLocation(m,"uv"),r=_.getUniformLocation(m,"renderType"),n=_.getUniformLocation(m,"map"),i=_.getUniformLocation(m,"occlusionMap"),s=_.getUniformLocation(m,"opacity"),a=_.getUniformLocation(m,"color"),u=_.getUniformLocation(m,"scale"),c=_.getUniformLocation(m,"rotation"),h=_.getUniformLocation(m,"screenPosition")}for(_.useProgram(m),b.initAttributes(),b.enableAttribute(l),b.enableAttribute(p),b.disableUnusedAttributes(),_.uniform1i(i,0),_.uniform1i(n,1),_.bindBuffer(_.ARRAY_BUFFER,f),_.vertexAttribPointer(l,2,_.FLOAT,!1,16,0),_.vertexAttribPointer(p,2,_.FLOAT,!1,16,8),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,d),b.disable(_.CULL_FACE),_.depthMask(!1),N=0,D=t.length;D>N;N++)if(A=16/M,P.set(A*E,A),L=t[N],x.set(L.matrixWorld.elements[12],L.matrixWorld.elements[13],L.matrixWorld.elements[14]),x.applyMatrix4(w.matrixWorldInverse),x.applyProjection(w.projectionMatrix),k.copy(x),O.x=k.x*C+C,O.y=k.y*T+T,v||0<O.x&&O.x<S&&0<O.y&&O.y<M){b.activeTexture(_.TEXTURE0),b.bindTexture(_.TEXTURE_2D,null),b.activeTexture(_.TEXTURE1),b.bindTexture(_.TEXTURE_2D,g),_.copyTexImage2D(_.TEXTURE_2D,0,_.RGB,O.x-8,O.y-8,16,16,0),_.uniform1i(r,0),_.uniform2f(u,P.x,P.y),_.uniform3f(h,k.x,k.y,k.z),b.disable(_.BLEND),b.enable(_.DEPTH_TEST),_.drawElements(_.TRIANGLES,6,_.UNSIGNED_SHORT,0),b.activeTexture(_.TEXTURE0),b.bindTexture(_.TEXTURE_2D,y),_.copyTexImage2D(_.TEXTURE_2D,0,_.RGBA,O.x-8,O.y-8,16,16,0),_.uniform1i(r,1),b.disable(_.DEPTH_TEST),b.activeTexture(_.TEXTURE1),b.bindTexture(_.TEXTURE_2D,g),_.drawElements(_.TRIANGLES,6,_.UNSIGNED_SHORT,0),L.positionScreen.copy(k),L.customUpdateCallback?L.customUpdateCallback(L):L.updateLensFlares(),_.uniform1i(r,2),b.enable(_.BLEND);for(var R=0,j=L.lensFlares.length;j>R;R++){var I=L.lensFlares[R];.001<I.opacity&&.001<I.scale&&(k.x=I.x,k.y=I.y,k.z=I.z,A=I.size*I.scale/M,P.x=A*E,P.y=A,_.uniform3f(h,k.x,k.y,k.z),_.uniform2f(u,P.x,P.y),_.uniform1f(c,I.rotation),_.uniform1f(s,I.opacity),_.uniform3f(a,I.color.r,I.color.g,I.color.b),b.setBlending(I.blending,I.blendEquation,I.blendSrc,I.blendDst),e.setTexture(I.texture,1),_.drawElements(_.TRIANGLES,6,_.UNSIGNED_SHORT,0))}}b.enable(_.CULL_FACE),b.enable(_.DEPTH_TEST),_.depthMask(!0),e.resetGLState()}}},o.SpritePlugin=function(e,t){function r(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var n,i,s,a,u,c,h,l,p,f,d,m,v,g,y,_,b,x,w,S,M,E=e.context,C=e.state,T=new o.Vector3,A=new o.Quaternion,P=new o.Vector3;this.render=function(k,O){if(0!==t.length){if(void 0===S){var N=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),D=new Uint16Array([0,1,2,0,2,3]);x=E.createBuffer(),w=E.createBuffer(),E.bindBuffer(E.ARRAY_BUFFER,x),E.bufferData(E.ARRAY_BUFFER,N,E.STATIC_DRAW),E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,w),E.bufferData(E.ELEMENT_ARRAY_BUFFER,D,E.STATIC_DRAW);var N=E.createProgram(),D=E.createShader(E.VERTEX_SHADER),L=E.createShader(E.FRAGMENT_SHADER);E.shaderSource(D,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n")),E.shaderSource(L,["precision "+e.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n")),E.compileShader(D),E.compileShader(L),E.attachShader(N,D),E.attachShader(N,L),E.linkProgram(N),S=N,_=E.getAttribLocation(S,"position"),b=E.getAttribLocation(S,"uv"),n=E.getUniformLocation(S,"uvOffset"),i=E.getUniformLocation(S,"uvScale"),s=E.getUniformLocation(S,"rotation"),a=E.getUniformLocation(S,"scale"),u=E.getUniformLocation(S,"color"),c=E.getUniformLocation(S,"map"),h=E.getUniformLocation(S,"opacity"),l=E.getUniformLocation(S,"modelViewMatrix"),p=E.getUniformLocation(S,"projectionMatrix"),f=E.getUniformLocation(S,"fogType"),d=E.getUniformLocation(S,"fogDensity"),m=E.getUniformLocation(S,"fogNear"),v=E.getUniformLocation(S,"fogFar"),g=E.getUniformLocation(S,"fogColor"),y=E.getUniformLocation(S,"alphaTest"),N=document.createElement("canvas"),N.width=8,N.height=8,D=N.getContext("2d"),D.fillStyle="white",D.fillRect(0,0,8,8),M=new o.Texture(N),M.needsUpdate=!0}E.useProgram(S),C.initAttributes(),C.enableAttribute(_),C.enableAttribute(b),C.disableUnusedAttributes(),C.disable(E.CULL_FACE),C.enable(E.BLEND),E.bindBuffer(E.ARRAY_BUFFER,x),E.vertexAttribPointer(_,2,E.FLOAT,!1,16,0),E.vertexAttribPointer(b,2,E.FLOAT,!1,16,8),E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,w),E.uniformMatrix4fv(p,!1,O.projectionMatrix.elements),C.activeTexture(E.TEXTURE0),E.uniform1i(c,0),D=N=0,(L=k.fog)?(E.uniform3f(g,L.color.r,L.color.g,L.color.b),L instanceof o.Fog?(E.uniform1f(m,L.near),E.uniform1f(v,L.far),E.uniform1i(f,1),D=N=1):L instanceof o.FogExp2&&(E.uniform1f(d,L.density),E.uniform1i(f,2),D=N=2)):(E.uniform1i(f,0),D=N=0);for(var L=0,R=t.length;R>L;L++){var j=t[L];j.modelViewMatrix.multiplyMatrices(O.matrixWorldInverse,j.matrixWorld),j.z=-j.modelViewMatrix.elements[14]}t.sort(r);for(var I=[],L=0,R=t.length;R>L;L++){var j=t[L],V=j.material;E.uniform1f(y,V.alphaTest),E.uniformMatrix4fv(l,!1,j.modelViewMatrix.elements),j.matrixWorld.decompose(T,A,P),I[0]=P.x,I[1]=P.y,j=0,k.fog&&V.fog&&(j=D),N!==j&&(E.uniform1i(f,j),N=j),null!==V.map?(E.uniform2f(n,V.map.offset.x,V.map.offset.y),E.uniform2f(i,V.map.repeat.x,V.map.repeat.y)):(E.uniform2f(n,0,0),E.uniform2f(i,1,1)),E.uniform1f(h,V.opacity),E.uniform3f(u,V.color.r,V.color.g,V.color.b),E.uniform1f(s,V.rotation),E.uniform2fv(a,I),C.setBlending(V.blending,V.blendEquation,V.blendSrc,V.blendDst),C.setDepthTest(V.depthTest),C.setDepthWrite(V.depthWrite),V.map&&V.map.image&&V.map.image.width?e.setTexture(V.map,0):e.setTexture(M,0),E.drawElements(E.TRIANGLES,6,E.UNSIGNED_SHORT,0)}C.enable(E.CULL_FACE),e.resetGLState()}}},o.CurveUtils={tangentQuadraticBezier:function(e,t,r,n){return 2*(1-e)*(r-t)+2*e*(n-r)},tangentCubicBezier:function(e,t,r,n,i){return-3*t*(1-e)*(1-e)+3*r*(1-e)*(1-e)-6*e*r*(1-e)+6*e*n*(1-e)-3*e*e*n+3*e*e*i},tangentSpline:function(e,t,r,n,i){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,r,n,i){e=.5*(r-e),n=.5*(n-t);var o=i*i;return(2*t-2*r+e+n)*i*o+(-3*t+3*r-2*e-n)*o+e*i+t}},o.GeometryUtils={merge:function(e,t,r){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var n;t instanceof o.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,t=t.geometry),e.merge(t,n,r)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},o.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,r,n){console.warn("THREE.ImageUtils.loadTexture is being deprecated. Use THREE.TextureLoader() instead.");var i=new o.TextureLoader;return i.setCrossOrigin(this.crossOrigin),e=i.load(e,r,void 0,n),t&&(e.mapping=t),e},loadTextureCube:function(e,t,r,n){console.warn("THREE.ImageUtils.loadTextureCube is being deprecated. Use THREE.CubeTextureLoader() instead.");var i=new o.CubeTextureLoader;return i.setCrossOrigin(this.crossOrigin),e=i.load(e,r,void 0,n),t&&(e.mapping=t),e},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}},o.SceneUtils={createMultiMaterialObject:function(e,t){for(var r=new o.Group,n=0,i=t.length;i>n;n++)r.add(new o.Mesh(e,t[n]));return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld),t.remove(e),r.add(e)},attach:function(e,t,r){var n=new o.Matrix4;n.getInverse(r.matrixWorld),e.applyMatrix(n),t.remove(e),r.add(e)}},o.ShapeUtils={area:function(e){for(var t=e.length,r=0,n=t-1,i=0;t>i;n=i++)r+=e[n].x*e[i].y-e[i].x*e[n].y;return.5*r},triangulate:function(){return function(e,t){var r=e.length;if(3>r)return null;var n,i,s,a=[],u=[],c=[];if(0<o.ShapeUtils.area(e))for(i=0;r>i;i++)u[i]=i;else for(i=0;r>i;i++)u[i]=r-1-i;var h=2*r;for(i=r-1;r>2;){if(0>=h--){console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()");break}n=i,n>=r&&(n=0),i=n+1,i>=r&&(i=0),s=i+1,s>=r&&(s=0);var l;e:{var p=l=void 0,f=void 0,d=void 0,m=void 0,v=void 0,g=void 0,y=void 0,_=void 0,p=e[u[n]].x,f=e[u[n]].y,d=e[u[i]].x,m=e[u[i]].y,v=e[u[s]].x,g=e[u[s]].y;if(Number.EPSILON>(d-p)*(g-f)-(m-f)*(v-p))l=!1;else{var b=void 0,x=void 0,w=void 0,S=void 0,M=void 0,E=void 0,C=void 0,T=void 0,A=void 0,P=void 0,A=T=C=_=y=void 0,b=v-d,x=g-m,w=p-v,S=f-g,M=d-p,E=m-f;for(l=0;r>l;l++)if(y=e[u[l]].x,_=e[u[l]].y,!(y===p&&_===f||y===d&&_===m||y===v&&_===g)&&(C=y-p,T=_-f,A=y-d,P=_-m,y-=v,_-=g,A=b*P-x*A,C=M*T-E*C,T=w*_-S*y,A>=-Number.EPSILON&&T>=-Number.EPSILON&&C>=-Number.EPSILON)){l=!1;break e}l=!0}}if(l){for(a.push([e[u[n]],e[u[i]],e[u[s]]]),c.push([u[n],u[i],u[s]]),n=i,s=i+1;r>s;n++,s++)u[n]=u[s];r--,h=2*r}}return t?c:a}}(),triangulateShape:function(e,t){function r(e,t,r){return e.x!==t.x?e.x<t.x?e.x<=r.x&&r.x<=t.x:t.x<=r.x&&r.x<=e.x:e.y<t.y?e.y<=r.y&&r.y<=t.y:t.y<=r.y&&r.y<=e.y}function n(e,t,n,i,o){var s=t.x-e.x,a=t.y-e.y,u=i.x-n.x,c=i.y-n.y,h=e.x-n.x,l=e.y-n.y,p=a*u-s*c,f=a*h-s*l;if(Math.abs(p)>Number.EPSILON){if(p>0){if(0>f||f>p)return[];if(u=c*h-u*l,0>u||u>p)return[]}else{if(f>0||p>f)return[];if(u=c*h-u*l,u>0||p>u)return[]}return 0===u?!o||0!==f&&f!==p?[e]:[]:u===p?!o||0!==f&&f!==p?[t]:[]:0===f?[n]:f===p?[i]:(o=u/p,[{x:e.x+o*s,y:e.y+o*a}])}return 0!==f||c*h!==u*l?[]:(a=0===s&&0===a,u=0===u&&0===c,a&&u?e.x!==n.x||e.y!==n.y?[]:[e]:a?r(n,i,e)?[e]:[]:u?r(e,t,n)?[n]:[]:(0!==s?(e.x<t.x?(s=e,u=e.x,a=t,e=t.x):(s=t,u=t.x,a=e,e=e.x),n.x<i.x?(t=n,p=n.x,c=i,n=i.x):(t=i,p=i.x,c=n,n=n.x)):(e.y<t.y?(s=e,u=e.y,a=t,e=t.y):(s=t,u=t.y,a=e,e=e.y),n.y<i.y?(t=n,p=n.y,c=i,n=i.y):(t=i,p=i.y,c=n,n=n.y)),p>=u?p>e?[]:e===p?o?[]:[t]:n>=e?[t,a]:[t,c]:u>n?[]:u===n?o?[]:[s]:n>=e?[s,a]:[s,c]))}function i(e,t,r,n){var i=t.x-e.x,o=t.y-e.y;t=r.x-e.x,r=r.y-e.y;var s=n.x-e.x;return n=n.y-e.y,e=i*r-o*t,i=i*n-o*s,Math.abs(e)>Number.EPSILON?(t=s*r-n*t,e>0?i>=0&&t>=0:i>=0||t>=0):i>0}var s,a,u,c,h,l={};for(u=e.concat(),s=0,a=t.length;a>s;s++)Array.prototype.push.apply(u,t[s]);for(s=0,a=u.length;a>s;s++)h=u[s].x+":"+u[s].y,void 0!==l[h]&&console.warn("THREE.Shape: Duplicate point",h),l[h]=s;s=function(e,t){function r(e,t){var r=v.length-1,n=e-1;0>n&&(n=r);var o=e+1;return o>r&&(o=0),(r=i(v[e],v[n],v[o],a[t]))?(r=a.length-1,n=t-1,0>n&&(n=r),o=t+1,o>r&&(o=0),(r=i(a[t],a[n],a[o],v[e]))?!0:!1):!1}function o(e,t){var r,i;for(r=0;r<v.length;r++)if(i=r+1,i%=v.length,i=n(e,t,v[r],v[i],!0),0<i.length)return!0;return!1}function s(e,r){var i,o,s,a;for(i=0;i<g.length;i++)for(o=t[g[i]],s=0;s<o.length;s++)if(a=s+1,a%=o.length,a=n(e,r,o[s],o[a],!0),0<a.length)return!0;return!1}var a,u,c,h,l,p,f,d,m,v=e.concat(),g=[],y=[],_=0;for(u=t.length;u>_;_++)g.push(_);f=0;for(var b=2*g.length;0<g.length;){if(b--,0>b){console.log("Infinite Loop! Holes left:"+g.length+", Probably Hole outside Shape!");break}for(c=f;c<v.length;c++){for(h=v[c],u=-1,_=0;_<g.length;_++)if(l=g[_],p=h.x+":"+h.y+":"+l,void 0===y[p]){for(a=t[l],d=0;d<a.length;d++)if(l=a[d],r(c,d)&&!o(h,l)&&!s(h,l)){u=d,g.splice(_,1),f=v.slice(0,c+1),l=v.slice(c),d=a.slice(u),m=a.slice(0,u+1),v=f.concat(d).concat(m).concat(l),f=c;break}if(u>=0)break;y[p]=!0}if(u>=0)break}}return v}(e,t);var p=o.ShapeUtils.triangulate(s,!1);for(s=0,a=p.length;a>s;s++)for(c=p[s],u=0;3>u;u++)h=c[u].x+":"+c[u].y,h=l[h],void 0!==h&&(c[u]=h);return p.concat()},isClockWise:function(e){return 0>o.ShapeUtils.area(e)},b2:function(){return function(e,t,r,n){var i=1-e;return i*i*t+2*(1-e)*e*r+e*e*n}}(),b3:function(){return function(e,t,r,n,i){var o=1-e,s=1-e;return o*o*o*t+3*s*s*e*r+3*(1-e)*e*e*n+e*e*e*i}}()},o.Audio=function(e){o.Object3D.call(this),this.type="Audio",this.context=e.context,this.source=this.context.createBufferSource(),this.source.onended=this.onEnded.bind(this),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.panner=this.context.createPanner(),this.panner.connect(this.gain),this.autoplay=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1},o.Audio.prototype=Object.create(o.Object3D.prototype),o.Audio.prototype.constructor=o.Audio,o.Audio.prototype.load=function(e){var t=this,r=new XMLHttpRequest;return r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(e){t.context.decodeAudioData(this.response,function(e){t.source.buffer=e,t.autoplay&&t.play()})},r.send(),this},o.Audio.prototype.play=function(){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else{var e=this.context.createBufferSource();e.buffer=this.source.buffer,e.loop=this.source.loop,e.onended=this.source.onended,e.start(0,this.startTime),e.playbackRate.value=this.playbackRate,this.isPlaying=!0,this.source=e,this.connect()}},o.Audio.prototype.pause=function(){this.source.stop(),this.startTime=this.context.currentTime},o.Audio.prototype.stop=function(){this.source.stop(),this.startTime=0},o.Audio.prototype.connect=function(){void 0!==this.filter?(this.source.connect(this.filter),this.filter.connect(this.panner)):this.source.connect(this.panner)},o.Audio.prototype.disconnect=function(){void 0!==this.filter?(this.source.disconnect(this.filter),this.filter.disconnect(this.panner)):this.source.disconnect(this.panner)},o.Audio.prototype.setFilter=function(e){!0===this.isPlaying?(this.disconnect(),this.filter=e,this.connect()):this.filter=e},o.Audio.prototype.getFilter=function(){return this.filter},o.Audio.prototype.setPlaybackRate=function(e){this.playbackRate=e,!0===this.isPlaying&&(this.source.playbackRate.value=this.playbackRate)},o.Audio.prototype.getPlaybackRate=function(){return this.playbackRate;
},o.Audio.prototype.onEnded=function(){this.isPlaying=!1},o.Audio.prototype.setLoop=function(e){this.source.loop=e},o.Audio.prototype.getLoop=function(){return this.source.loop},o.Audio.prototype.setRefDistance=function(e){this.panner.refDistance=e},o.Audio.prototype.getRefDistance=function(){return this.panner.refDistance},o.Audio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e},o.Audio.prototype.getRolloffFactor=function(){return this.panner.rolloffFactor},o.Audio.prototype.setVolume=function(e){this.gain.gain.value=e},o.Audio.prototype.getVolume=function(){return this.gain.gain.value},o.Audio.prototype.updateMatrixWorld=function(){var e=new o.Vector3;return function(t){o.Object3D.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}(),o.AudioListener=function(){o.Object3D.call(this),this.type="AudioListener",this.context=new(window.AudioContext||window.webkitAudioContext)},o.AudioListener.prototype=Object.create(o.Object3D.prototype),o.AudioListener.prototype.constructor=o.AudioListener,o.AudioListener.prototype.updateMatrixWorld=function(){var e=new o.Vector3,t=new o.Quaternion,r=new o.Vector3,n=new o.Vector3;return function(i){o.Object3D.prototype.updateMatrixWorld.call(this,i),i=this.context.listener;var s=this.up;this.matrixWorld.decompose(e,t,r),n.set(0,0,-1).applyQuaternion(t),i.setPosition(e.x,e.y,e.z),i.setOrientation(n.x,n.y,n.z,s.x,s.y,s.z)}}(),o.Curve=function(){},o.Curve.prototype={constructor:o.Curve,getPoint:function(e){return console.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},getPointAt:function(e){return e=this.getUtoTmapping(e),this.getPoint(e)},getPoints:function(e){e||(e=5);var t,r=[];for(t=0;e>=t;t++)r.push(this.getPoint(t/e));return r},getSpacedPoints:function(e){e||(e=5);var t,r=[];for(t=0;e>=t;t++)r.push(this.getPointAt(t/e));return r},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,n=[],i=this.getPoint(0),o=0;for(n.push(0),r=1;e>=r;r++)t=this.getPoint(r/e),o+=t.distanceTo(i),n.push(o),i=t;return this.cacheArcLengths=n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var r,n=this.getLengths(),i=0,o=n.length;r=t?t:e*n[o-1];for(var s,a=0,u=o-1;u>=a;)if(i=Math.floor(a+(u-a)/2),s=n[i]-r,0>s)a=i+1;else{if(!(s>0)){u=i;break}u=i-1}return i=u,n[i]===r?i/(o-1):(a=n[i],n=(i+(r-a)/(n[i+1]-a))/(o-1))},getTangent:function(e){var t=e-1e-4;return e+=1e-4,0>t&&(t=0),e>1&&(e=1),t=this.getPoint(t),this.getPoint(e).clone().sub(t).normalize()},getTangentAt:function(e){return e=this.getUtoTmapping(e),this.getTangent(e)}},o.Curve.Utils=o.CurveUtils,o.Curve.create=function(e,t){return e.prototype=Object.create(o.Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},o.CurvePath=function(){this.curves=[],this.autoClose=!1},o.CurvePath.prototype=Object.create(o.Curve.prototype),o.CurvePath.prototype.constructor=o.CurvePath,o.CurvePath.prototype.add=function(e){this.curves.push(e)},o.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new o.LineCurve(t,e))},o.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=t)return e=this.curves[n],t=1-(r[n]-t)/e.getLength(),e.getPointAt(t);n++}return null},o.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},o.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,n=this.curves.length;n>r;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e},o.CurvePath.prototype.createPointsGeometry=function(e){return e=this.getPoints(e,!0),this.createGeometry(e)},o.CurvePath.prototype.createSpacedPointsGeometry=function(e){return e=this.getSpacedPoints(e,!0),this.createGeometry(e)},o.CurvePath.prototype.createGeometry=function(e){for(var t=new o.Geometry,r=0,n=e.length;n>r;r++){var i=e[r];t.vertices.push(new o.Vector3(i.x,i.y,i.z||0))}return t},o.Path=function(e){o.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},o.Path.prototype=Object.create(o.CurvePath.prototype),o.Path.prototype.constructor=o.Path,o.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;r>t;t++)this.lineTo(e[t].x,e[t].y)},o.Path.prototype.moveTo=function(e,t){this.actions.push({action:"moveTo",args:[e,t]})},o.Path.prototype.lineTo=function(e,t){var r=this.actions[this.actions.length-1].args,r=new o.LineCurve(new o.Vector2(r[r.length-2],r[r.length-1]),new o.Vector2(e,t));this.curves.push(r),this.actions.push({action:"lineTo",args:[e,t]})},o.Path.prototype.quadraticCurveTo=function(e,t,r,n){var i=this.actions[this.actions.length-1].args,i=new o.QuadraticBezierCurve(new o.Vector2(i[i.length-2],i[i.length-1]),new o.Vector2(e,t),new o.Vector2(r,n));this.curves.push(i),this.actions.push({action:"quadraticCurveTo",args:[e,t,r,n]})},o.Path.prototype.bezierCurveTo=function(e,t,r,n,i,s){var a=this.actions[this.actions.length-1].args,a=new o.CubicBezierCurve(new o.Vector2(a[a.length-2],a[a.length-1]),new o.Vector2(e,t),new o.Vector2(r,n),new o.Vector2(i,s));this.curves.push(a),this.actions.push({action:"bezierCurveTo",args:[e,t,r,n,i,s]})},o.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,r=[new o.Vector2(r[r.length-2],r[r.length-1])];Array.prototype.push.apply(r,e),r=new o.SplineCurve(r),this.curves.push(r),this.actions.push({action:"splineThru",args:t})},o.Path.prototype.arc=function(e,t,r,n,i,o){var s=this.actions[this.actions.length-1].args;this.absarc(e+s[s.length-2],t+s[s.length-1],r,n,i,o)},o.Path.prototype.absarc=function(e,t,r,n,i,o){this.absellipse(e,t,r,r,n,i,o)},o.Path.prototype.ellipse=function(e,t,r,n,i,o,s,a){var u=this.actions[this.actions.length-1].args;this.absellipse(e+u[u.length-2],t+u[u.length-1],r,n,i,o,s,a)},o.Path.prototype.absellipse=function(e,t,r,n,i,s,a,u){var c=[e,t,r,n,i,s,a,u||0];e=new o.EllipseCurve(e,t,r,n,i,s,a,u),this.curves.push(e),e=e.getPoint(1),c.push(e.x),c.push(e.y),this.actions.push({action:"ellipse",args:c})},o.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var r=[],n=0;e>n;n++)r.push(this.getPoint(n/e));return r},o.Path.prototype.getPoints=function(e,t){e=e||12;for(var r,n,i,s,a,u,c,h,l,p,f=o.ShapeUtils.b2,d=o.ShapeUtils.b3,m=[],v=0,g=this.actions.length;g>v;v++){l=this.actions[v];var y=l.args;switch(l.action){case"moveTo":m.push(new o.Vector2(y[0],y[1]));break;case"lineTo":m.push(new o.Vector2(y[0],y[1]));break;case"quadraticCurveTo":for(r=y[2],n=y[3],a=y[0],u=y[1],0<m.length?(l=m[m.length-1],c=l.x,h=l.y):(l=this.actions[v-1].args,c=l[l.length-2],h=l[l.length-1]),y=1;e>=y;y++)p=y/e,l=f(p,c,a,r),p=f(p,h,u,n),m.push(new o.Vector2(l,p));break;case"bezierCurveTo":for(r=y[4],n=y[5],a=y[0],u=y[1],i=y[2],s=y[3],0<m.length?(l=m[m.length-1],c=l.x,h=l.y):(l=this.actions[v-1].args,c=l[l.length-2],h=l[l.length-1]),y=1;e>=y;y++)p=y/e,l=d(p,c,a,i,r),p=d(p,h,u,s,n),m.push(new o.Vector2(l,p));break;case"splineThru":for(l=this.actions[v-1].args,p=[new o.Vector2(l[l.length-2],l[l.length-1])],l=e*y[0].length,p=p.concat(y[0]),p=new o.SplineCurve(p),y=1;l>=y;y++)m.push(p.getPointAt(y/l));break;case"arc":for(r=y[0],n=y[1],u=y[2],i=y[3],l=y[4],a=!!y[5],c=l-i,h=2*e,y=1;h>=y;y++)p=y/h,a||(p=1-p),p=i+p*c,l=r+u*Math.cos(p),p=n+u*Math.sin(p),m.push(new o.Vector2(l,p));break;case"ellipse":r=y[0],n=y[1],u=y[2],s=y[3],i=y[4],l=y[5],a=!!y[6];var _=y[7];c=l-i,h=2*e;var b,x;for(0!==_&&(b=Math.cos(_),x=Math.sin(_)),y=1;h>=y;y++){if(p=y/h,a||(p=1-p),p=i+p*c,l=r+u*Math.cos(p),p=n+s*Math.sin(p),0!==_){var w=l;l=(w-r)*b-(p-n)*x+r,p=(w-r)*x+(p-n)*b+n}m.push(new o.Vector2(l,p))}}}return f=m[m.length-1],Math.abs(f.x-m[0].x)<Number.EPSILON&&Math.abs(f.y-m[0].y)<Number.EPSILON&&m.splice(m.length-1,1),t&&m.push(m[0]),m},o.Path.prototype.toShapes=function(e,t){function r(e){for(var t=[],r=0,n=e.length;n>r;r++){var i=e[r],s=new o.Shape;s.actions=i.actions,s.curves=i.curves,t.push(s)}return t}function n(e,t){for(var r=t.length,n=!1,i=r-1,o=0;r>o;i=o++){var s=t[i],a=t[o],u=a.x-s.x,c=a.y-s.y;if(Math.abs(c)>Number.EPSILON){if(0>c&&(s=t[o],u=-u,a=t[i],c=-c),!(e.y<s.y||e.y>a.y))if(e.y===s.y){if(e.x===s.x)return!0}else{if(i=c*(e.x-s.x)-u*(e.y-s.y),0===i)return!0;0>i||(n=!n)}}else if(e.y===s.y&&(a.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=a.x))return!0}return n}var i=o.ShapeUtils.isClockWise,s=function(e){for(var t=[],r=new o.Path,n=0,i=e.length;i>n;n++){var s=e[n],a=s.args,s=s.action;"moveTo"===s&&0!==r.actions.length&&(t.push(r),r=new o.Path),r[s].apply(r,a)}return 0!==r.actions.length&&t.push(r),t}(this.actions);if(0===s.length)return[];if(!0===t)return r(s);var a,u,c,h=[];if(1===s.length)return u=s[0],c=new o.Shape,c.actions=u.actions,c.curves=u.curves,h.push(c),h;var l=!i(s[0].getPoints()),l=e?!l:l;c=[];var p,f=[],d=[],m=0;f[m]=void 0,d[m]=[];for(var v=0,g=s.length;g>v;v++)u=s[v],p=u.getPoints(),a=i(p),(a=e?!a:a)?(!l&&f[m]&&m++,f[m]={s:new o.Shape,p:p},f[m].s.actions=u.actions,f[m].s.curves=u.curves,l&&m++,d[m]=[]):d[m].push({h:u,p:p[0]});if(!f[0])return r(s);if(1<f.length){for(v=!1,u=[],i=0,s=f.length;s>i;i++)c[i]=[];for(i=0,s=f.length;s>i;i++)for(a=d[i],l=0;l<a.length;l++){for(m=a[l],p=!0,g=0;g<f.length;g++)n(m.p,f[g].p)&&(i!==g&&u.push({froms:i,tos:g,hole:l}),p?(p=!1,c[g].push(m)):v=!0);p&&c[i].push(m)}0<u.length&&(v||(d=c))}for(v=0,i=f.length;i>v;v++)for(c=f[v].s,h.push(c),u=d[v],s=0,a=u.length;a>s;s++)c.holes.push(u[s].h);return h},o.Shape=function(){o.Path.apply(this,arguments),this.holes=[]},o.Shape.prototype=Object.create(o.Path.prototype),o.Shape.prototype.constructor=o.Shape,o.Shape.prototype.extrude=function(e){return new o.ExtrudeGeometry(this,e)},o.Shape.prototype.makeGeometry=function(e){return new o.ShapeGeometry(this,e)},o.Shape.prototype.getPointsHoles=function(e){for(var t=[],r=0,n=this.holes.length;n>r;r++)t[r]=this.holes[r].getPoints(e);return t},o.Shape.prototype.extractAllPoints=function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},o.Shape.prototype.extractPoints=function(e){return this.extractAllPoints(e)},o.Shape.Utils=o.ShapeUtils,o.LineCurve=function(e,t){this.v1=e,this.v2=t},o.LineCurve.prototype=Object.create(o.Curve.prototype),o.LineCurve.prototype.constructor=o.LineCurve,o.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},o.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},o.LineCurve.prototype.getTangent=function(e){return this.v2.clone().sub(this.v1).normalize()},o.QuadraticBezierCurve=function(e,t,r){this.v0=e,this.v1=t,this.v2=r},o.QuadraticBezierCurve.prototype=Object.create(o.Curve.prototype),o.QuadraticBezierCurve.prototype.constructor=o.QuadraticBezierCurve,o.QuadraticBezierCurve.prototype.getPoint=function(e){var t=o.ShapeUtils.b2;return new o.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y))},o.QuadraticBezierCurve.prototype.getTangent=function(e){var t=o.CurveUtils.tangentQuadraticBezier;return new o.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y)).normalize()},o.CubicBezierCurve=function(e,t,r,n){this.v0=e,this.v1=t,this.v2=r,this.v3=n},o.CubicBezierCurve.prototype=Object.create(o.Curve.prototype),o.CubicBezierCurve.prototype.constructor=o.CubicBezierCurve,o.CubicBezierCurve.prototype.getPoint=function(e){var t=o.ShapeUtils.b3;return new o.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y))},o.CubicBezierCurve.prototype.getTangent=function(e){var t=o.CurveUtils.tangentCubicBezier;return new o.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y)).normalize()},o.SplineCurve=function(e){this.points=void 0==e?[]:e},o.SplineCurve.prototype=Object.create(o.Curve.prototype),o.SplineCurve.prototype.constructor=o.SplineCurve,o.SplineCurve.prototype.getPoint=function(e){var t=this.points;e*=t.length-1;var r=Math.floor(e);e-=r;var n=t[0===r?r:r-1],i=t[r],s=t[r>t.length-2?t.length-1:r+1],t=t[r>t.length-3?t.length-1:r+2],r=o.CurveUtils.interpolate;return new o.Vector2(r(n.x,i.x,s.x,t.x,e),r(n.y,i.y,s.y,t.y,e))},o.EllipseCurve=function(e,t,r,n,i,o,s,a){this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=n,this.aStartAngle=i,this.aEndAngle=o,this.aClockwise=s,this.aRotation=a||0},o.EllipseCurve.prototype=Object.create(o.Curve.prototype),o.EllipseCurve.prototype.constructor=o.EllipseCurve,o.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;0>t&&(t+=2*Math.PI),t>2*Math.PI&&(t-=2*Math.PI),t=!0===this.aClockwise?this.aEndAngle+(1-e)*(2*Math.PI-t):this.aStartAngle+e*t,e=this.aX+this.xRadius*Math.cos(t);var r=this.aY+this.yRadius*Math.sin(t);if(0!==this.aRotation){var t=Math.cos(this.aRotation),n=Math.sin(this.aRotation),i=e;e=(i-this.aX)*t-(r-this.aY)*n+this.aX,r=(i-this.aX)*n+(r-this.aY)*t+this.aY}return new o.Vector2(e,r)},o.ArcCurve=function(e,t,r,n,i,s){o.EllipseCurve.call(this,e,t,r,r,n,i,s)},o.ArcCurve.prototype=Object.create(o.EllipseCurve.prototype),o.ArcCurve.prototype.constructor=o.ArcCurve,o.LineCurve3=o.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new o.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),o.QuadraticBezierCurve3=o.Curve.create(function(e,t,r){this.v0=e,this.v1=t,this.v2=r},function(e){var t=o.ShapeUtils.b2;return new o.Vector3(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y),t(e,this.v0.z,this.v1.z,this.v2.z))}),o.CubicBezierCurve3=o.Curve.create(function(e,t,r,n){this.v0=e,this.v1=t,this.v2=r,this.v3=n},function(e){var t=o.ShapeUtils.b3;return new o.Vector3(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z))}),o.SplineCurve3=o.Curve.create(function(e){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3"),this.points=void 0==e?[]:e},function(e){var t=this.points;e*=t.length-1;var r=Math.floor(e);e-=r;var n=t[0==r?r:r-1],i=t[r],s=t[r>t.length-2?t.length-1:r+1],t=t[r>t.length-3?t.length-1:r+2],r=o.CurveUtils.interpolate;return new o.Vector3(r(n.x,i.x,s.x,t.x,e),r(n.y,i.y,s.y,t.y,e),r(n.z,i.z,s.z,t.z,e))}),o.CatmullRomCurve3=function(){function e(){}var t=new o.Vector3,r=new e,n=new e,i=new e;return e.prototype.init=function(e,t,r,n){this.c0=e,this.c1=r,this.c2=-3*e+3*t-2*r-n,this.c3=2*e-2*t+r+n},e.prototype.initNonuniformCatmullRom=function(e,t,r,n,i,o,s){e=((t-e)/i-(r-e)/(i+o)+(r-t)/o)*o,n=((r-t)/o-(n-t)/(o+s)+(n-r)/s)*o,this.init(t,r,e,n)},e.prototype.initCatmullRom=function(e,t,r,n,i){this.init(t,r,i*(r-e),i*(n-t))},e.prototype.calc=function(e){var t=e*e;return this.c0+this.c1*e+this.c2*t+this.c3*t*e},o.Curve.create(function(e){this.points=e||[]},function(e){var s,a,u=this.points;a=u.length,2>a&&console.log("duh, you need at least 2 points"),e*=a-1,s=Math.floor(e),e-=s,0===e&&s===a-1&&(s=a-2,e=1);var c,h,l;if(0===s?(t.subVectors(u[0],u[1]).add(u[0]),c=t):c=u[s-1],h=u[s],l=u[s+1],a>s+2?u=u[s+2]:(t.subVectors(u[a-1],u[a-2]).add(u[a-2]),u=t),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var p="chordal"===this.type?.5:.25;a=Math.pow(c.distanceToSquared(h),p),s=Math.pow(h.distanceToSquared(l),p),p=Math.pow(l.distanceToSquared(u),p),1e-4>s&&(s=1),1e-4>a&&(a=s),1e-4>p&&(p=s),r.initNonuniformCatmullRom(c.x,h.x,l.x,u.x,a,s,p),n.initNonuniformCatmullRom(c.y,h.y,l.y,u.y,a,s,p),i.initNonuniformCatmullRom(c.z,h.z,l.z,u.z,a,s,p)}else"catmullrom"===this.type&&(a=void 0!==this.tension?this.tension:.5,r.initCatmullRom(c.x,h.x,l.x,u.x,a),n.initCatmullRom(c.y,h.y,l.y,u.y,a),i.initCatmullRom(c.z,h.z,l.z,u.z,a));return new o.Vector3(r.calc(e),n.calc(e),i.calc(e))})}(),o.ClosedSplineCurve3=o.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t=this.points;e*=t.length-0;var r=Math.floor(e);e-=r;var r=r+(r>0?0:(Math.floor(Math.abs(r)/t.length)+1)*t.length),n=t[(r-1)%t.length],i=t[r%t.length],s=t[(r+1)%t.length],t=t[(r+2)%t.length],r=o.CurveUtils.interpolate;return new o.Vector3(r(n.x,i.x,s.x,t.x,e),r(n.y,i.y,s.y,t.y,e),r(n.z,i.z,s.z,t.z,e))}),o.BoxGeometry=function(e,t,r,n,i,s){function a(e,t,r,n,i,s,a,c){var h,l=u.widthSegments,p=u.heightSegments,f=i/2,d=s/2,m=u.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?h="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(h="y",p=u.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(h="x",l=u.depthSegments);var v=l+1,g=p+1,y=i/l,_=s/p,b=new o.Vector3;for(b[h]=a>0?1:-1,i=0;g>i;i++)for(s=0;v>s;s++){var x=new o.Vector3;x[e]=(s*y-f)*r,x[t]=(i*_-d)*n,x[h]=a,u.vertices.push(x)}for(i=0;p>i;i++)for(s=0;l>s;s++)d=s+v*i,e=s+v*(i+1),t=s+1+v*(i+1),r=s+1+v*i,n=new o.Vector2(s/l,1-i/p),a=new o.Vector2(s/l,1-(i+1)/p),h=new o.Vector2((s+1)/l,1-(i+1)/p),f=new o.Vector2((s+1)/l,1-i/p),d=new o.Face3(d+m,e+m,r+m),d.normal.copy(b),d.vertexNormals.push(b.clone(),b.clone(),b.clone()),d.materialIndex=c,u.faces.push(d),u.faceVertexUvs[0].push([n,a,f]),d=new o.Face3(e+m,t+m,r+m),d.normal.copy(b),d.vertexNormals.push(b.clone(),b.clone(),b.clone()),d.materialIndex=c,u.faces.push(d),u.faceVertexUvs[0].push([a.clone(),h,f.clone()])}o.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:s},this.widthSegments=n||1,this.heightSegments=i||1,this.depthSegments=s||1;var u=this;n=e/2,i=t/2,s=r/2,a("z","y",-1,-1,r,t,n,0),a("z","y",1,-1,r,t,-n,1),a("x","z",1,1,e,r,i,2),a("x","z",1,-1,e,r,-i,3),a("x","y",1,-1,e,t,s,4),a("x","y",-1,-1,e,t,-s,5),this.mergeVertices()},o.BoxGeometry.prototype=Object.create(o.Geometry.prototype),o.BoxGeometry.prototype.constructor=o.BoxGeometry,o.BoxGeometry.prototype.clone=function(){var e=this.parameters;return new o.BoxGeometry(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)},o.CubeGeometry=o.BoxGeometry,o.CircleGeometry=function(e,t,r,n){o.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new o.CircleBufferGeometry(e,t,r,n))},o.CircleGeometry.prototype=Object.create(o.Geometry.prototype),o.CircleGeometry.prototype.constructor=o.CircleGeometry,o.CircleGeometry.prototype.clone=function(){var e=this.parameters;return new o.CircleGeometry(e.radius,e.segments,e.thetaStart,e.thetaLength)},o.CircleBufferGeometry=function(e,t,r,n){o.BufferGeometry.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},e=e||50,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i=t+2,s=new Float32Array(3*i),a=new Float32Array(3*i),i=new Float32Array(2*i);a[2]=1,i[0]=.5,i[1]=.5;for(var u=0,c=3,h=2;t>=u;u++,c+=3,h+=2){var l=r+u/t*n;s[c]=e*Math.cos(l),s[c+1]=e*Math.sin(l),a[c+2]=1,i[h]=(s[c]/e+1)/2,i[h+1]=(s[c+1]/e+1)/2}for(r=[],c=1;t>=c;c++)r.push(c,c+1,0);this.setIndex(new o.BufferAttribute(new Uint16Array(r),1)),this.addAttribute("position",new o.BufferAttribute(s,3)),this.addAttribute("normal",new o.BufferAttribute(a,3)),this.addAttribute("uv",new o.BufferAttribute(i,2)),this.boundingSphere=new o.Sphere(new o.Vector3,e)},o.CircleBufferGeometry.prototype=Object.create(o.BufferGeometry.prototype),o.CircleBufferGeometry.prototype.constructor=o.CircleBufferGeometry,o.CircleBufferGeometry.prototype.clone=function(){var e=this.parameters;return new o.CircleBufferGeometry(e.radius,e.segments,e.thetaStart,e.thetaLength)},o.CylinderGeometry=function(e,t,r,n,i,s,a,u){o.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:s,thetaStart:a,thetaLength:u},e=void 0!==e?e:20,t=void 0!==t?t:20,r=void 0!==r?r:100,n=n||8,i=i||1,s=void 0!==s?s:!1,a=void 0!==a?a:0,u=void 0!==u?u:2*Math.PI;var c,h,l=r/2,p=[],f=[];for(h=0;i>=h;h++){var d=[],m=[],v=h/i,g=v*(t-e)+e;for(c=0;n>=c;c++){var y=c/n,_=new o.Vector3;_.x=g*Math.sin(y*u+a),_.y=-v*r+l,_.z=g*Math.cos(y*u+a),this.vertices.push(_),d.push(this.vertices.length-1),m.push(new o.Vector2(y,1-v))}p.push(d),f.push(m)}for(r=(t-e)/r,c=0;n>c;c++)for(0!==e?(a=this.vertices[p[0][c]].clone(),u=this.vertices[p[0][c+1]].clone()):(a=this.vertices[p[1][c]].clone(),u=this.vertices[p[1][c+1]].clone()),a.setY(Math.sqrt(a.x*a.x+a.z*a.z)*r).normalize(),u.setY(Math.sqrt(u.x*u.x+u.z*u.z)*r).normalize(),h=0;i>h;h++){var d=p[h][c],m=p[h+1][c],v=p[h+1][c+1],g=p[h][c+1],y=a.clone(),_=a.clone(),b=u.clone(),x=u.clone(),w=f[h][c].clone(),S=f[h+1][c].clone(),M=f[h+1][c+1].clone(),E=f[h][c+1].clone();this.faces.push(new o.Face3(d,m,g,[y,_,x])),this.faceVertexUvs[0].push([w,S,E]),this.faces.push(new o.Face3(m,v,g,[_.clone(),b,x.clone()])),this.faceVertexUvs[0].push([S.clone(),M,E.clone()])}if(!1===s&&e>0)for(this.vertices.push(new o.Vector3(0,l,0)),c=0;n>c;c++)d=p[0][c],m=p[0][c+1],v=this.vertices.length-1,y=new o.Vector3(0,1,0),_=new o.Vector3(0,1,0),b=new o.Vector3(0,1,0),w=f[0][c].clone(),S=f[0][c+1].clone(),M=new o.Vector2(S.x,0),this.faces.push(new o.Face3(d,m,v,[y,_,b],void 0,1)),this.faceVertexUvs[0].push([w,S,M]);if(!1===s&&t>0)for(this.vertices.push(new o.Vector3(0,-l,0)),c=0;n>c;c++)d=p[i][c+1],m=p[i][c],v=this.vertices.length-1,y=new o.Vector3(0,-1,0),_=new o.Vector3(0,-1,0),b=new o.Vector3(0,-1,0),w=f[i][c+1].clone(),S=f[i][c].clone(),M=new o.Vector2(S.x,1),this.faces.push(new o.Face3(d,m,v,[y,_,b],void 0,2)),this.faceVertexUvs[0].push([w,S,M]);this.computeFaceNormals()},o.CylinderGeometry.prototype=Object.create(o.Geometry.prototype),o.CylinderGeometry.prototype.constructor=o.CylinderGeometry,o.CylinderGeometry.prototype.clone=function(){var e=this.parameters;return new o.CylinderGeometry(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)},o.EdgesGeometry=function(e,t){function r(e,t){return e-t}o.BufferGeometry.call(this);var n,i=Math.cos(o.Math.degToRad(void 0!==t?t:1)),s=[0,0],a={},u=["a","b","c"];e instanceof o.BufferGeometry?(n=new o.Geometry,n.fromBufferGeometry(e)):n=e.clone(),n.mergeVertices(),n.computeFaceNormals();var c=n.vertices;n=n.faces;for(var h=0,l=n.length;l>h;h++)for(var p=n[h],f=0;3>f;f++){s[0]=p[u[f]],s[1]=p[u[(f+1)%3]],s.sort(r);var d=s.toString();void 0===a[d]?a[d]={vert1:s[0],vert2:s[1],face1:h,face2:void 0}:a[d].face2=h}s=[];for(d in a)u=a[d],(void 0===u.face2||n[u.face1].normal.dot(n[u.face2].normal)<=i)&&(h=c[u.vert1],s.push(h.x),s.push(h.y),s.push(h.z),h=c[u.vert2],s.push(h.x),s.push(h.y),s.push(h.z));this.addAttribute("position",new o.BufferAttribute(new Float32Array(s),3))},o.EdgesGeometry.prototype=Object.create(o.BufferGeometry.prototype),o.EdgesGeometry.prototype.constructor=o.EdgesGeometry,o.ExtrudeGeometry=function(e,t){"undefined"!=typeof e&&(o.Geometry.call(this),this.type="ExtrudeGeometry",e=Array.isArray(e)?e:[e],this.addShapeList(e,t),this.computeFaceNormals())},o.ExtrudeGeometry.prototype=Object.create(o.Geometry.prototype),o.ExtrudeGeometry.prototype.constructor=o.ExtrudeGeometry,o.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var r=e.length,n=0;r>n;n++)this.addShape(e[n],t)},o.ExtrudeGeometry.prototype.addShape=function(e,t){function r(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}function n(e,t,r){var n=1,n=e.x-t.x,i=e.y-t.y,s=r.x-e.x,a=r.y-e.y,u=n*n+i*i;if(Math.abs(n*a-i*s)>Number.EPSILON){var c=Math.sqrt(u),h=Math.sqrt(s*s+a*a),u=t.x-i/c;if(t=t.y+n/c,s=((r.x-a/h-u)*a-(r.y+s/h-t)*s)/(n*a-i*s),r=u+n*s-e.x,e=t+i*s-e.y,n=r*r+e*e,2>=n)return new o.Vector2(r,e);n=Math.sqrt(n/2)}else e=!1,n>Number.EPSILON?s>Number.EPSILON&&(e=!0):n<-Number.EPSILON?s<-Number.EPSILON&&(e=!0):Math.sign(i)===Math.sign(a)&&(e=!0),e?(r=-i,e=n,n=Math.sqrt(u)):(r=n,e=i,n=Math.sqrt(u/2));return new o.Vector2(r/n,e/n)}function i(e,t){var r,n;for(F=e.length;0<=--F;){r=F,n=F-1,0>n&&(n=e.length-1);for(var i=0,s=_+2*v,i=0;s>i;i++){var a=I*i,u=I*(i+1),c=t+r+a,a=t+n+a,h=t+n+u,u=t+r+u,c=c+T,a=a+T,h=h+T,u=u+T;C.faces.push(new o.Face3(c,a,u,null,null,1)),C.faces.push(new o.Face3(a,h,u,null,null,1)),c=w.generateSideWallUV(C,c,a,h,u),C.faceVertexUvs[0].push([c[0],c[1],c[3]]),C.faceVertexUvs[0].push([c[1],c[2],c[3]])}}}function s(e,t,r){C.vertices.push(new o.Vector3(e,t,r))}function a(e,t,r){e+=T,t+=T,r+=T,C.faces.push(new o.Face3(e,t,r,null,null,0)),e=w.generateTopUV(C,e,t,r),C.faceVertexUvs[0].push(e)}var u,c,h,l,p,f=void 0!==t.amount?t.amount:100,d=void 0!==t.bevelThickness?t.bevelThickness:6,m=void 0!==t.bevelSize?t.bevelSize:d-2,v=void 0!==t.bevelSegments?t.bevelSegments:3,g=void 0!==t.bevelEnabled?t.bevelEnabled:!0,y=void 0!==t.curveSegments?t.curveSegments:12,_=void 0!==t.steps?t.steps:1,b=t.extrudePath,x=!1,w=void 0!==t.UVGenerator?t.UVGenerator:o.ExtrudeGeometry.WorldUVGenerator;b&&(u=b.getSpacedPoints(_),x=!0,g=!1,c=void 0!==t.frames?t.frames:new o.TubeGeometry.FrenetFrames(b,_,!1),h=new o.Vector3,l=new o.Vector3,p=new o.Vector3),g||(m=d=v=0);var S,M,E,C=this,T=this.vertices.length,b=e.extractPoints(y),y=b.shape,A=b.holes;if(b=!o.ShapeUtils.isClockWise(y)){for(y=y.reverse(),M=0,E=A.length;E>M;M++)S=A[M],o.ShapeUtils.isClockWise(S)&&(A[M]=S.reverse());b=!1}var P=o.ShapeUtils.triangulateShape(y,A),k=y;for(M=0,E=A.length;E>M;M++)S=A[M],y=y.concat(S);var O,N,D,L,R,j,I=y.length,V=P.length,b=[],F=0;for(D=k.length,O=D-1,N=F+1;D>F;F++,O++,N++)O===D&&(O=0),N===D&&(N=0),b[F]=n(k[F],k[O],k[N]);var B,U=[],G=b.concat();for(M=0,E=A.length;E>M;M++){for(S=A[M],B=[],F=0,D=S.length,O=D-1,N=F+1;D>F;F++,O++,N++)O===D&&(O=0),N===D&&(N=0),B[F]=n(S[F],S[O],S[N]);U.push(B),G=G.concat(B)}for(O=0;v>O;O++){for(D=O/v,L=d*(1-D),N=m*Math.sin(D*Math.PI/2),F=0,D=k.length;D>F;F++)R=r(k[F],b[F],N),s(R.x,R.y,-L);for(M=0,E=A.length;E>M;M++)for(S=A[M],B=U[M],F=0,D=S.length;D>F;F++)R=r(S[F],B[F],N),s(R.x,R.y,-L)}for(N=m,F=0;I>F;F++)R=g?r(y[F],G[F],N):y[F],x?(l.copy(c.normals[0]).multiplyScalar(R.x),h.copy(c.binormals[0]).multiplyScalar(R.y),p.copy(u[0]).add(l).add(h),s(p.x,p.y,p.z)):s(R.x,R.y,0);for(D=1;_>=D;D++)for(F=0;I>F;F++)R=g?r(y[F],G[F],N):y[F],x?(l.copy(c.normals[D]).multiplyScalar(R.x),h.copy(c.binormals[D]).multiplyScalar(R.y),p.copy(u[D]).add(l).add(h),s(p.x,p.y,p.z)):s(R.x,R.y,f/_*D);for(O=v-1;O>=0;O--){for(D=O/v,L=d*(1-D),N=m*Math.sin(D*Math.PI/2),F=0,D=k.length;D>F;F++)R=r(k[F],b[F],N),s(R.x,R.y,f+L);for(M=0,E=A.length;E>M;M++)for(S=A[M],B=U[M],F=0,D=S.length;D>F;F++)R=r(S[F],B[F],N),x?s(R.x,R.y+u[_-1].y,u[_-1].x+L):s(R.x,R.y,f+L)}!function(){if(g){var e;for(e=0*I,F=0;V>F;F++)j=P[F],a(j[2]+e,j[1]+e,j[0]+e);for(e=_+2*v,e*=I,F=0;V>F;F++)j=P[F],a(j[0]+e,j[1]+e,j[2]+e)}else{for(F=0;V>F;F++)j=P[F],a(j[2],j[1],j[0]);for(F=0;V>F;F++)j=P[F],a(j[0]+I*_,j[1]+I*_,j[2]+I*_)}}(),function(){var e=0;for(i(k,e),e+=k.length,M=0,E=A.length;E>M;M++)S=A[M],i(S,e),e+=S.length}()},o.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,r,n){return e=e.vertices,t=e[t],r=e[r],n=e[n],[new o.Vector2(t.x,t.y),new o.Vector2(r.x,r.y),new o.Vector2(n.x,n.y)]},generateSideWallUV:function(e,t,r,n,i){return e=e.vertices,t=e[t],r=e[r],n=e[n],i=e[i],.01>Math.abs(t.y-r.y)?[new o.Vector2(t.x,1-t.z),new o.Vector2(r.x,1-r.z),new o.Vector2(n.x,1-n.z),new o.Vector2(i.x,1-i.z)]:[new o.Vector2(t.y,1-t.z),new o.Vector2(r.y,1-r.z),new o.Vector2(n.y,1-n.z),new o.Vector2(i.y,1-i.z)]}},o.ShapeGeometry=function(e,t){o.Geometry.call(this),this.type="ShapeGeometry",!1===Array.isArray(e)&&(e=[e]),this.addShapeList(e,t),this.computeFaceNormals()},o.ShapeGeometry.prototype=Object.create(o.Geometry.prototype),o.ShapeGeometry.prototype.constructor=o.ShapeGeometry,o.ShapeGeometry.prototype.addShapeList=function(e,t){for(var r=0,n=e.length;n>r;r++)this.addShape(e[r],t);return this},o.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var r,n,i,s=t.material,a=void 0===t.UVGenerator?o.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,u=this.vertices.length;r=e.extractPoints(void 0!==t.curveSegments?t.curveSegments:12);var c=r.shape,h=r.holes;if(!o.ShapeUtils.isClockWise(c))for(c=c.reverse(),r=0,n=h.length;n>r;r++)i=h[r],o.ShapeUtils.isClockWise(i)&&(h[r]=i.reverse());var l=o.ShapeUtils.triangulateShape(c,h);for(r=0,n=h.length;n>r;r++)i=h[r],c=c.concat(i);for(h=c.length,n=l.length,r=0;h>r;r++)i=c[r],this.vertices.push(new o.Vector3(i.x,i.y,0));for(r=0;n>r;r++)h=l[r],c=h[0]+u,i=h[1]+u,h=h[2]+u,this.faces.push(new o.Face3(c,i,h,null,null,s)),this.faceVertexUvs[0].push(a.generateTopUV(this,c,i,h))},o.LatheGeometry=function(e,t,r,n){o.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},t=t||12,r=r||0,n=n||2*Math.PI;for(var i=1/(e.length-1),s=1/t,a=0,u=t;u>=a;a++)for(var c=r+a*s*n,h=Math.cos(c),l=Math.sin(c),c=0,p=e.length;p>c;c++){var f=e[c],d=new o.Vector3;d.x=h*f.x-l*f.y,d.y=l*f.x+h*f.y,d.z=f.z,this.vertices.push(d)}for(r=e.length,a=0,u=t;u>a;a++)for(c=0,p=e.length-1;p>c;c++){t=l=c+r*a,n=l+r;var h=l+1+r,l=l+1,f=a*s,d=c*i,m=f+s,v=d+i;this.faces.push(new o.Face3(t,n,l)),this.faceVertexUvs[0].push([new o.Vector2(f,d),new o.Vector2(m,d),new o.Vector2(f,v)]),this.faces.push(new o.Face3(n,h,l)),this.faceVertexUvs[0].push([new o.Vector2(m,d),new o.Vector2(m,v),new o.Vector2(f,v)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},o.LatheGeometry.prototype=Object.create(o.Geometry.prototype),o.LatheGeometry.prototype.constructor=o.LatheGeometry,o.PlaneGeometry=function(e,t,r,n){o.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new o.PlaneBufferGeometry(e,t,r,n))},o.PlaneGeometry.prototype=Object.create(o.Geometry.prototype),o.PlaneGeometry.prototype.constructor=o.PlaneGeometry,o.PlaneGeometry.prototype.clone=function(){var e=this.parameters;return new o.PlaneGeometry(e.width,e.height,e.widthSegments,e.heightSegments)},o.PlaneBufferGeometry=function(e,t,r,n){o.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};var i=e/2,s=t/2;r=Math.floor(r)||1,n=Math.floor(n)||1;var a=r+1,u=n+1,c=e/r,h=t/n;t=new Float32Array(a*u*3),e=new Float32Array(a*u*3);for(var l=new Float32Array(a*u*2),p=0,f=0,d=0;u>d;d++)for(var m=d*h-s,v=0;a>v;v++)t[p]=v*c-i,t[p+1]=-m,e[p+2]=1,l[f]=v/r,l[f+1]=1-d/n,p+=3,f+=2;for(p=0,i=new(65535<t.length/3?Uint32Array:Uint16Array)(r*n*6),d=0;n>d;d++)for(v=0;r>v;v++)s=v+a*(d+1),u=v+1+a*(d+1),c=v+1+a*d,i[p]=v+a*d,i[p+1]=s,i[p+2]=c,i[p+3]=s,i[p+4]=u,i[p+5]=c,p+=6;this.setIndex(new o.BufferAttribute(i,1)),this.addAttribute("position",new o.BufferAttribute(t,3)),this.addAttribute("normal",new o.BufferAttribute(e,3)),this.addAttribute("uv",new o.BufferAttribute(l,2))},o.PlaneBufferGeometry.prototype=Object.create(o.BufferGeometry.prototype),o.PlaneBufferGeometry.prototype.constructor=o.PlaneBufferGeometry,o.PlaneBufferGeometry.prototype.clone=function(){var e=this.parameters;return new o.PlaneBufferGeometry(e.width,e.height,e.widthSegments,e.heightSegments)},o.RingGeometry=function(e,t,r,n,i,s){o.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:s},e=e||0,t=t||50,i=void 0!==i?i:0,s=void 0!==s?s:2*Math.PI,r=void 0!==r?Math.max(3,r):8,n=void 0!==n?Math.max(1,n):8;var a,u=[],c=e,h=(t-e)/n;for(e=0;n+1>e;e++){for(a=0;r+1>a;a++){var l=new o.Vector3,p=i+a/r*s;l.x=c*Math.cos(p),l.y=c*Math.sin(p),this.vertices.push(l),u.push(new o.Vector2((l.x/t+1)/2,(l.y/t+1)/2))}c+=h}for(t=new o.Vector3(0,0,1),e=0;n>e;e++)for(i=e*(r+1),a=0;r>a;a++)s=p=a+i,h=p+r+1,l=p+r+2,this.faces.push(new o.Face3(s,h,l,[t.clone(),t.clone(),t.clone()])),this.faceVertexUvs[0].push([u[s].clone(),u[h].clone(),u[l].clone()]),
s=p,h=p+r+2,l=p+1,this.faces.push(new o.Face3(s,h,l,[t.clone(),t.clone(),t.clone()])),this.faceVertexUvs[0].push([u[s].clone(),u[h].clone(),u[l].clone()]);this.computeFaceNormals(),this.boundingSphere=new o.Sphere(new o.Vector3,c)},o.RingGeometry.prototype=Object.create(o.Geometry.prototype),o.RingGeometry.prototype.constructor=o.RingGeometry,o.RingGeometry.prototype.clone=function(){var e=this.parameters;return new o.RingGeometry(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)},o.SphereGeometry=function(e,t,r,n,i,s,a){o.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:s,thetaLength:a},this.fromBufferGeometry(new o.SphereBufferGeometry(e,t,r,n,i,s,a))},o.SphereGeometry.prototype=Object.create(o.Geometry.prototype),o.SphereGeometry.prototype.constructor=o.SphereGeometry,o.SphereGeometry.prototype.clone=function(){var e=this.parameters;return new o.SphereGeometry(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)},o.SphereBufferGeometry=function(e,t,r,n,i,s,a){o.BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:s,thetaLength:a},e=e||50,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI,s=void 0!==s?s:0,a=void 0!==a?a:Math.PI;for(var u=s+a,c=(t+1)*(r+1),h=new o.BufferAttribute(new Float32Array(3*c),3),l=new o.BufferAttribute(new Float32Array(3*c),3),c=new o.BufferAttribute(new Float32Array(2*c),2),p=0,f=[],d=new o.Vector3,m=0;r>=m;m++){for(var v=[],g=m/r,y=0;t>=y;y++){var _=y/t,b=-e*Math.cos(n+_*i)*Math.sin(s+g*a),x=e*Math.cos(s+g*a),w=e*Math.sin(n+_*i)*Math.sin(s+g*a);d.set(b,x,w).normalize(),h.setXYZ(p,b,x,w),l.setXYZ(p,d.x,d.y,d.z),c.setXY(p,_,1-g),v.push(p),p++}f.push(v)}for(n=[],m=0;r>m;m++)for(y=0;t>y;y++)i=f[m][y+1],a=f[m][y],p=f[m+1][y],d=f[m+1][y+1],(0!==m||s>0)&&n.push(i,a,d),(m!==r-1||u<Math.PI)&&n.push(a,p,d);this.setIndex(new(65535<h.count?o.Uint32Attribute:o.Uint16Attribute)(n,1)),this.addAttribute("position",h),this.addAttribute("normal",l),this.addAttribute("uv",c),this.boundingSphere=new o.Sphere(new o.Vector3,e)},o.SphereBufferGeometry.prototype=Object.create(o.BufferGeometry.prototype),o.SphereBufferGeometry.prototype.constructor=o.SphereBufferGeometry,o.SphereBufferGeometry.prototype.clone=function(){var e=this.parameters;return new o.SphereBufferGeometry(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)},o.TorusGeometry=function(e,t,r,n,i){o.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},e=e||100,t=t||40,r=r||8,n=n||6,i=i||2*Math.PI;for(var s=new o.Vector3,a=[],u=[],c=0;r>=c;c++)for(var h=0;n>=h;h++){var l=h/n*i,p=c/r*Math.PI*2;s.x=e*Math.cos(l),s.y=e*Math.sin(l);var f=new o.Vector3;f.x=(e+t*Math.cos(p))*Math.cos(l),f.y=(e+t*Math.cos(p))*Math.sin(l),f.z=t*Math.sin(p),this.vertices.push(f),a.push(new o.Vector2(h/n,c/r)),u.push(f.clone().sub(s).normalize())}for(c=1;r>=c;c++)for(h=1;n>=h;h++)e=(n+1)*c+h-1,t=(n+1)*(c-1)+h-1,i=(n+1)*(c-1)+h,s=(n+1)*c+h,l=new o.Face3(e,t,s,[u[e].clone(),u[t].clone(),u[s].clone()]),this.faces.push(l),this.faceVertexUvs[0].push([a[e].clone(),a[t].clone(),a[s].clone()]),l=new o.Face3(t,i,s,[u[t].clone(),u[i].clone(),u[s].clone()]),this.faces.push(l),this.faceVertexUvs[0].push([a[t].clone(),a[i].clone(),a[s].clone()]);this.computeFaceNormals()},o.TorusGeometry.prototype=Object.create(o.Geometry.prototype),o.TorusGeometry.prototype.constructor=o.TorusGeometry,o.TorusGeometry.prototype.clone=function(){var e=this.parameters;return new o.TorusGeometry(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)},o.TorusKnotGeometry=function(e,t,r,n,i,s,a){function u(e,t,r,n,i){var s=Math.cos(e),a=Math.sin(e);return e*=t/r,t=Math.cos(e),s*=n*(2+t)*.5,a=n*(2+t)*a*.5,n=i*n*Math.sin(e)*.5,new o.Vector3(s,a,n)}o.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,p:i,q:s,heightScale:a},e=e||100,t=t||40,r=r||64,n=n||8,i=i||2,s=s||3,a=a||1;for(var c=Array(r),h=new o.Vector3,l=new o.Vector3,p=new o.Vector3,f=0;r>f;++f){c[f]=Array(n);var d=f/r*2*i*Math.PI,m=u(d,s,i,e,a),d=u(d+.01,s,i,e,a);for(h.subVectors(d,m),l.addVectors(d,m),p.crossVectors(h,l),l.crossVectors(p,h),p.normalize(),l.normalize(),d=0;n>d;++d){var v=d/n*2*Math.PI,g=-t*Math.cos(v),v=t*Math.sin(v),y=new o.Vector3;y.x=m.x+g*l.x+v*p.x,y.y=m.y+g*l.y+v*p.y,y.z=m.z+g*l.z+v*p.z,c[f][d]=this.vertices.push(y)-1}}for(f=0;r>f;++f)for(d=0;n>d;++d)i=(f+1)%r,s=(d+1)%n,e=c[f][d],t=c[i][d],i=c[i][s],s=c[f][s],a=new o.Vector2(f/r,d/n),h=new o.Vector2((f+1)/r,d/n),l=new o.Vector2((f+1)/r,(d+1)/n),p=new o.Vector2(f/r,(d+1)/n),this.faces.push(new o.Face3(e,t,s)),this.faceVertexUvs[0].push([a,h,p]),this.faces.push(new o.Face3(t,i,s)),this.faceVertexUvs[0].push([h.clone(),l,p.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},o.TorusKnotGeometry.prototype=Object.create(o.Geometry.prototype),o.TorusKnotGeometry.prototype.constructor=o.TorusKnotGeometry,o.TorusKnotGeometry.prototype.clone=function(){var e=this.parameters;return new o.TorusKnotGeometry(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.p,e.q,e.heightScale)},o.TubeGeometry=function(e,t,r,n,i,s){o.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,segments:t,radius:r,radialSegments:n,closed:i,taper:s},t=t||64,r=r||1,n=n||8,i=i||!1,s=s||o.TubeGeometry.NoTaper;var a,u,c,h,l,p,f,d,m,v,g=[],y=t+1,_=new o.Vector3;for(d=new o.TubeGeometry.FrenetFrames(e,t,i),m=d.normals,v=d.binormals,this.tangents=d.tangents,this.normals=m,this.binormals=v,d=0;y>d;d++)for(g[d]=[],c=d/(y-1),f=e.getPointAt(c),a=m[d],u=v[d],l=r*s(c),c=0;n>c;c++)h=c/n*2*Math.PI,p=-l*Math.cos(h),h=l*Math.sin(h),_.copy(f),_.x+=p*a.x+h*u.x,_.y+=p*a.y+h*u.y,_.z+=p*a.z+h*u.z,g[d][c]=this.vertices.push(new o.Vector3(_.x,_.y,_.z))-1;for(d=0;t>d;d++)for(c=0;n>c;c++)s=i?(d+1)%t:d+1,y=(c+1)%n,e=g[d][c],r=g[s][c],s=g[s][y],y=g[d][y],_=new o.Vector2(d/t,c/n),m=new o.Vector2((d+1)/t,c/n),v=new o.Vector2((d+1)/t,(c+1)/n),a=new o.Vector2(d/t,(c+1)/n),this.faces.push(new o.Face3(e,r,y)),this.faceVertexUvs[0].push([_,m,a]),this.faces.push(new o.Face3(r,s,y)),this.faceVertexUvs[0].push([m.clone(),v,a.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},o.TubeGeometry.prototype=Object.create(o.Geometry.prototype),o.TubeGeometry.prototype.constructor=o.TubeGeometry,o.TubeGeometry.prototype.clone=function(){return new this.constructor(this.parameters.path,this.parameters.segments,this.parameters.radius,this.parameters.radialSegments,this.parameters.closed,this.parameters.taper)},o.TubeGeometry.NoTaper=function(e){return 1},o.TubeGeometry.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)},o.TubeGeometry.FrenetFrames=function(e,t,r){var n=new o.Vector3,i=[],s=[],a=[],u=new o.Vector3,c=new o.Matrix4;t+=1;var h,l,p;for(this.tangents=i,this.normals=s,this.binormals=a,h=0;t>h;h++)l=h/(t-1),i[h]=e.getTangentAt(l),i[h].normalize();for(s[0]=new o.Vector3,a[0]=new o.Vector3,e=Number.MAX_VALUE,h=Math.abs(i[0].x),l=Math.abs(i[0].y),p=Math.abs(i[0].z),e>=h&&(e=h,n.set(1,0,0)),e>=l&&(e=l,n.set(0,1,0)),e>=p&&n.set(0,0,1),u.crossVectors(i[0],n).normalize(),s[0].crossVectors(i[0],u),a[0].crossVectors(i[0],s[0]),h=1;t>h;h++)s[h]=s[h-1].clone(),a[h]=a[h-1].clone(),u.crossVectors(i[h-1],i[h]),u.length()>Number.EPSILON&&(u.normalize(),n=Math.acos(o.Math.clamp(i[h-1].dot(i[h]),-1,1)),s[h].applyMatrix4(c.makeRotationAxis(u,n))),a[h].crossVectors(i[h],s[h]);if(r)for(n=Math.acos(o.Math.clamp(s[0].dot(s[t-1]),-1,1)),n/=t-1,0<i[0].dot(u.crossVectors(s[0],s[t-1]))&&(n=-n),h=1;t>h;h++)s[h].applyMatrix4(c.makeRotationAxis(i[h],n*h)),a[h].crossVectors(i[h],s[h])},o.PolyhedronGeometry=function(e,t,r,n){function i(e){var t=e.normalize().clone();t.index=c.vertices.push(t)-1;var r=Math.atan2(e.z,-e.x)/2/Math.PI+.5;return e=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5,t.uv=new o.Vector2(r,1-e),t}function s(e,t,r,n){n=new o.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()],void 0,n),c.faces.push(n),g.copy(e).add(t).add(r).divideScalar(3),n=Math.atan2(g.z,-g.x),c.faceVertexUvs[0].push([u(e.uv,e,n),u(t.uv,t,n),u(r.uv,r,n)])}function a(e,t){for(var r=Math.pow(2,t),n=i(c.vertices[e.a]),o=i(c.vertices[e.b]),a=i(c.vertices[e.c]),u=[],h=e.materialIndex,l=0;r>=l;l++){u[l]=[];for(var p=i(n.clone().lerp(a,l/r)),f=i(o.clone().lerp(a,l/r)),d=r-l,m=0;d>=m;m++)u[l][m]=0===m&&l===r?p:i(p.clone().lerp(f,m/d))}for(l=0;r>l;l++)for(m=0;2*(r-l)-1>m;m++)n=Math.floor(m/2),0===m%2?s(u[l][n+1],u[l+1][n],u[l][n],h):s(u[l][n+1],u[l+1][n+1],u[l+1][n],h)}function u(e,t,r){return 0>r&&1===e.x&&(e=new o.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new o.Vector2(r/2/Math.PI+.5,e.y)),e.clone()}o.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},r=r||1,n=n||0;for(var c=this,h=0,l=e.length;l>h;h+=3)i(new o.Vector3(e[h],e[h+1],e[h+2]));e=this.vertices;for(var p=[],f=h=0,l=t.length;l>h;h+=3,f++){var d=e[t[h]],m=e[t[h+1]],v=e[t[h+2]];p[f]=new o.Face3(d.index,m.index,v.index,[d.clone(),m.clone(),v.clone()],void 0,f)}for(var g=new o.Vector3,h=0,l=p.length;l>h;h++)a(p[h],n);for(h=0,l=this.faceVertexUvs[0].length;l>h;h++)t=this.faceVertexUvs[0][h],n=t[0].x,e=t[1].x,p=t[2].x,f=Math.max(n,e,p),d=Math.min(n,e,p),f>.9&&.1>d&&(.2>n&&(t[0].x+=1),.2>e&&(t[1].x+=1),.2>p&&(t[2].x+=1));for(h=0,l=this.vertices.length;l>h;h++)this.vertices[h].multiplyScalar(r);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new o.Sphere(new o.Vector3,r)},o.PolyhedronGeometry.prototype=Object.create(o.Geometry.prototype),o.PolyhedronGeometry.prototype.constructor=o.PolyhedronGeometry,o.PolyhedronGeometry.prototype.clone=function(){var e=this.parameters;return new o.PolyhedronGeometry(e.vertices,e.indices,e.radius,e.detail)},o.DodecahedronGeometry=function(e,t){var r=(1+Math.sqrt(5))/2,n=1/r;o.PolyhedronGeometry.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}},o.DodecahedronGeometry.prototype=Object.create(o.PolyhedronGeometry.prototype),o.DodecahedronGeometry.prototype.constructor=o.DodecahedronGeometry,o.DodecahedronGeometry.prototype.clone=function(){var e=this.parameters;return new o.DodecahedronGeometry(e.radius,e.detail)},o.IcosahedronGeometry=function(e,t){var r=(1+Math.sqrt(5))/2;o.PolyhedronGeometry.call(this,[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}},o.IcosahedronGeometry.prototype=Object.create(o.PolyhedronGeometry.prototype),o.IcosahedronGeometry.prototype.constructor=o.IcosahedronGeometry,o.IcosahedronGeometry.prototype.clone=function(){var e=this.parameters;return new o.IcosahedronGeometry(e.radius,e.detail)},o.OctahedronGeometry=function(e,t){o.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},o.OctahedronGeometry.prototype=Object.create(o.PolyhedronGeometry.prototype),o.OctahedronGeometry.prototype.constructor=o.OctahedronGeometry,o.OctahedronGeometry.prototype.clone=function(){var e=this.parameters;return new o.OctahedronGeometry(e.radius,e.detail)},o.TetrahedronGeometry=function(e,t){o.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}},o.TetrahedronGeometry.prototype=Object.create(o.PolyhedronGeometry.prototype),o.TetrahedronGeometry.prototype.constructor=o.TetrahedronGeometry,o.TetrahedronGeometry.prototype.clone=function(){var e=this.parameters;return new o.TetrahedronGeometry(e.radius,e.detail)},o.ParametricGeometry=function(e,t,r){o.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r};var n,i,s,a,u=this.vertices,c=this.faces,h=this.faceVertexUvs[0],l=t+1;for(n=0;r>=n;n++)for(a=n/r,i=0;t>=i;i++)s=i/t,s=e(s,a),u.push(s);var p,f,d,m;for(n=0;r>n;n++)for(i=0;t>i;i++)e=n*l+i,u=n*l+i+1,a=(n+1)*l+i+1,s=(n+1)*l+i,p=new o.Vector2(i/t,n/r),f=new o.Vector2((i+1)/t,n/r),d=new o.Vector2((i+1)/t,(n+1)/r),m=new o.Vector2(i/t,(n+1)/r),c.push(new o.Face3(e,u,s)),h.push([p,f,m]),c.push(new o.Face3(u,a,s)),h.push([f.clone(),d,m.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},o.ParametricGeometry.prototype=Object.create(o.Geometry.prototype),o.ParametricGeometry.prototype.constructor=o.ParametricGeometry,o.WireframeGeometry=function(e){function t(e,t){return e-t}o.BufferGeometry.call(this);var r=[0,0],n={},i=["a","b","c"];if(e instanceof o.Geometry){var s=e.vertices,a=e.faces,u=0,c=new Uint32Array(6*a.length);e=0;for(var h=a.length;h>e;e++)for(var l=a[e],p=0;3>p;p++){r[0]=l[i[p]],r[1]=l[i[(p+1)%3]],r.sort(t);var f=r.toString();void 0===n[f]&&(c[2*u]=r[0],c[2*u+1]=r[1],n[f]=!0,u++)}for(r=new Float32Array(6*u),e=0,h=u;h>e;e++)for(p=0;2>p;p++)n=s[c[2*e+p]],u=6*e+3*p,r[u+0]=n.x,r[u+1]=n.y,r[u+2]=n.z;this.addAttribute("position",new o.BufferAttribute(r,3))}else if(e instanceof o.BufferGeometry){if(null!==e.index){for(h=e.index.array,s=e.attributes.position,i=e.drawcalls,u=0,0===i.length&&e.addGroup(0,h.length),c=new Uint32Array(2*h.length),a=0,l=i.length;l>a;++a){e=i[a],p=e.start,f=e.count,e=p;for(var d=p+f;d>e;e+=3)for(p=0;3>p;p++)r[0]=h[e+p],r[1]=h[e+(p+1)%3],r.sort(t),f=r.toString(),void 0===n[f]&&(c[2*u]=r[0],c[2*u+1]=r[1],n[f]=!0,u++)}for(r=new Float32Array(6*u),e=0,h=u;h>e;e++)for(p=0;2>p;p++)u=6*e+3*p,n=c[2*e+p],r[u+0]=s.getX(n),r[u+1]=s.getY(n),r[u+2]=s.getZ(n)}else for(s=e.attributes.position.array,u=s.length/3,c=u/3,r=new Float32Array(6*u),e=0,h=c;h>e;e++)for(p=0;3>p;p++)u=18*e+6*p,c=9*e+3*p,r[u+0]=s[c],r[u+1]=s[c+1],r[u+2]=s[c+2],n=9*e+(p+1)%3*3,r[u+3]=s[n],r[u+4]=s[n+1],r[u+5]=s[n+2];this.addAttribute("position",new o.BufferAttribute(r,3))}},o.WireframeGeometry.prototype=Object.create(o.BufferGeometry.prototype),o.WireframeGeometry.prototype.constructor=o.WireframeGeometry,o.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),r=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);e=new o.BufferGeometry,e.addAttribute("position",new o.BufferAttribute(t,3)),e.addAttribute("color",new o.BufferAttribute(r,3)),t=new o.LineBasicMaterial({vertexColors:o.VertexColors}),o.LineSegments.call(this,e,t)},o.AxisHelper.prototype=Object.create(o.LineSegments.prototype),o.AxisHelper.prototype.constructor=o.AxisHelper,o.ArrowHelper=function(){var e=new o.Geometry;e.vertices.push(new o.Vector3(0,0,0),new o.Vector3(0,1,0));var t=new o.CylinderGeometry(0,.5,1,5,1);return t.translate(0,-.5,0),function(r,n,i,s,a,u){o.Object3D.call(this),void 0===s&&(s=16776960),void 0===i&&(i=1),void 0===a&&(a=.2*i),void 0===u&&(u=.2*a),this.position.copy(n),i>a&&(this.line=new o.Line(e,new o.LineBasicMaterial({color:s})),this.line.matrixAutoUpdate=!1,this.add(this.line)),this.cone=new o.Mesh(t,new o.MeshBasicMaterial({color:s})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(r),this.setLength(i,a,u)}}(),o.ArrowHelper.prototype=Object.create(o.Object3D.prototype),o.ArrowHelper.prototype.constructor=o.ArrowHelper,o.ArrowHelper.prototype.setDirection=function(){var e,t=new o.Vector3;return function(r){.99999<r.y?this.quaternion.set(0,0,0,1):-.99999>r.y?this.quaternion.set(1,0,0,0):(t.set(r.z,0,-r.x).normalize(),e=Math.acos(r.y),this.quaternion.setFromAxisAngle(t,e))}}(),o.ArrowHelper.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),e>t&&(this.line.scale.set(1,e-t,1),this.line.updateMatrix()),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},o.ArrowHelper.prototype.setColor=function(e){void 0!==this.line&&this.line.material.color.set(e),this.cone.material.color.set(e)},o.BoxHelper=function(e){var t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),n=new o.BufferGeometry;n.setIndex(new o.BufferAttribute(t,1)),n.addAttribute("position",new o.BufferAttribute(r,3)),o.LineSegments.call(this,n,new o.LineBasicMaterial({color:16776960})),void 0!==e&&this.update(e)},o.BoxHelper.prototype=Object.create(o.LineSegments.prototype),o.BoxHelper.prototype.constructor=o.BoxHelper,o.BoxHelper.prototype.update=function(){var e=new o.Box3;return function(t){if(e.setFromObject(t),!e.empty()){t=e.min;var r=e.max,n=this.geometry.attributes.position,i=n.array;i[0]=r.x,i[1]=r.y,i[2]=r.z,i[3]=t.x,i[4]=r.y,i[5]=r.z,i[6]=t.x,i[7]=t.y,i[8]=r.z,i[9]=r.x,i[10]=t.y,i[11]=r.z,i[12]=r.x,i[13]=r.y,i[14]=t.z,i[15]=t.x,i[16]=r.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=r.x,i[22]=t.y,i[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),o.BoundingBoxHelper=function(e,t){var r=void 0!==t?t:8947848;this.object=e,this.box=new o.Box3,o.Mesh.call(this,new o.BoxGeometry(1,1,1),new o.MeshBasicMaterial({color:r,wireframe:!0}))},o.BoundingBoxHelper.prototype=Object.create(o.Mesh.prototype),o.BoundingBoxHelper.prototype.constructor=o.BoundingBoxHelper,o.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},o.CameraHelper=function(e){function t(e,t,n){r(e,n),r(t,n)}function r(e,t){n.vertices.push(new o.Vector3),n.colors.push(new o.Color(t)),void 0===s[e]&&(s[e]=[]),s[e].push(n.vertices.length-1)}var n=new o.Geometry,i=new o.LineBasicMaterial({color:16777215,vertexColors:o.FaceColors}),s={};t("n1","n2",16755200),t("n2","n4",16755200),t("n4","n3",16755200),t("n3","n1",16755200),t("f1","f2",16755200),t("f2","f4",16755200),t("f4","f3",16755200),t("f3","f1",16755200),t("n1","f1",16755200),t("n2","f2",16755200),t("n3","f3",16755200),t("n4","f4",16755200),t("p","n1",16711680),t("p","n2",16711680),t("p","n3",16711680),t("p","n4",16711680),t("u1","u2",43775),t("u2","u3",43775),t("u3","u1",43775),t("c","t",16777215),t("p","c",3355443),t("cn1","cn2",3355443),t("cn3","cn4",3355443),t("cf1","cf2",3355443),t("cf3","cf4",3355443),o.LineSegments.call(this,n,i),this.camera=e,this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()},o.CameraHelper.prototype=Object.create(o.LineSegments.prototype),o.CameraHelper.prototype.constructor=o.CameraHelper,o.CameraHelper.prototype.update=function(){function e(e,o,s,a){if(n.set(o,s,a).unproject(i),e=r[e],void 0!==e)for(o=0,s=e.length;s>o;o++)t.vertices[e[o]].copy(n)}var t,r,n=new o.Vector3,i=new o.Camera;return function(){t=this.geometry,r=this.pointMap,i.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),t.verticesNeedUpdate=!0}}(),o.DirectionalLightHelper=function(e,t){o.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var r=new o.Geometry;r.vertices.push(new o.Vector3(-t,t,0),new o.Vector3(t,t,0),new o.Vector3(t,-t,0),new o.Vector3(-t,-t,0),new o.Vector3(-t,t,0));var n=new o.LineBasicMaterial({fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new o.Line(r,n),this.add(this.lightPlane),r=new o.Geometry,r.vertices.push(new o.Vector3,new o.Vector3),n=new o.LineBasicMaterial({fog:!1}),n.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new o.Line(r,n),this.add(this.targetLine),this.update()},o.DirectionalLightHelper.prototype=Object.create(o.Object3D.prototype),o.DirectionalLightHelper.prototype.constructor=o.DirectionalLightHelper,o.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},o.DirectionalLightHelper.prototype.update=function(){var e=new o.Vector3,t=new o.Vector3,r=new o.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e),this.lightPlane.lookAt(r),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(r),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),o.EdgesHelper=function(e,t,r){t=void 0!==t?t:16777215,o.LineSegments.call(this,new o.EdgesGeometry(e.geometry,r),new o.LineBasicMaterial({color:t})),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},o.EdgesHelper.prototype=Object.create(o.LineSegments.prototype),o.EdgesHelper.prototype.constructor=o.EdgesHelper,o.FaceNormalsHelper=function(e,t,r,n){this.object=e,this.size=void 0!==t?t:1,e=void 0!==r?r:16776960,n=void 0!==n?n:1,t=0,r=this.object.geometry,r instanceof o.Geometry?t=r.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead."),r=new o.BufferGeometry,t=new o.Float32Attribute(6*t,3),r.addAttribute("position",t),o.LineSegments.call(this,r,new o.LineBasicMaterial({color:e,linewidth:n})),this.matrixAutoUpdate=!1,this.update()},o.FaceNormalsHelper.prototype=Object.create(o.LineSegments.prototype),o.FaceNormalsHelper.prototype.constructor=o.FaceNormalsHelper,o.FaceNormalsHelper.prototype.update=function(){var e=new o.Vector3,t=new o.Vector3,r=new o.Matrix3;return function(){this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,i=this.geometry.attributes.position,o=this.object.geometry,s=o.vertices,o=o.faces,a=0,u=0,c=o.length;c>u;u++){var h=o[u],l=h.normal;e.copy(s[h.a]).add(s[h.b]).add(s[h.c]).divideScalar(3).applyMatrix4(n),t.copy(l).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),i.setXYZ(a,e.x,e.y,e.z),a+=1,i.setXYZ(a,t.x,t.y,t.z),a+=1}return i.needsUpdate=!0,this}}(),o.GridHelper=function(e,t){var r=new o.Geometry,n=new o.LineBasicMaterial({vertexColors:o.VertexColors});this.color1=new o.Color(4473924),this.color2=new o.Color(8947848);for(var i=-e;e>=i;i+=t){r.vertices.push(new o.Vector3(-e,0,i),new o.Vector3(e,0,i),new o.Vector3(i,0,-e),new o.Vector3(i,0,e));var s=0===i?this.color1:this.color2;r.colors.push(s,s,s,s)}o.LineSegments.call(this,r,n)},o.GridHelper.prototype=Object.create(o.LineSegments.prototype),o.GridHelper.prototype.constructor=o.GridHelper,o.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},o.HemisphereLightHelper=function(e,t){o.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new o.Color,new o.Color];var r=new o.SphereGeometry(t,4,2);r.rotateX(-Math.PI/2);for(var n=0;8>n;n++)r.faces[n].color=this.colors[4>n?0:1];n=new o.MeshBasicMaterial({vertexColors:o.FaceColors,wireframe:!0}),this.lightSphere=new o.Mesh(r,n),this.add(this.lightSphere),this.update()},o.HemisphereLightHelper.prototype=Object.create(o.Object3D.prototype),o.HemisphereLightHelper.prototype.constructor=o.HemisphereLightHelper,o.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},o.HemisphereLightHelper.prototype.update=function(){var e=new o.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),o.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var r=new o.SphereGeometry(t,4,2),n=new o.MeshBasicMaterial({wireframe:!0,fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity),o.Mesh.call(this,r,n),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},o.PointLightHelper.prototype=Object.create(o.Mesh.prototype),o.PointLightHelper.prototype.constructor=o.PointLightHelper,o.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},o.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},o.SkeletonHelper=function(e){this.bones=this.getBoneList(e);for(var t=new o.Geometry,r=0;r<this.bones.length;r++)this.bones[r].parent instanceof o.Bone&&(t.vertices.push(new o.Vector3),t.vertices.push(new o.Vector3),t.colors.push(new o.Color(0,0,1)),t.colors.push(new o.Color(0,1,0)));t.dynamic=!0,r=new o.LineBasicMaterial({vertexColors:o.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0}),o.LineSegments.call(this,t,r),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},o.SkeletonHelper.prototype=Object.create(o.LineSegments.prototype),o.SkeletonHelper.prototype.constructor=o.SkeletonHelper,o.SkeletonHelper.prototype.getBoneList=function(e){var t=[];e instanceof o.Bone&&t.push(e);for(var r=0;r<e.children.length;r++)t.push.apply(t,this.getBoneList(e.children[r]));return t},o.SkeletonHelper.prototype.update=function(){for(var e=this.geometry,t=(new o.Matrix4).getInverse(this.root.matrixWorld),r=new o.Matrix4,n=0,i=0;i<this.bones.length;i++){var s=this.bones[i];s.parent instanceof o.Bone&&(r.multiplyMatrices(t,s.matrixWorld),e.vertices[n].setFromMatrixPosition(r),r.multiplyMatrices(t,s.parent.matrixWorld),e.vertices[n+1].setFromMatrixPosition(r),n+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},o.SpotLightHelper=function(e){o.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,e=new o.CylinderGeometry(0,1,1,8,1,!0),e.translate(0,-.5,0),e.rotateX(-Math.PI/2);var t=new o.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new o.Mesh(e,t),this.add(this.cone),this.update()},o.SpotLightHelper.prototype=Object.create(o.Object3D.prototype),o.SpotLightHelper.prototype.constructor=o.SpotLightHelper,o.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},o.SpotLightHelper.prototype.update=function(){var e=new o.Vector3,t=new o.Vector3;return function(){var r=this.light.distance?this.light.distance:1e4,n=r*Math.tan(this.light.angle);this.cone.scale.set(n,n,r),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),o.VertexNormalsHelper=function(e,t,r,n){this.object=e,this.size=void 0!==t?t:1,e=void 0!==r?r:16711680,n=void 0!==n?n:1,t=0,r=this.object.geometry,r instanceof o.Geometry?t=3*r.faces.length:r instanceof o.BufferGeometry&&(t=r.attributes.normal.count),r=new o.BufferGeometry,t=new o.Float32Attribute(6*t,3),r.addAttribute("position",t),o.LineSegments.call(this,r,new o.LineBasicMaterial({color:e,linewidth:n})),this.matrixAutoUpdate=!1,this.update()},o.VertexNormalsHelper.prototype=Object.create(o.LineSegments.prototype),o.VertexNormalsHelper.prototype.constructor=o.VertexNormalsHelper,o.VertexNormalsHelper.prototype.update=function(){var e=new o.Vector3,t=new o.Vector3,r=new o.Matrix3;return function(){var n=["a","b","c"];this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);var i=this.object.matrixWorld,s=this.geometry.attributes.position,a=this.object.geometry;if(a instanceof o.Geometry)for(var u=a.vertices,c=a.faces,h=a=0,l=c.length;l>h;h++)for(var p=c[h],f=0,d=p.vertexNormals.length;d>f;f++){var m=p.vertexNormals[f];e.copy(u[p[n[f]]]).applyMatrix4(i),t.copy(m).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),s.setXYZ(a,e.x,e.y,e.z),a+=1,s.setXYZ(a,t.x,t.y,t.z),a+=1}else if(a instanceof o.BufferGeometry)for(n=a.attributes.position,u=a.attributes.normal,f=a=0,d=n.count;d>f;f++)e.set(n.getX(f),n.getY(f),n.getZ(f)).applyMatrix4(i),t.set(u.getX(f),u.getY(f),u.getZ(f)),t.applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),s.setXYZ(a,e.x,e.y,e.z),a+=1,s.setXYZ(a,t.x,t.y,t.z),a+=1;return s.needsUpdate=!0,this}}(),o.WireframeHelper=function(e,t){var r=void 0!==t?t:16777215;o.LineSegments.call(this,new o.WireframeGeometry(e.geometry),new o.LineBasicMaterial({color:r})),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},o.WireframeHelper.prototype=Object.create(o.LineSegments.prototype),o.WireframeHelper.prototype.constructor=o.WireframeHelper,o.ImmediateRenderObject=function(e){o.Object3D.call(this),this.material=e,this.render=function(e){}},o.ImmediateRenderObject.prototype=Object.create(o.Object3D.prototype),o.ImmediateRenderObject.prototype.constructor=o.ImmediateRenderObject,o.MorphBlendMesh=function(e,t){o.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length;this.createAnimation("__default",0,r-1,r/1),this.setAnimationWeight("__default",1)},o.MorphBlendMesh.prototype=Object.create(o.Mesh.prototype),o.MorphBlendMesh.prototype.constructor=o.MorphBlendMesh,o.MorphBlendMesh.prototype.createAnimation=function(e,t,r,n){t={start:t,end:r,length:r-t+1,fps:n,duration:(r-t)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1},this.animationsMap[e]=t,this.animationsList.push(t)},o.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,r=/([a-z]+)_?(\d+)/,n={},i=this.geometry,o=0,s=i.morphTargets.length;s>o;o++){var a=i.morphTargets[o].name.match(r);if(a&&1<a.length){var u=a[1];n[u]||(n[u]={start:1/0,end:-(1/0)}),a=n[u],o<a.start&&(a.start=o),o>a.end&&(a.end=o),t||(t=u)}}for(u in n)a=n[u],this.createAnimation(u,a.start,a.end,e);this.firstAnimation=t},o.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){(e=this.animationsMap[e])&&(e.direction=1,e.directionBackwards=!1)},o.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){(e=this.animationsMap[e])&&(e.direction=-1,e.directionBackwards=!0)},o.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var r=this.animationsMap[e];r&&(r.fps=t,r.duration=(r.end-r.start)/r.fps)},o.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var r=this.animationsMap[e];r&&(r.duration=t,r.fps=(r.end-r.start)/r.duration)},o.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var r=this.animationsMap[e];r&&(r.weight=t)},o.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var r=this.animationsMap[e];r&&(r.time=t)},o.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;return(e=this.animationsMap[e])&&(t=e.time),t},o.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;return(e=this.animationsMap[e])&&(t=e.duration),t},o.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},o.MorphBlendMesh.prototype.stopAnimation=function(e){(e=this.animationsMap[e])&&(e.active=!1)},o.MorphBlendMesh.prototype.update=function(e){for(var t=0,r=this.animationsList.length;r>t;t++){var n=this.animationsList[t];if(n.active){var i=n.duration/n.length;
n.time+=n.direction*e,n.mirroredLoop?(n.time>n.duration||0>n.time)&&(n.direction*=-1,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),0>n.time&&(n.time=0,n.directionBackwards=!1)):(n.time%=n.duration,0>n.time&&(n.time+=n.duration));var s=n.start+o.Math.clamp(Math.floor(n.time/i),0,n.length-1),a=n.weight;s!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*a,this.morphTargetInfluences[s]=0,n.lastFrame=n.currentFrame,n.currentFrame=s),i=n.time%i/i,n.directionBackwards&&(i=1-i),n.currentFrame!==n.lastFrame?(this.morphTargetInfluences[n.currentFrame]=i*a,this.morphTargetInfluences[n.lastFrame]=(1-i)*a):this.morphTargetInfluences[n.currentFrame]=a}}},"undefined"!=typeof n?("undefined"!=typeof r&&r.exports&&(n=r.exports=o),n.THREE=o):this.THREE=o},{}],197:[function(t,r,n){(function(){function t(e){function t(t,r,n,i,o,s){for(;o>=0&&s>o;o+=e){var a=i?i[o]:o;n=r(n,t[a],a,t)}return n}return function(r,n,i,o){n=w(n,o,4);var s=!P(r)&&x.keys(r),a=(s||r).length,u=e>0?0:a-1;return arguments.length<3&&(i=r[s?s[u]:u],u+=e),t(r,n,i,s,u,a)}}function i(e){return function(t,r,n){r=S(r,n);for(var i=A(t),o=e>0?0:i-1;o>=0&&i>o;o+=e)if(r(t[o],o,t))return o;return-1}}function o(e,t,r){return function(n,i,o){var s=0,a=A(n);if("number"==typeof o)e>0?s=o>=0?o:Math.max(o+a,s):a=o>=0?Math.min(o+1,a):o+a+1;else if(r&&o&&a)return o=r(n,i),n[o]===i?o:-1;if(i!==i)return o=t(f.call(n,s,a),x.isNaN),o>=0?o+s:-1;for(o=e>0?s:a-1;o>=0&&a>o;o+=e)if(n[o]===i)return o;return-1}}function s(e,t){var r=L.length,n=e.constructor,i=x.isFunction(n)&&n.prototype||h,o="constructor";for(x.has(e,o)&&!x.contains(t,o)&&t.push(o);r--;)o=L[r],o in e&&e[o]!==i[o]&&!x.contains(t,o)&&t.push(o)}var a=this,u=a._,c=Array.prototype,h=Object.prototype,l=Function.prototype,p=c.push,f=c.slice,d=h.toString,m=h.hasOwnProperty,v=Array.isArray,g=Object.keys,y=l.bind,_=Object.create,b=function(){},x=function(e){return e instanceof x?e:this instanceof x?void(this._wrapped=e):new x(e)};"undefined"!=typeof n?("undefined"!=typeof r&&r.exports&&(n=r.exports=x),n._=x):a._=x,x.VERSION="1.8.3";var w=function(e,t,r){if(void 0===t)return e;switch(null==r?3:r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)};case 4:return function(r,n,i,o){return e.call(t,r,n,i,o)}}return function(){return e.apply(t,arguments)}},S=function(e,t,r){return null==e?x.identity:x.isFunction(e)?w(e,t,r):x.isObject(e)?x.matcher(e):x.property(e)};x.iteratee=function(e,t){return S(e,t,1/0)};var M=function(e,t){return function(r){var n=arguments.length;if(2>n||null==r)return r;for(var i=1;n>i;i++)for(var o=arguments[i],s=e(o),a=s.length,u=0;a>u;u++){var c=s[u];t&&void 0!==r[c]||(r[c]=o[c])}return r}},E=function(e){if(!x.isObject(e))return{};if(_)return _(e);b.prototype=e;var t=new b;return b.prototype=null,t},C=function(e){return function(t){return null==t?void 0:t[e]}},T=Math.pow(2,53)-1,A=C("length"),P=function(e){var t=A(e);return"number"==typeof t&&t>=0&&T>=t};x.each=x.forEach=function(e,t,r){t=w(t,r);var n,i;if(P(e))for(n=0,i=e.length;i>n;n++)t(e[n],n,e);else{var o=x.keys(e);for(n=0,i=o.length;i>n;n++)t(e[o[n]],o[n],e)}return e},x.map=x.collect=function(e,t,r){t=S(t,r);for(var n=!P(e)&&x.keys(e),i=(n||e).length,o=Array(i),s=0;i>s;s++){var a=n?n[s]:s;o[s]=t(e[a],a,e)}return o},x.reduce=x.foldl=x.inject=t(1),x.reduceRight=x.foldr=t(-1),x.find=x.detect=function(e,t,r){var n;return n=P(e)?x.findIndex(e,t,r):x.findKey(e,t,r),void 0!==n&&-1!==n?e[n]:void 0},x.filter=x.select=function(e,t,r){var n=[];return t=S(t,r),x.each(e,function(e,r,i){t(e,r,i)&&n.push(e)}),n},x.reject=function(e,t,r){return x.filter(e,x.negate(S(t)),r)},x.every=x.all=function(e,t,r){t=S(t,r);for(var n=!P(e)&&x.keys(e),i=(n||e).length,o=0;i>o;o++){var s=n?n[o]:o;if(!t(e[s],s,e))return!1}return!0},x.some=x.any=function(e,t,r){t=S(t,r);for(var n=!P(e)&&x.keys(e),i=(n||e).length,o=0;i>o;o++){var s=n?n[o]:o;if(t(e[s],s,e))return!0}return!1},x.contains=x.includes=x.include=function(e,t,r,n){return P(e)||(e=x.values(e)),("number"!=typeof r||n)&&(r=0),x.indexOf(e,t,r)>=0},x.invoke=function(e,t){var r=f.call(arguments,2),n=x.isFunction(t);return x.map(e,function(e){var i=n?t:e[t];return null==i?i:i.apply(e,r)})},x.pluck=function(e,t){return x.map(e,x.property(t))},x.where=function(e,t){return x.filter(e,x.matcher(t))},x.findWhere=function(e,t){return x.find(e,x.matcher(t))},x.max=function(e,t,r){var n,i,o=-(1/0),s=-(1/0);if(null==t&&null!=e){e=P(e)?e:x.values(e);for(var a=0,u=e.length;u>a;a++)n=e[a],n>o&&(o=n)}else t=S(t,r),x.each(e,function(e,r,n){i=t(e,r,n),(i>s||i===-(1/0)&&o===-(1/0))&&(o=e,s=i)});return o},x.min=function(e,t,r){var n,i,o=1/0,s=1/0;if(null==t&&null!=e){e=P(e)?e:x.values(e);for(var a=0,u=e.length;u>a;a++)n=e[a],o>n&&(o=n)}else t=S(t,r),x.each(e,function(e,r,n){i=t(e,r,n),(s>i||i===1/0&&o===1/0)&&(o=e,s=i)});return o},x.shuffle=function(e){for(var t,r=P(e)?e:x.values(e),n=r.length,i=Array(n),o=0;n>o;o++)t=x.random(0,o),t!==o&&(i[o]=i[t]),i[t]=r[o];return i},x.sample=function(e,t,r){return null==t||r?(P(e)||(e=x.values(e)),e[x.random(e.length-1)]):x.shuffle(e).slice(0,Math.max(0,t))},x.sortBy=function(e,t,r){return t=S(t,r),x.pluck(x.map(e,function(e,r,n){return{value:e,index:r,criteria:t(e,r,n)}}).sort(function(e,t){var r=e.criteria,n=t.criteria;if(r!==n){if(r>n||void 0===r)return 1;if(n>r||void 0===n)return-1}return e.index-t.index}),"value")};var k=function(e){return function(t,r,n){var i={};return r=S(r,n),x.each(t,function(n,o){var s=r(n,o,t);e(i,n,s)}),i}};x.groupBy=k(function(e,t,r){x.has(e,r)?e[r].push(t):e[r]=[t]}),x.indexBy=k(function(e,t,r){e[r]=t}),x.countBy=k(function(e,t,r){x.has(e,r)?e[r]++:e[r]=1}),x.toArray=function(e){return e?x.isArray(e)?f.call(e):P(e)?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return null==e?0:P(e)?e.length:x.keys(e).length},x.partition=function(e,t,r){t=S(t,r);var n=[],i=[];return x.each(e,function(e,r,o){(t(e,r,o)?n:i).push(e)}),[n,i]},x.first=x.head=x.take=function(e,t,r){return null!=e?null==t||r?e[0]:x.initial(e,e.length-t):void 0},x.initial=function(e,t,r){return f.call(e,0,Math.max(0,e.length-(null==t||r?1:t)))},x.last=function(e,t,r){return null!=e?null==t||r?e[e.length-1]:x.rest(e,Math.max(0,e.length-t)):void 0},x.rest=x.tail=x.drop=function(e,t,r){return f.call(e,null==t||r?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var O=function(e,t,r,n){for(var i=[],o=0,s=n||0,a=A(e);a>s;s++){var u=e[s];if(P(u)&&(x.isArray(u)||x.isArguments(u))){t||(u=O(u,t,r));var c=0,h=u.length;for(i.length+=h;h>c;)i[o++]=u[c++]}else r||(i[o++]=u)}return i};x.flatten=function(e,t){return O(e,t,!1)},x.without=function(e){return x.difference(e,f.call(arguments,1))},x.uniq=x.unique=function(e,t,r,n){x.isBoolean(t)||(n=r,r=t,t=!1),null!=r&&(r=S(r,n));for(var i=[],o=[],s=0,a=A(e);a>s;s++){var u=e[s],c=r?r(u,s,e):u;t?(s&&o===c||i.push(u),o=c):r?x.contains(o,c)||(o.push(c),i.push(u)):x.contains(i,u)||i.push(u)}return i},x.union=function(){return x.uniq(O(arguments,!0,!0))},x.intersection=function(e){for(var t=[],r=arguments.length,n=0,i=A(e);i>n;n++){var o=e[n];if(!x.contains(t,o)){for(var s=1;r>s&&x.contains(arguments[s],o);s++);s===r&&t.push(o)}}return t},x.difference=function(e){var t=O(arguments,!0,!0,1);return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){return x.unzip(arguments)},x.unzip=function(e){for(var t=e&&x.max(e,A).length||0,r=Array(t),n=0;t>n;n++)r[n]=x.pluck(e,n);return r},x.object=function(e,t){for(var r={},n=0,i=A(e);i>n;n++)t?r[e[n]]=t[n]:r[e[n][0]]=e[n][1];return r},x.findIndex=i(1),x.findLastIndex=i(-1),x.sortedIndex=function(e,t,r,n){r=S(r,n,1);for(var i=r(t),o=0,s=A(e);s>o;){var a=Math.floor((o+s)/2);r(e[a])<i?o=a+1:s=a}return o},x.indexOf=o(1,x.findIndex,x.sortedIndex),x.lastIndexOf=o(-1,x.findLastIndex),x.range=function(e,t,r){null==t&&(t=e||0,e=0),r=r||1;for(var n=Math.max(Math.ceil((t-e)/r),0),i=Array(n),o=0;n>o;o++,e+=r)i[o]=e;return i};var N=function(e,t,r,n,i){if(!(n instanceof t))return e.apply(r,i);var o=E(e.prototype),s=e.apply(o,i);return x.isObject(s)?s:o};x.bind=function(e,t){if(y&&e.bind===y)return y.apply(e,f.call(arguments,1));if(!x.isFunction(e))throw new TypeError("Bind must be called on a function");var r=f.call(arguments,2),n=function(){return N(e,n,t,this,r.concat(f.call(arguments)))};return n},x.partial=function(e){var t=f.call(arguments,1),r=function(){for(var n=0,i=t.length,o=Array(i),s=0;i>s;s++)o[s]=t[s]===x?arguments[n++]:t[s];for(;n<arguments.length;)o.push(arguments[n++]);return N(e,r,this,this,o)};return r},x.bindAll=function(e){var t,r,n=arguments.length;if(1>=n)throw new Error("bindAll must be passed function names");for(t=1;n>t;t++)r=arguments[t],e[r]=x.bind(e[r],e);return e},x.memoize=function(e,t){var r=function(n){var i=r.cache,o=""+(t?t.apply(this,arguments):n);return x.has(i,o)||(i[o]=e.apply(this,arguments)),i[o]};return r.cache={},r},x.delay=function(e,t){var r=f.call(arguments,2);return setTimeout(function(){return e.apply(null,r)},t)},x.defer=x.partial(x.delay,x,1),x.throttle=function(e,t,r){var n,i,o,s=null,a=0;r||(r={});var u=function(){a=r.leading===!1?0:x.now(),s=null,o=e.apply(n,i),s||(n=i=null)};return function(){var c=x.now();a||r.leading!==!1||(a=c);var h=t-(c-a);return n=this,i=arguments,0>=h||h>t?(s&&(clearTimeout(s),s=null),a=c,o=e.apply(n,i),s||(n=i=null)):s||r.trailing===!1||(s=setTimeout(u,h)),o}},x.debounce=function(e,t,r){var n,i,o,s,a,u=function(){var c=x.now()-s;t>c&&c>=0?n=setTimeout(u,t-c):(n=null,r||(a=e.apply(o,i),n||(o=i=null)))};return function(){o=this,i=arguments,s=x.now();var c=r&&!n;return n||(n=setTimeout(u,t)),c&&(a=e.apply(o,i),o=i=null),a}},x.wrap=function(e,t){return x.partial(t,e)},x.negate=function(e){return function(){return!e.apply(this,arguments)}},x.compose=function(){var e=arguments,t=e.length-1;return function(){for(var r=t,n=e[t].apply(this,arguments);r--;)n=e[r].call(this,n);return n}},x.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},x.before=function(e,t){var r;return function(){return--e>0&&(r=t.apply(this,arguments)),1>=e&&(t=null),r}},x.once=x.partial(x.before,2);var D=!{toString:null}.propertyIsEnumerable("toString"),L=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];x.keys=function(e){if(!x.isObject(e))return[];if(g)return g(e);var t=[];for(var r in e)x.has(e,r)&&t.push(r);return D&&s(e,t),t},x.allKeys=function(e){if(!x.isObject(e))return[];var t=[];for(var r in e)t.push(r);return D&&s(e,t),t},x.values=function(e){for(var t=x.keys(e),r=t.length,n=Array(r),i=0;r>i;i++)n[i]=e[t[i]];return n},x.mapObject=function(e,t,r){t=S(t,r);for(var n,i=x.keys(e),o=i.length,s={},a=0;o>a;a++)n=i[a],s[n]=t(e[n],n,e);return s},x.pairs=function(e){for(var t=x.keys(e),r=t.length,n=Array(r),i=0;r>i;i++)n[i]=[t[i],e[t[i]]];return n},x.invert=function(e){for(var t={},r=x.keys(e),n=0,i=r.length;i>n;n++)t[e[r[n]]]=r[n];return t},x.functions=x.methods=function(e){var t=[];for(var r in e)x.isFunction(e[r])&&t.push(r);return t.sort()},x.extend=M(x.allKeys),x.extendOwn=x.assign=M(x.keys),x.findKey=function(e,t,r){t=S(t,r);for(var n,i=x.keys(e),o=0,s=i.length;s>o;o++)if(n=i[o],t(e[n],n,e))return n},x.pick=function(e,t,r){var n,i,o={},s=e;if(null==s)return o;x.isFunction(t)?(i=x.allKeys(s),n=w(t,r)):(i=O(arguments,!1,!1,1),n=function(e,t,r){return t in r},s=Object(s));for(var a=0,u=i.length;u>a;a++){var c=i[a],h=s[c];n(h,c,s)&&(o[c]=h)}return o},x.omit=function(e,t,r){if(x.isFunction(t))t=x.negate(t);else{var n=x.map(O(arguments,!1,!1,1),String);t=function(e,t){return!x.contains(n,t)}}return x.pick(e,t,r)},x.defaults=M(x.allKeys,!0),x.create=function(e,t){var r=E(e);return t&&x.extendOwn(r,t),r},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e},x.isMatch=function(e,t){var r=x.keys(t),n=r.length;if(null==e)return!n;for(var i=Object(e),o=0;n>o;o++){var s=r[o];if(t[s]!==i[s]||!(s in i))return!1}return!0};var R=function(e,t,r,n){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=d.call(e);if(i!==d.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var o="[object Array]"===i;if(!o){if("object"!=typeof e||"object"!=typeof t)return!1;var s=e.constructor,a=t.constructor;if(s!==a&&!(x.isFunction(s)&&s instanceof s&&x.isFunction(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1}r=r||[],n=n||[];for(var u=r.length;u--;)if(r[u]===e)return n[u]===t;if(r.push(e),n.push(t),o){if(u=e.length,u!==t.length)return!1;for(;u--;)if(!R(e[u],t[u],r,n))return!1}else{var c,h=x.keys(e);if(u=h.length,x.keys(t).length!==u)return!1;for(;u--;)if(c=h[u],!x.has(t,c)||!R(e[c],t[c],r,n))return!1}return r.pop(),n.pop(),!0};x.isEqual=function(e,t){return R(e,t)},x.isEmpty=function(e){return null==e?!0:P(e)&&(x.isArray(e)||x.isString(e)||x.isArguments(e))?0===e.length:0===x.keys(e).length},x.isElement=function(e){return!(!e||1!==e.nodeType)},x.isArray=v||function(e){return"[object Array]"===d.call(e)},x.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},x.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){x["is"+e]=function(t){return d.call(t)==="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return x.has(e,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(x.isFunction=function(e){return"function"==typeof e||!1}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!==+e},x.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===d.call(e)},x.isNull=function(e){return null===e},x.isUndefined=function(e){return void 0===e},x.has=function(e,t){return null!=e&&m.call(e,t)},x.noConflict=function(){return a._=u,this},x.identity=function(e){return e},x.constant=function(e){return function(){return e}},x.noop=function(){},x.property=C,x.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},x.matcher=x.matches=function(e){return e=x.extendOwn({},e),function(t){return x.isMatch(t,e)}},x.times=function(e,t,r){var n=Array(Math.max(0,e));t=w(t,r,1);for(var i=0;e>i;i++)n[i]=t(i);return n},x.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},x.now=Date.now||function(){return(new Date).getTime()};var j={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},I=x.invert(j),V=function(e){var t=function(t){return e[t]},r="(?:"+x.keys(e).join("|")+")",n=RegExp(r),i=RegExp(r,"g");return function(e){return e=null==e?"":""+e,n.test(e)?e.replace(i,t):e}};x.escape=V(j),x.unescape=V(I),x.result=function(e,t,r){var n=null==e?void 0:e[t];return void 0===n&&(n=r),x.isFunction(n)?n.call(e):n};var F=0;x.uniqueId=function(e){var t=++F+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var B=/(.)^/,U={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},G=/\\|'|\r|\n|\u2028|\u2029/g,z=function(e){return"\\"+U[e]};x.template=function(e,t,r){!t&&r&&(t=r),t=x.defaults({},t,x.templateSettings);var n=RegExp([(t.escape||B).source,(t.interpolate||B).source,(t.evaluate||B).source].join("|")+"|$","g"),i=0,o="__p+='";e.replace(n,function(t,r,n,s,a){return o+=e.slice(i,a).replace(G,z),i=a+t.length,r?o+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'":n?o+="'+\n((__t=("+n+"))==null?'':__t)+\n'":s&&(o+="';\n"+s+"\n__p+='"),t}),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var s=new Function(t.variable||"obj","_",o)}catch(a){throw a.source=o,a}var u=function(e){return s.call(this,e,x)},c=t.variable||"obj";return u.source="function("+c+"){\n"+o+"}",u},x.chain=function(e){var t=x(e);return t._chain=!0,t};var H=function(e,t){return e._chain?x(t).chain():t};x.mixin=function(e){x.each(x.functions(e),function(t){var r=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return p.apply(e,arguments),H(this,r.apply(x,e))}})},x.mixin(x),x.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=c[e];x.prototype[e]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!==e&&"splice"!==e||0!==r.length||delete r[0],H(this,r)}}),x.each(["concat","join","slice"],function(e){var t=c[e];x.prototype[e]=function(){return H(this,t.apply(this._wrapped,arguments))}}),x.prototype.value=function(){return this._wrapped},x.prototype.valueOf=x.prototype.toJSON=x.prototype.value,x.prototype.toString=function(){return""+this._wrapped},"function"==typeof e&&e.amd&&e("underscore",[],function(){return x})}).call(this)},{}],198:[function(e,t,r){function n(e,t,r,n){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=r,this.p2y=n}t.exports=n,n.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},n.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},n.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},n.prototype.solveCurveX=function(e,t){"undefined"==typeof t&&(t=1e-6);var r,n,i,o,s;for(i=e,s=0;8>s;s++){if(o=this.sampleCurveX(i)-e,Math.abs(o)<t)return i;var a=this.sampleCurveDerivativeX(i);if(Math.abs(a)<1e-6)break;i-=o/a}if(r=0,n=1,i=e,r>i)return r;if(i>n)return n;for(;n>r;){if(o=this.sampleCurveX(i),Math.abs(o-e)<t)return i;e>o?r=i:n=i,i=.5*(n-r)+r}return i},n.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},{}],199:[function(e,t,r){var n=e("./vdom/create-element.js");t.exports=n},{"./vdom/create-element.js":212}],200:[function(e,t,r){var n=e("./vtree/diff.js");t.exports=n},{"./vtree/diff.js":232}],201:[function(e,t,r){var n=e("./virtual-hyperscript/index.js");t.exports=n},{"./virtual-hyperscript/index.js":219}],202:[function(e,t,r){var n=e("./diff.js"),i=e("./patch.js"),o=e("./h.js"),s=e("./create-element.js"),a=e("./vnode/vnode.js"),u=e("./vnode/vtext.js");t.exports={diff:n,patch:i,h:o,create:s,VNode:a,VText:u}},{"./create-element.js":199,"./diff.js":200,"./h.js":201,"./patch.js":210,"./vnode/vnode.js":228,"./vnode/vtext.js":230}],203:[function(e,t,r){t.exports=function(e){var t,r=String.prototype.split,n=/()??/.exec("")[1]===e;return t=function(t,i,o){if("[object RegExp]"!==Object.prototype.toString.call(i))return r.call(t,i,o);var s,a,u,c,h=[],l=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.extended?"x":"")+(i.sticky?"y":""),p=0,i=new RegExp(i.source,l+"g");for(t+="",n||(s=new RegExp("^"+i.source+"$(?!\\s)",l)),o=o===e?-1>>>0:o>>>0;(a=i.exec(t))&&(u=a.index+a[0].length,!(u>p&&(h.push(t.slice(p,a.index)),!n&&a.length>1&&a[0].replace(s,function(){for(var t=1;t<arguments.length-2;t++)arguments[t]===e&&(a[t]=e)}),a.length>1&&a.index<t.length&&Array.prototype.push.apply(h,a.slice(1)),c=a[0].length,p=u,h.length>=o)));)i.lastIndex===a.index&&i.lastIndex++;return p===t.length?(c||!i.test(""))&&h.push(""):h.push(t.slice(p)),h.length>o?h.slice(0,o):h}}()},{}],204:[function(e,t,r){"use strict";function n(e){var t=e[s];return t||(t=e[s]={}),t}var i=e("individual/one-version"),o="7";i("ev-store",o);var s="__EV_STORE_KEY@"+o;t.exports=n},{"individual/one-version":206}],205:[function(e,t,r){(function(e){"use strict";function r(e,t){return e in n?n[e]:(n[e]=t,t)}var n="undefined"!=typeof window?window:"undefined"!=typeof e?e:{};t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],206:[function(e,t,r){"use strict";function n(e,t,r){var n="__INDIVIDUAL_ONE_VERSION_"+e,o=n+"_ENFORCE_SINGLETON",s=i(o,t);if(s!==t)throw new Error("Can only have one copy of "+e+".\nYou already have version "+s+" installed.\nThis means you cannot install version "+t);return i(n,r)}var i=e("./index.js");t.exports=n},{"./index.js":205}],207:[function(e,t,r){(function(r){var n="undefined"!=typeof r?r:"undefined"!=typeof window?window:{},i=e("min-document");if("undefined"!=typeof document)t.exports=document;else{var o=n["__GLOBAL_DOCUMENT_CACHE@4"];o||(o=n["__GLOBAL_DOCUMENT_CACHE@4"]=i),t.exports=o}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"min-document":1}],208:[function(e,t,r){"use strict";t.exports=function(e){return"object"==typeof e&&null!==e}},{}],209:[function(e,t,r){function n(e){return"[object Array]"===o.call(e)}var i=Array.isArray,o=Object.prototype.toString;t.exports=i||n},{}],210:[function(e,t,r){var n=e("./vdom/patch.js");t.exports=n},{"./vdom/patch.js":215}],211:[function(e,t,r){function n(e,t,r){for(var n in t){var s=t[n];void 0===s?i(e,n,s,r):u(s)?(i(e,n,s,r),s.hook&&s.hook(e,n,r?r[n]:void 0)):a(s)?o(e,t,r,n,s):e[n]=s}}function i(e,t,r,n){if(n){var i=n[t];if(u(i))i.unhook&&i.unhook(e,t,r);else if("attributes"===t)for(var o in i)e.removeAttribute(o);else if("style"===t)for(var s in i)e.style[s]="";else"string"==typeof i?e[t]="":e[t]=null}}function o(e,t,r,n,i){var o=r?r[n]:void 0;if("attributes"!==n){if(o&&a(o)&&s(o)!==s(i))return void(e[n]=i);a(e[n])||(e[n]={});var u="style"===n?"":void 0;for(var c in i){var h=i[c];e[n][c]=void 0===h?u:h}}else for(var l in i){var p=i[l];void 0===p?e.removeAttribute(l):e.setAttribute(l,p)}}function s(e){return Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__?e.__proto__:e.constructor?e.constructor.prototype:void 0}var a=e("is-object"),u=e("../vnode/is-vhook.js");t.exports=n},{"../vnode/is-vhook.js":223,"is-object":208}],212:[function(e,t,r){function n(e,t){var r=t?t.document||i:i,h=t?t.warn:null;if(e=c(e).a,u(e))return e.init();if(a(e))return r.createTextNode(e.text);if(!s(e))return h&&h("Item is not a valid virtual dom node",e),null;var l=null===e.namespace?r.createElement(e.tagName):r.createElementNS(e.namespace,e.tagName),p=e.properties;o(l,p);for(var f=e.children,d=0;d<f.length;d++){var m=n(f[d],t);m&&l.appendChild(m)}return l}var i=e("global/document"),o=e("./apply-properties"),s=e("../vnode/is-vnode.js"),a=e("../vnode/is-vtext.js"),u=e("../vnode/is-widget.js"),c=e("../vnode/handle-thunk.js");t.exports=n},{"../vnode/handle-thunk.js":221,"../vnode/is-vnode.js":224,"../vnode/is-vtext.js":225,"../vnode/is-widget.js":226,"./apply-properties":211,"global/document":207}],213:[function(e,t,r){function n(e,t,r,n){return r&&0!==r.length?(r.sort(s),i(e,t,r,n,0)):{}}function i(e,t,r,n,s){if(n=n||{},e){o(r,s,s)&&(n[s]=e);var u=t.children;if(u)for(var c=e.childNodes,h=0;h<t.children.length;h++){s+=1;var l=u[h]||a,p=s+(l.count||0);o(r,s,p)&&i(c[h],l,r,n,s),s=p}}return n}function o(e,t,r){if(0===e.length)return!1;for(var n,i,o=0,s=e.length-1;s>=o;){if(n=(s+o)/2>>0,i=e[n],o===s)return i>=t&&r>=i;if(t>i)o=n+1;else{if(!(i>r))return!0;s=n-1}}return!1}function s(e,t){return e>t?1:-1}var a={};t.exports=n},{}],214:[function(e,t,r){function n(e,t,r){var n=e.type,c=e.vNode,f=e.patch;switch(n){case d.REMOVE:return i(t,c);case d.INSERT:return o(t,f,r);case d.VTEXT:return s(t,c,f,r);case d.WIDGET:return a(t,c,f,r);case d.VNODE:return u(t,c,f,r);case d.ORDER:return h(t,f),t;case d.PROPS:return p(t,f,c.properties),t;case d.THUNK:return l(t,r.patch(t,f,r));default:return t}}function i(e,t){var r=e.parentNode;return r&&r.removeChild(e),c(e,t),null}function o(e,t,r){var n=r.render(t,r);return e&&e.appendChild(n),e}function s(e,t,r,n){var i;if(3===e.nodeType)e.replaceData(0,e.length,r.text),i=e;else{var o=e.parentNode;i=n.render(r,n),o&&i!==e&&o.replaceChild(i,e)}return i}function a(e,t,r,n){var i,o=m(t,r);i=o?r.update(t,e)||e:n.render(r,n);var s=e.parentNode;return s&&i!==e&&s.replaceChild(i,e),o||c(e,t),i}function u(e,t,r,n){var i=e.parentNode,o=n.render(r,n);return i&&o!==e&&i.replaceChild(o,e),o}function c(e,t){"function"==typeof t.destroy&&f(t)&&t.destroy(e)}function h(e,t){for(var r,n,i,o=e.childNodes,s={},a=0;a<t.removes.length;a++)n=t.removes[a],r=o[n.from],n.key&&(s[n.key]=r),e.removeChild(r);for(var u=o.length,c=0;c<t.inserts.length;c++)i=t.inserts[c],r=s[i.key],e.insertBefore(r,i.to>=u++?null:o[i.to])}function l(e,t){return e&&t&&e!==t&&e.parentNode&&e.parentNode.replaceChild(t,e),t}var p=e("./apply-properties"),f=e("../vnode/is-widget.js"),d=e("../vnode/vpatch.js"),m=e("./update-widget");t.exports=n},{"../vnode/is-widget.js":226,"../vnode/vpatch.js":229,"./apply-properties":211,"./update-widget":216}],215:[function(e,t,r){function n(e,t,r){return r=r||{},r.patch=r.patch&&r.patch!==n?r.patch:i,r.render=r.render||c,r.patch(e,t,r)}function i(e,t,r){var n=s(t);if(0===n.length)return e;var i=h(e,t.a,n),u=e.ownerDocument;r.document||u===a||(r.document=u);for(var c=0;c<n.length;c++){var l=n[c];e=o(e,i[l],t[l],r)}return e}function o(e,t,r,n){if(!t)return e;var i;if(u(r))for(var o=0;o<r.length;o++)i=l(r[o],t,n),t===e&&(e=i);else i=l(r,t,n),t===e&&(e=i);return e}function s(e){var t=[];for(var r in e)"a"!==r&&t.push(Number(r));return t}var a=e("global/document"),u=e("x-is-array"),c=e("./create-element"),h=e("./dom-index"),l=e("./patch-op");t.exports=n},{"./create-element":212,"./dom-index":213,"./patch-op":214,"global/document":207,"x-is-array":209}],216:[function(e,t,r){function n(e,t){return i(e)&&i(t)?"name"in e&&"name"in t?e.id===t.id:e.init===t.init:!1}var i=e("../vnode/is-widget.js");t.exports=n},{"../vnode/is-widget.js":226}],217:[function(e,t,r){"use strict";function n(e){return this instanceof n?void(this.value=e):new n(e)}var i=e("ev-store");t.exports=n,n.prototype.hook=function(e,t){var r=i(e),n=t.substr(3);r[n]=this.value},n.prototype.unhook=function(e,t){var r=i(e),n=t.substr(3);r[n]=void 0}},{"ev-store":204}],218:[function(e,t,r){"use strict";function n(e){return this instanceof n?void(this.value=e):new n(e)}t.exports=n,n.prototype.hook=function(e,t){e[t]!==this.value&&(e[t]=this.value)}},{}],219:[function(e,t,r){"use strict";function n(e,t,r){var n,s,u,c,h=[];return!r&&a(t)&&(r=t,s={}),s=s||t||{},n=y(e,s),s.hasOwnProperty("key")&&(u=s.key,s.key=void 0),s.hasOwnProperty("namespace")&&(c=s.namespace,s.namespace=void 0),"INPUT"!==n||c||!s.hasOwnProperty("value")||void 0===s.value||v(s.value)||(s.value=_(s.value)),o(s),void 0!==r&&null!==r&&i(r,h,n,s),new l(n,s,h,u,c)}function i(e,t,r,n){if("string"==typeof e)t.push(new p(e));else if("number"==typeof e)t.push(new p(String(e)));else if(s(e))t.push(e);else{if(!h(e)){if(null===e||void 0===e)return;throw u({foreignObject:e,parentVnode:{tagName:r,properties:n}})}for(var o=0;o<e.length;o++)i(e[o],t,r,n)}}function o(e){for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];if(v(r))continue;"ev-"===t.substr(0,3)&&(e[t]=b(r))}}function s(e){return f(e)||d(e)||m(e)||g(e)}function a(e){return"string"==typeof e||h(e)||s(e)}function u(e){var t=new Error;return t.type="virtual-hyperscript.unexpected.virtual-element",t.message="Unexpected virtual child passed to h().\nExpected a VNode / Vthunk / VWidget / string but:\ngot:\n"+c(e.foreignObject)+".\nThe parent vnode is:\n"+c(e.parentVnode),t.foreignObject=e.foreignObject,t.parentVnode=e.parentVnode,t}function c(e){try{return JSON.stringify(e,null,"    ")}catch(t){return String(e)}}var h=e("x-is-array"),l=e("../vnode/vnode.js"),p=e("../vnode/vtext.js"),f=e("../vnode/is-vnode"),d=e("../vnode/is-vtext"),m=e("../vnode/is-widget"),v=e("../vnode/is-vhook"),g=e("../vnode/is-thunk"),y=e("./parse-tag.js"),_=e("./hooks/soft-set-hook.js"),b=e("./hooks/ev-hook.js");t.exports=n},{"../vnode/is-thunk":222,"../vnode/is-vhook":223,"../vnode/is-vnode":224,"../vnode/is-vtext":225,"../vnode/is-widget":226,"../vnode/vnode.js":228,"../vnode/vtext.js":230,"./hooks/ev-hook.js":217,"./hooks/soft-set-hook.js":218,"./parse-tag.js":220,"x-is-array":209}],220:[function(e,t,r){"use strict";function n(e,t){if(!e)return"DIV";var r=!t.hasOwnProperty("id"),n=i(e,o),a=null;s.test(n[1])&&(a="DIV");var u,c,h,l;for(l=0;l<n.length;l++)c=n[l],c&&(h=c.charAt(0),a?"."===h?(u=u||[],u.push(c.substring(1,c.length))):"#"===h&&r&&(t.id=c.substring(1,c.length)):a=c);return u&&(t.className&&u.push(t.className),t.className=u.join(" ")),t.namespace?a:a.toUpperCase()}var i=e("browser-split"),o=/([\.#]?[a-zA-Z0-9\u007F-\uFFFF_:-]+)/,s=/^\.|#/;t.exports=n},{"browser-split":203}],221:[function(e,t,r){function n(e,t){var r=e,n=t;return u(t)&&(n=i(t,e)),u(e)&&(r=i(e,null)),{a:r,b:n}}function i(e,t){var r=e.vnode;if(r||(r=e.vnode=e.render(t)),!(o(r)||s(r)||a(r)))throw new Error("thunk did not return a valid node");return r}var o=e("./is-vnode"),s=e("./is-vtext"),a=e("./is-widget"),u=e("./is-thunk");t.exports=n},{"./is-thunk":222,"./is-vnode":224,"./is-vtext":225,"./is-widget":226}],222:[function(e,t,r){function n(e){return e&&"Thunk"===e.type}t.exports=n},{}],223:[function(e,t,r){function n(e){return e&&("function"==typeof e.hook&&!e.hasOwnProperty("hook")||"function"==typeof e.unhook&&!e.hasOwnProperty("unhook"))}t.exports=n},{}],224:[function(e,t,r){function n(e){return e&&"VirtualNode"===e.type&&e.version===i}var i=e("./version");t.exports=n},{"./version":227}],225:[function(e,t,r){function n(e){return e&&"VirtualText"===e.type&&e.version===i}var i=e("./version");t.exports=n},{"./version":227}],226:[function(e,t,r){function n(e){return e&&"Widget"===e.type}t.exports=n},{}],227:[function(e,t,r){t.exports="2"},{}],228:[function(e,t,r){function n(e,t,r,n,i){this.tagName=e,this.properties=t||c,this.children=r||h,this.key=null!=n?String(n):void 0,this.namespace="string"==typeof i?i:null;var l,p=r&&r.length||0,f=0,d=!1,m=!1,v=!1;for(var g in t)if(t.hasOwnProperty(g)){var y=t[g];u(y)&&y.unhook&&(l||(l={}),l[g]=y)}for(var _=0;p>_;_++){var b=r[_];o(b)?(f+=b.count||0,!d&&b.hasWidgets&&(d=!0),!m&&b.hasThunks&&(m=!0),v||!b.hooks&&!b.descendantHooks||(v=!0)):!d&&s(b)?"function"==typeof b.destroy&&(d=!0):!m&&a(b)&&(m=!0)}this.count=p+f,this.hasWidgets=d,this.hasThunks=m,this.hooks=l,this.descendantHooks=v}var i=e("./version"),o=e("./is-vnode"),s=e("./is-widget"),a=e("./is-thunk"),u=e("./is-vhook");t.exports=n;var c={},h=[];n.prototype.version=i,n.prototype.type="VirtualNode"},{"./is-thunk":222,"./is-vhook":223,"./is-vnode":224,"./is-widget":226,"./version":227}],229:[function(e,t,r){function n(e,t,r){this.type=Number(e),this.vNode=t,this.patch=r}var i=e("./version");n.NONE=0,n.VTEXT=1,n.VNODE=2,n.WIDGET=3,n.PROPS=4,n.ORDER=5,n.INSERT=6,n.REMOVE=7,n.THUNK=8,t.exports=n,n.prototype.version=i,n.prototype.type="VirtualPatch"},{"./version":227}],230:[function(e,t,r){function n(e){this.text=String(e)}var i=e("./version");t.exports=n,n.prototype.version=i,n.prototype.type="VirtualText"},{"./version":227}],231:[function(e,t,r){function n(e,t){var r;for(var a in e){a in t||(r=r||{},r[a]=void 0);var u=e[a],c=t[a];if(u!==c)if(o(u)&&o(c))if(i(c)!==i(u))r=r||{},r[a]=c;else if(s(c))r=r||{},r[a]=c;else{var h=n(u,c);h&&(r=r||{},r[a]=h)}else r=r||{},r[a]=c}for(var l in t)l in e||(r=r||{},r[l]=t[l]);return r}function i(e){return Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__?e.__proto__:e.constructor?e.constructor.prototype:void 0}var o=e("is-object"),s=e("../vnode/is-vhook");t.exports=n},{"../vnode/is-vhook":223,"is-object":208}],232:[function(e,t,r){function n(e,t){var r={a:e};return i(e,t,r,0),r}function i(e,t,r,n){if(e!==t){var i=r[n],a=!1;if(x(e)||x(t))u(e,t,r,n);else if(null==t)b(e)||(s(e,r,n),i=r[n]),i=m(i,new g(g.REMOVE,e,t));else if(y(t))if(y(e))if(e.tagName===t.tagName&&e.namespace===t.namespace&&e.key===t.key){var c=S(e.properties,t.properties);c&&(i=m(i,new g(g.PROPS,e,c))),i=o(e,t,r,i,n)}else i=m(i,new g(g.VNODE,e,t)),a=!0;else i=m(i,new g(g.VNODE,e,t)),a=!0;else _(t)?_(e)?e.text!==t.text&&(i=m(i,new g(g.VTEXT,e,t))):(i=m(i,new g(g.VTEXT,e,t)),a=!0):b(t)&&(b(e)||(a=!0),i=m(i,new g(g.WIDGET,e,t)));i&&(r[n]=i),a&&s(e,r,n)}}function o(e,t,r,n,o){for(var s=e.children,a=p(s,t.children),u=a.children,c=s.length,h=u.length,l=c>h?c:h,f=0;l>f;f++){
var d=s[f],v=u[f];o+=1,d?i(d,v,r,o):v&&(n=m(n,new g(g.INSERT,null,v))),y(d)&&d.count&&(o+=d.count)}return a.moves&&(n=m(n,new g(g.ORDER,e,a.moves))),n}function s(e,t,r){h(e,t,r),a(e,t,r)}function a(e,t,r){if(b(e))"function"==typeof e.destroy&&(t[r]=m(t[r],new g(g.REMOVE,e,null)));else if(y(e)&&(e.hasWidgets||e.hasThunks))for(var n=e.children,i=n.length,o=0;i>o;o++){var s=n[o];r+=1,a(s,t,r),y(s)&&s.count&&(r+=s.count)}else x(e)&&u(e,null,t,r)}function u(e,t,r,i){var o=w(e,t),s=n(o.a,o.b);c(s)&&(r[i]=new g(g.THUNK,null,s))}function c(e){for(var t in e)if("a"!==t)return!0;return!1}function h(e,t,r){if(y(e)){if(e.hooks&&(t[r]=m(t[r],new g(g.PROPS,e,l(e.hooks)))),e.descendantHooks||e.hasThunks)for(var n=e.children,i=n.length,o=0;i>o;o++){var s=n[o];r+=1,h(s,t,r),y(s)&&s.count&&(r+=s.count)}}else x(e)&&u(e,null,t,r)}function l(e){var t={};for(var r in e)t[r]=void 0;return t}function p(e,t){var r=d(t),n=r.keys,i=r.free;if(i.length===t.length)return{children:t,moves:null};var o=d(e),s=o.keys,a=o.free;if(a.length===e.length)return{children:t,moves:null};for(var u=[],c=0,h=i.length,l=0,p=0;p<e.length;p++){var m,v=e[p];v.key?n.hasOwnProperty(v.key)?(m=n[v.key],u.push(t[m])):(m=p-l++,u.push(null)):h>c?(m=i[c++],u.push(t[m])):(m=p-l++,u.push(null))}for(var g=c>=i.length?t.length:i[c],y=0;y<t.length;y++){var _=t[y];_.key?s.hasOwnProperty(_.key)||u.push(_):y>=g&&u.push(_)}for(var b,x=u.slice(),w=0,S=[],M=[],E=0;E<t.length;){var C=t[E];for(b=x[w];null===b&&x.length;)S.push(f(x,w,null)),b=x[w];b&&b.key===C.key?(w++,E++):C.key?(b&&b.key&&n[b.key]!==E+1?(S.push(f(x,w,b.key)),b=x[w],b&&b.key===C.key?w++:M.push({key:C.key,to:E})):M.push({key:C.key,to:E}),E++):b&&b.key&&S.push(f(x,w,b.key))}for(;w<x.length;)b=x[w],S.push(f(x,w,b&&b.key));return S.length!==l||M.length?{children:u,moves:{removes:S,inserts:M}}:{children:u,moves:null}}function f(e,t,r){return e.splice(t,1),{from:t,key:r}}function d(e){for(var t={},r=[],n=e.length,i=0;n>i;i++){var o=e[i];o.key?t[o.key]=i:r.push(i)}return{keys:t,free:r}}function m(e,t){return e?(v(e)?e.push(t):e=[e,t],e):t}var v=e("x-is-array"),g=e("../vnode/vpatch"),y=e("../vnode/is-vnode"),_=e("../vnode/is-vtext"),b=e("../vnode/is-widget"),x=e("../vnode/is-thunk"),w=e("../vnode/handle-thunk"),S=e("./diff-props");t.exports=n},{"../vnode/handle-thunk":221,"../vnode/is-thunk":222,"../vnode/is-vnode":224,"../vnode/is-vtext":225,"../vnode/is-widget":226,"../vnode/vpatch":229,"./diff-props":231,"x-is-array":209}],233:[function(t,r,n){!function(e){"use strict";e(function(e){var t=e("./makePromise"),r=e("./Scheduler"),n=e("./env").asap;return t({scheduler:new r(n)})})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{"./Scheduler":234,"./env":246,"./makePromise":248}],234:[function(t,r,n){!function(e){"use strict";e(function(){function e(e){this._async=e,this._running=!1,this._queue=this,this._queueLen=0,this._afterQueue={},this._afterQueueLen=0;var t=this;this.drain=function(){t._drain()}}return e.prototype.enqueue=function(e){this._queue[this._queueLen++]=e,this.run()},e.prototype.afterQueue=function(e){this._afterQueue[this._afterQueueLen++]=e,this.run()},e.prototype.run=function(){this._running||(this._running=!0,this._async(this.drain))},e.prototype._drain=function(){for(var e=0;e<this._queueLen;++e)this._queue[e].run(),this._queue[e]=void 0;for(this._queueLen=0,this._running=!1,e=0;e<this._afterQueueLen;++e)this._afterQueue[e].run(),this._afterQueue[e]=void 0;this._afterQueueLen=0},e})}("function"==typeof e&&e.amd?e:function(e){r.exports=e()})},{}],235:[function(t,r,n){!function(e){"use strict";e(function(){function e(t){Error.call(this),this.message=t,this.name=e.name,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e})}("function"==typeof e&&e.amd?e:function(e){r.exports=e()})},{}],236:[function(t,r,n){!function(e){"use strict";e(function(){function e(e,r){function n(t,n,o){var s=e._defer(),a=o.length,u=new Array(a);return i({f:t,thisArg:n,args:o,params:u,i:a-1,call:r},s._handler),s}function i(t,n){if(t.i<0)return r(t.f,t.thisArg,t.params,n);var i=e._handler(t.args[t.i]);i.fold(o,t,void 0,n)}function o(e,t,r){e.params[e.i]=t,e.i-=1,i(e,r)}return arguments.length<2&&(r=t),n}function t(e,t,r,n){try{n.resolve(e.apply(t,r))}catch(i){n.reject(i)}}return e.tryCatchResolve=t,e})}("function"==typeof e&&e.amd?e:function(e){r.exports=e()})},{}],237:[function(t,r,n){!function(e){"use strict";e(function(e){var t=e("../state"),r=e("../apply");return function(e){function n(t){function r(e){h=null,this.resolve(e)}function n(e){this.resolved||(h.push(e),0===--c&&this.reject(h))}for(var i,o,s=e._defer(),a=s._handler,u=t.length>>>0,c=u,h=[],l=0;u>l;++l)if(o=t[l],void 0!==o||l in t){if(i=e._handler(o),i.state()>0){a.become(i),e._visitRemaining(t,l,i);break}i.visit(a,r,n)}else--c;return 0===c&&a.reject(new RangeError("any(): array must not be empty")),s}function i(t,r){function n(e){this.resolved||(h.push(e),0===--f&&(l=null,this.resolve(h)))}function i(e){this.resolved||(l.push(e),0===--o&&(h=null,this.reject(l)))}var o,s,a,u=e._defer(),c=u._handler,h=[],l=[],p=t.length>>>0,f=0;for(a=0;p>a;++a)s=t[a],(void 0!==s||a in t)&&++f;for(r=Math.max(r,0),o=f-r+1,f=Math.min(r,f),r>f?c.reject(new RangeError("some(): array must contain at least "+r+" item(s), but had "+f)):0===f&&c.resolve(h),a=0;p>a;++a)s=t[a],(void 0!==s||a in t)&&e._handler(s).visit(c,n,i,c.notify);return u}function o(t,r){return e._traverse(r,t)}function s(t,r){var n=y.call(t);return e._traverse(r,n).then(function(e){return a(n,e)})}function a(t,r){for(var n=r.length,i=new Array(n),o=0,s=0;n>o;++o)r[o]&&(i[s++]=e._handler(t[o]).value);return i.length=s,i}function u(e){return m(e.map(c))}function c(r){var n=e._handler(r);return 0===n.state()?d(r).then(t.fulfilled,t.rejected):(n._unreport(),t.inspect(n))}function h(e,t){return arguments.length>2?v.call(e,p(t),arguments[2]):v.call(e,p(t))}function l(e,t){return arguments.length>2?g.call(e,p(t),arguments[2]):g.call(e,p(t))}function p(e){return function(t,r,n){return f(e,void 0,[t,r,n])}}var f=r(e),d=e.resolve,m=e.all,v=Array.prototype.reduce,g=Array.prototype.reduceRight,y=Array.prototype.slice;return e.any=n,e.some=i,e.settle=u,e.map=o,e.filter=s,e.reduce=h,e.reduceRight=l,e.prototype.spread=function(e){return this.then(m).then(function(t){return e.apply(this,t)})},e}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{"../apply":236,"../state":249}],238:[function(t,r,n){!function(e){"use strict";e(function(){function e(){throw new TypeError("catch predicate must be a function")}function t(e,t){return r(t)?e instanceof t:t(e)}function r(e){return e===Error||null!=e&&e.prototype instanceof Error}function n(e){return("object"==typeof e||"function"==typeof e)&&null!==e}function i(e){return e}return function(r){function o(e,r){return function(n){return t(n,r)?e.call(this,n):c(n)}}function s(e,t,r,i){var o=e.call(t);return n(o)?a(o,r,i):r(i)}function a(e,t,r){return u(e).then(function(){return t(r)})}var u=r.resolve,c=r.reject,h=r.prototype["catch"];return r.prototype.done=function(e,t){this._handler.visit(this._handler.receiver,e,t)},r.prototype["catch"]=r.prototype.otherwise=function(t){return arguments.length<2?h.call(this,t):"function"!=typeof t?this.ensure(e):h.call(this,o(arguments[1],t))},r.prototype["finally"]=r.prototype.ensure=function(e){return"function"!=typeof e?this:this.then(function(t){return s(e,this,i,t)},function(t){return s(e,this,c,t)})},r.prototype["else"]=r.prototype.orElse=function(e){return this.then(void 0,function(){return e})},r.prototype["yield"]=function(e){return this.then(function(){return e})},r.prototype.tap=function(e){return this.then(e)["yield"](this)},r}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e()})},{}],239:[function(t,r,n){!function(e){"use strict";e(function(){return function(e){return e.prototype.fold=function(t,r){var n=this._beget();return this._handler.fold(function(r,n,i){e._handler(r).fold(function(e,r,n){n.resolve(t.call(this,r,e))},n,this,i)},r,n._handler.receiver,n._handler),n},e}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e()})},{}],240:[function(t,r,n){!function(e){"use strict";e(function(e){var t=e("../state").inspect;return function(e){return e.prototype.inspect=function(){return t(e._handler(this))},e}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{"../state":249}],241:[function(t,r,n){!function(e){"use strict";e(function(){return function(e){function t(e,t,n,i){return r(function(t){return[t,e(t)]},t,n,i)}function r(e,t,i,o){function s(o,s){return n(i(o)).then(function(){return r(e,t,i,s)})}return n(o).then(function(r){return n(t(r)).then(function(t){return t?r:n(e(r)).spread(s)})})}var n=e.resolve;return e.iterate=t,e.unfold=r,e}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e()})},{}],242:[function(t,r,n){!function(e){"use strict";e(function(){return function(e){return e.prototype.progress=function(e){return this.then(void 0,void 0,e)},e}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e()})},{}],243:[function(t,r,n){!function(e){"use strict";e(function(e){function t(e,t,n,i){return r.setTimer(function(){e(n,i,t)},t)}var r=e("../env"),n=e("../TimeoutError");return function(e){function i(e,r,n){t(o,e,r,n)}function o(e,t){t.resolve(e)}function s(e,t,r){var i="undefined"==typeof e?new n("timed out after "+r+"ms"):e;t.reject(i)}return e.prototype.delay=function(e){var t=this._beget();return this._handler.fold(i,e,void 0,t._handler),t},e.prototype.timeout=function(e,n){var i=this._beget(),o=i._handler,a=t(s,e,n,i._handler);return this._handler.visit(o,function(e){r.clearTimer(a),this.resolve(e)},function(e){r.clearTimer(a),this.reject(e)},o.notify),i},e}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{"../TimeoutError":235,"../env":246}],244:[function(t,r,n){!function(e){"use strict";e(function(e){function t(e){throw e}function r(){}var n=e("../env").setTimer,i=e("../format");return function(e){function o(e){e.handled||(f.push(e),h("Potentially unhandled rejection ["+e.id+"] "+i.formatError(e.value)))}function s(e){var t=f.indexOf(e);t>=0&&(f.splice(t,1),l("Handled previous rejection ["+e.id+"] "+i.formatObject(e.value)))}function a(e,t){p.push(e,t),null===d&&(d=n(u,0))}function u(){for(d=null;p.length>0;)p.shift()(p.shift())}var c,h=r,l=r;"undefined"!=typeof console&&(c=console,h="undefined"!=typeof c.error?function(e){c.error(e)}:function(e){c.log(e)},l="undefined"!=typeof c.info?function(e){c.info(e)}:function(e){c.log(e)}),e.onPotentiallyUnhandledRejection=function(e){a(o,e)},e.onPotentiallyUnhandledRejectionHandled=function(e){a(s,e)},e.onFatalRejection=function(e){a(t,e.value)};var p=[],f=[],d=null;return e}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{"../env":246,"../format":247}],245:[function(t,r,n){!function(e){"use strict";e(function(){return function(e){return e.prototype["with"]=e.prototype.withThis=function(e){var t=this._beget(),r=t._handler;return r.receiver=e,this._handler.chain(r,e),t},e}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e()})},{}],246:[function(t,r,n){(function(n){!function(e){"use strict";e(function(e){function t(){return"undefined"!=typeof n&&"[object process]"===Object.prototype.toString.call(n)}function r(){return"function"==typeof MutationObserver&&MutationObserver||"function"==typeof WebKitMutationObserver&&WebKitMutationObserver}function i(e){function t(){var e=r;r=void 0,e()}var r,n=document.createTextNode(""),i=new e(t);i.observe(n,{characterData:!0});var o=0;return function(e){r=e,n.data=o^=1}}var o,s="undefined"!=typeof setTimeout&&setTimeout,a=function(e,t){return setTimeout(e,t)},u=function(e){return clearTimeout(e)},c=function(e){return s(e,0)};if(t())c=function(e){return n.nextTick(e)};else if(o=r())c=i(o);else if(!s){var h=e,l=h("vertx");a=function(e,t){return l.setTimer(t,e)},u=l.cancelTimer,c=l.runOnLoop||l.runOnContext}return{setTimer:a,clearTimer:u,asap:c}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})}).call(this,t("_process"))},{_process:3}],247:[function(t,r,n){!function(e){"use strict";e(function(){function e(e){var r="object"==typeof e&&null!==e&&(e.stack||e.message)?e.stack||e.message:t(e);return e instanceof Error?r:r+" (WARNING: non-Error used)"}function t(e){var t=String(e);return"[object Object]"===t&&"undefined"!=typeof JSON&&(t=r(e,t)),t}function r(e,t){try{return JSON.stringify(e)}catch(r){return t}}return{formatError:e,formatObject:t,tryStringify:r}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e()})},{}],248:[function(t,r,n){(function(t){!function(e){"use strict";e(function(){return function(e){function r(e,t){this._handler=e===b?t:n(e)}function n(e){function t(e){i.resolve(e)}function r(e){i.reject(e)}function n(e){i.notify(e)}var i=new w;try{e(t,r,n)}catch(o){r(o)}return i}function i(e){return R(e)?e:new r(b,new S(g(e)))}function o(e){return new r(b,new S(new C(e)))}function s(){return ee}function a(){return new r(b,new w)}function u(e,t){var r=new w(e.receiver,e.join().context);return new t(b,r)}function c(e){return l(W,null,e)}function h(e,t){return l(B,e,t)}function l(e,t,n){function i(r,i,s){s.resolved||p(n,o,r,e(t,i,r),s)}function o(e,t,r){h[e]=t,0===--c&&r.become(new E(h))}for(var s,a="function"==typeof t?i:o,u=new w,c=n.length>>>0,h=new Array(c),l=0;l<n.length&&!u.resolved;++l)s=n[l],void 0!==s||l in n?p(n,a,l,s,u):--c;return 0===c&&u.become(new E(h)),new r(b,u)}function p(e,t,r,n,i){if(j(n)){var o=y(n),s=o.state();0===s?o.fold(t,r,void 0,i):s>0?t(r,o.value,i):(i.become(o),f(e,r+1,o))}else t(r,n,i)}function f(e,t,r){for(var n=t;n<e.length;++n)d(g(e[n]),r)}function d(e,t){if(e!==t){var r=e.state();0===r?e.visit(e,void 0,e._unreport):0>r&&e._unreport()}}function m(e){return"object"!=typeof e||null===e?o(new TypeError("non-iterable passed to race()")):0===e.length?s():1===e.length?i(e[0]):v(e)}function v(e){var t,n,i,o=new w;for(t=0;t<e.length;++t)if(n=e[t],void 0!==n||t in e){if(i=g(n),0!==i.state()){o.become(i),f(e,t+1,i);break}i.visit(o,o.resolve,o.reject)}return new r(b,o)}function g(e){return R(e)?e._handler.join():j(e)?_(e):new E(e)}function y(e){return R(e)?e._handler.join():_(e)}function _(e){try{var t=e.then;return"function"==typeof t?new M(t,e):new E(e)}catch(r){return new C(r)}}function b(){}function x(){}function w(e,t){r.createContext(this,t),this.consumers=void 0,this.receiver=e,this.handler=void 0,this.resolved=!1}function S(e){this.handler=e}function M(e,t){w.call(this),X.enqueue(new N(e,t,this))}function E(e){r.createContext(this),this.value=e}function C(e){r.createContext(this),this.id=++J,this.value=e,this.handled=!1,this.reported=!1,this._report()}function T(e,t){this.rejection=e,this.context=t}function A(e){this.rejection=e}function P(){return new C(new TypeError("Promise cycle"))}function k(e,t){this.continuation=e,this.handler=t}function O(e,t){this.handler=t,this.value=e}function N(e,t,r){this._then=e,this.thenable=t,this.resolver=r}function D(e,t,r,n,i){try{e.call(t,r,n,i)}catch(o){n(o)}}function L(e,t,r,n){this.f=e,this.z=t,this.c=r,this.to=n,this.resolver=Q,this.receiver=this}function R(e){return e instanceof r}function j(e){return("object"==typeof e||"function"==typeof e)&&null!==e}function I(e,t,n,i){return"function"!=typeof e?i.become(t):(r.enterContext(t),U(e,t.value,n,i),void r.exitContext())}function V(e,t,n,i,o){return"function"!=typeof e?o.become(n):(r.enterContext(n),G(e,t,n.value,i,o),void r.exitContext())}function F(e,t,n,i,o){return"function"!=typeof e?o.notify(t):(r.enterContext(n),z(e,t,i,o),void r.exitContext())}function B(e,t,r){try{return e(t,r)}catch(n){return o(n)}}function U(e,t,r,n){try{n.become(g(e.call(r,t)))}catch(i){n.become(new C(i))}}function G(e,t,r,n,i){try{e.call(n,t,r,i)}catch(o){i.become(new C(o))}}function z(e,t,r,n){try{n.notify(e.call(r,t))}catch(i){n.notify(i)}}function H(e,t){t.prototype=Y(e.prototype),t.prototype.constructor=t}function W(e,t){return t}function q(){}function $(){return"undefined"!=typeof t&&null!==t&&"function"==typeof t.emit?function(e,r){return"unhandledRejection"===e?t.emit(e,r.value,r):t.emit(e,r)}:"undefined"!=typeof self&&"function"==typeof CustomEvent?function(e,t,r){var n=!1;try{var i=new r("unhandledRejection");n=i instanceof r}catch(o){}return n?function(e,n){var i=new r(e,{detail:{reason:n.value,key:n},bubbles:!1,cancelable:!0});return!t.dispatchEvent(i)}:e}(q,self,CustomEvent):q}var X=e.scheduler,K=$(),Y=Object.create||function(e){function t(){}return t.prototype=e,new t};r.resolve=i,r.reject=o,r.never=s,r._defer=a,r._handler=g,r.prototype.then=function(e,t,r){var n=this._handler,i=n.join().state();if("function"!=typeof e&&i>0||"function"!=typeof t&&0>i)return new this.constructor(b,n);var o=this._beget(),s=o._handler;return n.chain(s,n.receiver,e,t,r),o},r.prototype["catch"]=function(e){return this.then(void 0,e)},r.prototype._beget=function(){return u(this._handler,this.constructor)},r.all=c,r.race=m,r._traverse=h,r._visitRemaining=f,b.prototype.when=b.prototype.become=b.prototype.notify=b.prototype.fail=b.prototype._unreport=b.prototype._report=q,b.prototype._state=0,b.prototype.state=function(){return this._state},b.prototype.join=function(){for(var e=this;void 0!==e.handler;)e=e.handler;return e},b.prototype.chain=function(e,t,r,n,i){this.when({resolver:e,receiver:t,fulfilled:r,rejected:n,progress:i})},b.prototype.visit=function(e,t,r,n){this.chain(Q,e,t,r,n)},b.prototype.fold=function(e,t,r,n){this.when(new L(e,t,r,n))},H(b,x),x.prototype.become=function(e){e.fail()};var Q=new x;H(b,w),w.prototype._state=0,w.prototype.resolve=function(e){this.become(g(e))},w.prototype.reject=function(e){this.resolved||this.become(new C(e))},w.prototype.join=function(){if(!this.resolved)return this;for(var e=this;void 0!==e.handler;)if(e=e.handler,e===this)return this.handler=P();return e},w.prototype.run=function(){var e=this.consumers,t=this.handler;this.handler=this.handler.join(),this.consumers=void 0;for(var r=0;r<e.length;++r)t.when(e[r])},w.prototype.become=function(e){this.resolved||(this.resolved=!0,this.handler=e,void 0!==this.consumers&&X.enqueue(this),void 0!==this.context&&e._report(this.context))},w.prototype.when=function(e){this.resolved?X.enqueue(new k(e,this.handler)):void 0===this.consumers?this.consumers=[e]:this.consumers.push(e)},w.prototype.notify=function(e){this.resolved||X.enqueue(new O(e,this))},w.prototype.fail=function(e){var t="undefined"==typeof e?this.context:e;this.resolved&&this.handler.join().fail(t)},w.prototype._report=function(e){this.resolved&&this.handler.join()._report(e)},w.prototype._unreport=function(){this.resolved&&this.handler.join()._unreport()},H(b,S),S.prototype.when=function(e){X.enqueue(new k(e,this))},S.prototype._report=function(e){this.join()._report(e)},S.prototype._unreport=function(){this.join()._unreport()},H(w,M),H(b,E),E.prototype._state=1,E.prototype.fold=function(e,t,r,n){V(e,t,this,r,n)},E.prototype.when=function(e){I(e.fulfilled,this,e.receiver,e.resolver)};var J=0;H(b,C),C.prototype._state=-1,C.prototype.fold=function(e,t,r,n){n.become(this)},C.prototype.when=function(e){"function"==typeof e.rejected&&this._unreport(),I(e.rejected,this,e.receiver,e.resolver)},C.prototype._report=function(e){X.afterQueue(new T(this,e))},C.prototype._unreport=function(){this.handled||(this.handled=!0,X.afterQueue(new A(this)))},C.prototype.fail=function(e){this.reported=!0,K("unhandledRejection",this),r.onFatalRejection(this,void 0===e?this.context:e)},T.prototype.run=function(){this.rejection.handled||this.rejection.reported||(this.rejection.reported=!0,K("unhandledRejection",this.rejection)||r.onPotentiallyUnhandledRejection(this.rejection,this.context))},A.prototype.run=function(){this.rejection.reported&&(K("rejectionHandled",this.rejection)||r.onPotentiallyUnhandledRejectionHandled(this.rejection))},r.createContext=r.enterContext=r.exitContext=r.onPotentiallyUnhandledRejection=r.onPotentiallyUnhandledRejectionHandled=r.onFatalRejection=q;var Z=new b,ee=new r(b,Z);return k.prototype.run=function(){this.handler.join().when(this.continuation)},O.prototype.run=function(){var e=this.handler.consumers;if(void 0!==e)for(var t,r=0;r<e.length;++r)t=e[r],F(t.progress,this.value,this.handler,t.receiver,t.resolver)},N.prototype.run=function(){function e(e){n.resolve(e)}function t(e){n.reject(e)}function r(e){n.notify(e)}var n=this.resolver;D(this._then,this.thenable,e,t,r)},L.prototype.fulfilled=function(e){this.f.call(this.c,this.z,e,this.to)},L.prototype.rejected=function(e){this.to.reject(e)},L.prototype.progress=function(e){this.to.notify(e)},r}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e()})}).call(this,t("_process"))},{_process:3}],249:[function(t,r,n){!function(e){"use strict";e(function(){function e(){return{state:"pending"}}function t(e){return{state:"rejected",reason:e}}function r(e){return{state:"fulfilled",value:e}}function n(n){var i=n.state();return 0===i?e():i>0?r(n.value):t(n.value)}return{pending:e,fulfilled:r,rejected:t,inspect:n}})}("function"==typeof e&&e.amd?e:function(e){r.exports=e()})},{}],250:[function(t,r,n){!function(e){"use strict";e(function(e){function t(e,t,r,n){var i=S.resolve(e);return arguments.length<2?i:i.then(t,r,n)}function r(e){return new S(e)}function n(e){return function(){for(var t=0,r=arguments.length,n=new Array(r);r>t;++t)n[t]=arguments[t];return M(e,this,n)}}function i(e){for(var t=0,r=arguments.length-1,n=new Array(r);r>t;++t)n[t]=arguments[t+1];return M(e,this,n)}function o(){return new s}function s(){function e(e){n._handler.resolve(e)}function t(e){n._handler.reject(e)}function r(e){n._handler.notify(e)}var n=S._defer();this.promise=n,this.resolve=e,this.reject=t,this.notify=r,this.resolver={resolve:e,reject:t,notify:r}}function a(e){return e&&"function"==typeof e.then}function u(){return S.all(arguments)}function c(e){return t(e,S.all)}function h(e){return t(e,S.settle)}function l(e,r){return t(e,function(e){return S.map(e,r)})}function p(e,r){return t(e,function(e){return S.filter(e,r)})}var f=e("./lib/decorators/timed"),d=e("./lib/decorators/array"),m=e("./lib/decorators/flow"),v=e("./lib/decorators/fold"),g=e("./lib/decorators/inspect"),y=e("./lib/decorators/iterate"),_=e("./lib/decorators/progress"),b=e("./lib/decorators/with"),x=e("./lib/decorators/unhandledRejection"),w=e("./lib/TimeoutError"),S=[d,m,v,y,_,g,b,f,x].reduce(function(e,t){return t(e)},e("./lib/Promise")),M=e("./lib/apply")(S);return t.promise=r,t.resolve=S.resolve,t.reject=S.reject,t.lift=n,t["try"]=i,t.attempt=i,t.iterate=S.iterate,t.unfold=S.unfold,t.join=u,t.all=c,t.settle=h,t.any=n(S.any),t.some=n(S.some),t.race=n(S.race),t.map=l,t.filter=p,t.reduce=n(S.reduce),t.reduceRight=n(S.reduceRight),t.isPromiseLike=a,t.Promise=S,t.defer=o,t.TimeoutError=w,t})}("function"==typeof e&&e.amd?e:function(e){r.exports=e(t)})},{"./lib/Promise":233,"./lib/TimeoutError":235,"./lib/apply":236,"./lib/decorators/array":237,"./lib/decorators/flow":238,"./lib/decorators/fold":239,"./lib/decorators/inspect":240,"./lib/decorators/iterate":241,"./lib/decorators/progress":242,"./lib/decorators/timed":243,"./lib/decorators/unhandledRejection":244,"./lib/decorators/with":245}],251:[function(e,t,r){function n(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}var i=e("./api/APIv2Call");r.APIv2Call=i.APIv2Call;var o=e("./api/APIv2");r.APIv2=o.APIv2;var s=e("./api/APIv3");r.APIv3=s.APIv3,n(e("./api/interfaces/interfaces"))},{"./api/APIv2":267,"./api/APIv2Call":268,"./api/APIv3":269,"./api/interfaces/interfaces":270}],252:[function(e,t,r){function n(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}var i=e("./component/Component");r.Component=i.Component;var o=e("./component/ComponentService");r.ComponentService=o.ComponentService;var s=e("./component/AttributionComponent");r.AttributionComponent=s.AttributionComponent;var a=e("./component/BackgroundComponent");r.BackgroundComponent=a.BackgroundComponent;var u=e("./component/CacheComponent");r.CacheComponent=u.CacheComponent;var c=e("./component/CoverComponent");r.CoverComponent=c.CoverComponent;var h=e("./component/DebugComponent");r.DebugComponent=h.DebugComponent;var l=e("./component/DetectionComponent");r.DetectionComponent=l.DetectionComponent;var p=e("./component/DirectionComponent");r.DirectionComponent=p.DirectionComponent;var f=e("./component/ImageComponent");r.ImageComponent=f.ImageComponent;var d=e("./component/KeyboardComponent");r.KeyboardComponent=d.KeyboardComponent;var m=e("./component/LoadingComponent");r.LoadingComponent=m.LoadingComponent;var v=e("./component/marker/Marker");r.Marker=v.Marker;var g=e("./component/marker/MarkerComponent");r.MarkerComponent=g.MarkerComponent;var y=e("./component/MouseComponent");r.MouseComponent=y.MouseComponent;var _=e("./component/NavigationComponent");r.NavigationComponent=_.NavigationComponent;var b=e("./component/NoneComponent");r.NoneComponent=b.NoneComponent;var x=e("./component/PlayerComponent");r.PlayerComponent=x.PlayerComponent;var w=e("./component/RouteComponent");r.RouteComponent=w.RouteComponent;var S=e("./component/SequenceComponent");r.SequenceComponent=S.SequenceComponent;var M=e("./component/SphereComponent");r.SphereComponent=M.SphereComponent;var E=e("./component/imageplane/ImagePlaneComponent");r.ImagePlaneComponent=E.ImagePlaneComponent;var C=e("./component/imageplane/ImagePlaneFactory");r.ImagePlaneFactory=C.ImagePlaneFactory;var T=e("./component/imageplane/ImagePlaneScene");r.ImagePlaneScene=T.ImagePlaneScene;var A=e("./component/imageplane/ImagePlaneShaders");r.ImagePlaneShaders=A.ImagePlaneShaders;var P=e("./component/imageplane/SliderComponent");r.SliderComponent=P.SliderComponent,n(e("./component/interfaces/interfaces"))},{"./component/AttributionComponent":271,"./component/BackgroundComponent":272,"./component/CacheComponent":273,"./component/Component":274,"./component/ComponentService":275,"./component/CoverComponent":276,"./component/DebugComponent":277,"./component/DetectionComponent":278,"./component/DirectionComponent":279,"./component/ImageComponent":280,"./component/KeyboardComponent":281,"./component/LoadingComponent":282,"./component/MouseComponent":283,"./component/NavigationComponent":284,"./component/NoneComponent":285,"./component/PlayerComponent":286,"./component/RouteComponent":287,"./component/SequenceComponent":288,"./component/SphereComponent":289,"./component/imageplane/ImagePlaneComponent":290,"./component/imageplane/ImagePlaneFactory":291,"./component/imageplane/ImagePlaneScene":292,"./component/imageplane/ImagePlaneShaders":293,"./component/imageplane/SliderComponent":294,"./component/interfaces/interfaces":295,"./component/marker/Marker":296,"./component/marker/MarkerComponent":297}],253:[function(e,t,r){function n(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}var i=e("./graph/edge/EdgeDirection");r.EdgeDirection=i.EdgeDirection;var o=e("./graph/edge/EdgeCalculatorSettings");r.EdgeCalculatorSettings=o.EdgeCalculatorSettings;var s=e("./graph/edge/EdgeCalculatorDirections");r.EdgeCalculatorDirections=s.EdgeCalculatorDirections;var a=e("./graph/edge/EdgeCalculatorCoefficients");r.EdgeCalculatorCoefficients=a.EdgeCalculatorCoefficients;var u=e("./graph/edge/EdgeCalculator");r.EdgeCalculator=u.EdgeCalculator,n(e("./graph/edge/interfaces/interfaces"))},{"./graph/edge/EdgeCalculator":318,"./graph/edge/EdgeCalculatorCoefficients":319,"./graph/edge/EdgeCalculatorDirections":320,"./graph/edge/EdgeCalculatorSettings":321,"./graph/edge/EdgeDirection":322,"./graph/edge/interfaces/interfaces":323}],254:[function(e,t,r){var n=e("./error/MoveTypeMapillaryError");r.MoveTypeMapillaryError=n.MoveTypeMapillaryError;var i=e("./error/NotImplementedMapillaryError");r.NotImplementedMapillaryError=i.NotImplementedMapillaryError;var o=e("./error/ParameterMapillaryError");r.ParameterMapillaryError=o.ParameterMapillaryError;var s=e("./error/InitializationMapillaryError");r.InitializationMapillaryError=s.InitializationMapillaryError},{"./error/InitializationMapillaryError":298,"./error/MoveTypeMapillaryError":300,"./error/NotImplementedMapillaryError":301,"./error/ParameterMapillaryError":302}],255:[function(e,t,r){function n(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}var i=e("./geo/GeoCoords");r.GeoCoords=i.GeoCoords;var o=e("./geo/GoogleTiles");r.GoogleTiles=o.GoogleTiles;var s=e("./geo/Spatial");r.Spatial=s.Spatial;var a=e("./geo/Transform");r.Transform=a.Transform;var u=e("./geo/Camera");r.Camera=u.Camera,n(e("./geo/interfaces/interfaces"))},{"./geo/Camera":303,"./geo/GeoCoords":304,"./geo/GoogleTiles":305,"./geo/Spatial":306,"./geo/Transform":307,"./geo/interfaces/interfaces":308}],256:[function(e,t,r){function n(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}var i=e("./graph/Graph");r.Graph=i.Graph;var o=e("./graph/GraphService");r.GraphService=o.GraphService;var s=e("./graph/ImageLoadingService");r.ImageLoadingService=s.ImageLoadingService;var a=e("./graph/MapillaryObject");r.MapillaryObject=a.MapillaryObject;var u=e("./graph/MapillaryRect");r.MapillaryRect=u.MapillaryRect;var c=e("./graph/Node");r.Node=c.Node;var h=e("./graph/Sequence");r.Sequence=h.Sequence;var l=e("./graph/TilesService");r.TilesService=l.TilesService;var p=e("./graph/VectorTilesService");r.VectorTilesService=p.VectorTilesService,n(e("./graph/interfaces/interfaces"))},{"./graph/Graph":309,"./graph/GraphService":310,"./graph/ImageLoadingService":311,"./graph/MapillaryObject":312,"./graph/MapillaryRect":313,"./graph/Node":314,"./graph/Sequence":315,"./graph/TilesService":316,"./graph/VectorTilesService":317,"./graph/interfaces/interfaces":324}],257:[function(e,t,r){var n=e("./Viewer");r.Viewer=n.Viewer,r.ImageSize=n.ImageSize;var i=e("./Edge");r.EdgeDirection=i.EdgeDirection},{"./Edge":253,"./Viewer":261}],258:[function(e,t,r){function n(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}var i=e("./render/DOMRenderer");r.DOMRenderer=i.DOMRenderer;var o=e("./render/GLRenderer");r.GLRenderer=o.GLRenderer;var s=e("./render/GLRenderMode");r.GLRenderMode=s.GLRenderMode;var a=e("./render/GLRenderStage");r.GLRenderStage=a.GLRenderStage,n(e("./render/interfaces/interfaces"))},{"./render/DOMRenderer":325,"./render/GLRenderMode":326,"./render/GLRenderStage":327,"./render/GLRenderer":328,"./render/interfaces/interfaces":329}],259:[function(e,t,r){function n(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}var i=e("./state/FrameGenerator");r.FrameGenerator=i.FrameGenerator;var o=e("./state/StateService");r.StateService=o.StateService;var s=e("./state/StateContext");r.StateContext=s.StateContext;var a=e("./state/State");r.State=a.State;var u=e("./state/states/StateBase");r.StateBase=u.StateBase;var c=e("./state/states/TraversingState");r.TraversingState=c.TraversingState;var h=e("./state/states/WaitingState");r.WaitingState=h.WaitingState,n(e("./state/interfaces/interfaces"))},{"./state/FrameGenerator":330,"./state/State":331,"./state/StateContext":332,"./state/StateService":333,"./state/interfaces/interfaces":334,"./state/states/StateBase":335,"./state/states/TraversingState":336,"./state/states/WaitingState":337}],260:[function(e,t,r){var n=e("./utils/EventEmitter");r.EventEmitter=n.EventEmitter;var i=e("./utils/Settings");r.Settings=i.Settings;var o=e("./utils/Urls");r.Urls=o.Urls},{"./utils/EventEmitter":338,"./utils/Settings":339,"./utils/Urls":340}],261:[function(e,t,r){function n(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}var i=e("./viewer/Container");r.Container=i.Container;var o=e("./viewer/EventLauncher");r.EventLauncher=o.EventLauncher;var s=e("./viewer/ImageSize");r.ImageSize=s.ImageSize;var a=e("./viewer/LoadingService");r.LoadingService=a.LoadingService;var u=e("./viewer/MouseService");r.MouseService=u.MouseService;var c=e("./viewer/Navigator");r.Navigator=c.Navigator;var h=e("./viewer/ComponentController");r.ComponentController=h.ComponentController;var l=e("./viewer/Viewer");r.Viewer=l.Viewer,n(e("./viewer/interfaces/interfaces"))},{"./viewer/ComponentController":341,
"./viewer/Container":342,"./viewer/EventLauncher":343,"./viewer/ImageSize":344,"./viewer/LoadingService":345,"./viewer/MouseService":346,"./viewer/Navigator":347,"./viewer/Viewer":348,"./viewer/interfaces/interfaces":349}],262:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("../API"),o=function(e){function t(){e.apply(this,arguments)}return n(t,e),t.prototype.callOr=function(e){return this.callApi("im/"+e+"/or")},t}(i.APIv2Call);r.APIIm=o,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o},{"../API":251}],263:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("../API"),o=function(e){function t(){e.apply(this,arguments)}return n(t,e),t.prototype.callNav=function(e){return this.callApi("nav/"+e)},t.prototype.h=function(e){return this.callNav("h/"+e)},t.prototype.im=function(e){return this.callNav("im/"+e)},t}(i.APIv2Call);r.APINav=o,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o},{"../API":251}],264:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("../API"),o=function(e){function t(){e.apply(this,arguments)}return n(t,e),t.prototype.callS=function(e){return this.callApi("s/"+e)},t.prototype.get=function(e){return this.callS(e)},t}(i.APIv2Call);r.APIS=o,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o},{"../API":251}],265:[function(e,t,r){var n=e("./APISearchIm"),i=function(){function e(e){this.clientId=e,this.im=new n["default"](e)}return e}();r.APISearch=i,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=i},{"./APISearchIm":266}],266:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("../API"),o=function(e){function t(){e.apply(this,arguments)}return n(t,e),t.prototype.callSearchIm=function(e){return this.callApi("search/im/"+e)},t.prototype.close2=function(e,t){return this.callSearchIm("close2?lat="+e+"&lon="+t)},t}(i.APIv2Call);r.APISearchIm=o,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o},{"../API":251}],267:[function(e,t,r){var n=e("./APIIm"),i=e("./APINav"),o=e("./APISearch"),s=e("./APIS"),a=function(){function e(e){this.clientId=e,this.im=new n["default"](e),this.nav=new i["default"](e),this.s=new s["default"](e),this.search=new o["default"](e)}return e}();r.APIv2=a,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=a},{"./APIIm":262,"./APINav":263,"./APIS":264,"./APISearch":265}],268:[function(e,t,r){var n=e("rest"),i=e("rest/interceptor/mime"),o=function(){function e(e){this.clientId=e,this.httpsUrl="https://a.mapillary.com/v2/",this.client=n.wrap(i)}return e.prototype.callApi=function(e){var t=this.httpsUrl+e;return t+=e.indexOf("?")>-1?"&client_id="+this.clientId:"?client_id="+this.clientId,this.client(t).entity()},e.vcr={},e}();r.APIv2Call=o,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o},{rest:173,"rest/interceptor/mime":178}],269:[function(e,t,r){var n=e("falcor"),i=e("falcor-http-datasource"),o=e("../Utils"),s=function(){function e(e){this._clientId=e,this._model=new n.Model({source:new i(o.Urls.falcorModel(e),{crossDomain:!0,withCredentials:!1})})}return Object.defineProperty(e.prototype,"model",{get:function(){return this._model},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clientId",{get:function(){return this._clientId},enumerable:!0,configurable:!0}),e}();r.APIv3=s,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=s},{"../Utils":260,falcor:40,"falcor-http-datasource":4}],270:[function(e,t,r){},{}],271:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("virtual-dom"),o=e("../Component"),s=function(e){function t(t,r,n){e.call(this,t,r,n)}return n(t,e),t.prototype._activate=function(){var e=this;this._disposable=this._navigator.stateService.currentNode$.map(function(t){return{name:e._name,vnode:e.getAttributionNode(t.user,t.key)}}).subscribe(this._container.domRenderer.render$)},t.prototype._deactivate=function(){this._disposable.dispose()},t.prototype.getAttributionNode=function(e,t){return i.h("div.Attribution",{},[i.h("a",{href:"https://www.mapillary.com/profile/"+e,target:"_blank",textContent:"@"+e},[]),i.h("span",{textContent:"|"},[]),i.h("a",{href:"https://www.mapillary.com/map/im/"+t+"/photo",target:"_blank",textContent:"mapillary.com"},[])])},t.componentName="attribution",t}(o.Component);r.AttributionComponent=s,o.ComponentService.register(s),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=s},{"../Component":252,"virtual-dom":202}],272:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("virtual-dom"),o=e("../Component"),s=function(e){function t(t,r,n){e.call(this,t,r,n)}return n(t,e),t.prototype._activate=function(){this._container.domRenderer.render$.onNext({name:this._name,vnode:this.getBackgroundNode("The viewer can't display the given photo.")})},t.prototype._deactivate=function(){},t.prototype.getBackgroundNode=function(e){return i.h("div.BackgroundWrapper",{},[i.h("p",{textContent:e},[])])},t.componentName="background",t}(o.Component);r.BackgroundComponent=s,o.ComponentService.register(s),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=s},{"../Component":252,"virtual-dom":202}],273:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("underscore"),o=e("../Edge"),s=e("../Component"),a=function(e){function t(t,r,n){e.call(this,t,r,n)}return n(t,e),t.prototype._activate=function(){var e=this;this._disposable=this._navigator.stateService.currentNode$.subscribe(function(t){i.map(t.edges,function(t){t.data.direction===o.EdgeDirection.Next&&e._navigator.graphService.node$(t.to).first().subscribe(function(t){i.map(t.edges,function(t){t.data.direction===o.EdgeDirection.Next&&e._navigator.graphService.node$(t.to).first().subscribe()})}),t.data.direction===o.EdgeDirection.Prev&&e._navigator.graphService.node$(t.to).first().subscribe(function(t){i.map(t.edges,function(t){t.data.direction===o.EdgeDirection.Prev&&e._navigator.graphService.node$(t.to).first().subscribe()})})})})},t.prototype._deactivate=function(){this._disposable.dispose()},t.componentName="cache",t}(s.Component);r.CacheComponent=a,s.ComponentService.register(a),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=a},{"../Component":252,"../Edge":253,underscore:197}],274:[function(e,t,r){var n=e("rx"),i=function(){function e(e,t,r){this._activated$=new n.BehaviorSubject(!1),this._configurationSubject$=new n.Subject,this._navigator=r,this._container=t,this._activated=!1,this._name=e,this._configuration$=this._configurationSubject$.scan(function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}).shareReplay(1),this._configuration$.subscribe()}return e.prototype.activate=function(e){this._activated||(void 0===e?this._configurationSubject$.onNext(this.defaultConfiguration):this._configurationSubject$.onNext(e),this._activate(),this._activated=!0,this._activated$.onNext(!0))},e.prototype.deactivate=function(){this._activated&&(this._container.domRenderer.clear(this._name),this._container.glRenderer.clear(this._name),this._deactivate(),this._activated=!1,this._activated$.onNext(!1))},Object.defineProperty(e.prototype,"activated",{get:function(){return this._activated},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activated$",{get:function(){return this._activated$},enumerable:!0,configurable:!0}),e.prototype.configure=function(e){this._configurationSubject$.onNext(e)},Object.defineProperty(e.prototype,"defaultConfiguration",{get:function(){return{}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"configuration$",{get:function(){return this._configuration$},enumerable:!0,configurable:!0}),e.componentName="not_worthy",e}();r.Component=i,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=i},{rx:195}],275:[function(e,t,r){var n=e("../Error"),i=e("underscore"),o=function(){function e(t,r){this._components={},this._container=t,this._navigator=r;for(var n=0,o=i.values(e.registeredComponents);n<o.length;n++){var s=o[n];this._components[s.componentName]={active:!1,component:new s(s.componentName,t,r)}}this._coverComponent=new e.registeredCoverComponent("cover",t,r),this._coverComponent.activate(),this._coverActivated=!0}return e.register=function(t){void 0===e.registeredComponents[t.componentName]&&(e.registeredComponents[t.componentName]=t)},e.registerCover=function(t){e.registeredCoverComponent=t},e.prototype.activateCover=function(){if(!this._coverActivated){this._coverActivated=!0;for(var e=0,t=i.values(this._components);e<t.length;e++){var r=t[e];r.active&&r.component.deactivate()}}},e.prototype.deactivateCover=function(){if(this._coverActivated){this._coverActivated=!1;for(var e=0,t=i.values(this._components);e<t.length;e++){var r=t[e];r.active&&r.component.activate()}}},e.prototype.activate=function(e){this.checkName(e),this._components[e].active=!0,this._coverActivated||this.get(e).activate()},e.prototype.configure=function(e,t){this.checkName(e),this.get(e).configure(t)},e.prototype.deactivate=function(e){this.checkName(e),this._components[e].active=!1,this._coverActivated||this.get(e).deactivate()},e.prototype.get=function(e){return this._components[e].component},e.prototype.getCover=function(){return this._coverComponent},e.prototype.checkName=function(e){if(!(e in this._components))throw new n.ParameterMapillaryError("Component does not exist: "+e)},e.registeredComponents={},e}();r.ComponentService=o,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o},{"../Error":254,underscore:197}],276:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("virtual-dom"),o=e("../Component"),s=function(e){function t(t,r,n){e.call(this,t,r,n)}return n(t,e),t.prototype._activate=function(){var e=this;this._keyDisposable=this._navigator.stateService.currentNode$.map(function(e){return{key:e.key}}).subscribe(this._configurationSubject$),this._disposable=this._configuration$.map(function(t){return t.key?t.visible?{name:e._name,vnode:e.getCoverButtonVNode(t)}:{name:e._name,vnode:i.h("div.Cover.CoverDone",[e.getCoverBackgroundVNode(t)])}:{name:e._name,vnode:i.h("div",[])}}).subscribe(this._container.domRenderer.render$)},t.prototype._deactivate=function(){this._disposable.dispose(),this._keyDisposable.dispose()},Object.defineProperty(t.prototype,"defaultConfiguration",{get:function(){return{loading:!1,visible:!0}},enumerable:!0,configurable:!0}),t.prototype.getCoverButtonVNode=function(e){var t=this,r="span.CoverButtonIcon",n=[];return e.loading&&(r="div.uil-ripple-css",n.push(i.h("div",{},[]))),i.h("div.Cover",[this.getCoverBackgroundVNode(e),i.h("button.CoverButton",{onclick:function(){t.configure({loading:!0})}},[i.h(r,{},n)])])},t.prototype.getCoverBackgroundVNode=function(e){var t="url(https://d1cuyjsrcm0gby.cloudfront.net/"+e.key+"/thumb-320.jpg)";return i.h("div.CoverBackground",{style:{backgroundImage:t}},[])},t.componentName="cover",t}(o.Component);r.CoverComponent=s,o.ComponentService.registerCover(s),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=s},{"../Component":252,"virtual-dom":202}],277:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("underscore"),o=e("rx"),s=e("virtual-dom"),a=e("../Component"),u=function(e){function t(t,r,n){e.call(this,t,r,n),this._open$=new o.BehaviorSubject(!1),this._displaying=!1}return n(t,e),t.prototype._activate=function(){var e=this;this._disposable=this._navigator.stateService.currentState$.combineLatest(this._open$,this._navigator.graphService.imageLoadingService.loadstatus$,function(t,r,n){return{name:e._name,vnode:e._getDebugVNode(r,e._getDebugInfo(t,n))}}).subscribe(this._container.domRenderer.render$)},t.prototype._deactivate=function(){this._disposable.dispose()},t.prototype._getDebugInfo=function(e,t){var r=[];r.push(s.h("h2","Node")),e.state.currentNode&&r.push(s.h("p","currentNode: "+e.state.currentNode.key)),e.state.previousNode&&r.push(s.h("p","previousNode: "+e.state.previousNode.key)),r.push(s.h("h2","Loading"));for(var n=0,o=0,a=0,u=0,c=i.values(t);u<c.length;u++){var h=c[u];n+=h.loaded,h.loaded!==h.total?a++:o++}return r.push(s.h("p","Loaded Images: "+o)),r.push(s.h("p","Loading Images: "+a)),r.push(s.h("p","Total bytes loaded: "+n)),r.push(s.h("h2","Camera")),r.push(s.h("p","camera.position.x: "+e.state.camera.position.x)),r.push(s.h("p","camera.position.y: "+e.state.camera.position.y)),r.push(s.h("p","camera.position.z: "+e.state.camera.position.z)),r.push(s.h("p","camera.lookat.x: "+e.state.camera.lookat.x)),r.push(s.h("p","camera.lookat.y: "+e.state.camera.lookat.y)),r.push(s.h("p","camera.lookat.z: "+e.state.camera.lookat.z)),r.push(s.h("p","camera.up.x: "+e.state.camera.up.x)),r.push(s.h("p","camera.up.y: "+e.state.camera.up.y)),r.push(s.h("p","camera.up.z: "+e.state.camera.up.z)),r},t.prototype._getDebugVNode=function(e,t){return e?s.h("div.Debug",{},[s.h("h2",{},["Debug"]),this._getDebugVNodeButton(e),s.h("pre",{},t)]):this._getDebugVNodeButton(e)},t.prototype._getDebugVNodeButton=function(e){var t=e?"Disable Debug":"D",r=e?"":".DebugButtonFixed";return e?s.h("button.DebugButton"+r,{onclick:this._closeDebugElement.bind(this)},[t]):s.h("button.DebugButton"+r,{onclick:this._openDebugElement.bind(this)},[t])},t.prototype._closeDebugElement=function(e){this._open$.onNext(!1)},t.prototype._openDebugElement=function(){this._open$.onNext(!0)},t.componentName="debug",t}(a.Component);r.DebugComponent=u,a.ComponentService.register(u),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=u},{"../Component":252,rx:195,underscore:197,"virtual-dom":202}],278:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("virtual-dom"),o=e("../Component"),s=function(e){function t(t,r,n){e.call(this,t,r,n),this.apiV3=n.apiV3}return n(t,e),t.prototype._activate=function(){var e=this;this._disposable=this._navigator.stateService.currentNode$.flatMap(function(t){return e.apiV3.model.get(["imageByKey",t.key,"ors",{from:0,to:20},["key","obj","rect","value","package","score"]])}).map(function(t){var r=[];delete t.json.imageByKey.$__path,t=t.json.imageByKey[Object.keys(t.json.imageByKey)[0]].ors,delete t.$__path;for(var n in t)if(t.hasOwnProperty(n)){if(n=t[n],!n)continue;var i=[];i[0]=n.rect.geometry.coordinates[1][0],i[1]=n.rect.geometry.coordinates[1][1],i[2]=n.rect.geometry.coordinates[3][0],i[3]=n.rect.geometry.coordinates[3][1];var o={key:n.key,object:n.obj,"package":n["package"],rect:i,score:n.score,value:n.value};r.push(o)}return{name:e._name,vnode:e.getRects(r)}}).subscribe(this._container.domRenderer.render$)},t.prototype._deactivate=function(){this._disposable.dispose()},t.prototype.getRects=function(e){var t=this,r=[];return e.forEach(function(e){var n=t.coordsToCss(e.rect),o=n.map(function(e){return 100*e+"%"});r.push(i.h("div.Rect",{style:t.getRectStyle(o)},[i.h("span",{style:"color: red;",textContent:e.value},[])]))}),i.h("div.rectContainer",{},r)},t.prototype.coordsToCss=function(e){var t=e.concat();return t[2]=1-t[2],t[3]=1-t[3],t},t.prototype.getRectStyle=function(e){return"top:"+e[1]+"; bottom:"+e[3]+"; right:"+e[2]+"; left:"+e[0]},t.componentName="detection",t}(o.Component);r.DetectionComponent=s,o.ComponentService.register(s),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=s},{"../Component":252,"virtual-dom":202}],279:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("virtual-dom"),o=e("../Edge"),s=e("../Geo"),a=e("../Component"),u=function(e){function t(t,r,n){e.call(this,t,r,n),this.arrowOffset=62,this.innerArrowOffset=25,this.dropShadowOffset=3,this.steps=[o.EdgeDirection.StepForward,o.EdgeDirection.StepBackward,o.EdgeDirection.StepLeft,o.EdgeDirection.StepRight],this.turns=[o.EdgeDirection.TurnLeft,o.EdgeDirection.TurnRight,o.EdgeDirection.TurnU],this.turnNames={},this.turnNames[o.EdgeDirection.TurnLeft]="TurnLeft",this.turnNames[o.EdgeDirection.TurnRight]="TurnRight",this.turnNames[o.EdgeDirection.TurnU]="TurnAround"}return n(t,e),t.prototype._activate=function(){var e=this;this.spatial=new s.Spatial,this.currentKey=null,this.currentPlaneRotation=0,this.currentUpRotation=0,this.rotationEpsilon=.5*Math.PI/180,this._disposable=this._navigator.stateService.currentState$.map(function(t){var r=t.state.currentNode,n=t.state.camera,i=n.lookat.clone().sub(n.position),o=Math.atan2(i.y,i.x),s=e.spatial.angleToPlane(i.toArray(),[0,0,1]);if(null==r||r.key===e.currentKey&&Math.abs(e.currentPlaneRotation-o)<e.rotationEpsilon&&Math.abs(e.currentUpRotation-s)<e.rotationEpsilon)return null;e.currentKey=r.key,e.currentPlaneRotation=o,e.currentUpRotation=s;var a=e.rotationFromCamera(t.state.camera),u=15*Math.PI/32-a.theta,c=Math.min(.8,Math.max(.6,-1.8*u/Math.PI+.8)),h=[],l=[];return r.pano?h=h.concat(e.createPanoArrows(r,a,c)):(h=h.concat(e.createPerspectiveToPanoArrows(r,a,c)),h=h.concat(e.createStepArrows(r,a,c)),l=l.concat(e.createTurnArrows(r))),{name:e._name,vnode:e.getVNodeContainer(h,l,a,r.pano)}}).filter(function(e){return null!=e}).subscribe(this._container.domRenderer.render$)},t.prototype._deactivate=function(){this._disposable.dispose()},t.prototype.createStepArrows=function(e,t,r){for(var n=[],i=0,o=e.edges;i<o.length;i++){var s=o[i],a=s.data.direction;-1!==this.steps.indexOf(a)&&n.push(this.createVNodeByDirection(s.data.worldMotionAzimuth,t,r,a))}return n},t.prototype.createPerspectiveToPanoArrows=function(e,t,r){for(var n=[],i=0,s=e.edges;i<s.length;i++){var a=s[i];a.data.direction===o.EdgeDirection.Pano&&n.push(this.createVNodeByKey(a.data.worldMotionAzimuth,t,r,this.innerArrowOffset,a.to,"DirectionsArrowPano"))}return n},t.prototype.createPanoArrows=function(e,t,r){for(var n=[],i=0,s=e.edges;i<s.length;i++){var a=s[i],u=a.data.direction;u===o.EdgeDirection.Pano?n.push(this.createVNodeByKey(a.data.worldMotionAzimuth,t,r,this.arrowOffset,a.to,"DirectionsArrowPano")):this.steps.indexOf(u)>-1&&n.push(this.createPanoToPerspectiveArrow(a.data.worldMotionAzimuth,t,r,u,a.to))}return n},t.prototype.createTurnArrows=function(e){for(var t=[],r=0,n=e.edges;r<n.length;r++){var i=n[r],o=i.data.direction,s=this.turnNames[o];if(-1!==this.turns.indexOf(o)){var a={};"TurnRight"===s?a.transform="perspective(375px) rotateX(60deg) scaleX(-1)":"TurnLeft"===s?a.transform="perspective(375px) rotateX(60deg)":"TurnAround"===s&&(a.transform="perspective(375px) rotateX(60deg) rotate(270deg) scale(1.15, 1.15)"),t.push(this.createVNodeByTurn(s,o,a))}}return t},t.prototype.createPanoToPerspectiveArrow=function(e,t,r,n,i){var s=Math.PI/8,a=t.phi;switch(n){case o.EdgeDirection.StepBackward:a=t.phi-Math.PI;break;case o.EdgeDirection.StepLeft:a=t.phi+Math.PI/2;break;case o.EdgeDirection.StepRight:a=t.phi-Math.PI/2}return Math.abs(this.spatial.wrapAngle(e-a))<s?this.createVNodeByKey(e,t,r,this.arrowOffset,i,"DirectionsArrowStep"):this.createVNodeDisabled(e,t)},t.prototype.rotationFromCamera=function(e){var t=e.lookat.clone().sub(e.position),r=t.clone().dot(e.up),n=t.clone().sub(e.up.clone().multiplyScalar(r)),i=Math.atan2(n.y,n.x),o=Math.PI/2-this.spatial.angleToPlane(t.toArray(),[0,0,1]);return{phi:i,theta:o}},t.prototype.calcTranslation=function(e){return[Math.cos(e),Math.sin(e)]},t.prototype.calcShadowTranslation=function(e,t){var r=this.spatial.wrapAngle(e-t);return this.calcTranslation(r)},t.prototype.createVNodeByKey=function(e,t,r,n,i,o){var s=this,a=function(e){s._navigator.moveToKey(i).subscribe()};return this.createVNode(e,t,r,n,o,a)},t.prototype.createVNodeDisabled=function(e,t){return this.createVNode(e,t,.2,this.arrowOffset,"DirectionsArrowDisabled")},t.prototype.createVNodeByDirection=function(e,t,r,n){var i=this,o=function(e){i._navigator.moveDir(n).subscribe()};return this.createVNode(e,t,r,this.arrowOffset,"DirectionsArrowStep",o)},t.prototype.createVNodeByTurn=function(e,t,r){var n=this,o=function(e){n._navigator.moveDir(t).subscribe()};return i.h("div."+e,{onclick:o,style:r},[])},t.prototype.createVNode=function(e,t,r,n,o,s){var a=this.calcTranslation(e),u=-n*a[1],c=-n*a[0],h=this.calcShadowTranslation(e,t.phi),l=-this.dropShadowOffset*h[1],p=this.dropShadowOffset*h[0],f=-this.spatial.radToDeg(e),d="drop-shadow("+l+"px "+p+"px 1px rgba(0,0,0,0.8))",m="translate("+u+"px, "+c+"px) rotate("+f+"deg)",v={style:{"-webkit-filter":d,filter:d,opacity:""+r,transform:m}};return null!=s&&(v.onclick=s),i.h("div."+o,v,[])},t.prototype.getVNodePanoIndication=function(e){return e?i.h("div.PanoIndication",{},[]):void 0},t.prototype.getVNodeContainer=function(e,t,r,n){var o=this.spatial.radToDeg(r.phi),s={transform:"perspective(375px) rotateX(60deg) rotateZ("+o+"deg)"};return i.h("div",{},[this.getVNodePanoIndication(n),i.h("div.DirectionsWrapper",{},[t,i.h("div.Directions",{style:s},e)])])},t.componentName="direction",t}(a.Component);r.DirectionComponent=u,a.ComponentService.register(u),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=u},{"../Component":252,"../Edge":253,"../Geo":255,"virtual-dom":202}],280:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("virtual-dom"),o=e("../Component"),s=function(e){function t(t,r,n){e.call(this,t,r,n),this.canvasId=r.id+"-"+this._name}return n(t,e),t.prototype._activate=function(){var e=this;this._disposable=this._container.domRenderer.element$.combineLatest(this._navigator.stateService.currentNode$,function(t,r){var n=document.getElementById(e.canvasId);return{canvas:n,node:r}}).subscribe(function(t){var r=t.canvas,n=t.node;if(!n||!r)return null;var i=r.getContext("2d"),o=e._container.element.clientWidth,s=e._container.element.clientHeight;i.fillStyle="black",i.fillRect(0,0,o,s);var a=n.image.height,u=n.image.width,c=s/a*u,h=(o-c)/2;r.width=o,r.height=s,i.drawImage(n.image,h,0,c,s)}),this._container.domRenderer.render$.onNext({name:this._name,vnode:i.h("canvas#"+this.canvasId,[])})},t.prototype._deactivate=function(){this._disposable.dispose()},t.componentName="image",t}(o.Component);r.ImageComponent=s,o.ComponentService.register(s),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=s},{"../Component":252,"virtual-dom":202}],281:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("rx"),o=e("../Edge"),s=e("../Component"),a=e("../Geo"),u=function(e){function t(t,r,n){e.call(this,t,r,n),this._spatial=new a.Spatial,this._perspectiveDirections=[o.EdgeDirection.StepForward,o.EdgeDirection.StepBackward,o.EdgeDirection.StepLeft,o.EdgeDirection.StepRight,o.EdgeDirection.TurnLeft,o.EdgeDirection.TurnRight,o.EdgeDirection.TurnU]}return n(t,e),t.prototype._activate=function(){var e=this;this._disposable=i.Observable.fromEvent(document,"keydown").withLatestFrom(this._navigator.stateService.currentState$,function(e,t){return{event:e,frame:t}}).subscribe(function(t){t.frame.state.currentNode.pano?e._navigatePanorama(t.event,t.frame.state.currentNode,t.frame.state.camera):e._navigatePerspective(t.event,t.frame.state.currentNode)})},t.prototype._deactivate=function(){this._disposable.dispose()},t.prototype._navigatePanorama=function(e,t,r){var n=0,i=null,s=null,a=this._rotationFromCamera(r).phi;switch(e.keyCode){case 37:n=Math.PI/2+a,i=o.EdgeDirection.StepLeft;break;case 38:if(e.altKey){s=o.EdgeDirection.Next;break}n=a,i=o.EdgeDirection.StepForward;break;case 39:n=-Math.PI/2+a,i=o.EdgeDirection.StepRight;break;case 40:if(e.altKey){s=o.EdgeDirection.Prev;break}n=Math.PI+a,i=o.EdgeDirection.StepBackward;break;default:return}if(e.preventDefault(),null!=s)return void this._moveDir(s,t);n=this._spatial.wrapAngle(n);for(var u=Math.PI/4,c=t.edges.filter(function(e){return e.data.direction===o.EdgeDirection.Pano||e.data.direction===i}),h=Number.MAX_VALUE,l=null,p=0;p<c.length;p++){var f=c[p],d=Math.abs(this._spatial.wrapAngle(f.data.worldMotionAzimuth-n));d<Math.min(h,u)&&(h=d,l=f.to)}null!=l&&this._navigator.moveToKey(l).subscribe(function(e){},function(e){console.error(e)})},t.prototype._rotationFromCamera=function(e){var t=e.lookat.clone().sub(e.position),r=t.clone().dot(e.up),n=t.clone().sub(e.up.clone().multiplyScalar(r)),i=Math.atan2(n.y,n.x),o=Math.PI/2-this._spatial.angleToPlane(t.toArray(),[0,0,1]);return{phi:i,theta:o}},t.prototype._navigatePerspective=function(e,t){var r=null;switch(e.keyCode){case 37:r=e.shiftKey?o.EdgeDirection.TurnLeft:o.EdgeDirection.StepLeft;break;case 38:if(e.altKey){r=o.EdgeDirection.Next;break}r=e.shiftKey?o.EdgeDirection.Pano:o.EdgeDirection.StepForward;break;case 39:r=e.shiftKey?o.EdgeDirection.TurnRight:o.EdgeDirection.StepRight;break;case 40:if(e.altKey){r=o.EdgeDirection.Prev;break}r=e.shiftKey?o.EdgeDirection.TurnU:o.EdgeDirection.StepBackward;break;default:return}e.preventDefault(),this._moveDir(r,t)},t.prototype._moveDir=function(e,t){var r=t.edges.some(function(t){return t.data.direction===e});r&&this._navigator.moveDir(e).subscribe(function(e){},function(e){console.error(e)})},t.componentName="keyboard",t}(s.Component);r.KeyboardComponent=u,s.ComponentService.register(u),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=u},{"../Component":252,"../Edge":253,"../Geo":255,rx:195}],282:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("underscore"),o=e("virtual-dom"),s=e("../Component"),a=function(e){function t(t,r,n){e.call(this,t,r,n)}return n(t,e),t.prototype._activate=function(){var e=this;this._disposable=this._navigator.loadingService.loading$.combineLatest(this._navigator.graphService.imageLoadingService.loadstatus$,function(t,r){if(!t)return{name:"loading",vnode:e.getBarVNode(100)};for(var n=0,o=0,s=0,a=i.values(r);s<a.length;s++){var u=a[s];u.loaded!==u.total&&(o+=u.loaded,n+=u.total)}var c=100;return 0!==n&&(c=o/n*100),{name:e._name,vnode:e.getBarVNode(c)}}).subscribe(this._container.domRenderer.render$)},t.prototype._deactivate=function(){this._disposable.dispose()},t.prototype.getBarVNode=function(e){var t={},r={};return 100!==e?(t.width=e.toFixed(0)+"%",t.opacity="1"):(t.width="100%",t.opacity="0"),o.h("div.Loading",{style:r},[o.h("div.LoadingBar",{style:t},[])])},t.componentName="loading",t}(s.Component);r.LoadingComponent=a,s.ComponentService.register(a),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=a},{"../Component":252,underscore:197,"virtual-dom":202}],283:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("../Component"),o=function(e){function t(t,r,n){e.call(this,t,r,n)}return n(t,e),t.prototype._activate=function(){var e=this;this._container.mouseService.claimMouse(this._name,0),this._mouseDragSubscription=this._container.mouseService.filteredMouseEvent$(this._name,this._container.mouseService.mouseDrag$).subscribe(function(t){var r=t.e,n=e._container.element.offsetWidth,i=e._container.element.offsetHeight,o=Math.max(n,i),s=Math.max(2/3,n/o),a=Math.max(2/3,i/o),u=3*Math.PI/4,c=s*u*r.movementX/o,h=-a*u*r.movementY/o;e._navigator.stateService.rotate({phi:c,theta:h})})},t.prototype._deactivate=function(){this._container.mouseService.unclaimMouse(this._name),this._mouseDragSubscription.dispose()},t.componentName="mouse",t}(i.Component);r.MouseComponent=o,i.ComponentService.register(o),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o},{"../Component":252}],284:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("virtual-dom"),o=e("../Edge"),s=e("../Component"),a=function(e){function t(t,r,n){e.call(this,t,r,n),this._dirNames={},this._dirNames[o.EdgeDirection.StepForward]="Forward",this._dirNames[o.EdgeDirection.StepBackward]="Backward",this._dirNames[o.EdgeDirection.StepLeft]="Left",this._dirNames[o.EdgeDirection.StepRight]="Right",this._dirNames[o.EdgeDirection.TurnLeft]="Turnleft",this._dirNames[o.EdgeDirection.TurnRight]="Turnright",this._dirNames[o.EdgeDirection.TurnU]="Turnaround"}return n(t,e),t.prototype._activate=function(){var e=this;this._disposable=this._navigator.stateService.currentNode$.map(function(t){for(var r=[],n=0,o=t.edges;n<o.length;n++){var s=o[n],a=s.data.direction,u=e._dirNames[a];null!=u&&r.push(e.createVNode(a,u))}return{name:e._name,vnode:i.h("div.NavigationComponent",r)}}).subscribe(this._container.domRenderer.render$)},t.prototype._deactivate=function(){this._disposable.dispose()},t.prototype.createVNode=function(e,t){var r=this;return i.h("span.btn.Direction.Direction"+t,{onclick:function(t){r._navigator.moveDir(e).first().subscribe()}},[])},t.componentName="navigation",t}(s.Component);r.NavigationComponent=a,s.ComponentService.register(a),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=a},{"../Component":252,"../Edge":253,"virtual-dom":202}],285:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("../Component"),o=function(e){function t(){e.apply(this,arguments)}return n(t,e),t.prototype._activate=function(){},t.prototype._deactivate=function(){},t.componentName="none",t}(i.Component);r.NoneComponent=o,i.ComponentService.register(o),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o},{"../Component":252}],286:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("rx"),o=e("../Edge"),s=e("../Component"),a=function(e){function t(t,r,n){e.call(this,t,r,n),this._configurationOperation$=new i.Subject,this._stop$=new i.Subject,this.nodesAhead=5}return n(t,e),t.prototype._activate=function(){var e=this;this._configurationSubscription=this._configurationOperation$.scan(function(e,t){return t(e)},{playing:!1})["finally"](function(){null!=e._playingSubscription&&(e._navigator.stateService.cutNodes(),e._stop())}).subscribe(),this._configuration$.map(function(t){
return function(r){return t.playing!==r.playing&&(e._navigator.stateService.cutNodes(),t.playing?e._play():e._stop()),r.playing=t.playing,r}}).subscribe(this._configurationOperation$),this._stop$.map(function(){return function(t){return t.playing&&e._stop(),t.playing=!1,t}}).subscribe(this._configurationOperation$)},t.prototype._deactivate=function(){this.stop(),this._configurationSubscription.dispose()},Object.defineProperty(t.prototype,"defaultConfiguration",{get:function(){return{playing:!1}},enumerable:!0,configurable:!0}),t.prototype.play=function(){this.configure({playing:!0})},t.prototype.stop=function(){this.configure({playing:!1})},t.prototype._play=function(){var e=this;this._playingSubscription=this._navigator.stateService.currentState$.filter(function(e){return e.id%5===0}).filter(function(t){return t.state.nodesAhead<e.nodesAhead}).distinctUntilChanged(function(e){return e.state.lastNode.key}).map(function(e){return e.state.lastNode}).selectMany(function(t){return e._navigator.graphService.nextNode$(t,o.EdgeDirection.Next).withLatestFrom(e._navigator.stateService.currentState$,function(e,t){return{last:t.state.lastNode,next:e}}).first().filter(function(e){return e.last.key===t.key}).map(function(e){return e.next})}).subscribe(function(t){e._navigator.stateService.appendNodes([t])},function(t){e._stop$.onNext(null)})},t.prototype._stop=function(){this._playingSubscription.dispose(),this._playingSubscription=null},t.componentName="player",t}(s.Component);r.PlayerComponent=a,s.ComponentService.register(a),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=a},{"../Component":252,"../Edge":253,rx:195}],287:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("underscore"),o=e("rx"),s=e("virtual-dom"),a=e("../Component"),u=function(){function e(){}return e}(),c=function(){function e(){}return e}(),h=function(){function e(){this.nodeInstructions=[],this.nodeInstructionsOrdered=[]}return e}(),l=function(e){function t(t,r,n){e.call(this,t,r,n)}return n(t,e),t.prototype._activate=function(){var e,t=this;e=this._navigator.stateService.currentState$.filter(function(e){return e.id%2===0}).filter(function(e){return e.state.nodesAhead<15}).distinctUntilChanged(function(e){return e.state.lastNode.key});var r;r=this.configuration$.selectMany(function(e){return o.Observable.from(e.paths)}).distinct(function(e){return e.sequenceKey}).flatMap(function(e){return o.Observable.fromPromise(t._navigator.apiV2.s.get(e.sequenceKey))}).combineLatest(this.configuration$,function(e,t){for(var r=0,n=[],i=0,o=t.paths;i<o.length;i++){var s=o[i];if(s.sequenceKey===e.key){for(var a=[],u=!1,c=0,h=e.keys;c<h.length;c++){var l=h[c];if(s.startKey===l&&(u=!0),u){for(var p=null,f=0,d=s.infoKeys;f<d.length;f++){var m=d[f];m.key===l&&(p=m.description)}a.push({description:p,key:l})}s.stopKey===l&&(u=!1)}n.push({nodeInstructions:a,place:r})}r++}return n}).scan(function(e,t){for(var r=0;r<t.length;r++){var n=t[r];e.nodeInstructionsOrdered[n.place]=n.nodeInstructions}return e.nodeInstructions=i.flatten(e.nodeInstructionsOrdered),e},new h),this._disposable=e.combineLatest(r,this.configuration$,function(e,t,r){return{conf:r,frame:e,routeTrack:t}}).scan(function(e,r){return void 0===r.conf.playing||r.conf.playing?(e.routeTrack=r.routeTrack,e.currentNode=r.frame.state.currentNode,e.lastNode=r.frame.state.lastNode,e.playing=!0):(t._navigator.stateService.cutNodes(),e.playing=!1),e},new c).filter(function(e){return e.playing}).filter(function(e){for(var t=0,r=e.routeTrack.nodeInstructions;t<r.length;t++){var n=r[t];if(n&&n.key===e.lastNode.key)return!0}return!1}).distinctUntilChanged(function(e){return e.lastNode.key}).selectMany(function(e){for(var r=0,n=0,i=e.routeTrack.nodeInstructions;n<i.length;n++){var s=i[n];if(s.key===e.lastNode.key)break;r++}var a=e.routeTrack.nodeInstructions[r+1];return a?t._navigator.graphService.node$(a.key):o.Observable.just(null)}).combineLatest(this.configuration$,function(e,t){return{conf:t,node:e}}).filter(function(e){return null!==e.node&&e.conf.playing}).pluck("node").subscribe(this._navigator.stateService.appendNode$),this._disposableDescription=this._navigator.stateService.currentNode$.combineLatest(r,this.configuration$,function(e,t,r){if(void 0!==r.playing&&!r.playing)return"quit";for(var n=null,i=0,o=t.nodeInstructions;i<o.length;i++){var s=o[i];if(s.key===e.key){n=s.description;break}}return n}).scan(function(e,t){return t!==e.description&&null!==t?(e.description=t,e.showsLeft=6):e.showsLeft--,"quit"===t&&(e.description=null),e},new u).map(function(e){return e.showsLeft>0&&e.description?{name:t._name,vnode:t.getRouteAnnotationNode(e.description)}:{name:t._name,vnode:s.h("div",[])}}).subscribe(this._container.domRenderer.render$)},t.prototype._deactivate=function(){this._disposable.dispose(),this._disposableDescription.dispose()},t.prototype.play=function(){this.configure({playing:!0})},t.prototype.stop=function(){this.configure({playing:!1})},t.prototype.getRouteAnnotationNode=function(e){return s.h("div.RouteFrame",{},[s.h("p",{textContent:e},[])])},t.componentName="route",t}(a.Component);r.RouteComponent=l,a.ComponentService.register(l),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=l},{"../Component":252,rx:195,underscore:197,"virtual-dom":202}],288:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("virtual-dom"),o=e("../Component"),s=e("../Edge"),a=function(e){function t(t,r,n){e.call(this,t,r,n)}return n(t,e),t.prototype._activate=function(){var e=this;this._nodeSubscription=this._navigator.stateService.currentNode$.map(function(t){var r=e._createSequenceArrows(t);return{name:e._name,vnode:e._getVNodeContainer(r)}}).subscribe(this._container.domRenderer.render$)},t.prototype._deactivate=function(){this._nodeSubscription.dispose()},t.prototype._createSequenceArrows=function(e){for(var t=this,r=!1,n=!1,o=0,a=e.edges;o<a.length;o++){var u=a[o];u.data.direction===s.EdgeDirection.Next&&(r=!0),u.data.direction===s.EdgeDirection.Prev&&(n=!0)}var c="div.NextInSeq"+(r?"":".InSeqDisabled"),h="div.PrevInSeq"+(n?"":".InSeqDisabled"),l=r?{onclick:function(e){t._navigator.moveDir(s.EdgeDirection.Next).subscribe()}}:{},p=n?{onclick:function(e){t._navigator.moveDir(s.EdgeDirection.Prev).subscribe()}}:{};return[i.h(c,l,[]),i.h(h,p,[])]},t.prototype._getVNodeContainer=function(e){return i.h("div",{},[i.h("div.InSeq",{},e)])},t.componentName="sequence",t}(o.Component);r.SequenceComponent=a,o.ComponentService.register(a),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=a},{"../Component":252,"../Edge":253,"virtual-dom":202}],289:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("three"),o=e("../Component"),s=e("../Geo"),a=e("../Render"),u=function(e){function t(t,r,n){e.call(this,t,r,n)}return n(t,e),t.prototype._activate=function(){var e=this;this.scene=new i.Scene,this.key="",this.alpha=0,this.camera=new s.Camera;var t=this.render.bind(this);this._disposable=this._navigator.stateService.currentState$.map(function(r){var n=r.state,i=e.updateAlpha(n.alpha);return i=e.updateSphere(n.camera,n.currentNode)||i,{name:e._name,render:{frameId:r.id,needsRender:i,render:t,stage:a.GLRenderStage.Foreground}}}).subscribe(this._container.glRenderer.render$)},t.prototype._deactivate=function(){this.disposeSphere(),this._disposable.dispose()},t.prototype.updateAlpha=function(e){return e===this.alpha?!1:(this.alpha=e,!0)},t.prototype.updateSphere=function(e,t){if(null==t||t.key===this.key)return!1;this.key=t.key,this.disposeSphere();var r=e.lookat.clone().sub(e.position).normalize().multiplyScalar(10).add(e.lookat);this.sphere=this.createSphere(),this.sphere.position.copy(r),this.scene.add(this.sphere)},t.prototype.render=function(e,t){null!=this.sphere&&(this.sphere.material.opacity=this.alpha>.5?this.alpha:1-this.alpha),t.render(this.scene,e)},t.prototype.createSphere=function(){var e=new i.SphereGeometry(1.5,32,32),t=new i.Color(Math.round(Math.random()),Math.round(Math.random()),Math.round(Math.random())),r=new i.MeshBasicMaterial({color:t.getHex(),depthWrite:!0,transparent:!0}),n=new i.Mesh(e,r);return n},t.prototype.disposeSphere=function(){null!=this.sphere&&(this.scene.remove(this.sphere),this.sphere.geometry.dispose(),this.sphere.material.dispose(),this.sphere=null)},t.componentName="sphere",t}(o.Component);r.SphereComponent=u,o.ComponentService.register(u),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=u},{"../Component":252,"../Geo":255,"../Render":258,three:196}],290:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("../../Component"),o=e("../../Render"),s=e("../../Geo"),a=function(e){function t(t,r,n){e.call(this,t,r,n)}return n(t,e),t.prototype._activate=function(){var e=this;this.currentKey=null,this.previousKey=null,this.alpha=0,this.alphaOld=0,this.fadeOutSpeed=.05,this.lastCamera=new s.Camera,this.epsilon=1e-6,this.imagePlaneFactory=new i.ImagePlaneFactory,this.imagePlaneScene=new i.ImagePlaneScene;var t=this.render.bind(this);this._disposable=this._navigator.stateService.currentState$.map(function(r){var n=e.updateImagePlanes(r.state);return n=e.updateAlpha(r.state.alpha)||n,n=e.updateAlphaOld(r.state.alpha)||n,{name:e._name,render:{frameId:r.id,needsRender:n,render:t,stage:o.GLRenderStage.Background}}}).subscribe(this._container.glRenderer.render$)},t.prototype._deactivate=function(){this.imagePlaneScene.clear(),this._disposable.dispose()},t.prototype.updateAlpha=function(e){return e===this.alpha?!1:(this.alpha=e,!0)},t.prototype.updateAlphaOld=function(e){return 1>e||0===this.alphaOld?!1:(this.alphaOld=Math.max(0,this.alphaOld-this.fadeOutSpeed),!0)},t.prototype.updateImagePlanes=function(e){if(null==e.currentNode||e.currentNode.key===this.currentKey)return!1;if(this.previousKey=null!=e.previousNode?e.previousNode.key:null,null!=this.previousKey&&this.previousKey!==this.currentKey){var t=this.imagePlaneFactory.createMesh(e.previousNode,e.previousTransform);this.imagePlaneScene.updateImagePlanes([t])}this.currentKey=e.currentNode.key;var r=this.imagePlaneFactory.createMesh(e.currentNode,e.currentTransform);return this.imagePlaneScene.updateImagePlanes([r]),this.alphaOld=1,!0},t.prototype.render=function(e,t){for(var r=this.imagePlaneScene.imagePlanesOld.length?1:this.alpha,n=0,i=this.imagePlaneScene.imagePlanes;n<i.length;n++){var o=i[n];o.material.uniforms.opacity.value=r}for(var s=0,a=this.imagePlaneScene.imagePlanesOld;s<a.length;s++){var o=a[s];o.material.uniforms.opacity.value=this.alphaOld}t.render(this.imagePlaneScene.scene,e),t.render(this.imagePlaneScene.sceneOld,e);for(var u=0,c=this.imagePlaneScene.imagePlanes;u<c.length;u++){var o=c[u];o.material.uniforms.opacity.value=this.alpha}t.render(this.imagePlaneScene.scene,e)},t.componentName="imageplane",t}(i.Component);r.ImagePlaneComponent=a,i.ComponentService.register(a),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=a},{"../../Component":252,"../../Geo":255,"../../Render":258}],291:[function(e,t,r){var n=e("three"),i=e("../../Component"),o=function(){function e(e,t){this.imagePlaneDepth=null!=e?e:200,this.imageSphereRadius=null!=t?t:200}return e.prototype.createMesh=function(e,t){var r=e.pano?this.createImageSphere(e,t):this.createImagePlane(e,t);return r},e.prototype.createImageSphere=function(e,t){var r=this.createTexture(e.image),i=this.createSphereMaterialParameters(t,r),o=new n.ShaderMaterial(i),s=this.getImageSphereGeo(t,e),a=new n.Mesh(s,o);return a},e.prototype.createImagePlane=function(e,t){var r=this.createTexture(e.image),i=this.createMaterialParameters(t,r),o=new n.ShaderMaterial(i),s=this.getImagePlaneGeo(t,e),a=new n.Mesh(s,o);return a},e.prototype.createSphereMaterialParameters=function(e,t){var r=e.gpano,o=2*Math.PI*r.CroppedAreaImageWidthPixels/r.FullPanoWidthPixels,s=Math.PI*r.CroppedAreaImageHeightPixels/r.FullPanoHeightPixels,a={depthWrite:!1,fragmentShader:i.ImagePlaneShaders.equirectangular.fragment,side:n.DoubleSide,transparent:!0,uniforms:{opacity:{type:"f",value:1},phiLength:{type:"f",value:o},projectorMat:{type:"m4",value:e.rt},projectorTex:{type:"t",value:t},thetaLength:{type:"f",value:s}},vertexShader:i.ImagePlaneShaders.equirectangular.vertex};return a},e.prototype.createMaterialParameters=function(e,t){var r={depthWrite:!1,fragmentShader:i.ImagePlaneShaders.perspective.fragment,side:n.DoubleSide,transparent:!0,uniforms:{bbox:{type:"v4",value:new n.Vector4(0,0,1,1)},opacity:{type:"f",value:1},projectorMat:{type:"m4",value:e.projectorMatrix()},projectorTex:{type:"t",value:t}},vertexShader:i.ImagePlaneShaders.perspective.vertex};return r},e.prototype.createTexture=function(e){var t=new n.Texture(e);return t.minFilter=n.LinearFilter,t.needsUpdate=!0,t},e.prototype.getImageSphereGeo=function(e,t){if(!t.mesh.populated||e.scale<.01||e.scale>50)return this.getFlatImageSphereGeo(e);for(var r=new n.Geometry,i=(new n.Matrix4).getInverse(e.srt),o=5*e.scale,s=this.imageSphereRadius*e.scale,a=0,u=t.mesh.vertices;a<u.length;a++){var c=u[a],h=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]),l=Math.max(o,Math.min(h,s)),p=l/h,f=new n.Vector3(c[0]*p,c[1]*p,c[2]*p);f.applyMatrix4(i),r.vertices.push(f)}for(var d=0,m=t.mesh.faces;d<m.length;d++){var v=m[d];r.faces.push(new n.Face3(v[0],v[1],v[2]))}return r},e.prototype.getImagePlaneGeo=function(e,t){if(!t.mesh.populated||e.scale<.01||e.scale>50)return this.getFlatImagePlaneGeo(e);for(var r=new n.Geometry,i=(new n.Matrix4).getInverse(e.srt),o=5*e.scale,s=this.imagePlaneDepth*e.scale,a=0,u=t.mesh.vertices;a<u.length;a++){var c=u[a],h=Math.max(o,Math.min(c[2],s)),l=h/c[2],p=new n.Vector3(c[0]*l,c[1]*l,h);p.applyMatrix4(i),r.vertices.push(p)}for(var f=0,d=t.mesh.faces;f<d.length;f++){var m=d[f];r.faces.push(new n.Face3(m[0],m[1],m[2]))}return r},e.prototype.getFlatImageSphereGeo=function(e){var t=e.gpano,r=2*Math.PI*t.CroppedAreaLeftPixels/t.FullPanoWidthPixels,i=2*Math.PI*t.CroppedAreaImageWidthPixels/t.FullPanoWidthPixels,o=Math.PI*t.CroppedAreaTopPixels/t.FullPanoHeightPixels,s=Math.PI*t.CroppedAreaImageHeightPixels/t.FullPanoHeightPixels,a=new n.SphereGeometry(this.imageSphereRadius,20,40,r-Math.PI/2,i,o,s);return a.applyMatrix((new n.Matrix4).getInverse(e.rt)),a},e.prototype.getFlatImagePlaneGeo=function(e){var t=e.width,r=e.height,i=Math.max(t,r),o=t/2/i,s=r/2/i,a=e.pixelToVertex(-o,-s,this.imagePlaneDepth),u=e.pixelToVertex(o,-s,this.imagePlaneDepth),c=e.pixelToVertex(o,s,this.imagePlaneDepth),h=e.pixelToVertex(-o,s,this.imagePlaneDepth),l=new n.Geometry;return l.vertices.push(a,h,c,u),l.faces.push(new n.Face3(0,1,3),new n.Face3(1,2,3)),l},e}();r.ImagePlaneFactory=o,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o},{"../../Component":252,three:196}],292:[function(e,t,r){var n=e("three"),i=function(){function e(){this.scene=new n.Scene,this.sceneOld=new n.Scene,this.imagePlanes=[],this.imagePlanesOld=[]}return e.prototype.updateImagePlanes=function(e){this._dispose(this.imagePlanesOld,this.sceneOld);for(var t=0,r=this.imagePlanes;t<r.length;t++){var n=r[t];this.scene.remove(n),this.sceneOld.add(n)}for(var i=0;i<e.length;i++){var n=e[i];this.scene.add(n)}this.imagePlanesOld=this.imagePlanes,this.imagePlanes=e},e.prototype.addImagePlanes=function(e){for(var t=0;t<e.length;t++){var r=e[t];this.scene.add(r),this.imagePlanes.push(r)}},e.prototype.addImagePlanesOld=function(e){for(var t=0;t<e.length;t++){var r=e[t];this.sceneOld.add(r),this.imagePlanesOld.push(r)}},e.prototype.setImagePlanes=function(e){this._clear(),this.addImagePlanes(e)},e.prototype.setImagePlanesOld=function(e){this._clearOld(),this.addImagePlanesOld(e)},e.prototype.clear=function(){this._clear(),this._clearOld()},e.prototype._clear=function(){this._dispose(this.imagePlanes,this.scene),this.imagePlanes.length=0},e.prototype._clearOld=function(){this._dispose(this.imagePlanesOld,this.sceneOld),this.imagePlanesOld.length=0},e.prototype._dispose=function(e,t){for(var r=0;r<e.length;r++){var n=e[r];t.remove(n),n.geometry.dispose(),n.material.dispose();var i=n.material.uniforms.projectorTex.value;null!=i&&i.dispose()}},e}();r.ImagePlaneScene=i,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=i},{three:196}],293:[function(e,t,r){var n=(e("path"),function(){function e(){}return e.equirectangular={fragment:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n#define tau 6.28318530718\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float phiLength;\nuniform float thetaLength;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vec3 b = normalize(vRstq.xyz);\n    float lat = -asin(b.y);\n    float lon = atan(b.x, b.z);\n    float x = lon / phiLength + 0.5;\n    float y = lat / thetaLength + 0.5;\n    vec4 baseColor = texture2D(projectorTex, vec2(x, y));\n    baseColor.a = opacity;\n    gl_FragColor = baseColor;\n}",vertex:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},e.perspective={fragment:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform vec4 bbox;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x / vRstq.w;\n    float y = vRstq.y / vRstq.w;\n\n    vec4 baseColor;\n    if (x > bbox[0] && y > bbox[1] && x < bbox[2] && y < bbox[3]) {\n        baseColor = texture2D(projectorTex, vec2(x, y));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}",vertex:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},e}());r.ImagePlaneShaders=n},{path:2}],294:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("rx"),o=e("../../State"),s=e("../../Render"),a=e("../../Component"),u=function(){function e(){this._imagePlaneFactory=new a.ImagePlaneFactory,this._imagePlaneScene=new a.ImagePlaneScene,this._currentKey=null,this._previousKey=null,this._currentPano=!1,this._previousPano=!1,this._frameId=0,this._needsRender=!1,this._motionless=!1,this._curtain=1}return Object.defineProperty(e.prototype,"frameId",{get:function(){return this._frameId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsRender",{get:function(){return this._needsRender},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disabled",{get:function(){return null==this._currentKey||null==this._previousKey||this._motionless||this._currentPano||this._previousPano},enumerable:!0,configurable:!0}),e.prototype.update=function(e){this._updateFrameId(e.id),this._needsRender=this._updateImagePlanes(e.state),this._needsRender=this._updateCurtain(e.state.alpha)||this._needsRender},e.prototype.render=function(e,t){t.render(this._imagePlaneScene.sceneOld,e),t.render(this._imagePlaneScene.scene,e)},e.prototype.dispose=function(){this._imagePlaneScene.clear()},e.prototype.clearNeedsRender=function(){this._needsRender=!1},e.prototype._updateFrameId=function(e){this._frameId=e},e.prototype._updateImagePlanes=function(e){if(null!=e.currentNode){var t=!1;return null!=e.previousNode&&this._previousKey!==e.previousNode.key&&(t=!0,this._previousKey=e.previousNode.key,this._previousPano=e.previousNode.pano,this._motionless=e.motionless,this._imagePlaneScene.setImagePlanesOld([this._imagePlaneFactory.createMesh(e.previousNode,e.previousTransform)])),this._currentKey!==e.currentNode.key&&(t=!0,this._currentKey=e.currentNode.key,this._currentPano=e.currentNode.pano,this._motionless=e.motionless,this._imagePlaneScene.setImagePlanes([this._imagePlaneFactory.createMesh(e.currentNode,e.currentTransform)])),t}},e.prototype._updateCurtain=function(e){if(this.disabled||Math.abs(this._curtain-e)<.001)return!1;this._curtain=e;for(var t=0,r=this._imagePlaneScene.imagePlanes;t<r.length;t++){var n=r[t],i=n.material,o=i.uniforms.bbox.value;o.z=this._curtain}return!0},e}(),c=function(e){function t(t,r,n){e.call(this,t,r,n),this._sliderStateOperation$=new i.Subject,this._sliderStateCreator$=new i.Subject,this._sliderStateDisposer$=new i.Subject,this._sliderState$=this._sliderStateOperation$.scan(function(e,t){return t(e)},null).filter(function(e){return null!=e}).distinctUntilChanged(function(e){return e.frameId}),this._sliderStateCreator$.map(function(){return function(e){if(null!=e)throw new Error("Multiple slider states can not be created at the same time");return new u}}).subscribe(this._sliderStateOperation$),this._sliderStateDisposer$.map(function(){return function(e){return e.dispose(),null}}).subscribe(this._sliderStateOperation$)}return n(t,e),t.prototype.setNodes=function(e){var t=this;this._activated&&i.Observable.zip(this._navigator.graphService.node$(e.background),this._navigator.graphService.node$(e.foreground),function(e,t){return{background:e,foreground:t}}).withLatestFrom(this._navigator.stateService.currentState$,function(e,t){return{nodes:e,state:t.state}}).subscribe(function(e){if(null==e.state.currentNode||null==e.state.previousNode||e.state.currentNode.key!==e.nodes.foreground.key||e.state.previousNode.key!==e.nodes.background.key){if(e.state.currentNode.key===e.nodes.background.key)return void t._navigator.stateService.setNodes([e.nodes.foreground]);if(e.state.currentNode.key===e.nodes.foreground.key&&1===e.state.trajectory.length)return void t._navigator.stateService.prependNodes([e.nodes.background]);t._navigator.stateService.setNodes([e.nodes.background]),t._navigator.stateService.setNodes([e.nodes.foreground])}},function(e){console.log(e)})},t.prototype._activate=function(){var e=this;this._navigator.stateService.state$.first().subscribe(function(t){t===o.State.Traversing&&e._navigator.stateService.wait()}),this._sliderStateSubscription=this._sliderState$.map(function(t){var r={name:e._name,render:{frameId:t.frameId,needsRender:t.needsRender,render:t.render.bind(t),stage:s.GLRenderStage.Background}};return t.clearNeedsRender(),r}).subscribe(this._container.glRenderer.render$),this._sliderStateCreator$.onNext(null),this._stateSubscription=this._navigator.stateService.currentState$.map(function(e){return function(t){return t.update(e),t}}).subscribe(this._sliderStateOperation$),this._mouseMoveSubscription=this._container.mouseService.mouseMove$.map(function(t){return function(r){if(r.disabled)return r;var n=t.offsetX/e._container.element.offsetWidth;return e._navigator.stateService.moveTo(n),r}}).subscribe(this._sliderStateOperation$)},t.prototype._deactivate=function(){var e=this;this._navigator.stateService.state$.first().subscribe(function(t){t===o.State.Waiting&&e._navigator.stateService.traverse()}),this._sliderStateDisposer$.onNext(null),this._stateSubscription.dispose(),this._mouseMoveSubscription.dispose(),this._sliderStateSubscription.dispose()},t.componentName="slider",t}(a.Component);r.SliderComponent=c,a.ComponentService.register(c),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=c},{"../../Component":252,"../../Render":258,"../../State":259,rx:195}],295:[function(e,t,r){},{}],296:[function(e,t,r){var n=e("rx"),i=function(){function e(e,t,r){void 0===r&&(r=0),this.visibleInKeys=[],this.self$=new n.Subject,this.setPosition(e,t,r),this.setColor(13434828)}return e.prototype.setPosition=function(e,t,r){void 0===r&&(r=0),this.lat=e,this.lon=t,this.alt=r,this.update()},e.prototype.setColor=function(e){this.color=e,this.update()},e.prototype.setVisibleInKeys=function(e){this.visibleInKeys=e,this.update()},e.prototype.update=function(){this.hash=Math.random(),this.self$.onNext(this)},e}();r.Marker=i,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=i},{rx:195}],297:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("underscore"),o=e("three"),s=e("rbush"),a=e("rx"),u=e("../../Component"),c=e("../../Render"),h=e("../../Geo"),l=function(){function e(){this._create$=new a.Subject,this._remove$=new a.Subject,this._update$=new a.Subject,this._markers$=this._update$.scan(function(e,t){return t(e)},s(2e4,[".lon",".lat",".lon",".lat"])).shareReplay(1),this._create$.map(function(e){return function(t){return t.insert({lat:e.lat,lon:e.lon,marker:e}),t}}).subscribe(this._update$),this._remove$.map(function(e){return function(t){return t.remove(e),t}}).subscribe(this._update$)}return e.prototype.addMarker=function(e){this._create$.onNext(e)},e.prototype.removeMarker=function(e){this._remove$.onNext(e)},Object.defineProperty(e.prototype,"markers$",{get:function(){return this._markers$},enumerable:!0,configurable:!0}),e}();r.MarkerSet=l;var p=function(e){function t(t,r,n){e.call(this,t,r,n),this._circleToRayAngle=2}return n(t,e),t.prototype._activate=function(){var e=this;this._scene=new o.Scene,this._markerSet=new l,this._markerObjects={},this._disposable=a.Observable.combineLatest(this._navigator.graphService.graph$,this._navigator.stateService.currentState$,this._markerSet.markers$,function(e,t,r){return{frame:t,graph:e,markers:r}}).distinctUntilChanged(function(e){return e.frame.id}).map(function(t){return e.renderHash(t)}).subscribe(this._container.glRenderer.render$),this._disposableConfiguration=this.configuration$.filter(function(e){return e.mapillaryObjects}).flatMapLatest(function(t){return e._navigator.graphService.vectorTilesService.mapillaryObjects$.map(function(t){var r=i.map(t.rects,function(e){return e.image_key}),n=e.createMarker(t.latLon.lat,t.latLon.lon,t.alt);return n.setVisibleInKeys(r),n})}).subscribe(function(t){e.addMarker(t)})},t.prototype._deactivate=function(){this.disposeScene(),this._disposable.dispose(),this._disposableConfiguration.dispose()},t.prototype.createMarker=function(e,t,r){return new u.Marker(e,t,r)},t.prototype.addMarker=function(e){this._markerSet.addMarker(e)},t.prototype.removeMarker=function(e){this._markerSet.removeMarker(e)},t.prototype.renderHash=function(e){var t=this.updateScene(e);return{name:this._name,render:{frameId:e.frame.id,needsRender:t,render:this.render.bind(this),stage:c.GLRenderStage.Foreground}}},t.prototype.updateScene=function(e){if(!(e.frame&&e.graph&&e.markers&&e.frame.state.currentNode))return!1;var t=!1,r=this._markerObjects,n=e.frame.state.currentNode;this._markerObjects={};for(var o=.001,s=n.latLon.lon-o/2,a=n.latLon.lat-o/2,u=n.latLon.lon+o/2,c=n.latLon.lat+o/2,l=i.map(e.markers.search([s,a,u,c]),function(e){return e.marker}).filter(function(e){return 0===e.visibleInKeys.length||i.contains(e.visibleInKeys,n.key)}),p=0;p<l.length;p++){var f=l[p];if(f.hash in r)this._markerObjects[f.hash]=r[f.hash],delete r[f.hash];else{var d=e.graph.referenceLatLonAlt,m=(new h.GeoCoords).topocentric_from_lla(f.lat,f.lon,f.alt,d.lat,d.lon,d.alt),v=this.createMarkerGeometry(f.color);v.position.set(m[0],m[1],m[2]),this._scene.add(v),this._markerObjects[f.hash]=v,t=!0}}for(var g in r)r.hasOwnProperty(g)&&(this.disposeObject(r[g]),t=!0);return t},t.prototype.render=function(e,t){t.render(this._scene,e)},t.prototype.createMarkerGeometry=function(e){var t=2,r=new o.Mesh(this.markerGeometry(t,16,8),new o.MeshBasicMaterial({color:e,depthWrite:!1,opacity:.4,shading:o.SmoothShading,transparent:!0})),n=new o.Mesh(new o.SphereGeometry(t/2,16,8),new o.MeshBasicMaterial({color:16777215,depthWrite:!1,opacity:.6,shading:o.SmoothShading,transparent:!0}));n.position.z=this.markerHeight(t);var i=new o.Object3D;return i.add(n),i.add(r),i},t.prototype.markerHeight=function(e){var t=Math.tan(Math.PI-this._circleToRayAngle);return e*Math.sqrt(1+t*t)},t.prototype.markerGeometry=function(e,t,r){var n=new o.Geometry;t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6);for(var i=this.markerHeight(e),s=[],a=0;r>=a;++a){for(var u=[],c=0;t>=c;++c){var h=c/t*Math.PI*2,l=a/r*Math.PI,p=void 0;if(l<this._circleToRayAngle)p=e;else{var f=Math.tan(l-this._circleToRayAngle);p=e*Math.sqrt(1+f*f)}var d=new o.Vector3;d.x=p*Math.cos(h)*Math.sin(l),d.y=p*Math.sin(h)*Math.sin(l),d.z=p*Math.cos(l)+i,n.vertices.push(d),u.push(n.vertices.length-1)}s.push(u)}for(var a=0;r>a;++a)for(var c=0;t>c;++c){var m=s[a][c+1],v=s[a][c],g=s[a+1][c],y=s[a+1][c+1],_=n.vertices[m].clone().normalize(),b=n.vertices[v].clone().normalize(),x=n.vertices[g].clone().normalize(),w=n.vertices[y].clone().normalize();n.faces.push(new o.Face3(m,v,y,[_,b,w])),n.faces.push(new o.Face3(v,g,y,[b.clone(),x,w.clone()]))}return n.computeFaceNormals(),n.boundingSphere=new o.Sphere(new o.Vector3,e+i),n},t.prototype.disposeObject=function(e){this._scene.remove(e);for(var t=0;t<e.children.length;++t){var r=e.children[t];r.geometry.dispose(),r.material.dispose()}},t.prototype.disposeScene=function(){for(var e in this._markerObjects)this._markerObjects.hasOwnProperty(e)&&this.disposeObject(this._markerObjects[e]);this._markerObjects={}},t.componentName="marker",t}(u.Component);r.MarkerComponent=p,u.ComponentService.register(p),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=p},{"../../Component":252,"../../Geo":255,"../../Render":258,rbush:171,rx:195,three:196,underscore:197}],298:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("./MapillaryError"),o=function(e){function t(){this.name="InitializationMapillaryError",this.message="Could not initialize",e.call(this)}return n(t,e),t}(i.MapillaryError);r.InitializationMapillaryError=o,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o},{"./MapillaryError":299}],299:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=function(e){function t(){e.call(this)}return n(t,e),t}(Error);r.MapillaryError=i,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=i},{}],300:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("./MapillaryError"),o=function(e){function t(){this.name="MoveTypeMapillaryError",this.message="The type of ui you use does not support this move",e.call(this)}return n(t,e),t}(i.MapillaryError);r.MoveTypeMapillaryError=o,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o},{"./MapillaryError":299}],301:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("./MapillaryError"),o=function(e){function t(){this.name="NotImplementedMapillaryError",this.message="This function has not yet been implemented",e.call(this)}return n(t,e),t}(i.MapillaryError);r.NotImplementedMapillaryError=o,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o},{"./MapillaryError":299}],302:[function(e,t,r){var n=this&&this.__extends||function(e,t){
function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("./MapillaryError"),o=function(e){function t(t){this.name="ParameterMapillaryError",this.message=null!=t?t:"The function was not called with correct parameters",e.call(this)}return n(t,e),t}(i.MapillaryError);r.ParameterMapillaryError=o,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o},{"./MapillaryError":299}],303:[function(e,t,r){var n=e("three"),i=function(){function e(e){null!=e?(this._position=e.pixelToVertex(0,0,0),this._lookat=e.pixelToVertex(0,0,10),this._up=e.upVector(),this._focal=this._getFocal(e)):(this._position=new n.Vector3(0,0,0),this._lookat=new n.Vector3(0,0,1),this._up=new n.Vector3(0,-1,0),this._focal=1)}return Object.defineProperty(e.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lookat",{get:function(){return this._lookat},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this._up},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"focal",{get:function(){return this._focal},set:function(e){this._focal=e},enumerable:!0,configurable:!0}),e.prototype.lerpCameras=function(e,t,r){this._position.subVectors(t.position,e.position).multiplyScalar(r).add(e.position),this._lookat.subVectors(t.lookat,e.lookat).multiplyScalar(r).add(e.lookat),this._up.subVectors(t.up,e.up).multiplyScalar(r).add(e.up),this._focal=(1-r)*e.focal+r*t.focal},e.prototype.copy=function(e){this._position.copy(e.position),this._lookat.copy(e.lookat),this._up.copy(e.up),this._focal=e.focal},e.prototype.clone=function(){var t=new e;return t.position.copy(this._position),t.lookat.copy(this._lookat),t.up.copy(this._up),t.focal=this._focal,t},e.prototype.diff=function(e){var t=this._position.distanceToSquared(e.position),r=this._lookat.distanceToSquared(e.lookat),n=this._up.distanceToSquared(e.up),i=100*Math.abs(this._focal-e.focal);return Math.max(t,r,n,i)},e.prototype._getFocal=function(e){if(null!=e.gpano)return.5;var t=Math.max(e.width,e.height);return e.orientation>4?e.focal/t*e.height:e.focal/t*e.width},e}();r.Camera=i},{three:196}],304:[function(e,t,r){var n=e("three"),i=function(){function e(){this._wgs84a=6378137,this._wgs84b=6356752.314245}return e.prototype.topocentric_from_lla=function(e,t,r,i,o,s){var a=(new n.Matrix4).getInverse(this._ecef_from_topocentric_transform(i,o,s)),u=a.elements,c=this._ecef_from_lla(e,t,r),h=c[0],l=c[1],p=c[2],f=u[0]*h+u[4]*l+u[8]*p+u[12],d=u[1]*h+u[5]*l+u[9]*p+u[13],m=u[2]*h+u[6]*l+u[10]*p+u[14];return[f,d,m]},e.prototype.lla_from_topocentric=function(e,t,r,n,i,o){var s=this._ecef_from_topocentric_transform(n,i,o).elements,a=s[0]*e+s[4]*t+s[8]*r+s[12],u=s[1]*e+s[5]*t+s[9]*r+s[13],c=s[2]*e+s[6]*t+s[10]*r+s[14];return this._lla_from_ecef(a,u,c)},e.prototype._ecef_from_lla=function(e,t,r){var n=this._wgs84a*this._wgs84a,i=this._wgs84b*this._wgs84b,o=e/180*Math.PI,s=t/180*Math.PI,a=Math.cos(o),u=Math.sin(o),c=Math.cos(s),h=Math.sin(s),l=1/Math.sqrt(n*a*a+i*u*u),p=(n*l+r)*a*c,f=(n*l+r)*a*h,d=(i*l+r)*u;return[p,f,d]},e.prototype._lla_from_ecef=function(e,t,r){var n=this._wgs84a,i=this._wgs84b,o=Math.sqrt((n*n-i*i)/(n*n)),s=Math.sqrt((n*n-i*i)/(i*i)),a=Math.sqrt(e*e+t*t),u=Math.atan2(r*n,a*i),c=Math.sin(u),h=Math.cos(u),l=Math.atan2(t,e),p=Math.atan2(r+s*s*i*c*c*c,a-o*o*n*h*h*h),f=Math.sin(p),d=Math.cos(p),m=n/Math.sqrt(1-o*o*f*f),v=a/d-m;return[180*p/Math.PI,180*l/Math.PI,v]},e.prototype._norm=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},e.prototype._normalized=function(e){var t=this._norm(e);return[e[0]/t,e[1]/t,e[2]/t]},e.prototype._ecef_from_topocentric_transform=function(e,t,r){var i=1e-6,o=this._ecef_from_lla(e,t,r),s=this._ecef_from_lla(e,t+i,r),a=this._ecef_from_lla(e,t-i,r),u=this._ecef_from_lla(e+i,t,r),c=this._ecef_from_lla(e-i,t,r),h=this._ecef_from_lla(e,t,r+i),l=this._ecef_from_lla(e,t,r-i),p=this._normalized([s[0]-a[0],s[1]-a[1],s[2]-a[2]]),f=this._normalized([u[0]-c[0],u[1]-c[1],u[2]-c[2]]),d=this._normalized([h[0]-l[0],h[1]-l[1],h[2]-l[2]]),m=new n.Matrix4;return m.set(p[0],f[0],d[0],o[0],p[1],f[1],d[1],o[1],p[2],f[2],d[2],o[2],0,0,0,1),m},e}();r.GeoCoords=i,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=i},{three:196}],305:[function(e,t,r){var n=function(){function e(){}return e.prototype.fromLatLonToPoint=function(e){var t=Math.min(Math.max(Math.sin(e.lat*(Math.PI/180)),-.9999),.9999);return{x:128+e.lon*(256/360),y:128+.5*Math.log((1+t)/(1-t))*-(256/(2*Math.PI))}},e.prototype.fromPointToLatLon=function(e){return{lat:(2*Math.atan(Math.exp((e.y-128)/-(256/(2*Math.PI))))-Math.PI/2)/(Math.PI/180),lon:(e.x-128)/(256/360)}},e.prototype.getTileAtLatLon=function(e,t){var r=Math.pow(2,t),n=256/r,i=this.fromLatLonToPoint(e);return{x:Math.floor(i.x/n),y:Math.floor(i.y/n),z:t}},e.prototype.getTileBounds=function(e){e=this.normalizeTile(e);var t=Math.pow(2,e.z),r=256/t,n={x:e.x*r,y:e.y*r+r},i={x:e.x*r+r,y:e.y*r};return{ne:this.fromPointToLatLon(i),sw:this.fromPointToLatLon(n)}},e.prototype.normalizeTile=function(e){var t=Math.pow(2,e.z);return e.x=(e.x%t+t)%t,e.y=(e.y%t+t)%t,e},e}();r.GoogleTiles=n,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n},{}],306:[function(e,t,r){var n=e("three"),i=function(){function e(){this._epsilon=1e-9}return e.prototype.degToRad=function(e){return Math.PI*e/180},e.prototype.radToDeg=function(e){return 180*e/Math.PI},e.prototype.rotationMatrix=function(e){var t=new n.Vector3(e[0],e[1],e[2]),r=t.length();return t.normalize(),(new n.Matrix4).makeRotationAxis(t,r)},e.prototype.rotate=function(e,t){var r=new n.Vector3(e[0],e[1],e[2]),i=this.rotationMatrix(t);return r.applyMatrix4(i),r},e.prototype.opticalCenter=function(e,t){var r=[-e[0],-e[1],-e[2]],n=[-t[0],-t[1],-t[2]];return this.rotate(n,r)},e.prototype.viewingDirection=function(e){var t=[-e[0],-e[1],-e[2]];return this.rotate([0,0,1],t)},e.prototype.wrap=function(e,t,r){if(t>r)throw new Error("Invalid arguments: max must be larger than min.");for(var n=r-t;e>r||t>e;)e>r?e-=n:t>e&&(e+=n);return e},e.prototype.wrapAngle=function(e){return this.wrap(e,-Math.PI,Math.PI)},e.prototype.angleBetweenVector2=function(e,t,r,n){var i=Math.atan2(n,r)-Math.atan2(t,e);return this.wrapAngle(i)},e.prototype.angleDifference=function(e,t){var r=t-e;return this.wrapAngle(r)},e.prototype.relativeRotationAngle=function(e,t){var r=this.rotationMatrix([-e[0],-e[1],-e[2]]),n=this.rotationMatrix(t),i=r.multiply(n),o=i.elements,s=Math.acos((o[0]+o[5]+o[10]-1)/2);return s},e.prototype.angleToPlane=function(e,t){var r=(new n.Vector3).fromArray(e),i=r.length();if(i<this._epsilon)return 0;var o=r.dot((new n.Vector3).fromArray(t));return Math.asin(o/i)},e.prototype.distanceFromLatLon=function(e,t,r,n){var i=6371e3,o=this.degToRad(r-e),s=this.degToRad(n-t),a=Math.sin(o/2)*Math.sin(o/2)+Math.cos(e)*Math.cos(r)*Math.sin(s/2)*Math.sin(s/2),u=2*i*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return u},e}();r.Spatial=i,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=i},{three:196}],307:[function(e,t,r){var n=e("three"),i=function(){function e(e){this._width=this._getValue(e.apiNavImIm.width,4),this._height=this._getValue(e.apiNavImIm.height,3),this._focal=this._getValue(e.apiNavImIm.cfocal,1),this._orientation=this._getValue(e.apiNavImIm.orientation,1),this._scale=this._getValue(e.apiNavImIm.atomic_scale,1),this._aspect=this._orientation<5?this._width/this._height:this._height/this._width,this._gpano=e.apiNavImIm.gpano?e.apiNavImIm.gpano:null,this._rt=this._getRt(e),this._srt=this._getSrt(this._rt,this._scale)}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"focal",{get:function(){return this._focal},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"orientation",{get:function(){return this._orientation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspect",{get:function(){return this._aspect},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gpano",{get:function(){return this._gpano},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rt",{get:function(){return this._rt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"srt",{get:function(){return this._srt},enumerable:!0,configurable:!0}),e.prototype.pixelToVertex=function(e,t,r){var i=new n.Vector4(e/this._focal*r,t/this._focal*r,r,1);return i.applyMatrix4((new n.Matrix4).getInverse(this._rt)),new n.Vector3(i.x/i.w,i.y/i.w,i.z/i.w)},e.prototype.upVector=function(){var e=this._rt.elements;switch(this._orientation){case 1:return new n.Vector3(-e[1],-e[5],-e[9]);case 3:return new n.Vector3(e[1],e[5],e[9]);case 6:return new n.Vector3(-e[0],-e[4],-e[8]);case 8:return new n.Vector3(e[0],e[4],e[8]);default:return new n.Vector3(-e[1],-e[5],-e[9])}},e.prototype.projectorMatrix=function(){var e=this._normalizedToTextureMatrix(),t=this._focal,r=(new n.Matrix4).set(t,0,0,0,0,t,0,0,0,0,0,0,0,0,1,0);return e.multiply(r),e.multiply(this._rt),e},e.prototype._getValue=function(e,t){return null!=e&&e>0?e:t},e.prototype._getRt=function(e){var t=new n.Vector3(e.apiNavImIm.rotation[0],e.apiNavImIm.rotation[1],e.apiNavImIm.rotation[2]),r=t.length();t.normalize();var i=new n.Matrix4;return i.makeRotationAxis(t,r),i.setPosition(new n.Vector3(e.translation[0],e.translation[1],e.translation[2])),i},e.prototype._getSrt=function(e,t){var r=e.clone(),i=r.elements;return i[12]=t*i[12],i[13]=t*i[13],i[14]=t*i[14],r.scale(new n.Vector3(t,t,t)),r},e.prototype._normalizedToTextureMatrix=function(){var e=Math.max(this._width,this._height),t=e/this._width,r=e/this._height;switch(this._orientation){case 1:return(new n.Matrix4).set(t,0,0,.5,0,-r,0,.5,0,0,1,0,0,0,0,1);case 3:return(new n.Matrix4).set(-t,0,0,.5,0,r,0,.5,0,0,1,0,0,0,0,1);case 6:return(new n.Matrix4).set(0,-r,0,.5,-t,0,0,.5,0,0,1,0,0,0,0,1);case 8:return(new n.Matrix4).set(0,r,0,.5,t,0,0,.5,0,0,1,0,0,0,0,1);default:return(new n.Matrix4).set(t,0,0,.5,0,-r,0,.5,0,0,1,0,0,0,0,1)}},e}();r.Transform=i},{three:196}],308:[function(e,t,r){},{}],309:[function(e,t,r){var n=e("underscore"),i=e("graphlib"),o=e("rbush"),s=e("three"),a=e("latlon-geohash"),u=e("../Edge"),c=e("../Geo"),h=e("../Graph"),l=function(){function e(){}return e.n="n",e.nw="nw",e.w="w",e.sw="sw",e.s="s",e.se="se",e.e="e",e.ne="ne",e}(),p=function(){function e(){this.referenceLatLonAlt=null,this.boxWidth=.001,this.defaultAlt=2,this.sequences=[],this.sequenceHash={},this.spatial=o(2e4,[".lon",".lat",".lon",".lat"]),this.graph=new i.Graph({multigraph:!0}),this.cachedNodes={},this.unWorthyNodes={},this.edgeCalculator=new u.EdgeCalculator,this.spatialLib=new c.Spatial,this.geoCoords=new c.GeoCoords}return e.prototype.addNodesFromAPI=function(e,t){var r=this;if(void 0!==e){var i,o,s=e.hs[0],u=a.bounds(s),c=a.neighbours(s),l={};o=n.map(e.ss,function(e){var t=new h.Sequence(e);return n.each(e.keys,function(e){l[e]=t}),t}),i=n.map(e.ims,function(e){var t=e.lat;null!=e.clat&&(t=e.clat);var n=e.lon;null!=e.clon&&(n=e.clon);var i=e.ca;null!=e.cca&&(i=e.cca);var o={lat:t,lon:n};null==e.rotation&&(e.rotation=r.computeRotation(e.ca,e.orientation));var a=r.computeTranslation(e,o),p=r.computeHs(o,u.sw,u.ne,s,c),f=new h.Node(e.key,i,o,!1,l[e.key],e,a,p);return f.user=e.user,f.capturedAt=e.captured_at,r.unWorthyNodes[e.key]=!0,f}),this.insertNodes(i),this.insertSequences(o),this.makeNodesWorthy(t)}},e.prototype.makeNodesWorthy=function(e){var t,r=[];for(var i in this.unWorthyNodes)if(this.unWorthyNodes.hasOwnProperty(i))if(this.unWorthyNodes[i]){var o=this.getNode(i),s=o.hs;t=!0,n.each(s,function(r){t=t&&!!e[r]}),t&&(o.worthy=!0,this.unWorthyNodes[i]=!1,r.push(i))}else r.push(i);for(var a=0;a<r.length;a++){var i=r[a];delete this.unWorthyNodes[i]}},e.prototype.getNode=function(e){return this.graph.node(e)},e.prototype.getEdges=function(e){var t=this,r=this.graph.outEdges(e.key);return n.map(r,function(e){var r=t.graph.edge(e);return{data:r,from:e.v,to:e.w}})},e.prototype.cacheNode=function(e){this.computeEdges(e),e.cached=!0,e.lastUsed=(new Date).getTime(),this.cachedNodes[e.key]=!0},e.prototype.evictNodeCache=function(){Object.keys(this.cachedNodes).length<30},e.prototype.unCacheNode=function(e){delete this.cachedNodes[e.key],e.lastCacheEvict=(new Date).getTime()},e.prototype.computeEdges=function(e){if(!e.worthy)return!1;var t=this.edgeCalculator.computeSequenceEdges(e),r=n.map(t,function(e){return e.to}),i=e.latLon.lon-this.boxWidth/2,o=e.latLon.lat-this.boxWidth/2,s=e.latLon.lon+this.boxWidth/2,a=e.latLon.lat+this.boxWidth/2,u=n.map(this.spatial.search([i,o,s,a]),function(e){return e.node}),c=this.edgeCalculator.getPotentialEdges(e,u,r);return t=t.concat(this.edgeCalculator.computeStepEdges(e,c,e.findPrevKeyInSequence(),e.findNextKeyInSequence())),t=t.concat(this.edgeCalculator.computeTurnEdges(e,c)),t=t.concat(this.edgeCalculator.computePanoEdges(e,c)),t=t.concat(this.edgeCalculator.computePerspectiveToPanoEdges(e,c)),this.addEdgesToNode(e,t),e.edges=this.getEdges(e),!0},e.prototype.insertNodes=function(e){var t=this;n.each(e,function(e){t.insertNode(e)})},e.prototype.insertSequences=function(e){this.sequences=n.uniq(this.sequences.concat(e),function(e){return e.key})},e.prototype.insertNode=function(e){null==this.getNode(e.key)&&(this.spatial.insert({lat:e.latLon.lat,lon:e.latLon.lon,node:e}),this.graph.setNode(e.key,e))},e.prototype.nextNode=function(e,t){for(var r=this.graph.outEdges(e.key),n=0;n<r.length;n++){var i=r[n],o=this.graph.edge(i);if(o.direction===t)return this.getNode(i.w)}return null},e.prototype.computeHs=function(e,t,r,n,i){var o=[n],s=[0,0,0],a=this.geoCoords.topocentric_from_lla(r.lat,r.lon,0,t.lat,t.lon,0),u=this.geoCoords.topocentric_from_lla(e.lat,e.lon,0,t.lat,t.lon,0),c=u[0]-s[0],h=a[0]-u[0],p=u[1]-s[1],f=a[1]-u[1],d=20>c,m=20>h,v=20>p,g=20>f;return g&&o.push(i[l.n]),g&&d&&o.push(i[l.nw]),d&&o.push(i[l.w]),d&&v&&o.push(i[l.sw]),v&&o.push(i[l.s]),v&&m&&o.push(i[l.se]),m&&o.push(i[l.e]),m&&g&&o.push(i[l.ne]),o},e.prototype.computeRotation=function(e,t){var r=0,n=0,i=0;switch(t){case 1:r=Math.PI/2;break;case 3:r=-Math.PI/2,i=Math.PI;break;case 6:n=-Math.PI/2,i=-Math.PI/2;break;case 8:n=Math.PI/2,i=Math.PI/2}var o=(new s.Matrix4).makeRotationZ(i),a=new s.Euler(r,n,e*Math.PI/180,"XYZ"),u=(new s.Matrix4).makeRotationFromEuler(a),c=(new s.Vector4).setAxisAngleFromRotationMatrix(u.multiply(o));return c.multiplyScalar(c.w).toArray().slice(0,3)},e.prototype.computeTranslation=function(e,t){var r=null==e.calt?this.defaultAlt:e.calt;null==this.referenceLatLonAlt&&(this.referenceLatLonAlt={alt:r,lat:t.lat,lon:t.lon}),Math.abs(t.lon-this.referenceLatLonAlt.lon)>.1&&(this.referenceLatLonAlt={alt:r,lat:t.lat,lon:t.lon});var n=this.geoCoords.topocentric_from_lla(t.lat,t.lon,r,this.referenceLatLonAlt.lat,this.referenceLatLonAlt.lon,this.referenceLatLonAlt.alt),i=this.spatialLib.rotate(n,e.rotation);return[-i.x,-i.y,-i.z]},e.prototype.addEdgesToNode=function(e,t){var r=this.graph.outEdges(e.key);for(var n in r)if(r.hasOwnProperty(n)){var i=r[n];this.graph.removeEdge(i)}for(var o=0;o<t.length;o++){var s=t[o];this.graph.setEdge(e.key,s.to,s.data,e.key+s.to+s.data.direction)}},e}();r.Graph=p,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=p},{"../Edge":253,"../Geo":255,"../Graph":256,graphlib:149,"latlon-geohash":170,rbush:171,three:196,underscore:197}],310:[function(e,t,r){var n=e("rx"),i=e("../Graph"),o=function(){function e(e,t){this._updates$=new n.Subject,this._cache$=new n.Subject,this._tilesService=new i.TilesService(e),this._vectorTilesService=new i.VectorTilesService(t),this._imageLoadingService=new i.ImageLoadingService,this._graph$=this._updates$.scan(function(e,t){var r=t(e);return r.evictNodeCache(),r},new i.Graph).shareReplay(1),this._graph$.subscribe(),this._updates$.onNext(function(e){return e}),this._loadingNode$=this._cache$.distinct(function(e){return e.key+e.lastCacheEvict}).flatMap(function(e){return e.cacheAssets()}).publish(),this._loadingNode$.connect(),this._loadingNode$.subscribe(this._imageLoadingService.loadnode$),this._cachedNode$=this._loadingNode$.filter(function(e){return!!e.image&&!!e.mesh}).publish(),this._cachedNode$.connect(),this._cachedNode$.subscribe(this._tilesService.cacheNode$),this._cachedNode$.subscribe(this._vectorTilesService.cacheNode$),this._cachedNode$.map(function(e){return function(t){return t.cacheNode(e),t}}).subscribe(this._updates$);var r;this._tilesService.tiles$.combineLatest(this._tilesService.cachedTiles$,function(e,t){return function(n){return r===e?n:(r=e,n.addNodesFromAPI(e,t),n)}}).subscribe(this._updates$)}return Object.defineProperty(e.prototype,"graph$",{get:function(){return this._graph$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageLoadingService",{get:function(){return this._imageLoadingService},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vectorTilesService",{get:function(){return this._vectorTilesService},enumerable:!0,configurable:!0}),e.prototype.node$=function(e){var t=this;return this._graph$.skipWhile(function(r){var n=r.getNode(e);return null==n?(t._tilesService.cacheIm$.onNext(e),!0):n.worthy?n.cached?!1:(t._cache$.onNext(n),!0):(t._tilesService.cacheNodeH$.onNext(n),!0)}).map(function(t){return t.getNode(e)}).take(1)},e.prototype.nextNode$=function(e,t){var r=this;return e.cached||n.Observable["throw"](new Error("node is not yet cached")),this._graph$.map(function(r){var n=r.nextNode(e,t);return null==n?null:n.key}).distinct().flatMap(function(e){return null==e?n.Observable["throw"](new Error("no Image in direction")):r.node$(e)})},e}();r.GraphService=o,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o},{"../Graph":256,rx:195}],311:[function(e,t,r){var n=e("rx"),i=function(){function e(){this._loadnode$=new n.Subject,this._loadstatus$=this._loadnode$.scan(function(e,t){return e[t.key]=t.loadStatus,e},{}).shareReplay(1),this._loadstatus$.subscribe()}return Object.defineProperty(e.prototype,"loadnode$",{get:function(){return this._loadnode$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadstatus$",{get:function(){return this._loadstatus$},enumerable:!0,configurable:!0}),e}();r.ImageLoadingService=i},{rx:195}],312:[function(e,t,r){var n=function(){function e(e,t,r,n,i,o,s,a){this._alt=e,this._firstSeenAt=t,this._latLon=r,this._key=n,this._lastSeenAt=i,this._rects=o,this._dPackage=s,this._value=a}return Object.defineProperty(e.prototype,"alt",{get:function(){return this._alt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstSeenAt",{get:function(){return this._firstSeenAt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"latLon",{get:function(){return this._latLon},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastSeenAt",{get:function(){return this._lastSeenAt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rects",{get:function(){return this._rects},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dPackage",{get:function(){return this._dPackage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.MapillaryObject=n,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n},{}],313:[function(e,t,r){var n=function(){function e(e,t,r){this._capturedAt=e,this._imageKey=t,this._rectKey=r}return Object.defineProperty(e.prototype,"capturedAt",{get:function(){return this._capturedAt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageKey",{get:function(){return this._imageKey},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rectKey",{get:function(){return this._rectKey},enumerable:!0,configurable:!0}),e}();r.MapillaryRect=n,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n},{}],314:[function(e,t,r){(function(t){var n=e("rx"),i=e("../Utils"),o=function(){function e(e,t,r,n,i,o,s,a){this.key=e,this.ca=t,this.latLon=r,this.worthy=n,this.sequence=i,this.apiNavImIm=o,this.translation=s,this.cached=!1,this.lastCacheEvict=0,this.lastUsed=(new Date).getTime(),this.hs=a,this.loadStatus={loaded:0,total:100}}return e.prototype.cacheAssets=function(){var e=this;return this.cacheImage().combineLatest(this.cacheMesh(),function(t,r){return e.loadStatus.loaded=0,e.loadStatus.total=0,r&&(e.mesh=r.object,e.loadStatus.loaded+=r.loaded.loaded,e.loadStatus.total+=r.loaded.total),t&&(e.image=t.object,e.loadStatus.loaded+=t.loaded.loaded,e.loadStatus.total+=t.loaded.total),e})},e.prototype.cacheImage=function(){var e=this;return n.Observable.create(function(r){var n=new Image;if(n.crossOrigin="Anonymous","development"===t.env.MAPENV)return r.onNext({loaded:{loaded:1,total:1},object:e.image}),void r.onCompleted();var o=new XMLHttpRequest;o.open("GET",i.Urls.image(e.key,i.Settings.baseImageSize),!0),o.responseType="arraybuffer",o.onload=function(e){n.onload=function(){r.onNext({loaded:{loaded:e.loaded,total:e.total},object:n}),r.onCompleted()},n.onerror=function(e){r.onError(e)};var t=new Blob([o.response]);n.src=window.URL.createObjectURL(t)},o.onprogress=function(e){r.onNext({loaded:{loaded:e.loaded,total:e.total},object:null})},o.send()})},e.prototype.cacheMesh=function(){var e=this;return n.Observable.create(function(r){if("development"===t.env.MAPENV)return r.onNext({loaded:{loaded:1,total:1},object:{faces:[[-1]],vertices:[[-1]]}}),void r.onCompleted();if(!e.merged){var n={faces:[],populated:!1,vertices:[]};return r.onNext({loaded:{loaded:0,total:0},object:n}),void r.onCompleted()}var o=new XMLHttpRequest;o.open("GET",i.Urls.mesh(e.key),!0),o.responseType="text",o.onload=function(t){var n=JSON.parse(o.responseText)[e.key];null==n?n={faces:[],populated:!1,vertices:[]}:n.populated=!0,r.onNext({loaded:{loaded:t.loaded,total:t.total},object:n}),r.onCompleted()},o.onprogress=function(e){r.onNext({loaded:{loaded:e.loaded,total:e.total},object:null})},o.send()})},Object.defineProperty(e.prototype,"loaded",{get:function(){return this.cached&&null!=this.image},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"merged",{get:function(){return null!=this.apiNavImIm&&null!=this.apiNavImIm.merge_version&&this.apiNavImIm.merge_version>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pano",{get:function(){return null!=this.apiNavImIm.gpano&&null!=this.apiNavImIm.gpano.FullPanoWidthPixels},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullPano",{get:function(){return null!=this.apiNavImIm.gpano&&0===this.apiNavImIm.gpano.CroppedAreaLeftPixels&&0===this.apiNavImIm.gpano.CroppedAreaTopPixels&&this.apiNavImIm.gpano.CroppedAreaImageWidthPixels===this.apiNavImIm.gpano.FullPanoWidthPixels&&this.apiNavImIm.gpano.CroppedAreaImageHeightPixels===this.apiNavImIm.gpano.FullPanoHeightPixels},enumerable:!0,configurable:!0}),e.prototype.findNextKeyInSequence=function(){return void 0===this.sequence?null:this.sequence.findNextKey(this.key)},e.prototype.findPrevKeyInSequence=function(){return void 0===this.sequence?null:this.sequence.findPrevKey(this.key)},e}();r.Node=o,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o}).call(this,e("_process"))},{"../Utils":260,_process:3,rx:195}],315:[function(e,t,r){var n=e("underscore"),i=function(){function e(e){this.response=e,this.key=e.key,this.keys=e.keys,this.path=e.path}return e.prototype.findNextKey=function(e){var t=n.indexOf(this.keys,e);return t+1>=this.keys.length||-1===t?null:this.keys[t+1]},e.prototype.findPrevKey=function(e){var t=n.indexOf(this.keys,e);return 0===t||-1===t?null:this.keys[t-1]},e}();r.Sequence=i,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=i},{underscore:197}],316:[function(e,t,r){var n=e("underscore"),i=e("latlon-geohash"),o=e("rx"),s=e("../Geo"),a=function(){function e(e){var t=this;this._updates$=new o.Subject,this._cacheH$=new o.Subject,this._cacheNodeH$=new o.Subject,this._cacheIm$=new o.Subject,this._cacheNode$=new o.Subject,this._spatialLib=new s.Spatial,this._apiV2=e,this._cachedTiles$=this._updates$.scan(function(e,t){return t(e)},{}).shareReplay(1),this._imTiles$=this._cacheIm$.distinct().flatMap(function(e){return o.Observable.fromPromise(t._apiV2.nav.im(e))}),this._hTiles$=this._cacheH$.distinct().flatMap(function(e){return o.Observable.fromPromise(t._apiV2.nav.h(e))}),this._cacheNodeH$.distinct(function(e){return e.key}).flatMap(function(e){return o.Observable.from(e.hs)}).subscribe(this._cacheH$),this._tiles$=this._imTiles$.merge(this._hTiles$).publish(),this._tiles$.connect(),this._tiles$.map(function(e){return function(t){return void 0!==e&&n.each(e.hs,function(e){t[e]=!0}),t}}).subscribe(this._updates$),this._cacheNode$.flatMap(function(e){var t=[],r=i.encode(e.latLon.lat,e.latLon.lon,7);return t.push(r),n.each(i.neighbours(r),function(e){t.push(e)}),o.Observable.from(t)}).subscribe(this._cacheH$)}return Object.defineProperty(e.prototype,"cacheH$",{get:function(){return this._cacheH$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cacheNodeH$",{get:function(){return this._cacheNodeH$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cacheIm$",{get:function(){return this._cacheIm$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cacheNode$",{get:function(){return this._cacheNode$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cachedTiles$",{get:function(){return this._cachedTiles$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tiles$",{get:function(){return this._tiles$},enumerable:!0,configurable:!0}),e}();r.TilesService=a,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=a},{"../Geo":255,"latlon-geohash":170,rx:195,underscore:197}],317:[function(e,t,r){var n=e("rx"),i=e("../Geo"),o=e("../Graph"),s=function(){function e(e){var t=this;this._cacheNode$=new n.Subject,this._apiV3=e,this._googleTiles=new i.GoogleTiles,this._mapillaryObjects$=this._cacheNode$.map(function(e){return t._googleTiles.getTileAtLatLon(e.latLon,17)}).distinct(function(e){return e.z+"-"+e.x+"-"+e.y}).flatMap(function(e){return t._apiV3.model.get(["tile","all",e.z,e.x,e.y,"objects",{from:0,to:100},["key","value","package","l","alt","rects","last_seen_at","first_seen_at"]])}).flatMap(function(e){var t=parseInt(Object.keys(e.json.tile.all)[0],10),r=parseInt(Object.keys(e.json.tile.all[t])[0],10),i=parseInt(Object.keys(e.json.tile.all[t][r])[0],10),s=e.json.tile.all[t][r][i].objects,a=[];for(var u in s)if(s.hasOwnProperty(u)&&(delete u.$__path,u=s[u],u.rects&&u.rects.length>1)){var c=[];for(var h in u.rects)if(u.rects.hasOwnProperty(h)){h=u.rects[h];var l=new o.MapillaryRect(h.capturedAt,h.imageKey,h.rectKey);c.push(l)}var p=new o.MapillaryObject(u.alt,u.first_seen_at,u.l,u.key,u.lastSeenAt,u.rects,u.dPackage,u.value);a.push(p)}return n.Observable.from(a)}).shareReplay(1)}return Object.defineProperty(e.prototype,"cacheNode$",{get:function(){return this._cacheNode$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapillaryObjects$",{get:function(){return this._mapillaryObjects$},enumerable:!0,configurable:!0}),e}();r.VectorTilesService=s,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=s},{"../Geo":255,"../Graph":256,rx:195}],318:[function(e,t,r){var n=e("../../Edge"),i=e("../../Geo"),o=function(){function e(e,t,r){this.spatial=new i.Spatial,this.settings=null!=e?e:new n.EdgeCalculatorSettings,this.directions=null!=t?t:new n.EdgeCalculatorDirections,this.coefficients=null!=r?r:new n.EdgeCalculatorCoefficients}return e.prototype.getPotentialEdges=function(e,t,r){if(!e.worthy||!e.merged)return[];for(var n=this.spatial.opticalCenter(e.apiNavImIm.rotation,e.translation),i=this.spatial.viewingDirection(e.apiNavImIm.rotation),o=this.spatial.angleToPlane(i.toArray(),[0,0,1]),s=[],a=0;a<t.length;a++){var u=t[a];if(u.merged&&u.key!==e.key){var c=this.spatial.opticalCenter(u.apiNavImIm.rotation,u.translation),h=c.clone().sub(n),l=h.length();if(!(l>this.settings.maxDistance&&r.indexOf(u.key)<0)){var p=this.spatial.angleBetweenVector2(i.x,i.y,h.x,h.y),f=this.spatial.angleToPlane(h.toArray(),[0,0,1]),d=this.spatial.viewingDirection(u.apiNavImIm.rotation),m=this.spatial.angleBetweenVector2(i.x,i.y,d.x,d.y),v=this.spatial.angleToPlane(d.toArray(),[0,0,1]),g=v-o,y=this.spatial.relativeRotationAngle(e.apiNavImIm.rotation,u.apiNavImIm.rotation),_=this.spatial.angleBetweenVector2(1,0,h.x,h.y),b=null!=u.sequence&&null!=e.sequence&&u.sequence.key===e.sequence.key,x=null==u.apiNavImIm.merge_cc&&null==e.apiNavImIm.merge_cc||u.apiNavImIm.merge_cc===e.apiNavImIm.merge_cc,w={apiNavImIm:u.apiNavImIm,directionChange:m,distance:l,fullPano:u.fullPano,motionChange:p,rotation:y,sameMergeCc:x,sameSequence:b,verticalDirectionChange:g,verticalMotion:f,worldMotionAzimuth:_};s.push(w)}}}return s},e.prototype.computeSequenceEdges=function(e){if(!e.worthy)return[];var t=[],r=e.findNextKeyInSequence();null!=r&&t.push({data:{direction:n.EdgeDirection.Next,worldMotionAzimuth:Number.NaN},from:e.apiNavImIm.key,to:r});var i=e.findPrevKeyInSequence();return null!=i&&t.push({data:{direction:n.EdgeDirection.Prev,worldMotionAzimuth:Number.NaN},from:e.apiNavImIm.key,to:i}),t},e.prototype.computeStepEdges=function(e,t,r,n){var i=[];if(e.fullPano)return i;for(var o in this.directions.steps)if(this.directions.steps.hasOwnProperty(o)){for(var s=this.directions.steps[o],a=Number.MAX_VALUE,u=null,c=null,h=0;h<t.length;h++){var l=t[h];if(!(l.fullPano||Math.abs(l.directionChange)>this.settings.stepMaxDirectionChange)){var p=this.spatial.angleDifference(s.motionChange,l.motionChange),f=this.spatial.angleDifference(l.directionChange,p),d=Math.max(Math.abs(p),Math.abs(f));if(!(Math.abs(d)>this.settings.stepMaxDrift)){var m=l.apiNavImIm.key;if(!s.useFallback||m!==r&&m!==n||(c=l),!(l.distance>this.settings.stepMaxDistance)){p=Math.sqrt(p*p+l.verticalMotion*l.verticalMotion);var v=this.coefficients.stepPreferredDistance*Math.abs(l.distance-this.settings.stepPreferredDistance)/this.settings.stepMaxDistance+this.coefficients.stepMotion*p/this.settings.stepMaxDrift+this.coefficients.stepRotation*l.rotation/this.settings.stepMaxDirectionChange+this.coefficients.stepSequencePenalty*(l.sameSequence?0:1)+this.coefficients.stepMergeCcPenalty*(l.sameMergeCc?0:1);a>v&&(a=v,u=l)}}}}u=null==u?c:u,null!=u&&i.push({data:{direction:s.direction,worldMotionAzimuth:u.worldMotionAzimuth},from:e.key,to:u.apiNavImIm.key})}return i},e.prototype.computeTurnEdges=function(e,t){var r=[];if(e.fullPano)return r;for(var i in this.directions.turns)if(this.directions.turns.hasOwnProperty(i)){for(var o=this.directions.turns[i],s=Number.MAX_VALUE,a=null,u=0;u<t.length;u++){var c=t[u];if(!(c.fullPano||c.distance>this.settings.turnMaxDistance)){var h=o.direction!==n.EdgeDirection.TurnU&&c.distance<this.settings.turnMaxRigDistance&&Math.abs(c.directionChange)>this.settings.turnMinRigDirectionChange,l=this.spatial.angleDifference(o.directionChange,c.directionChange),p=void 0;if(h&&c.directionChange*o.directionChange>0&&Math.abs(c.directionChange)<Math.abs(o.directionChange))p=-Math.PI/2+Math.abs(c.directionChange);else{if(Math.abs(l)>this.settings.turnMaxDirectionChange)continue;var f=o.motionChange?this.spatial.angleDifference(o.motionChange,c.motionChange):0;f=Math.sqrt(f*f+c.verticalMotion*c.verticalMotion),p=this.coefficients.turnDistance*c.distance/this.settings.turnMaxDistance+this.coefficients.turnMotion*f/Math.PI+this.coefficients.turnSequencePenalty*(c.sameSequence?0:1)+this.coefficients.turnMergeCcPenalty*(c.sameMergeCc?0:1);
}s>p&&(s=p,a=c)}}null!=a&&r.push({data:{direction:o.direction,worldMotionAzimuth:a.worldMotionAzimuth},from:e.key,to:a.apiNavImIm.key})}return r},e.prototype.computePerspectiveToPanoEdges=function(e,t){if(e.fullPano)return[];for(var r=Number.MAX_VALUE,i=null,o=0;o<t.length;o++){var s=t[o];if(s.fullPano){var a=this.coefficients.panoPreferredDistance*Math.abs(s.distance-this.settings.panoPreferredDistance)/this.settings.panoMaxDistance+this.coefficients.panoMotion*Math.abs(s.motionChange)/Math.PI+this.coefficients.panoMergeCcPenalty*(s.sameMergeCc?0:1);r>a&&(r=a,i=s)}}return null==i?[]:[{data:{direction:n.EdgeDirection.Pano,worldMotionAzimuth:i.worldMotionAzimuth},from:e.key,to:i.apiNavImIm.key}]},e.prototype.computeRotationEdges=function(e,t){var r=[];if(e.fullPano)return r;for(var n in this.directions.rotations)if(this.directions.rotations.hasOwnProperty(n)){for(var i=this.directions.rotations[n],o=Number.MAX_VALUE,s=null,a=0;a<t.length;a++){var u=t[a];if(!u.fullPano&&!(u.distance>this.settings.rotationMaxDistance||u.directionChange*i.directionChangeSign<0||Math.abs(u.directionChange)>this.settings.rotationMaxDirectionChange||Math.abs(u.verticalDirectionChange)>this.settings.rotationMaxVerticalDirectionChange)){var c=Math.abs(u.directionChange);o>c&&(o=c,s=u)}}null!=s&&r.push({data:{direction:i.direction,worldMotionAzimuth:s.worldMotionAzimuth},from:e.key,to:s.apiNavImIm.key})}return r},e.prototype.computePanoEdges=function(e,t){if(!e.fullPano)return[];for(var r=[],i=[],o=[],s=0;s<t.length;s++){var a=t[s];if(!(a.distance>this.settings.panoMaxDistance))if(a.fullPano){if(a.distance<this.settings.panoMinDistance)continue;i.push(a)}else for(var u in this.directions.panos)if(this.directions.panos.hasOwnProperty(u)){var c=this.directions.panos[u],h=this.spatial.angleDifference(a.directionChange,a.motionChange),l=this.spatial.angleDifference(c.directionChange,h);if(!(Math.abs(l)>this.settings.panoMaxStepTurnChange)){o.push([c.direction,a]);break}}}for(var p=Math.PI/this.settings.panoMaxItems,f=[],d=[],m=0;m<this.settings.panoMaxItems;m++){for(var v=m/this.settings.panoMaxItems*2*Math.PI,g=Number.MAX_VALUE,y=null,_=0;_<i.length;_++){var a=i[_],b=this.spatial.angleDifference(v,a.motionChange);if(!(Math.abs(b)>p)){for(var x=Number.MAX_VALUE,w=0;w<f.length;w++){var S=f[w],M=Math.abs(this.spatial.angleDifference(S,a.motionChange));x>M&&(x=M)}if(!(p>=x)){var E=this.coefficients.panoPreferredDistance*Math.abs(a.distance-this.settings.panoPreferredDistance)/this.settings.panoMaxDistance+this.coefficients.panoMotion*Math.abs(b)/p+this.coefficients.panoSequencePenalty*(a.sameSequence?0:1)+this.coefficients.panoMergeCcPenalty*(a.sameMergeCc?0:1);g>E&&(g=E,y=a)}}}null!=y?(f.push(y.motionChange),r.push({data:{direction:n.EdgeDirection.Pano,worldMotionAzimuth:y.worldMotionAzimuth},from:e.key,to:y.apiNavImIm.key})):d.push(v)}var C={};C[n.EdgeDirection.Pano]=f,C[n.EdgeDirection.StepForward]=[],C[n.EdgeDirection.StepLeft]=[],C[n.EdgeDirection.StepBackward]=[],C[n.EdgeDirection.StepRight]=[];for(var T=0;T<d.length;T++){var A=d[T],P=[];for(var u in this.directions.panos)if(this.directions.panos.hasOwnProperty(u)){for(var c=this.directions.panos[u],k=C[n.EdgeDirection.Pano].concat(C[c.direction]).concat(C[c.prev]).concat(C[c.next]),g=Number.MAX_VALUE,y=null,O=0;O<o.length;O++){var a=o[O];if(a[0]===c.direction){var N=this.spatial.angleDifference(A,a[1].motionChange);if(!(Math.abs(N)>p)){for(var D=Number.MAX_VALUE,L=0;L<k.length;L++){var S=k[L],x=Math.abs(this.spatial.angleDifference(S,a[1].motionChange));D>x&&(D=x)}if(!(p>=D)){var E=this.coefficients.panoPreferredDistance*Math.abs(a[1].distance-this.settings.panoPreferredDistance)/this.settings.panoMaxDistance+this.coefficients.panoMotion*Math.abs(N)/p+this.coefficients.panoMergeCcPenalty*(a[1].sameMergeCc?0:1);g>E&&(g=E,y=a)}}}}null!=y&&(P.push(y),r.push({data:{direction:y[0],worldMotionAzimuth:y[1].worldMotionAzimuth},from:e.key,to:y[1].apiNavImIm.key}))}for(var R=0;R<P.length;R++){var j=P[R];C[j[0]].push(j[1].motionChange)}}return r},e}();r.EdgeCalculator=o,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o},{"../../Edge":253,"../../Geo":255}],319:[function(e,t,r){var n=function(){function e(){this.stepPreferredDistance=4,this.stepMotion=3,this.stepRotation=4,this.stepSequencePenalty=2,this.stepMergeCcPenalty=6,this.turnDistance=4,this.turnMotion=2,this.turnSequencePenalty=1,this.turnMergeCcPenalty=4,this.panoPreferredDistance=2,this.panoMotion=2,this.panoSequencePenalty=1,this.panoMergeCcPenalty=4}return e}();r.EdgeCalculatorCoefficients=n,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n},{}],320:[function(e,t,r){var n=e("../../Edge"),i=function(){function e(){this.steps={},this.turns={},this.panos={},this.rotations={},this.steps[n.EdgeDirection.StepForward]={direction:n.EdgeDirection.StepForward,motionChange:0,useFallback:!0},this.steps[n.EdgeDirection.StepBackward]={direction:n.EdgeDirection.StepBackward,motionChange:Math.PI,useFallback:!0},this.steps[n.EdgeDirection.StepLeft]={direction:n.EdgeDirection.StepLeft,motionChange:Math.PI/2,useFallback:!1},this.steps[n.EdgeDirection.StepRight]={direction:n.EdgeDirection.StepRight,motionChange:-Math.PI/2,useFallback:!1},this.turns[n.EdgeDirection.TurnLeft]={direction:n.EdgeDirection.TurnLeft,directionChange:Math.PI/2,motionChange:Math.PI/4},this.turns[n.EdgeDirection.TurnRight]={direction:n.EdgeDirection.TurnRight,directionChange:-Math.PI/2,motionChange:-Math.PI/4},this.turns[n.EdgeDirection.TurnU]={direction:n.EdgeDirection.TurnU,directionChange:Math.PI,motionChange:null},this.panos[n.EdgeDirection.StepForward]={direction:n.EdgeDirection.StepForward,directionChange:0,next:n.EdgeDirection.StepLeft,prev:n.EdgeDirection.StepRight},this.panos[n.EdgeDirection.StepBackward]={direction:n.EdgeDirection.StepBackward,directionChange:Math.PI,next:n.EdgeDirection.StepRight,prev:n.EdgeDirection.StepLeft},this.panos[n.EdgeDirection.StepLeft]={direction:n.EdgeDirection.StepLeft,directionChange:Math.PI/2,next:n.EdgeDirection.StepBackward,prev:n.EdgeDirection.StepForward},this.panos[n.EdgeDirection.StepRight]={direction:n.EdgeDirection.StepRight,directionChange:-Math.PI/2,next:n.EdgeDirection.StepForward,prev:n.EdgeDirection.StepBackward},this.rotations[n.EdgeDirection.RotateLeft]={direction:n.EdgeDirection.RotateLeft,directionChangeSign:1},this.rotations[n.EdgeDirection.RotateRight]={direction:n.EdgeDirection.RotateRight,directionChangeSign:-1}}return e}();r.EdgeCalculatorDirections=i},{"../../Edge":253}],321:[function(e,t,r){var n=function(){function e(){this.stepMaxDistance=20,this.stepMaxDirectionChange=Math.PI/6,this.stepMaxDrift=Math.PI/6,this.stepPreferredDistance=4,this.turnMaxDistance=15,this.turnMaxDirectionChange=2*Math.PI/9,this.turnMaxRigDistance=.65,this.turnMinRigDirectionChange=Math.PI/6,this.panoMinDistance=.1,this.panoMaxDistance=20,this.panoPreferredDistance=5,this.panoMaxItems=4,this.panoMaxStepTurnChange=Math.PI/8,this.rotationMaxDistance=this.turnMaxRigDistance,this.rotationMaxDirectionChange=Math.PI/6,this.rotationMaxVerticalDirectionChange=Math.PI/8}return Object.defineProperty(e.prototype,"maxDistance",{get:function(){return Math.max(this.panoMaxDistance,Math.max(this.stepMaxDistance,this.turnMaxDistance))},enumerable:!0,configurable:!0}),e}();r.EdgeCalculatorSettings=n,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n},{}],322:[function(e,t,r){!function(e){e[e.Next=0]="Next",e[e.Prev=1]="Prev",e[e.StepLeft=2]="StepLeft",e[e.StepRight=3]="StepRight",e[e.StepForward=4]="StepForward",e[e.StepBackward=5]="StepBackward",e[e.TurnLeft=6]="TurnLeft",e[e.TurnRight=7]="TurnRight",e[e.TurnU=8]="TurnU",e[e.RotateLeft=9]="RotateLeft",e[e.RotateRight=10]="RotateRight",e[e.Pano=11]="Pano"}(r.EdgeDirection||(r.EdgeDirection={}));r.EdgeDirection},{}],323:[function(e,t,r){},{}],324:[function(e,t,r){},{}],325:[function(e,t,r){var n=e("underscore"),i=e("rx"),o=e("virtual-dom"),s=function(){function e(e){this._render$=new i.Subject;var t=o.create(o.h("div.domRenderer",[]));e.appendChild(t),this._vNode$=this._render$.scan(function(e,t){return null==t.vnode?delete e[t.name]:e[t.name]=t.vnode,e},{}).map(function(e){var t=n.values(e);return o.h("div.domRenderer",t)}),this._vPatch$=this._vNode$.scan(function(e,t){return e.vpatch=o.diff(e.vnode,t),e.vnode=t,e},{vnode:o.h("div.domRenderer",[]),vpatch:null}).pluck("vpatch"),this._element$=this._vPatch$.scan(function(e,t){return o.patch(e,t)},t).shareReplay(1).publish(),this._element$.connect(),this._element$.subscribe()}return Object.defineProperty(e.prototype,"element$",{get:function(){return this._element$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"render$",{get:function(){return this._render$},enumerable:!0,configurable:!0}),e.prototype.clear=function(e){return this._render$.onNext({name:e,vnode:null})},e}();r.DOMRenderer=s,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=s},{rx:195,underscore:197,"virtual-dom":202}],326:[function(e,t,r){!function(e){e[e.Letterbox=0]="Letterbox",e[e.Fill=1]="Fill"}(r.GLRenderMode||(r.GLRenderMode={}));var n=r.GLRenderMode;Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n},{}],327:[function(e,t,r){!function(e){e[e.Background=0]="Background",e[e.Foreground=1]="Foreground"}(r.GLRenderStage||(r.GLRenderStage={}));var n=r.GLRenderStage;Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n},{}],328:[function(e,t,r){var n=e("rx"),i=e("three"),o=e("underscore"),s=e("../Geo"),a=e("../Render"),u=function(){function e(e){this.alpha=0,this.currentAspect=1,this.currentOrientation=1,this.currentPano=!1,this.focal=1,this.frameId=0,this.needsRender=!1,this.previousAspect=1,this.previousOrientation=1,this.previousPano=!1,this.renderMode=a.GLRenderMode.Letterbox,this._lastCamera=new s.Camera,this._perspective=new i.PerspectiveCamera(50,e,.4,1e4)}return Object.defineProperty(e.prototype,"perspective",{get:function(){return this._perspective},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastCamera",{get:function(){return this._lastCamera},enumerable:!0,configurable:!0}),e.prototype.updateProjection=function(){var e=this._getAspect(this.currentAspect,this.currentOrientation,this.currentPano,this.perspective.aspect),t=this._getAspect(this.previousAspect,this.previousOrientation,this.previousPano,this.perspective.aspect),r=(1-this.alpha)*t+this.alpha*e,n=2*Math.atan(.5/r/this.focal)*180/Math.PI;this._perspective.fov=n,this._perspective.updateProjectionMatrix()},e.prototype.updatePerspective=function(e){this._perspective.up.copy(e.up),this._perspective.position.copy(e.position),this._perspective.lookAt(e.lookat)},e.prototype._getAspect=function(e,t,r,n){if(r)return 4/3>n?n:4/3;var i=5>t?1:1/e/e,o=this.renderMode===a.GLRenderMode.Letterbox?e>n:n>e,s=o?i*n:i*e;return s},e}(),c=function(){function e(e,t){var r=this;this._resize$=new n.Subject,this._renderMode$=new n.Subject,this._frame$=new n.Subject,this._cameraStateOperation$=new n.Subject,this._render$=new n.Subject,this._clear$=new n.Subject,this._renderOperation$=new n.Subject,this._rendererOperation$=new n.Subject,this._element=e,this._currentFrame$=t,this._renderer$=this._rendererOperation$.scan(function(e,t){return t(e)},{needsRender:!1,renderer:null}),this._render$.first().subscribe(function(e){r._rendererOperation$.onNext(function(e){var t=new i.WebGLRenderer;return t.setSize(r._element.offsetWidth,r._element.offsetHeight),t.setClearColor(new i.Color(2105376),1),t.sortObjects=!1,t.domElement.style.width="100%",t.domElement.style.height="100%",r._element.appendChild(t.domElement),e.needsRender=!0,e.renderer=t,e})}),this._frameSubscribe(),this._renderCollection$=this._renderOperation$.scan(function(e,t){return t(e)},{}),this._render$.map(function(e){return function(t){return t[e.name]=e.render,t}}).subscribe(this._renderOperation$),this._clear$.map(function(e){return function(t){return delete t[e],t}}).subscribe(this._renderOperation$),this._clear$.map(function(e){return function(e){return null==e.renderer?e:(e.needsRender=!0,e)}}).subscribe(this._rendererOperation$),this._renderCollection$.subscribe(function(e){Object.keys(e).length||null==r._frameSubscription||(r._frameSubscription.dispose(),r._frameSubscription=null,r._frameSubscribe())}),this._cameraState$=this._cameraStateOperation$.scan(function(e,t){return t(e)},new u(this._element.offsetWidth/this._element.offsetHeight)),this._frame$.map(function(e){return function(t){t.frameId=e.id;var r=e.state.camera;if(t.lastCamera.diff(r)<1e-5&&t.alpha===e.state.alpha)return t;t.alpha=e.state.alpha,t.focal=r.focal;var n=e.state.currentTransform,i=e.state.previousTransform;return null==i&&(i=e.state.currentTransform),t.currentAspect=n.aspect,t.currentOrientation=n.orientation,t.currentPano=e.state.currentNode.fullPano,t.previousAspect=i.aspect,t.previousOrientation=i.orientation,t.previousPano=null!=e.state.previousNode&&e.state.previousNode.fullPano,t.updateProjection(),t.updatePerspective(r),t.lastCamera.copy(r),t.needsRender=!0,t}}).subscribe(this._cameraStateOperation$),this._size$=this._resize$.map(function(){return{height:r._element.offsetHeight,width:r._element.offsetWidth}}).share(),this._size$.map(function(e){return function(t){return t.perspective.aspect=e.width/e.height,t.updateProjection(),t.needsRender=!0,t}}).subscribe(this._cameraStateOperation$),this._size$.map(function(e){return function(t){return null==t.renderer?t:(t.renderer.setSize(e.width,e.height),t.needsRender=!0,t)}}).subscribe(this._rendererOperation$),this._renderMode$.map(function(e){return function(t){return t.renderMode=e,t.updateProjection(),t.needsRender=!0,t}}).subscribe(this._cameraStateOperation$),n.Observable.combineLatest(this._cameraState$,this._renderCollection$,this._renderer$,function(e,t,r){return{cameraState:e,renderer:r,renders:o.values(t)}}).filter(function(e){for(var t=e.cameraState.needsRender||e.renderer.needsRender,r=e.cameraState.frameId,n=0,i=e.renders;n<i.length;n++){var o=i[n];if(o.frameId!==r)return!1;t=t||o.needsRender}return t}).distinctUntilChanged(function(e){return e.cameraState.frameId}).subscribe(function(e){e.cameraState.needsRender=!1,e.renderer.needsRender=!1;for(var t=e.cameraState.perspective,r=[],n=[],i=0,o=e.renders;i<o.length;i++){var s=o[i];s.stage===a.GLRenderStage.Background?r.push(s.render):s.stage===a.GLRenderStage.Foreground&&n.push(s.render)}var u=e.renderer.renderer;u.autoClear=!1,u.clear();for(var c=0;c<r.length;c++){var s=r[c];s(t,u)}u.clearDepth();for(var h=0;h<n.length;h++){var s=n[h];s(t,u)}})}return Object.defineProperty(e.prototype,"render$",{get:function(){return this._render$},enumerable:!0,configurable:!0}),e.prototype.clear=function(e){this._clear$.onNext(e)},e.prototype.resize=function(){this._resize$.onNext(null)},e.prototype.setRenderMode=function(e){this._renderMode$.onNext(e)},e.prototype._frameSubscribe=function(){var e=this;this._render$.first().subscribe(function(t){e._frameSubscription=e._currentFrame$.subscribe(e._frame$)})},e}();r.GLRenderer=c,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=c},{"../Geo":255,"../Render":258,rx:195,three:196,underscore:197}],329:[function(e,t,r){},{}],330:[function(e,t,r){var n=function(){function e(){window.requestAnimationFrame?(this._requestAnimationFrame=window.requestAnimationFrame,this._cancelAnimationFrame=window.cancelAnimationFrame):window.mozRequestAnimationFrame?(this._requestAnimationFrame=window.mozRequestAnimationFrame,this._cancelAnimationFrame=window.mozCancelAnimationFrame):window.webkitRequestAnimationFrame?(this._requestAnimationFrame=window.webkitRequestAnimationFrame,this._cancelAnimationFrame=window.webkitCancelAnimationFrame):window.msRequestAnimationFrame?(this._requestAnimationFrame=window.msRequestAnimationFrame,this._cancelAnimationFrame=window.msCancelRequestAnimationFrame):window.oRequestAnimationFrame?(this._requestAnimationFrame=window.oRequestAnimationFrame,this._cancelAnimationFrame=window.oCancelAnimationFrame):(this._requestAnimationFrame=function(e){return window.setTimeout(e,1e3/60)},this._cancelAnimationFrame=window.clearTimeout)}return e.prototype.requestAnimationFrame=function(e){return this._requestAnimationFrame.call(window,e)},e.prototype.cancelAnimationFrame=function(e){this._cancelAnimationFrame.call(window,e)},e}();r.FrameGenerator=n},{}],331:[function(e,t,r){!function(e){e[e.Traversing=0]="Traversing",e[e.Waiting=1]="Waiting"}(r.State||(r.State={}));var n=r.State;Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n},{}],332:[function(e,t,r){var n=e("../State"),i=e("../Geo"),o=function(){function e(){this._state=new n.TraversingState({alpha:1,camera:new i.Camera,currentIndex:0,trajectory:[]})}return e.prototype.traverse=function(){this._state=this._state.traverse()},e.prototype.wait=function(){this._state=this._state.wait()},Object.defineProperty(e.prototype,"state",{get:function(){if(this._state instanceof n.TraversingState)return n.State.Traversing;if(this._state instanceof n.WaitingState)return n.State.Waiting;throw new Error("Invalid state")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._state.alpha},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"camera",{get:function(){return this._state.camera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentNode",{get:function(){return this._state.currentNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"previousNode",{get:function(){return this._state.previousNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTransform",{get:function(){return this._state.currentTransform},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"previousTransform",{get:function(){return this._state.previousTransform},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trajectory",{get:function(){return this._state.trajectory},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentIndex",{get:function(){return this._state.currentIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastNode",{get:function(){return this._state.trajectory[this._state.trajectory.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nodesAhead",{get:function(){return this._state.trajectory.length-1-this._state.currentIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"motionless",{get:function(){return this._state.motionless},enumerable:!0,configurable:!0}),e.prototype.update=function(){this._state.update()},e.prototype.append=function(e){this._state.append(e)},e.prototype.prepend=function(e){this._state.prepend(e)},e.prototype.remove=function(e){this._state.remove(e)},e.prototype.cut=function(){this._state.cut()},e.prototype.set=function(e){this._state.set(e)},e.prototype.rotate=function(e){this._state.rotate(e)},e.prototype.move=function(e){this._state.move(e)},e.prototype.moveTo=function(e){this._state.moveTo(e)},e}();r.StateContext=o},{"../Geo":255,"../State":259}],333:[function(e,t,r){var n=e("rx"),i=e("../State"),o=function(){function e(){this._appendNode$=new n.Subject,this._frame$=new n.Subject,this._contextOperation$=new n.BehaviorSubject(function(e){return e}),this._context$=this._contextOperation$.scan(function(e,t){return t(e)},new i.StateContext).shareReplay(1),this._state$=this._context$.map(function(e){return e.state}).distinctUntilChanged().shareReplay(1),this._currentState$=this._frame$.withLatestFrom(this._context$,function(e,t){return[e,t]})["do"](function(e){e[1].update()}).map(function(e){return{id:e[0],state:e[1]}}).shareReplay(1),this._currentNode$=this._currentState$.map(function(e){return e.state.currentNode}).filter(function(e){return null!=e}).distinctUntilChanged().shareReplay(1),this._appendNode$.map(function(e){return function(t){return t.append([e]),t}}).subscribe(this._contextOperation$),this._state$.subscribe(),this._currentNode$.subscribe(),this._frameId=null,this._frameGenerator=new i.FrameGenerator}return Object.defineProperty(e.prototype,"currentState$",{get:function(){return this._currentState$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentNode$",{get:function(){return this._currentNode$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state$",{get:function(){return this._state$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"appendNode$",{get:function(){return this._appendNode$},enumerable:!0,configurable:!0}),e.prototype.traverse=function(){this._invokeContextOperation(function(e){e.traverse()})},e.prototype.wait=function(){this._invokeContextOperation(function(e){e.wait()})},e.prototype.appendNodes=function(e){this._invokeContextOperation(function(t){t.append(e)})},e.prototype.prependNodes=function(e){this._invokeContextOperation(function(t){t.prepend(e)})},e.prototype.removeNodes=function(e){this._invokeContextOperation(function(t){t.remove(e)})},e.prototype.cutNodes=function(){this._invokeContextOperation(function(e){e.cut()})},e.prototype.setNodes=function(e){this._invokeContextOperation(function(t){t.set(e)})},e.prototype.rotate=function(e){this._invokeContextOperation(function(t){t.rotate(e)})},e.prototype.move=function(e){this._invokeContextOperation(function(t){t.move(e)})},e.prototype.moveTo=function(e){this._invokeContextOperation(function(t){t.moveTo(e)})},e.prototype.start=function(){null==this._frameId&&(this._frameId=this._frameGenerator.requestAnimationFrame(this.frame.bind(this)))},e.prototype.stop=function(){null!=this._frameId&&(this._frameGenerator.cancelAnimationFrame(this._frameId),this._frameId=null)},e.prototype._invokeContextOperation=function(e){this._contextOperation$.onNext(function(t){return e(t),t})},e.prototype.frame=function(e){this._frameId=this._frameGenerator.requestAnimationFrame(this.frame.bind(this)),this._frame$.onNext(this._frameId)},e}();r.StateService=o},{"../State":259,rx:195}],334:[function(e,t,r){},{}],335:[function(e,t,r){var n=e("../../Error"),i=e("../../Geo"),o=function(){function e(e){this._spatial=new i.Spatial,this._alpha=e.alpha,this._camera=e.camera.clone(),this._currentIndex=e.currentIndex,this._trajectory=e.trajectory.slice(),this._trajectoryTransforms=[],this._trajectoryCameras=[];for(var t=0,r=this._trajectory;t<r.length;t++){var n=r[t],o=new i.Transform(n);this._trajectoryTransforms.push(o),this._trajectoryCameras.push(new i.Camera(o))}this._currentNode=this._trajectory.length>0?this._trajectory[this._currentIndex]:null,this._previousNode=this._trajectory.length>1&&this.currentIndex>0?this._trajectory[this._currentIndex-1]:null,this._currentCamera=this._trajectoryCameras.length>0?this._trajectoryCameras[this._currentIndex].clone():new i.Camera,this._previousCamera=this._trajectoryCameras.length>1&&this.currentIndex>0?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()}return Object.defineProperty(e.prototype,"alpha",{get:function(){return this._getAlpha()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"camera",{get:function(){return this._camera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trajectory",{get:function(){return this._trajectory},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentIndex",{get:function(){return this._currentIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentNode",{get:function(){return this._currentNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"previousNode",{get:function(){return this._previousNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTransform",{get:function(){return this._trajectoryTransforms.length>0?this._trajectoryTransforms[this.currentIndex]:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"previousTransform",{get:function(){return this._trajectoryTransforms.length>1&&this.currentIndex>0?this._trajectoryTransforms[this.currentIndex-1]:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"motionless",{get:function(){return this._motionless},enumerable:!0,configurable:!0}),e.prototype.append=function(e){if(e.length<1)throw Error("Trajectory can not be empty");this._trajectory=this._trajectory.concat(e),this._appendToTrajectories(e)},e.prototype.prepend=function(e){if(e.length<1)throw Error("Trajectory can not be empty");this._trajectory=e.slice().concat(this._trajectory),this._prependToTrajectories(e),this._currentIndex+=e.length,this._setCurrent()},e.prototype.remove=function(e){if(0>e)throw Error("n must be a positive integer");var t=this._trajectory.length;if(t-(this._currentIndex+1)<e)throw Error("Current node can not be removed");for(var r=0;e>r;r++)this._trajectory.pop(),this._trajectoryTransforms.pop(),this._trajectoryCameras.pop()},e.prototype.cut=function(){for(;this._trajectory.length-1>this._currentIndex;)this._trajectory.pop(),this._trajectoryTransforms.pop(),this._trajectoryCameras.pop()},e.prototype.set=function(e){this._set(e),this._setCurrent()},e.prototype._set=function(e){if(e.length<1)throw new n.ParameterMapillaryError("Trajectory can not be empty");null!=this._currentNode?(this._trajectory=[this._currentNode].concat(e),this._currentIndex=1):(this._trajectory=e.slice(),this._currentIndex=0),this._trajectoryTransforms.length=0,this._trajectoryCameras.length=0,this._appendToTrajectories(this._trajectory)},e.prototype._setCurrent=function(){if(this._currentNode=this._trajectory[this._currentIndex],this._previousNode=this._currentIndex>0?this._trajectory[this._currentIndex-1]:null,this._currentCamera=this._trajectoryCameras[this._currentIndex].clone(),this._previousCamera=this._currentIndex>0?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone(),null!=this._previousNode){var e=this._camera.lookat.clone().sub(this._camera.position);this._previousNode.pano&&this._previousCamera.lookat.copy(e.clone().add(this._previousCamera.position)),this._currentNode.pano&&this._currentCamera.lookat.copy(e.clone().add(this._currentCamera.position))}},e.prototype._motionlessTransition=function(){var e=null!=this._currentNode&&null!=this._previousNode;return e&&!(this._currentNode.merged&&this._previousNode.merged&&this._withinOriginalDistance()&&this._sameConnectedComponent())},e.prototype._appendToTrajectories=function(e){for(var t=0;t<e.length;t++){var r=e[t];if(!r.loaded)throw new n.ParameterMapillaryError("Node must be loaded when added to trajectory");var o=new i.Transform(r);this._trajectoryTransforms.push(o),this._trajectoryCameras.push(new i.Camera(o))}},e.prototype._prependToTrajectories=function(e){for(var t=0,r=e.reverse();t<r.length;t++){var o=r[t];if(!o.loaded)throw new n.ParameterMapillaryError("Node must be loaded when added to trajectory");var s=new i.Transform(o);this._trajectoryTransforms.unshift(s),this._trajectoryCameras.unshift(new i.Camera(s))}},e.prototype._sameConnectedComponent=function(){var e=this._currentNode,t=this._previousNode;return e&&e.apiNavImIm.merge_cc&&t&&t.apiNavImIm.merge_cc?e.apiNavImIm.merge_cc===t.apiNavImIm.merge_cc:!0},e.prototype._withinOriginalDistance=function(){var e=this._currentNode,t=this._previousNode;if(!e||!t)return!0;var r=this._spatial.distanceFromLatLon(e.apiNavImIm.lat,e.apiNavImIm.lon,t.apiNavImIm.lat,t.apiNavImIm.lon);return 25>r},e}();r.StateBase=o},{"../../Error":254,"../../Geo":255}],336:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("three"),o=e("unitbezier"),s=e("../../State"),a=function(){function e(e,t){this._phi=e,this._theta=t}return Object.defineProperty(e.prototype,"phi",{get:function(){return this._phi},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"theta",{get:function(){return this._theta},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isZero",{get:function(){return 0===this._phi&&0===this._theta},enumerable:!0,configurable:!0}),e.prototype.copy=function(e){this._phi=e.phi,this._theta=e.theta},e.prototype.lerp=function(e,t){this._phi=(1-t)*this._phi+t*e.phi,this._theta=(1-t)*this._theta+t*e.theta},e.prototype.multiply=function(e){this._phi*=e,this._theta*=e},e.prototype.threshold=function(e){this._phi=Math.abs(this._phi)>e?this._phi:0,this._theta=Math.abs(this._theta)>e?this._theta:0},e.prototype.lengthSquared=function(){return this._phi*this._phi+this._theta*this._theta},e.prototype.reset=function(){this._phi=0,this._theta=0},e}(),u=function(e){function t(t){e.call(this,t),this._motionless=this._motionlessTransition(),this._baseAlpha=this._alpha,this._animationSpeed=.025,this._unitBezier=new o(.74,.67,.38,.96),this._useBezier=!1,this._rotationDelta=new a(0,0),this._requestedRotationDelta=null,this._rotationAcceleration=.86,this._rotationIncreaseAlpha=.25,this._rotationDecreaseAlpha=.9,this._rotationThreshold=.001}return n(t,e),t.prototype.traverse=function(){throw new Error("Not implemented")},t.prototype.wait=function(){return new s.WaitingState(this)},t.prototype.append=function(t){0===this._trajectory.length&&(this._currentIndex=0,this._setNodes()),e.prototype.append.call(this,t)},t.prototype.prepend=function(t){0===this._trajectory.length&&(this._currentIndex=0,this._setNodes()),e.prototype.prepend.call(this,t)},t.prototype.set=function(t){e.prototype._set.call(this,t),this._setNodes(),this._clearRotation(),this._trajectory.length<3&&(this._useBezier=!0)},t.prototype.move=function(e){throw new Error("Not implemented")},t.prototype.moveTo=function(e){throw new Error("Not implemented")},t.prototype.rotate=function(e){null!=this._currentNode&&this._currentNode.fullPano&&(this._requestedRotationDelta=new a(e.phi,e.theta))},t.prototype.update=function(){1===this._alpha&&this._currentIndex+this._alpha<this._trajectory.length&&(this._currentIndex+=1,this._useBezier=this._trajectory.length<3&&this._currentIndex+1===this._trajectory.length,this._setNodes(),this._clearRotation()),this._baseAlpha=Math.min(1,this._baseAlpha+this._animationSpeed),this._useBezier?this._alpha=this._unitBezier.solve(this._baseAlpha):this._alpha=this._baseAlpha,this._updateRotation(),this._applyRotation(this._previousCamera),this._applyRotation(this._currentCamera),this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)},t.prototype._getAlpha=function(){return this._motionless?Math.ceil(this._alpha):this._alpha},t.prototype._setNodes=function(){this._alpha=0,this._baseAlpha=0,e.prototype._setCurrent.call(this),this._motionless=this._motionlessTransition()},t.prototype._applyRotation=function(e){if(null!=e){var t=(new i.Quaternion).setFromUnitVectors(e.up,new i.Vector3(0,0,1)),r=t.clone().inverse(),n=new i.Vector3;n.copy(e.lookat).sub(e.position),n.applyQuaternion(t);var o=n.length(),s=Math.atan2(n.y,n.x);s+=this._rotationDelta.phi;var a=Math.atan2(Math.sqrt(n.x*n.x+n.y*n.y),n.z);a+=this._rotationDelta.theta,a=Math.max(.1,Math.min(Math.PI-.1,a)),n.x=Math.sin(a)*Math.cos(s),n.y=Math.sin(a)*Math.sin(s),n.z=Math.cos(a),n.applyQuaternion(r),e.lookat.copy(e.position).add(n.multiplyScalar(o))}},t.prototype._updateRotation=function(){if(null!=this._requestedRotationDelta){var e=this._rotationDelta.lengthSquared(),t=this._requestedRotationDelta.lengthSquared();return t>e?this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationIncreaseAlpha):this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationDecreaseAlpha),void(this._requestedRotationDelta=null)}this._rotationDelta.isZero||(this._rotationDelta.multiply(this._rotationAcceleration),this._rotationDelta.threshold(this._rotationThreshold))},t.prototype._clearRotation=function(){this._currentNode.pano||(null!=this._requestedRotationDelta&&(this._requestedRotationDelta=null),this._rotationDelta.isZero||this._rotationDelta.reset())},t}(s.StateBase);r.TraversingState=u;
},{"../../State":259,three:196,unitbezier:198}],337:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("../../State"),o=function(e){function t(t){e.call(this,t),this._motionless=this._motionlessTransition()}return n(t,e),t.prototype.traverse=function(){return new i.TraversingState(this)},t.prototype.wait=function(){throw new Error("Not implemented")},t.prototype.prepend=function(t){e.prototype.prepend.call(this,t),this._motionless=this._motionlessTransition()},t.prototype.set=function(t){e.prototype.set.call(this,t),this._motionless=this._motionlessTransition()},t.prototype.rotate=function(e){},t.prototype.move=function(e){this._alpha=Math.max(0,Math.min(1,this._alpha+e))},t.prototype.moveTo=function(e){this._alpha=Math.max(0,Math.min(1,e))},t.prototype.update=function(){this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)},t.prototype._getAlpha=function(){return this._motionless?Math.ceil(this._alpha):this._alpha},t}(i.StateBase);r.WaitingState=o},{"../../State":259}],338:[function(e,t,r){var n=function(){function e(){this.events={}}return e.prototype.on=function(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)},e.prototype.off=function(e,t){if(!e)return void(this.events={});if(this.listens(e))delete this.events[e];else{var r=this.events[e].indexOf(t);r>=0&&this.events[e].splice(r,1),this.events[e].length&&delete this.events[e]}},e.prototype.fire=function(e,t){if(this.listens(e))for(var r=0,n=this.events[e];r<n.length;r++){var i=n[r];i.call(this,t)}},e.prototype.listens=function(e){return!(!this.events||!this.events[e])},e}();r.EventEmitter=n,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n},{}],339:[function(e,t,r){var n=function(){function e(){}return e.setOptions=function(t){t.baseImageSize?e._baseImageSize=t.baseImageSize:e._baseImageSize=640},Object.defineProperty(e,"baseImageSize",{get:function(){return e._baseImageSize},enumerable:!0,configurable:!0}),e}();r.Settings=n,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n},{}],340:[function(e,t,r){var n=function(){function e(){}return e.image=function(e,t){return"https://d1cuyjsrcm0gby.cloudfront.net/"+e+"/thumb-"+t+".jpg?origin=mapillary.webgl"},e.falcorModel=function(e){return"http://mapillary-vector.mapillary.io/v3/model.json?client_id="+e},e.mesh=function(e){return"https://d1cuyjsrcm0gby.cloudfront.net/"+e+"/sfm/v1.0/atomic_mesh.json"},e}();r.Urls=n,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n},{}],341:[function(e,t,r){var n=e("../Component"),i=function(){function e(e,t,r,i){var o=this;this._container=e,this._navigator=t,this._options=i,this._key=r,this._componentService=new n.ComponentService(this._container,this._navigator),r?this.initializeComponents():this._navigator.loadingService.loading$.filter(function(e){return e}).first().subscribe(function(e){o._navigator.stateService.start(),o._navigator.stateService.currentNode$.first().subscribe(function(e){o._key=e.key,o.initializeComponents()})})}return e.prototype.activateCover=function(){this._coverComponent.configure({loading:!1,visible:!0})},e.prototype.deactivateCover=function(){this._coverComponent.configure({loading:!0,visible:!0})},e.prototype.activate=function(e){this._componentService.activate(e)},e.prototype.deactivate=function(e){this._componentService.deactivate(e)},e.prototype.get=function(e){return this._componentService.get(e)},e.prototype.initializeComponents=function(){var e=this,t=this._options;this.uFalse(t.background,"background"),this.uFalse(t.debug,"debug"),this.uFalse(t.detection,"detection"),this.uFalse(t.image,"image"),this.uFalse(t.marker,"marker"),this.uFalse(t.navigation,"navigation"),this.uFalse(t.player,"player"),this.uFalse(t.route,"route"),this.uFalse(t.slider,"slider"),this.uTrue(t.attribution,"attribution"),this.uTrue(t.cache,"cache"),this.uTrue(t.direction,"direction"),this.uTrue(t.imageplane,"imageplane"),this.uTrue(t.keyboard,"keyboard"),this.uTrue(t.loading,"loading"),this.uTrue(t.mouse,"mouse"),this.uTrue(t.sequence,"sequence"),this._coverComponent=this._componentService.getCover(),this._coverComponent.configure({key:this._key}),void 0===t.cover||t.cover?this.activateCover():this.deactivateCover(),this._coverComponent.configuration$.subscribe(function(t){t.loading?e._navigator.moveToKey(t.key).subscribe(function(t){e._navigator.stateService.start(),e._coverComponent.configure({loading:!1,visible:!1}),e._componentService.deactivateCover()}):t.visible&&(e._navigator.stateService.stop(),e._componentService.activateCover())})},e.prototype.uFalse=function(e,t){return void 0===e?void this._componentService.deactivate(t):"boolean"==typeof e?void(e?this._componentService.activate(t):this._componentService.deactivate(t)):(this._componentService.configure(t,e),void this._componentService.activate(t))},e.prototype.uTrue=function(e,t){return void 0===e?void this._componentService.activate(t):"boolean"==typeof e?void(e?this._componentService.activate(t):this._componentService.deactivate(t)):(this._componentService.configure(t,e),void this._componentService.activate(t))},e}();r.ComponentController=i},{"../Component":252}],342:[function(e,t,r){var n=e("../Render"),i=e("../Viewer"),o=function(){function e(e,t){this.id=e,this.element=document.getElementById(e),this.element.classList.add("mapillary-js"),this.glRenderer=new n.GLRenderer(this.element,t),this.domRenderer=new n.DOMRenderer(this.element),this.mouseService=new i.MouseService(this.element)}return e}();r.Container=o,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o},{"../Render":258,"../Viewer":261}],343:[function(e,t,r){var n=function(){function e(e,t){var r=this;this._eventEmitter=e,this._navigator=t,this._loadingSubscription=this._navigator.loadingService.loading$.subscribe(function(e){r._eventEmitter.fire("loadingchanged",e)}),this._stateSubscription=this._navigator.stateService.currentNode$.subscribe(function(e){r._eventEmitter.fire("nodechanged",e)})}return e.prototype.dispose=function(){this._loadingSubscription.dispose(),this._stateSubscription.dispose()},e}();r.EventLauncher=n,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n},{}],344:[function(e,t,r){!function(e){e[e.Size320=320]="Size320",e[e.Size640=640]="Size640",e[e.Size1024=1024]="Size1024",e[e.Size2048=2048]="Size2048"}(r.ImageSize||(r.ImageSize={}));r.ImageSize},{}],345:[function(e,t,r){var n=e("underscore"),i=e("rx"),o=function(){function e(){this._loadersSubject$=new i.Subject,this._loaders$=this._loadersSubject$.scan(function(e,t){return void 0!==t.task&&(e[t.task]=t.loading),e},{}).startWith({}).shareReplay(1)}return Object.defineProperty(e.prototype,"loading$",{get:function(){return this._loaders$.map(function(e){return n.reduce(e,function(e,t){return e||t},!1)}).debounce(100).distinctUntilChanged()},enumerable:!0,configurable:!0}),e.prototype.taskLoading$=function(e){return this._loaders$.map(function(t){return!!t[e]}).debounce(100).distinctUntilChanged()},e.prototype.startLoading=function(e){this._loadersSubject$.onNext({loading:!0,task:e})},e.prototype.stopLoading=function(e){this._loadersSubject$.onNext({loading:!1,task:e})},e}();r.LoadingService=o,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o},{rx:195,underscore:197}],346:[function(e,t,r){var n=e("rx"),i=function(){function e(e){var t=this;this._mouseMoveOperation$=new n.Subject,this._claimMouse$=new n.Subject,this._element=e,this._mouseDown$=n.Observable.fromEvent(e,"mousedown"),this._mouseDown$.subscribe(function(e){e.preventDefault()}),this._mouseMove$=this._mouseMoveOperation$.scan(function(e,t){return t(e)},new MouseEvent("mousemove")),n.Observable.fromEvent(e,"mousemove").map(function(e){return function(t){return e.movementX=e.offsetX-t.offsetX,e.movementY=e.offsetY-t.offsetY,e}}).subscribe(this._mouseMoveOperation$),this._mouseLeave$=n.Observable.fromEvent(e,"mouseleave"),this._mouseUp$=n.Observable.fromEvent(e,"mouseup"),this._mouseOver$=n.Observable.fromEvent(e,"mouseover"),this._mouseWheel$=n.Observable.fromEvent(e,"wheel");var r=n.Observable.merge([this._mouseLeave$,this._mouseUp$,this._mouseOver$]);this._mouseDragStart$=this._mouseDown$.selectMany(function(e){return t._mouseMove$.takeUntil(r).take(1)}),this._mouseDrag$=this._mouseDown$.selectMany(function(e){return t._mouseMove$.skip(1).takeUntil(r)}),this._mouseDragEnd$=this._mouseDragStart$.selectMany(function(e){return r.first()}),this._mouseOwner$=this._claimMouse$.scan(function(e,t){return null==t.zindex?delete e[t.name]:e[t.name]=t.zindex,e},{}).map(function(e){var t=null,r=-1;for(var n in e)e.hasOwnProperty(n)&&e[n]>r&&(r=e[n],t=n);return t}).shareReplay(1).publish(),this._mouseOwner$.connect()}return e.prototype.claimMouse=function(e,t){this._claimMouse$.onNext({name:e,zindex:t})},e.prototype.unclaimMouse=function(e){this._claimMouse$.onNext({name:e,zindex:null})},e.prototype.filteredMouseEvent$=function(e,t){return t.combineLatest(this.mouseOwner$,function(e,t){return{e:e,owner:t}}).filter(function(t){return t.owner===e})},Object.defineProperty(e.prototype,"mouseOwner$",{get:function(){return this._mouseOwner$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseDown$",{get:function(){return this._mouseDown$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseMove$",{get:function(){return this._mouseMove$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseLeave$",{get:function(){return this._mouseLeave$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseUp$",{get:function(){return this._mouseUp$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseWheel$",{get:function(){return this._mouseWheel$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseDragStart$",{get:function(){return this._mouseDragStart$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseDrag$",{get:function(){return this._mouseDrag$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseDragEnd$",{get:function(){return this._mouseDragEnd$},enumerable:!0,configurable:!0}),e}();r.MouseService=i,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=i},{rx:195}],347:[function(e,t,r){var n=e("rx"),i=e("../API"),o=e("../Graph"),s=e("../State"),a=e("../Viewer"),u=function(){function e(e){this._keyRequested$=new n.BehaviorSubject(null),this._dirRequested$=new n.BehaviorSubject(null),this._latLonRequested$=new n.BehaviorSubject(null),this.apiV2=new i.APIv2(e),this.apiV3=new i.APIv3(e),this.graphService=new o.GraphService(this.apiV2,this.apiV3),this.stateService=new s.StateService,this.loadingService=new a.LoadingService}return e.prototype.moveToKey=function(e){var t=this;return this.loadingService.startLoading("navigator"),this._keyRequested$.onNext(e),this.graphService.node$(e).map(function(e){return t.loadingService.stopLoading("navigator"),t.stateService.setNodes([e]),e}).first()},e.prototype.moveDir=function(e){var t=this;return this.loadingService.startLoading("navigator"),this._dirRequested$.onNext(e),this.stateService.currentNode$.first().flatMap(function(r){return t.graphService.nextNode$(r,e).flatMap(function(e){return null==e?n.Observable.just(null):t.moveToKey(e.key)})}).first()},e.prototype.moveCloseTo=function(e,t){var r=this;return this.loadingService.startLoading("navigator"),this._latLonRequested$.onNext({lat:e,lon:t}),n.Observable.fromPromise(this.apiV2.search.im.close2(e,t)).flatMap(function(e){return null==e.key?n.Observable["throw"](new Error("no Image found")):r.moveToKey(e.key)}).first()},Object.defineProperty(e.prototype,"keyRequested$",{get:function(){return this._keyRequested$},enumerable:!0,configurable:!0}),e}();r.Navigator=u,Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=u},{"../API":251,"../Graph":256,"../State":259,"../Viewer":261,rx:195}],348:[function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("../Viewer"),o=e("../Utils"),s=e("when"),a=function(e){function t(t,r,n,s){void 0===s&&(s={}),this._navigator=new i.Navigator(r),this._container=new i.Container(t,this._navigator.stateService.currentState$),this._componentController=new i.ComponentController(this._container,this._navigator,n,s),this._eventLauncher=new i.EventLauncher(this,this._navigator),o.Settings.setOptions({}),e.call(this)}return n(t,e),t.prototype.moveToKey=function(e){var t=this;return s.promise(function(r,n){t._navigator.moveToKey(e).subscribe(function(e){r(e)},function(e){n(e)})})},t.prototype.moveDir=function(e){var t=this;return s.promise(function(r,n){t._navigator.moveDir(e).subscribe(function(e){r(e)},function(e){n(e)})})},t.prototype.moveCloseTo=function(e,t){var r=this;return s.promise(function(n,i){r._navigator.moveCloseTo(e,t).subscribe(function(e){n(e)},function(e){i(e)})})},t.prototype.activateComponent=function(e){this._componentController.activate(e)},t.prototype.deactivateComponent=function(e){this._componentController.deactivate(e)},t.prototype.getComponent=function(e){return this._componentController.get(e)},t.prototype.activateCover=function(){this._componentController.activateCover()},t.prototype.deactivateCover=function(){this._componentController.deactivateCover()},t.nodechanged="nodechanged",t.loadingchanged="loadingchanged",t}(o.EventEmitter);r.Viewer=a},{"../Utils":260,"../Viewer":261,when:250}],349:[function(e,t,r){},{}]},{},[257])(257)});
//# sourceMappingURL=mapillary-js.min.js.map
